<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Ê∑±Â∫¶Êé¢Á¥¢GoËØ≠Ë®Ä - Chuyu&#39;s Blog</title><meta name="Description" content="üòÅ"><meta property="og:title" content="Ê∑±Â∫¶Êé¢Á¥¢GoËØ≠Ë®Ä" />
<meta property="og:description" content="ÂâçË®ÄÔºöÁî®Êù•ËÆ∞ÂΩïGoÁöÑËØ≠Ë®ÄÁâπÊÄßÔºå‰∏ªË¶ÅÂèÇËÄÉ‰∏∫BÁ´ô„ÄäÂπºÈ∫üÂÆûÈ™åÂÆ§„ÄãÂèä„ÄäÊ∑±Â∫¶Êé¢Á¥¢GoËØ≠Ë®Ä„Äã„ÄÇ ‰∏Ä„ÄÅÂü∫Á°ÄÁü•ËØÜ 1.1 Êï∞ÊçÆÁªìÊûÑ 1.1.1 String ÁºñÁ†ÅÔºöÂÆöÈïøÁºñÁ†ÅÈùûÂ∏∏Êµ™Ë¥πÂÜÖÂ≠òÔºåÊâÄ‰ª•" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.seucy.me/10-%E6%B7%B1%E5%BA%A6%E6%8E%A2%E7%B4%A2go%E8%AF%AD%E8%A8%80/" /><meta property="og:image" content="https://blog.seucy.me/images/avatar.jpg"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-25T20:13:28+08:00" />
<meta property="article:modified_time" content="2023-04-25T20:13:28+08:00" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://blog.seucy.me/images/avatar.jpg"/>

<meta name="twitter:title" content="Ê∑±Â∫¶Êé¢Á¥¢GoËØ≠Ë®Ä"/>
<meta name="twitter:description" content="ÂâçË®ÄÔºöÁî®Êù•ËÆ∞ÂΩïGoÁöÑËØ≠Ë®ÄÁâπÊÄßÔºå‰∏ªË¶ÅÂèÇËÄÉ‰∏∫BÁ´ô„ÄäÂπºÈ∫üÂÆûÈ™åÂÆ§„ÄãÂèä„ÄäÊ∑±Â∫¶Êé¢Á¥¢GoËØ≠Ë®Ä„Äã„ÄÇ ‰∏Ä„ÄÅÂü∫Á°ÄÁü•ËØÜ 1.1 Êï∞ÊçÆÁªìÊûÑ 1.1.1 String ÁºñÁ†ÅÔºöÂÆöÈïøÁºñÁ†ÅÈùûÂ∏∏Êµ™Ë¥πÂÜÖÂ≠òÔºåÊâÄ‰ª•"/>
<meta name="application-name" content="Chuyu&#39;s Blog">
<meta name="apple-mobile-web-app-title" content="Chuyu&#39;s Blog"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/images/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://blog.seucy.me/10-%E6%B7%B1%E5%BA%A6%E6%8E%A2%E7%B4%A2go%E8%AF%AD%E8%A8%80/" /><link rel="prev" href="https://blog.seucy.me/%E4%BB%A3%E7%90%86/" /><link rel="next" href="https://blog.seucy.me/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AE%97%E6%B3%95/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Ê∑±Â∫¶Êé¢Á¥¢GoËØ≠Ë®Ä",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/blog.seucy.me\/10-%E6%B7%B1%E5%BA%A6%E6%8E%A2%E7%B4%A2go%E8%AF%AD%E8%A8%80\/"
        },"genre": "posts","keywords": "Go","wordcount":  74536 ,
        "url": "https:\/\/blog.seucy.me\/10-%E6%B7%B1%E5%BA%A6%E6%8E%A2%E7%B4%A2go%E8%AF%AD%E8%A8%80\/","datePublished": "2023-04-25T20:13:28+08:00","dateModified": "2023-04-25T20:13:28+08:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Chuyu"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Chuyu&#39;s Blog">·ì´ (¬∞‚åë¬∞) «É</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> ÂΩíÊ°£ </a><a class="menu-item" href="/tags/"> Ê†áÁ≠æ </a><a class="menu-item" href="/categories/"> ÂàÜÁ±ª </a><a class="menu-item" href="/about/"> ÂÖ≥‰∫é </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Chuyu&#39;s Blog">·ì´ (¬∞‚åë¬∞) «É</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">ÂΩíÊ°£</a><a class="menu-item" href="/tags/" title="">Ê†áÁ≠æ</a><a class="menu-item" href="/categories/" title="">ÂàÜÁ±ª</a><a class="menu-item" href="/about/" title="">ÂÖ≥‰∫é</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Ê∑±Â∫¶Êé¢Á¥¢GoËØ≠Ë®Ä</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Chuyu</a></span>&nbsp;<span class="post-category">included in <a href="/categories/go/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>Go</a>&nbsp;<a href="/categories/%E9%9D%A2%E8%AF%95/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>Èù¢ËØï</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2023-04-25">2023-04-25</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;74536 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;149 minutes&nbsp;<span id="/10-%E6%B7%B1%E5%BA%A6%E6%8E%A2%E7%B4%A2go%E8%AF%AD%E8%A8%80/" class="leancloud_visitors" data-flag-title="Ê∑±Â∫¶Êé¢Á¥¢GoËØ≠Ë®Ä">
                        <i class="far fa-eye fa-fw" aria-hidden="true"></i>&nbsp;<span class=leancloud-visitors-count></span>&nbsp;views
                    </span>&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#11-Êï∞ÊçÆÁªìÊûÑ">1.1 Êï∞ÊçÆÁªìÊûÑ</a>
      <ul>
        <li><a href="#111-string">1.1.1 String</a>
          <ul>
            <li><a href="#ÈóÆrune-Âíå-byte-ÁöÑÂå∫Âà´">ÈóÆÔºörune Âíå byte ÁöÑÂå∫Âà´Ôºü</a></li>
          </ul>
        </li>
        <li><a href="#112-slice">1.1.2 Slice</a>
          <ul>
            <li><a href="#1121-Êï∞ÊçÆÁªìÊûÑ">1.1.2.1 Êï∞ÊçÆÁªìÊûÑ</a></li>
            <li><a href="#1122-append">1.1.2.2 <code>append</code></a></li>
            <li><a href="#1123-Êâ©ÂÆπËßÑÂàô">1.1.2.3 ==Êâ©ÂÆπËßÑÂàô==</a></li>
            <li><a href="#ÈóÆslice-Âíå-array-ÊúâÂï•Âå∫Âà´">ÈóÆÔºöSlice Âíå Array ÊúâÂï•Âå∫Âà´Ôºü</a></li>
            <li><a href="#ÈóÆslice-ÁöÑÊÄßËÉΩÈô∑Èò±">ÈóÆÔºöSlice ÁöÑÊÄßËÉΩÈô∑Èò±Ôºü</a></li>
          </ul>
        </li>
        <li><a href="#113-ÁªìÊûÑ‰Ωì‰∏éÂÜÖÂ≠òÂØπÈΩê">1.1.3 ÁªìÊûÑ‰Ωì‰∏éÂÜÖÂ≠òÂØπÈΩê</a>
          <ul>
            <li><a href="#1131-ËÆøÈóÆÂÜÖÂ≠ò">1.1.3.1 ËÆøÈóÆÂÜÖÂ≠ò</a></li>
            <li><a href="#1132-ÂÜÖÂ≠òÂØπÈΩê">1.1.3.2 ÂÜÖÂ≠òÂØπÈΩê</a></li>
            <li><a href="#1133-ÁªìÊûÑ‰ΩìÂØπÈΩê">1.1.3.3 ÁªìÊûÑ‰ΩìÂØπÈΩê</a></li>
            <li><a href="#ÈóÆ‰ªÄ‰πàÊòØÂÜÖÂ≠òÂØπÈΩê">ÈóÆÔºö‰ªÄ‰πàÊòØÂÜÖÂ≠òÂØπÈΩêÔºü</a></li>
            <li><a href="#ÈóÆÂ¶Ç‰ΩïÁ°ÆÂÆöÊï∞ÊçÆÁ±ªÂûãÁöÑÂØπÈΩêËæπÁïå">ÈóÆÔºöÂ¶Ç‰ΩïÁ°ÆÂÆöÊï∞ÊçÆÁ±ªÂûãÁöÑÂØπÈΩêËæπÁïåÔºü</a></li>
            <li><a href="#ÈóÆ‰∏∫‰ªÄ‰πàË¶ÅÂÜÖÂ≠òÂØπÈΩê">ÈóÆÔºö‰∏∫‰ªÄ‰πàË¶ÅÂÜÖÂ≠òÂØπÈΩêÔºü</a></li>
          </ul>
        </li>
        <li><a href="#114-map">1.1.4 Map</a>
          <ul>
            <li><a href="#1141-Ê¶ÇËø∞">1.1.4.1 Ê¶ÇËø∞</a></li>
            <li><a href="#1142-Êï∞ÊçÆÁªìÊûÑ">1.1.4.2 Êï∞ÊçÆÁªìÊûÑ</a></li>
            <li><a href="#1143-ÂàùÂßãÂåñ">1.1.4.3 ÂàùÂßãÂåñ</a>
              <ul>
                <li><a href="#Â≠óÈù¢Èáè">==Â≠óÈù¢ÈáèÔºö==</a></li>
                <li><a href="#ËøêË°åÊó∂">==ËøêË°åÊó∂Ôºö==</a></li>
              </ul>
            </li>
            <li><a href="#1144-ËØªÂÜôÊìç‰Ωú">1.1.4.4 ËØªÂÜôÊìç‰Ωú</a>
              <ul>
                <li><a href="#ËÆøÈóÆ">==ËÆøÈóÆÔºö==</a></li>
                <li><a href="#ÂÜôÂÖ•">==ÂÜôÂÖ•Ôºö==</a></li>
              </ul>
            </li>
            <li><a href="#1145-Êâ©ÂÆπ">1.1.4.5 ‚≠êÊâ©ÂÆπ</a></li>
            <li><a href="#1145-Â∞èÁªì">1.1.4.5 Â∞èÁªì</a></li>
          </ul>
        </li>
        <li><a href="#115-syncmap">1.1.5 sync.map</a>
          <ul>
            <li><a href="#ÈóÆsyncmap-Âíå-mutexmap-ÊúâÂï•Âå∫Âà´syncmap-‰∏∫Âï•Ë¶ÅÊúâ‰ø©-mapreaddirty‰∏Ä‰∏™‰∏çË°åÂêó">ÈóÆÔºösync.map Âíå mutex+map ÊúâÂï•Âå∫Âà´Ôºüsync.map ‰∏∫Âï•Ë¶ÅÊúâ‰ø© map(read+dirty)Ôºü‰∏Ä‰∏™‰∏çË°åÂêóÔºü</a></li>
            <li><a href="#1151-Êü•ËØ¢Êï∞ÊçÆ">1.1.5.1 Êü•ËØ¢Êï∞ÊçÆ</a></li>
            <li><a href="#1152-Âà†Èô§Êï∞ÊçÆ">1.1.5.2 Âà†Èô§Êï∞ÊçÆ</a></li>
            <li><a href="#1153-Â¢ûÊîπÊï∞ÊçÆ">1.1.5.3 Â¢ûÊîπÊï∞ÊçÆ</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#12-ËØ≠Ë®ÄÂü∫Á°Ä">1.2 ËØ≠Ë®ÄÂü∫Á°Ä</a>
      <ul>
        <li><a href="#121-ÂáΩÊï∞Ë∞ÉÁî®">1.2.1 ÂáΩÊï∞Ë∞ÉÁî®</a>
          <ul>
            <li><a href="#1211-Ê†àÂ∏ßÂ∏ÉÂ±Ä">1.2.1.1 Ê†àÂ∏ßÂ∏ÉÂ±Ä</a></li>
            <li><a href="#1212-‰º†ÂèÇ‰∏éËøîÂõûÂÄº">1.2.1.2 ‰º†ÂèÇ‰∏éËøîÂõûÂÄº</a>
              <ul>
                <li><a href="#‰º†ÂÄº‰∏é‰º†ÂºïÁî®">==‰º†ÂÄº‰∏é‰º†ÂºïÁî®Ôºö==</a></li>
                <li><a href="#‰º†ÂèÇ">==‰º†ÂèÇÔºö==</a></li>
                <li><a href="#ËøîÂõûÂÄº">==ËøîÂõûÂÄºÔºö==</a></li>
              </ul>
            </li>
            <li><a href="#1213-Â∞èÁªì">1.2.1.3 Â∞èÁªì</a></li>
          </ul>
        </li>
        <li><a href="#122-Èó≠ÂåÖ">1.2.2 Èó≠ÂåÖ</a></li>
        <li><a href="#123-ÊñπÊ≥ï">1.2.3 ÊñπÊ≥ï</a>
          <ul>
            <li><a href="#1231-ÊñπÊ≥ïÁöÑÊú¨Ë¥®">1.2.3.1 ÊñπÊ≥ïÁöÑÊú¨Ë¥®</a></li>
            <li><a href="#1232-ÊñπÊ≥ïË∞ÉÁî®">1.2.3.2 ÊñπÊ≥ïË∞ÉÁî®</a></li>
            <li><a href="#1233-ÊñπÊ≥ïË°®ËææÂºèÂíåÊñπÊ≥ïÂèòÈáè">1.2.3.3 ÊñπÊ≥ïË°®ËææÂºèÂíåÊñπÊ≥ïÂèòÈáè</a></li>
          </ul>
        </li>
        <li><a href="#124-Êé•Âè£">1.2.4 Êé•Âè£</a>
          <ul>
            <li><a href="#1241-Ê¶ÇËø∞">1.2.4.1 Ê¶ÇËø∞</a></li>
            <li><a href="#1242-Êï∞ÊçÆÁªìÊûÑ">1.2.4.2 Êï∞ÊçÆÁªìÊûÑ</a></li>
          </ul>
        </li>
        <li><a href="#125-Á±ªÂûãÊñ≠Ë®Ä">1.2.5 Á±ªÂûãÊñ≠Ë®Ä</a>
          <ul>
            <li><a href="#1251-Á©∫Êé•Âè£ÂÖ∑‰ΩìÁ±ªÂûã">1.2.5.1 Á©∫Êé•Âè£.(ÂÖ∑‰ΩìÁ±ªÂûã)</a></li>
            <li><a href="#1252-ÈùûÁ©∫Êé•Âè£ÂÖ∑‰ΩìÁ±ªÂûã">1.2.5.2 ÈùûÁ©∫Êé•Âè£.(ÂÖ∑‰ΩìÁ±ªÂûã)</a></li>
            <li><a href="#1253-Á©∫Êé•Âè£ÈùûÁ©∫Êé•Âè£">1.2.5.3 Á©∫Êé•Âè£.(ÈùûÁ©∫Êé•Âè£)</a></li>
            <li><a href="#1254-ÈùûÁ©∫Êé•Âè£ÈùûÁ©∫Êé•Âè£">1.2.5.4 ÈùûÁ©∫Êé•Âè£.(ÈùûÁ©∫Êé•Âè£)</a></li>
            <li><a href="#1255-Â∞èÁªì">1.2.5.5 Â∞èÁªì</a></li>
          </ul>
        </li>
        <li><a href="#126-ÂèçÂ∞Ñ">1.2.6 ÂèçÂ∞Ñ</a>
          <ul>
            <li><a href="#1261-‰∏âÂ§ßÊ≥ïÂàô">1.2.6.1 ‰∏âÂ§ßÊ≥ïÂàô</a>
              <ul>
                <li><a href="#Ê≥ïÂàô1">Ê≥ïÂàô1</a></li>
                <li><a href="#Ê≥ïÂàô2">Ê≥ïÂàô2</a></li>
                <li><a href="#Ê≥ïÂàô3">Ê≥ïÂàô3</a></li>
              </ul>
            </li>
            <li><a href="#1262-Á±ªÂûãÂíåÂÄº">1.2.6.2 Á±ªÂûãÂíåÂÄº</a>
              <ul>
                <li><a href="#typeof">TypeOf</a>
                  <ul>
                    <li><a href="#Â¶Ç‰Ωï‰º†ÈÄíÂèÇÊï∞">Â¶Ç‰Ωï‰º†ÈÄíÂèÇÊï∞</a></li>
                    <li><a href="#ËøîÂõûÂÄºÊòØ‰ªÄ‰πà">ËøîÂõûÂÄºÊòØ‰ªÄ‰πàÔºü</a></li>
                  </ul>
                </li>
                <li><a href="#valueof">ValueOf</a>
                  <ul>
                    <li><a href="#ÂèÇÊï∞‰º†ÈÄí">ÂèÇÊï∞‰º†ÈÄí</a></li>
                  </ul>
                </li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#127-ÊñπÊ≥ïÈõÜ">1.2.7 ÊñπÊ≥ïÈõÜ</a>
          <ul>
            <li><a href="#ÈóÆÈ¢òtÂíåtÁöÑÊñπÊ≥ïÈõÜÊòØÂï•ÂÖ≥Á≥ª"><strong>ÈóÆÈ¢òÔºö</strong><code>T</code>Âíå<code>*T</code>ÁöÑÊñπÊ≥ïÈõÜÊòØÂï•ÂÖ≥Á≥ªÔºü</a></li>
          </ul>
        </li>
        <li><a href="#128-Ê≥õÂûã">1.2.8 Ê≥õÂûã</a>
          <ul>
            <li><a href="#go-117">go 1.17</a></li>
            <li><a href="#go-118">go 1.18</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#13-Â∏∏Áî®ÂÖ≥ÈîÆÂ≠ó">1.3 Â∏∏Áî®ÂÖ≥ÈîÆÂ≠ó</a>
      <ul>
        <li><a href="#131-defer">1.3.1 defer</a>
          <ul>
            <li>
              <ul>
                <li><a href="#ÊâßË°åÈ°∫Â∫è">==ÊâßË°åÈ°∫Â∫è==</a></li>
                <li><a href="#È¢ÑËÆ°ÁÆóÂèÇÊï∞">==È¢ÑËÆ°ÁÆóÂèÇÊï∞==</a></li>
              </ul>
            </li>
            <li><a href="#1311-Êï∞ÊçÆÁªìÊûÑ">1.3.1.1 Êï∞ÊçÆÁªìÊûÑ</a></li>
            <li><a href="#1312-ÊâßË°åÊú∫Âà∂">1.3.1.2 ÊâßË°åÊú∫Âà∂</a></li>
            <li><a href="#1313-Â†ÜÂàÜÈÖç">1.3.1.3 Â†ÜÂàÜÈÖç</a></li>
            <li><a href="#1314-Ê†à‰∏äÂàÜÈÖç">1.3.1.4 Ê†à‰∏äÂàÜÈÖç</a></li>
            <li><a href="#1315-ÂºÄÊîæÁºñÁ†Å">1.3.1.5 ÂºÄÊîæÁºñÁ†Å</a></li>
            <li><a href="#1316-Â∞èÁªì">1.3.1.6 Â∞èÁªì</a></li>
          </ul>
        </li>
        <li><a href="#132-panicÂíårecover">1.3.2 panicÂíårecover</a>
          <ul>
            <li><a href="#1321-Áé∞Ë±°">1.3.2.1 Áé∞Ë±°</a>
              <ul>
                <li><a href="#Ë∑®ÂçèÁ®ãÂ§±Êïà">Ë∑®ÂçèÁ®ãÂ§±Êïà</a></li>
                <li><a href="#Â§±ÊïàÁöÑÂ¥©Ê∫ÉÊÅ¢Â§ç">Â§±ÊïàÁöÑÂ¥©Ê∫ÉÊÅ¢Â§ç</a></li>
                <li><a href="#ÂµåÂ•óÂ¥©Ê∫É">ÂµåÂ•óÂ¥©Ê∫É</a></li>
              </ul>
            </li>
            <li><a href="#1322-Êï∞ÊçÆÁªìÊûÑ">1.3.2.2 Êï∞ÊçÆÁªìÊûÑ</a></li>
            <li><a href="#1323-recover">1.3.2.3 recover</a></li>
            <li><a href="#Â∞èÁªì">Â∞èÁªì</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#21-Âπ∂ÂèëÁºñÁ®ã">2.1 Âπ∂ÂèëÁºñÁ®ã</a>
      <ul>
        <li><a href="#211-gmp">2.1.1 GMP</a>
          <ul>
            <li><a href="#2111-Ê¶ÇËø∞">2.1.1.1 Ê¶ÇËø∞</a>
              <ul>
                <li><a href="#È¶ñÂÖàÁúã‰∏Ä‰∏™ÁÆÄÂçïÁöÑÂú∫ÊôØ">È¶ñÂÖàÁúã‰∏Ä‰∏™ÁÆÄÂçïÁöÑÂú∫ÊôØ</a></li>
                <li><a href="#‰∏Ä‰∏™ÊîπËøõÁöÑÂú∫ÊôØ">‰∏Ä‰∏™ÊîπËøõÁöÑÂú∫ÊôØ</a></li>
              </ul>
            </li>
            <li><a href="#2112-goroutineÂàõÂª∫ËÆ©Âá∫‰∏éÊÅ¢Â§ç">2.1.1.2 goroutineÂàõÂª∫„ÄÅËÆ©Âá∫‰∏éÊÅ¢Â§ç</a></li>
            <li><a href="#2113-goroutineËÆ©Âá∫Êä¢Âç†ÁõëÊéßÂíåË∞ÉÂ∫¶">2.1.1.3 goroutineËÆ©Âá∫„ÄÅÊä¢Âç†„ÄÅÁõëÊéßÂíåË∞ÉÂ∫¶</a>
              <ul>
                <li><a href="#‰∏ªÂä®ËÆ©Âá∫">‰∏ªÂä®ËÆ©Âá∫</a></li>
                <li><a href="#Êä¢Âç†">Êä¢Âç†</a></li>
                <li><a href="#Ë∞ÉÂ∫¶">Ë∞ÉÂ∫¶</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#212-mutex">2.1.2 Mutex</a>
          <ul>
            <li><a href="#2121-‰∏§ÁßçÊ®°Âºè">2.1.2.1 ‰∏§ÁßçÊ®°Âºè</a></li>
            <li><a href="#2122-lockÂíåunlock">2.1.2.2 LockÂíåUnlock</a></li>
            <li><a href="#2123-slow-path">2.1.2.3 Slow path</a></li>
            <li><a href="#ÈóÆgoroutine-Ëá™ÊóãÁöÑÊù°‰ª∂">ÈóÆÔºöGoroutine Ëá™ÊóãÁöÑÊù°‰ª∂Ôºü</a>
              <ul>
                <li><a href="#lockÊìç‰ΩúÁöÑslow-path">LockÊìç‰ΩúÁöÑ<code>Slow path</code></a></li>
                <li><a href="#unlockÊìç‰ΩúÁöÑslow-path">UnlockÊìç‰ΩúÁöÑSlow path</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#213-‰ø°Âè∑Èáè">2.1.3 ‰ø°Âè∑Èáè</a>
          <ul>
            <li><a href="#ÈóÆÈ¢òÂçèÁ®ãÁ≠âÂæÖ‰∏Ä‰∏™ÈîÅÊó∂Ë¶ÅÂ¶Ç‰Ωï‰ºëÁú†Á≠âÂæÖÂíåÂî§ÈÜíÂë¢">**ÈóÆÈ¢òÔºö**ÂçèÁ®ãÁ≠âÂæÖ‰∏Ä‰∏™ÈîÅÊó∂ÔºåË¶ÅÂ¶Ç‰Ωï‰ºëÁú†„ÄÅÁ≠âÂæÖÂíåÂî§ÈÜíÂë¢Ôºü</a></li>
          </ul>
        </li>
        <li><a href="#214-Êä¢Âç†ÂºèË∞ÉÂ∫¶">2.1.4 Êä¢Âç†ÂºèË∞ÉÂ∫¶</a>
          <ul>
            <li><a href="#2141-go-113">2.1.4.1 Go 1.13</a></li>
            <li><a href="#ÈóÆÈ¢ò‰∏∫‰ªÄ‰πà‰ºöÈô∑ÂÖ•ËøôÊ†∑ÁöÑÂ±ÄÈù¢">**ÈóÆÈ¢òÔºö**‰∏∫‰ªÄ‰πà‰ºöÈô∑ÂÖ•ËøôÊ†∑ÁöÑÂ±ÄÈù¢Ôºü</a></li>
            <li><a href="#2142-go-114-‰πãÂêé">2.1.4.2 Go 1.14 ‰πãÂêé</a>
              <ul>
                <li><a href="#‰ø°Âè∑ÂèëÈÄÅ">‰ø°Âè∑ÂèëÈÄÅ</a></li>
                <li><a href="#‰ø°Âè∑Â§ÑÁêÜ">‰ø°Âè∑Â§ÑÁêÜ</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#215-channel">2.1.5 Channel</a>
          <ul>
            <li><a href="#2151-Êï∞ÊçÆÁªìÊûÑ">2.1.5.1 Êï∞ÊçÆÁªìÊûÑ</a></li>
            <li><a href="#ÈóÆchannelÂ∫ïÂ±ÇÊï∞ÊçÆÁªìÊûÑÊòØÊÄé‰πàËÆæËÆ°ÁöÑ">ÈóÆÔºö<code>channel</code>Â∫ïÂ±ÇÊï∞ÊçÆÁªìÊûÑÊòØÊÄé‰πàËÆæËÆ°ÁöÑÔºü</a></li>
            <li><a href="#2152-ÂèëÈÄÅÊï∞ÊçÆ">2.1.5.2 ÂèëÈÄÅÊï∞ÊçÆ</a>
              <ul>
                <li><a href="#ÈòªÂ°ûÂºèÂèëÈÄÅ">ÈòªÂ°ûÂºèÂèëÈÄÅ</a></li>
                <li><a href="#ÈùûÈòªÂ°ûÂºèÂèëÈÄÅ">ÈùûÈòªÂ°ûÂºèÂèëÈÄÅ</a></li>
              </ul>
            </li>
            <li><a href="#2153-Êé•Êî∂Êï∞ÊçÆ">2.1.5.3 Êé•Êî∂Êï∞ÊçÆ</a>
              <ul>
                <li><a href="#ÈòªÂ°ûÂºèÊé•Êî∂">ÈòªÂ°ûÂºèÊé•Êî∂</a></li>
                <li><a href="#ÈùûÈòªÂ°ûÂºèÊé•Êî∂">ÈùûÈòªÂ°ûÂºèÊé•Êî∂</a></li>
              </ul>
            </li>
            <li><a href="#2154-Â§öË∑Øselect">2.1.5.4 Â§öË∑Øselect</a></li>
          </ul>
        </li>
        <li><a href="#216-ÂçèÁ®ã">2.1.6 ÂçèÁ®ã</a></li>
      </ul>
    </li>
    <li><a href="#22-ÂÜÖÂ≠òÁÆ°ÁêÜ">2.2 ÂÜÖÂ≠òÁÆ°ÁêÜ</a>
      <ul>
        <li><a href="#221-ÂÜÖÂ≠òÂàÜÈÖçÂô®">2.2.1 ÂÜÖÂ≠òÂàÜÈÖçÂô®</a>
          <ul>
            <li><a href="#2211-ËÆæËÆ°ÂéüÁêÜ">2.2.1.1 ËÆæËÆ°ÂéüÁêÜ</a></li>
          </ul>
        </li>
        <li><a href="#222-gc">2.2.2 GC</a>
          <ul>
            <li><a href="#ÈóÆÈ¢ò‰∏∫‰ªÄ‰πàÈúÄË¶ÅÂûÉÂúæÂõûÊî∂"><strong>ÈóÆÈ¢òÔºö‰∏∫‰ªÄ‰πàÈúÄË¶ÅÂûÉÂúæÂõûÊî∂Ôºü</strong></a></li>
            <li><a href="#2221-ËÆæËÆ°ÂéüÁêÜ">2.2.2.1 ËÆæËÆ°ÂéüÁêÜ</a></li>
            <li><a href="#ÈóÆÈ¢òËá™Âä®ÂûÉÂúæÂõûÊî∂ÊÄé‰πàÂå∫ÂàÜÂì™‰∫õÊï∞ÊçÆÊòØÂûÉÂúæÂë¢"><strong>ÈóÆÈ¢òÔºöËá™Âä®ÂûÉÂúæÂõûÊî∂ÊÄé‰πàÂå∫ÂàÜÂì™‰∫õÊï∞ÊçÆÊòØÂûÉÂúæÂë¢Ôºü</strong></a>
              <ul>
                <li><a href="#Ê†áËÆ∞-Ê∏ÖÊâ´ÁÆóÊ≥ï">Ê†áËÆ∞-Ê∏ÖÊâ´ÁÆóÊ≥ï</a>
                  <ul>
                    <li><a href="#‰∏âËâ≤ÊäΩË±°">‰∏âËâ≤ÊäΩË±°</a></li>
                  </ul>
                </li>
                <li><a href="#Â§çÂà∂ÂõûÊî∂ÁÆóÊ≥ï">Â§çÂà∂ÂõûÊî∂ÁÆóÊ≥ï</a>
                  <ul>
                    <li><a href="#ÂàÜ‰ª£ÂõûÊî∂">ÂàÜ‰ª£ÂõûÊî∂</a></li>
                  </ul>
                </li>
                <li><a href="#ÂºïÁî®ËÆ°Êï∞Âºè">ÂºïÁî®ËÆ°Êï∞Âºè</a></li>
                <li><a href="#Â¢ûÈáèÂºèÂûÉÂúæÂõûÊî∂">Â¢ûÈáèÂºèÂûÉÂúæÂõûÊî∂</a></li>
                <li><a href="#Âº∫‰∏âËâ≤‰∏çÂèòÂºè‰∏éÂº±‰∏âËâ≤‰∏çÂèòÂºè">Âº∫‰∏âËâ≤‰∏çÂèòÂºè‰∏éÂº±‰∏âËâ≤‰∏çÂèòÂºè</a></li>
                <li><a href="#ËØªÂÜôÂ±èÈöú">ËØªÂÜôÂ±èÈöú</a></li>
                <li><a href="#Â§öÊ†∏">Â§öÊ†∏</a></li>
              </ul>
            </li>
            <li><a href="#2222-go">2.2.2.2 Go</a></li>
            <li><a href="#ÈóÆÈ¢ò"><strong>ÈóÆÈ¢òÔºö</strong></a></li>
            <li><a href="#ÈóÆÈ¢ò‰∏∫‰ªÄ‰πàË¶ÅÂä†ÂÖ•Âà†Èô§ÂÜôÂ±èÈöú"><strong>ÈóÆÈ¢òÔºö‰∏∫‰ªÄ‰πàË¶ÅÂä†ÂÖ•Âà†Èô§ÂÜôÂ±èÈöúÔºü</strong></a></li>
          </ul>
        </li>
        <li><a href="#223-Â†ÜÂÜÖÂ≠òÂàÜÈÖç">2.2.3 Â†ÜÂÜÖÂ≠òÂàÜÈÖç</a>
          <ul>
            <li><a href="#2231-Êï∞ÊçÆÁªìÊûÑ">2.2.3.1 Êï∞ÊçÆÁªìÊûÑ</a></li>
            <li><a href="#2232-ÂàÜÈÖçÁ≠ñÁï•">2.2.3.2 ÂàÜÈÖçÁ≠ñÁï•</a></li>
            <li><a href="#2233-‰ΩçÂõæÊ†áËÆ∞">2.2.3.3 ‰ΩçÂõæÊ†áËÆ∞</a></li>
            <li><a href="#ÈóÆÈ¢òÈÄöËøá‰∏Ä‰∏™Â†ÜÂÜÖÂ≠òÂú∞ÂùÄÂ¶Ç‰ΩïÊâæÂà∞ÂØπÂ∫îÁöÑheaparenaÂíåmspan">**ÈóÆÈ¢òÔºö**ÈÄöËøá‰∏Ä‰∏™Â†ÜÂÜÖÂ≠òÂú∞ÂùÄÔºåÂ¶Ç‰ΩïÊâæÂà∞ÂØπÂ∫îÁöÑ<code>heapArena</code>Âíå<code>mspan</code>Ôºü</a></li>
            <li><a href="#2234-Êî∂Â∞æÂ∑•‰Ωú">2.2.3.4 Êî∂Â∞æÂ∑•‰Ωú</a></li>
          </ul>
        </li>
        <li><a href="#224-Ê†àÂÜÖÂ≠òÂàÜÈÖç">2.2.4 Ê†àÂÜÖÂ≠òÂàÜÈÖç</a>
          <ul>
            <li><a href="#2241-Ê†àÂÜÖÂ≠òÂàÜÈÖçËøáÁ®ã">2.2.4.1 Ê†àÂÜÖÂ≠òÂàÜÈÖçËøáÁ®ã</a></li>
            <li><a href="#2242-Ê†àÂ¢ûÈïø">2.2.4.2 Ê†àÂ¢ûÈïø</a></li>
            <li><a href="#2243-Ê†àÊî∂Áº©">2.2.4.3 Ê†àÊî∂Áº©</a></li>
            <li><a href="#2244-Ê†àÈáäÊîæ">2.2.4.4 Ê†àÈáäÊîæ</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#31-goroutineË∞ÉÂ∫¶">3.1 <code>GoroutineË∞ÉÂ∫¶</code></a>
      <ul>
        <li>
          <ul>
            <li><a href="#È¢òÁõÆ1">È¢òÁõÆÔºö1</a></li>
            <li><a href="#È¢òÁõÆ2">È¢òÁõÆÔºö2</a></li>
            <li><a href="#ÈóÆÁ≠îÈ¢òÈõÜÂêà">ÈóÆÁ≠îÈ¢òÈõÜÂêà</a></li>
            <li><a href="#ÈóÆgpmÊ®°Âûã‰∏≠pÂºïÂÖ•ÁöÑÂéüÂõ†"><strong>ÈóÆÔºöGPMÊ®°Âûã‰∏≠ÔºåPÂºïÂÖ•ÁöÑÂéüÂõ†Ôºü</strong></a></li>
            <li><a href="#ÈóÆÂ§ö‰∏™Á∫øÁ®ãÂèØ‰ª•Â±û‰∫éÂêå‰∏Ä‰∏™ËøõÁ®ãÂπ∂ÂÖ±‰∫´ÂÜÖÂ≠òÁ©∫Èó¥"><strong>ÈóÆÔºöÂ§ö‰∏™Á∫øÁ®ãÂèØ‰ª•Â±û‰∫éÂêå‰∏Ä‰∏™ËøõÁ®ãÂπ∂ÂÖ±‰∫´ÂÜÖÂ≠òÁ©∫Èó¥„ÄÇ</strong></a></li>
            <li><a href="#ÈóÆË∞ÅË¥üË¥£Ëß¶ÂèëtimerÊ≥®ÂÜåÁöÑÂõûË∞ÉÂáΩÊï∞">**ÈóÆÔºö**Ë∞ÅË¥üË¥£Ëß¶Âèë<code>timer</code>Ê≥®ÂÜåÁöÑÂõûË∞ÉÂáΩÊï∞Ôºü</a></li>
            <li><a href="#ÈóÆÂ¶Ç‰ΩïÊä¢Âç†ÂÖ∑‰ΩìËØ¥ËØ¥"><strong>ÈóÆÔºö<strong>Â¶Ç‰Ωï</strong>Êä¢Âç†</strong>ÔºüÂÖ∑‰ΩìËØ¥ËØ¥Ôºü</a></li>
            <li><a href="#ÈóÆÈÇ£Êä¢Âç†Êó∂ÊÄé‰πàÁü•ÈÅìÊüê‰∏™gËøêË°åÊó∂Èó¥ËøáÈïø‰∫ÜÂë¢">**ÈóÆÔºö**ÈÇ£Êä¢Âç†Êó∂ÔºåÊÄé‰πàÁü•ÈÅìÊüê‰∏™<code>g</code>ËøêË°åÊó∂Èó¥ËøáÈïø‰∫ÜÂë¢Ôºü</a></li>
            <li><a href="#ÈóÆÂ¶Ç‰ΩïË∞ÉÂ∫¶Â±ïÂºÄËØ¥ËØ¥"><strong>ÈóÆÔºö<strong>Â¶Ç‰Ωï</strong>Ë∞ÉÂ∫¶</strong>ÔºüÂ±ïÂºÄËØ¥ËØ¥Ôºü</a></li>
            <li><a href="#ÈóÆ">ÈóÆÔºö</a></li>
            <li><a href="#ÈóÆgoroutine-‰ªÄ‰πàÊó∂ÂÄô‰ºöÂèëÁîüÊ≥ÑÊºèÊÄé‰πàÂèëÁé∞goroutine-Ë¢´Âç†Êª°‰∫ÜÊÄé‰πàÂäû">ÈóÆÔºöGoroutine ‰ªÄ‰πàÊó∂ÂÄô‰ºöÂèëÁîüÊ≥ÑÊºèÔºüÊÄé‰πàÂèëÁé∞ÔºüGoroutine Ë¢´Âç†Êª°‰∫ÜÊÄé‰πàÂäûÔºüüö©‚≠ê</a></li>
            <li><a href="#ÈóÆÂ¶Ç‰ΩïÊéßÂà∂ÂçèÁ®ãÁöÑÂπ∂ÂèëÊï∞Èáè">ÈóÆÔºöÂ¶Ç‰ΩïÊéßÂà∂ÂçèÁ®ãÁöÑÂπ∂ÂèëÊï∞ÈáèÔºü</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#32-ÁªÑÂêàÂºèÁªßÊâø">3.2 ÁªÑÂêàÂºèÁªßÊâø</a>
      <ul>
        <li>
          <ul>
            <li><a href="#ÈóÆÂ¶Ç‰∏ã‰ª£Á†ÅËæìÂá∫‰ªÄ‰πà">ÈóÆÔºöÂ¶Ç‰∏ã‰ª£Á†ÅËæìÂá∫‰ªÄ‰πàÔºü</a></li>
            <li><a href="#ÈóÆÁªÑÂêàÂºèÁªßÊâø‰∏≠ÁºñËØëÂô®ÁîüÊàêÂåÖË£ÖÊñπÊ≥ïÁöÑËßÑÂàô">ÈóÆÔºöÁªÑÂêàÂºèÁªßÊâø‰∏≠ÔºåÁºñËØëÂô®ÁîüÊàêÂåÖË£ÖÊñπÊ≥ïÁöÑËßÑÂàôÔºü</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#33-Èó≠ÂåÖ">3.3 Èó≠ÂåÖ</a></li>
    <li><a href="#34-gc">3.4 GC</a>
      <ul>
        <li>
          <ul>
            <li><a href="#ÈóÆËá™Âä®ÂûÉÂúæÂõûÊî∂ÊÄé‰πàÂå∫ÂàÜÂì™‰∫õÊï∞ÊçÆÊòØÂûÉÂúæÂë¢"><strong>ÈóÆÔºöËá™Âä®ÂûÉÂúæÂõûÊî∂ÊÄé‰πàÂå∫ÂàÜÂì™‰∫õÊï∞ÊçÆÊòØÂûÉÂúæÂë¢Ôºü</strong></a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#35-mutex">3.5 Mutex</a>
      <ul>
        <li>
          <ul>
            <li><a href="#ÈóÆrwmutex-ÊòØËØª‰ºòÂÖàËøòÊòØÂÜô‰ºòÂÖàËØª‰ºòÂÖàÁöÑËØùÂ¶ÇÊûú‰∏ÄÁõ¥ÊúâËØªËØ∑Ê±ÇÈÇ£‰πàÂÜôËØ∑Ê±Ç‰ºöÈ••È•øÂêó">ÈóÆÔºöRWMutex ÊòØËØª‰ºòÂÖàËøòÊòØÂÜô‰ºòÂÖàÔºüËØª‰ºòÂÖàÁöÑËØùÔºåÂ¶ÇÊûú‰∏ÄÁõ¥ÊúâËØªËØ∑Ê±ÇÔºåÈÇ£‰πàÂÜôËØ∑Ê±Ç‰ºöÈ••È•øÂêóÔºü‚≠êüö©</a></li>
            <li><a href="#ÈóÆmutexÁöÑÂ∑•‰ΩúÊ®°ÂºèÊ≠£Â∏∏Ê®°ÂºèÂíåÈ••È•øÊ®°Âºè">ÈóÆÔºöMutexÁöÑÂ∑•‰ΩúÊ®°ÂºèÔºüÊ≠£Â∏∏Ê®°ÂºèÂíåÈ••È•øÊ®°ÂºèÔºü</a></li>
            <li><a href="#ÈóÆ‰ªÄ‰πàÊó∂ÂÄô‰ºöÂèëÁîüËá™Êóã">ÈóÆÔºö‰ªÄ‰πàÊó∂ÂÄô‰ºöÂèëÁîüËá™ÊóãÔºü</a></li>
            <li><a href="#ÈóÆ‰∏∫‰ªÄ‰πàËá™ÊóãÊ¨°Êï∞Êúâ‰∏äÈôê">ÈóÆÔºö‰∏∫‰ªÄ‰πàËá™ÊóãÊ¨°Êï∞Êúâ‰∏äÈôêÔºü</a></li>
            <li><a href="#ÈóÆÂçèÁ®ãÊòØÂ¶Ç‰ΩïËøõË°åÊéíÈòüÁöÑÂë¢">ÈóÆÔºöÂçèÁ®ãÊòØÂ¶Ç‰ΩïËøõË°åÊéíÈòüÁöÑÂë¢Ôºü</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#36-ÊñπÊ≥ïÈõÜ">3.6 ÊñπÊ≥ïÈõÜ</a>
      <ul>
        <li>
          <ul>
            <li><a href="#ÈóÆ‰∏∫‰ªÄ‰πàË¶ÅÈôêÂà∂-t-Âíå-t-‰∏çËÉΩÂ£∞ÊòéÂêåÂêçÊñπÊ≥ï">ÈóÆÔºö‰∏∫‰ªÄ‰πàË¶ÅÈôêÂà∂ <code>T</code> Âíå <code>*T</code> ‰∏çËÉΩÂ£∞ÊòéÂêåÂêçÊñπÊ≥ïÔºü</a></li>
            <li><a href="#ÈóÆ‰∏∫‰ªÄ‰πàÁºñËØëÂô®Ë¶Å‰∏∫-t-ÁîüÊàê-t-ÁöÑÂêåÂêçÊñπÊ≥ï">ÈóÆÔºö‰∏∫‰ªÄ‰πàÁºñËØëÂô®Ë¶Å‰∏∫ <code>*T</code> ÁîüÊàê <code>T</code> ÁöÑÂêåÂêçÊñπÊ≥ïÔºü</a></li>
            <li><a href="#ÈóÆ‰∏∫‰ªÄ‰πàÊòØ‰∏∫‰∫ÜÊîØÊåÅÊé•Âè£">ÈóÆÔºö‰∏∫‰ªÄ‰πàÊòØ‰∏∫‰∫ÜÊîØÊåÅÊé•Âè£Ôºü</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#37-Êä¢Âç†ÂºèË∞ÉÂ∫¶">3.7 Êä¢Âç†ÂºèË∞ÉÂ∫¶</a>
      <ul>
        <li>
          <ul>
            <li><a href="#ÈóÆÂ¶Ç‰ΩïËøõË°åÊä¢Âç†ÂºèË∞ÉÂ∫¶">ÈóÆÔºöÂ¶Ç‰ΩïËøõË°åÊä¢Âç†ÂºèË∞ÉÂ∫¶Ôºü</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#38-channel">3.8 Channel</a>
      <ul>
        <li>
          <ul>
            <li><a href="#ÈóÆchannel-ÊòØÂê¶ÊòØÂπ∂ÂèëÂÆâÂÖ®ÁöÑ">ÈóÆÔºöchannel ÊòØÂê¶ÊòØÂπ∂ÂèëÂÆâÂÖ®ÁöÑÔºü</a></li>
            <li><a href="#ÈóÆÊÄé‰πàÈÄöËøá-channel-ÂÆûÁé∞ÂçèÁ®ãÈó¥ÁöÑÈÄö‰ø°">ÈóÆÔºöÊÄé‰πàÈÄöËøá channel ÂÆûÁé∞ÂçèÁ®ãÈó¥ÁöÑÈÄö‰ø°Ôºü</a></li>
            <li><a href="#ÈóÆÂêëÂ∑≤ÂÖ≥Èó≠ÁöÑ-channel-ÂÜô-‰ºöÂèëÁîü‰ªÄ‰πà‰ªéÂ∑≤ÂÖ≥Èó≠ÁöÑ-channel-ËØª-‰ºöÂèëÁîü‰ªÄ‰πà">ÈóÆÔºöÂêëÂ∑≤ÂÖ≥Èó≠ÁöÑ channel ÂÜô ‰ºöÂèëÁîü‰ªÄ‰πàÔºü‰ªéÂ∑≤ÂÖ≥Èó≠ÁöÑ channel ËØª ‰ºöÂèëÁîü‰ªÄ‰πàÔºü‚≠ê</a></li>
            <li><a href="#ÈóÆÂ¶Ç‰Ωï‰ºòÈõÖÂÖ≥Èó≠‰∏Ä‰∏™-channel">ÈóÆÔºöÂ¶Ç‰Ωï‰ºòÈõÖÂÖ≥Èó≠‰∏Ä‰∏™ ChannelÔºü‚≠ê‚≠ê</a></li>
            <li><a href="#ÈóÆchannel-ÁöÑÂèëÈÄÅÊé•Êî∂ÂÖ≥Èó≠">ÈóÆÔºöchannel ÁöÑÂèëÈÄÅ„ÄÅÊé•Êî∂„ÄÅÂÖ≥Èó≠Ôºü</a></li>
            <li><a href="#ÈóÆchannel-ÈùûÂæóÂÖ≥Èó≠Âêó">ÈóÆÔºöchannel ÈùûÂæóÂÖ≥Èó≠ÂêóÔºü‚≠êüö©</a></li>
            <li><a href="#ÈóÆÂ¶Ç‰ΩïÂà§Êñ≠channelÂ∑≤ÂÖ≥Èó≠">ÈóÆÔºöÂ¶Ç‰ΩïÂà§Êñ≠channelÂ∑≤ÂÖ≥Èó≠Ôºüü§î‚ùì</a></li>
            <li><a href="#ÈóÆchannel-ÊúâÂï•Â∫îÁî®">ÈóÆÔºöChannel ÊúâÂï•Â∫îÁî®Ôºü</a></li>
            <li><a href="#ÈóÆchannel-Âï•Êó∂ÂÄô‰ºöÂØºËá¥ÂÜÖÂ≠òÊ≥ÑÊºè">ÈóÆÔºöChannel Âï•Êó∂ÂÄô‰ºöÂØºËá¥ÂÜÖÂ≠òÊ≥ÑÊºèÔºü</a></li>
            <li><a href="#ÈóÆchannelÁöÑÂ∫ïÂ±ÇÊòØÊÄéÊ†∑ÁöÑ">ÈóÆÔºö<code>channel</code>ÁöÑÂ∫ïÂ±ÇÊòØÊÄéÊ†∑ÁöÑÔºü</a></li>
            <li><a href="#ÈóÆchannelÊòØÂ¶Ç‰ΩïËøõË°åËØªÂÜôÁöÑ">ÈóÆÔºö<code>channel</code>ÊòØÂ¶Ç‰ΩïËøõË°åËØªÂÜôÁöÑÔºü</a></li>
            <li><a href="#ÈóÆÂ§öË∑Ø-select">ÈóÆÔºö<code>Â§öË∑Ø select</code>Ôºü</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#39-ÂÜÖÂ≠ò">3.9 ÂÜÖÂ≠ò</a>
      <ul>
        <li>
          <ul>
            <li><a href="#ÈóÆÂÜÖÂ≠òÈÄÉÈÄ∏">ÈóÆÔºöÂÜÖÂ≠òÈÄÉÈÄ∏Ôºü‚≠êüö©</a></li>
            <li><a href="#ÈóÆmakeÂíånewÊúâÂï•Âå∫Âà´">ÈóÆÔºömakeÂíånewÊúâÂï•Âå∫Âà´Ôºü</a></li>
            <li><a href="#ÈóÆ‰∏∫‰ªÄ‰πàË¶ÅÂÜÖÂ≠òÂØπÈΩê-1">ÈóÆÔºö‰∏∫‰ªÄ‰πàË¶ÅÂÜÖÂ≠òÂØπÈΩêÔºü</a></li>
            <li><a href="#ÈóÆÁªìÊûÑ‰ΩìÊòØÊÄé‰πàËøõË°åÂÜÖÂ≠òÂØπÈΩêÁöÑÊàêÂëòÁöÑÈ°∫Â∫è‰∏çÂêåÁªìÊûÑ‰ΩìÁöÑÂ§ßÂ∞è‰ºö‰∏çÂêåÂêó">ÈóÆÔºöÁªìÊûÑ‰ΩìÊòØÊÄé‰πàËøõË°åÂÜÖÂ≠òÂØπÈΩêÁöÑÔºüÊàêÂëòÁöÑÈ°∫Â∫è‰∏çÂêåÔºåÁªìÊûÑ‰ΩìÁöÑÂ§ßÂ∞è‰ºö‰∏çÂêåÂêóÔºü</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#310-Êï∞ÊçÆÁªìÊûÑ">3.10 Êï∞ÊçÆÁªìÊûÑ</a>
      <ul>
        <li>
          <ul>
            <li><a href="#ÈóÆmap-ÊòØÂπ∂ÂèëÂÆâÂÖ®ÁöÑÂêóÈÇ£ÊÄé‰πàËÆ©‰ªñÂπ∂ÂèëÂÆâÂÖ®ÈÇ£Âä†ÈîÅÁöÑ-map-Âíå-syncmap-ÊúâÂï•Âå∫Âà´syncmap-ÁöÑÈÄÇÁî®Âú∫ÊôØ">ÈóÆÔºömap ÊòØÂπ∂ÂèëÂÆâÂÖ®ÁöÑÂêóÔºüÈÇ£ÊÄé‰πàËÆ©‰ªñÂπ∂ÂèëÂÆâÂÖ®ÔºüÈÇ£Âä†ÈîÅÁöÑ map Âíå sync.map ÊúâÂï•Âå∫Âà´Ôºüsync.map ÁöÑÈÄÇÁî®Âú∫ÊôØÔºü‚≠êüö©</a></li>
            <li><a href="#ÈóÆmap‰∏≠keyÂèØ‰ª•‰∏∫nilÂêó">ÈóÆÔºömap‰∏≠ÔºåkeyÂèØ‰ª•‰∏∫nilÂêóÔºü‚≠êüö©</a></li>
            <li><a href="#ÈóÆmap‰∏≠func-ÂèØ‰ª•ÂÅökeyÂêó‰ªÄ‰πàÁ±ªÂûãËÉΩÂÅö‰∏∫‰ªÄ‰πà">ÈóÆÔºömap‰∏≠Ôºåfunc ÂèØ‰ª•ÂÅökeyÂêóÔºü‰ªÄ‰πàÁ±ªÂûãËÉΩÂÅöÔºü‰∏∫‰ªÄ‰πàÔºü‚≠êüö©</a></li>
            <li><a href="#ÈóÆbyte-Âíå-string-ÊÄé‰πàËΩ¨Êç¢ÊÄßËÉΩÂéüÁêÜÂêÑËá™ÁöÑÈÄÇÁî®Âú∫ÊôØ">ÈóÆÔºö[]byte{} Âíå string ÊÄé‰πàËΩ¨Êç¢ÔºüÊÄßËÉΩÔºüÂéüÁêÜÔºüÂêÑËá™ÁöÑÈÄÇÁî®Âú∫ÊôØÔºü‚≠êüö©</a></li>
            <li><a href="#ÈóÆ‰∏§ÁßçÊñπÊ≥ïÁöÑËΩ¨Êç¢ÂéüÁêÜ">ÈóÆÔºö‰∏§ÁßçÊñπÊ≥ïÁöÑËΩ¨Êç¢ÂéüÁêÜÔºü</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#311-ÁªìÊûÑ‰ΩìÂíåÊé•Âè£">3.11 ÁªìÊûÑ‰ΩìÂíåÊé•Âè£</a>
      <ul>
        <li>
          <ul>
            <li><a href="#Âü∫Á°Ä">Âü∫Á°Ä</a></li>
            <li><a href="#ÈóÆgo-Â¶Ç‰ΩïÂÆûÁé∞-Â§öÊÄÅÂéüÁêÜÊòØ‰ªÄ‰πà">ÈóÆÔºöGo Â¶Ç‰ΩïÂÆûÁé∞ Â§öÊÄÅÔºüÂéüÁêÜÊòØ‰ªÄ‰πàÔºü‚≠êüö©</a></li>
            <li><a href="#ÈóÆgo-Â¶Ç‰ΩïÂÆûÁé∞-ÁªÑÂêà-Âíå-ÁªßÊâø">ÈóÆÔºöGo Â¶Ç‰ΩïÂÆûÁé∞ ÁªÑÂêà Âíå ÁªßÊâøÔºü</a></li>
            <li><a href="#È¢òÁõÆ1-1">È¢òÁõÆÔºö1</a></li>
            <li><a href="#È¢òÁõÆ2-1">È¢òÁõÆÔºö2</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#312-ÂØπÊØî-java">3.12 ÂØπÊØî Java</a>
      <ul>
        <li>
          <ul>
            <li><a href="#ÈóÆgo-Âíå-java-ÁöÑÂå∫Âà´">ÈóÆÔºöGo Âíå Java ÁöÑÂå∫Âà´Ôºü</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><blockquote>
<p><strong>ÂâçË®Ä</strong>ÔºöÁî®Êù•ËÆ∞ÂΩïGoÁöÑËØ≠Ë®ÄÁâπÊÄßÔºå‰∏ªË¶ÅÂèÇËÄÉ‰∏∫BÁ´ô„ÄäÂπºÈ∫üÂÆûÈ™åÂÆ§„ÄãÂèä„ÄäÊ∑±Â∫¶Êé¢Á¥¢GoËØ≠Ë®Ä„Äã„ÄÇ</p>
</blockquote>
<h1 id="‰∏ÄÂü∫Á°ÄÁü•ËØÜ">‰∏Ä„ÄÅÂü∫Á°ÄÁü•ËØÜ</h1>
<h2 id="11-Êï∞ÊçÆÁªìÊûÑ">1.1 Êï∞ÊçÆÁªìÊûÑ</h2>
<h3 id="111-string">1.1.1 String</h3>
<p><strong>ÁºñÁ†Å</strong>Ôºö<strong>ÂÆöÈïøÁºñÁ†ÅÈùûÂ∏∏Êµ™Ë¥πÂÜÖÂ≠ò</strong>ÔºåÊâÄ‰ª•ÈááÁî®<strong>ÂèòÈïøÁºñÁ†Å</strong>„ÄÇ**ÈÇ£‰πàÊÄé‰πàÂàíÂàÜËæπÁïåÂë¢Ôºü**ÊúÄÈ´òÂá†‰ΩçÁ©∫Âá∫Êù•‰Ωú‰∏∫Ê†áËØÜ‰ΩçÔºåÊ†áËÆ∞ËØ•Â≠óÁ¨¶Âç†Áî®Âá†‰∏™Â≠óËäÇ„ÄÇ</p>
<p>ËøôÊòØ Go ÈªòËÆ§ÁöÑÁºñÁ†ÅÊñπÂºèÔºöUTF-8 ÁºñÁ†ÅÔºö</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230405223347820.png" alt="image-20230405223347820" style="zoom: 33%;" />
<hr>
<p>==<strong>stringÁöÑÁªìÊûÑÔºö</strong>==</p>
<ul>
<li><strong>‰∏Ä‰∏™Ëµ∑ÂßãÂú∞ÂùÄ</strong>ÔºöÁî®Êù•Ê†áËÆ∞Â≠óÁ¨¶‰∏≤Ëµ∑Âßã‰ΩçÁΩÆÔºõ‰ΩÜÊòØÊÄé‰πàÊâæÂà∞ÁªìÂ∞æÂë¢ÔºüC ÊòØÂú®Â≠óÁ¨¶‰∏≤ÁªìÂ∞æÂ§ÑÊîæ‰∏™<code>\0</code>Ôºå‰ΩÜËøôÈôêÂà∂‰∫ÜÂÜÖÂÆπ‰∏çËÉΩÂá∫Áé∞Ëøô‰∏™Â≠óÁ¨¶ÔºåÊâÄ‰ª• Go Âπ∂‰∏çËøôÊ†∑ÂÅöÔºõ</li>
<li><strong>‰∏Ä‰∏™Â≠óÁ¨¶‰∏≤ÈïøÂ∫¶Ôºö<strong>Áî®Êù•Ê†áËÆ∞ËØ•Â≠óÁ¨¶ÊúâÂ§öÈïø(<strong>Â≠óËäÇ‰∏™Êï∞</strong>ÔºåËÄå</strong>‰∏çÊòØÂ≠óÁ¨¶‰∏™Êï∞</strong>ÔºÅ)ÔºåËøôÊ†∑Â∞±ËÉΩÂ§üÊâæÂà∞Â≠óÁ¨¶‰∏≤Âú®Âì™ÁªìÊùü‰∫Ü„ÄÇ</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230405223805558.png" alt="image-20230405223805558" style="zoom:33%;" />
<p><strong>Go ÁöÑÂ≠óÁ¨¶‰∏≤ÂÜÖÂÆπ‰∏çËÉΩ‰øÆÊîπ</strong>ÔºåÊâÄ‰ª• Go ÁöÑÁºñËØëÂô®‰ºöÊääÂÆö‰πâÂ•ΩÁöÑÂ≠óÁ¨¶‰∏≤ÂÜÖÂÆπÂàÜÈÖçÂà∞Âè™ËØªÂÜÖÂ≠òÊÆµ„ÄÇÂèØ‰ª•ÈÄöËøá<code>[]byte()</code>Â∞ÜÂ≠óÁ¨¶‰∏≤ËΩ¨Êç¢‰∏∫Â≠óËäÇsliceÔºåËøôÊ†∑‰ºö‰∏∫sliceÂèòÈáèÈáçÊñ∞ÂàÜÈÖç‰∏ÄÊÆµÂÜÖÂ≠òÔºåÂπ∂Êã∑Ë¥ù‰πãÂâçÂ≠óÁ¨¶‰∏≤ÁöÑÂÜÖÂÆπÔºåÂèØËÑ±Á¶ªÂè™ËØªÂÜÖÂ≠òÁöÑÈôêÂà∂„ÄÇ</p>
<blockquote>
<h4 id="ÈóÆrune-Âíå-byte-ÁöÑÂå∫Âà´">ÈóÆÔºörune Âíå byte ÁöÑÂå∫Âà´Ôºü</h4>
</blockquote>
<p><strong>Êú¨Ë¥®Âå∫Âà´Â∞±ÊòØÔºö</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="kt">byte</span> <span class="p">=</span> <span class="kt">uint8</span>
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="kt">rune</span> <span class="p">=</span> <span class="kt">int32</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>rune Á≠âÂêå‰∫é <code>int32</code>ÔºåÂç≥4‰∏™Â≠óËäÇÈïøÂ∫¶ÔºåÂ∏∏Áî®Êù•Â§ÑÁêÜ unicode Êàñ utf-8 Â≠óÁ¨¶„ÄÇÊØîÂ¶ÇÁî®Êù•Â§ÑÁêÜ<strong>‰∏≠ÊñáÂ≠óÁ¨¶</strong>„ÄÇ</li>
<li>byte Á≠âÂêå‰∫é <code>uint8</code>ÔºåÂç≥‰∏Ä‰∏™Â≠óËäÇÈïøÂ∫¶ÔºåÂ∏∏Áî®Êù•Â§ÑÁêÜ ascii Â≠óÁ¨¶(ÂÖ±128‰∏™)„ÄÇ</li>
</ul>
<p>Âú®go‰∏≠‰øÆÊîπÂ≠óÁ¨¶‰∏≤ÔºåÈúÄË¶ÅÂÖàÂ∞ÜÂ≠óÁ¨¶‰∏≤ËΩ¨ÂåñÊàêÊï∞ÁªÑÔºå[]byte Êàñ []runeÔºåÁÑ∂ÂêéÂÜçËΩ¨Êç¢Êàê string Âûã„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">str</span> <span class="o">:=</span> <span class="s">&#34;‰Ω†Â•Ω world&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// str[i] ÂÖ∂ÂÆûÊòØ byte
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%c&#34;</span><span class="p">,</span> <span class="nx">str</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="c1">// √§¬Ω&amp;nbsp;√•¬•¬Ω world
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ‰ΩøÁî®rangeÔºåÂÖ∂ÂÆûÊòØ‰ΩøÁî®runeÁ±ªÂûãÊù•ÁºñÁ†ÅÁöÑÔºåruneÁ±ªÂûãÁî®Êù•Ë°®Á§∫utf8Â≠óÁ¨¶Ôºå‰∏Ä‰∏™runeÂ≠óÁ¨¶Áî±‰∏Ä‰∏™ÊàñÂ§ö‰∏™byteÁªÑÊàê„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">value</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">str</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%c&#34;</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="c1">// ‰Ω†Â•Ω world
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="112-slice">1.1.2 Slice</h3>
<h4 id="1121-Êï∞ÊçÆÁªìÊûÑ">1.1.2.1 Êï∞ÊçÆÁªìÊûÑ</h4>
<p><strong>Slice Êúâ‰∏â‰∏™ÈÉ®ÂàÜÔºö</strong></p>
<ul>
<li>ÂÖÉÁ¥†Â≠òÂì™Èáå(data)</li>
<li>Â≠ò‰∫ÜÂ§öÂ∞ë‰∏™ÂÖÉÁ¥†(len)</li>
<li>ÂèØ‰ª•Â≠òÂ§öÂ∞ë‰∏™ÂÖÉÁ¥†(cap)</li>
</ul>
<p>‰æãÂ¶ÇÔºö</p>
<ul>
<li>
<p><strong>Ëã•ÈÄöËøá<code>var ints []int</code>Êàñ<code>new</code>ÂàõÂª∫Êï∞ÁªÑ</strong>ÔºådataÊòØËØ•Êï∞ÁªÑÁöÑËµ∑ÂßãÂú∞ÂùÄÔºå‰ΩÜÂàùÂßãÂåñ‰∏∫nilÔºålen=0Ôºåcap=0ÔºåÂõ†‰∏∫‰∏ç‰ºöÂºÄËæüÂ∫ïÂ±ÇÂÜÖÂ≠òÁªôÂÆÉÔºõ</p>
</li>
<li>
<p><strong>Ëã•ÈÄöËøá<code>make([]int, 2, 5)</code>ÂàõÂª∫Êï∞ÁªÑ</strong>Ôºå‰∏ç‰ªÖ‰ºöÂàÜÈÖç‰∏äËø∞‰∏âÈÉ®ÂàÜÔºåËøò‰ºö<strong>ÂºÄËæü‰∏ÄÊÆµÂÜÖÂ≠ò</strong>‰Ωú‰∏∫ÂÆÉÁöÑÂ∫ïÂ±ÇÊï∞ÁªÑÔºõ</p>
</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230222212427138.png" alt="image-20230222212427138" style="zoom:33%;" />
<h4 id="1122-append">1.1.2.2 <code>append</code></h4>
<p><code>append</code>ÂèØ‰ª•‰∏∫Ê≤°ÊúâÂ∫ïÂ±ÇÂÜÖÂ≠òÁ©∫Èó¥ÁöÑSliceÂºÄËæü‰∏ÄÊÆµÂÜÖÂ≠òÔºåÂπ∂ËµãÂÄº„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230222212806168.png" alt="image-20230222212806168" style="zoom: 33%;" />
<p>ÂèØ‰ª•Êää‰∏çÂêåÁöÑSliceÂÖ≥ËÅîÂà∞Âêå‰∏Ä‰∏™Êï∞ÁªÑÔºåÂÆÉ‰ª¨‰ºö<strong>ÂÖ±Áî®Â∫ïÂ±ÇÊï∞ÁªÑ</strong>Ôºå‰æãÂ¶ÇÔºö</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230222213129238.png" alt="image-20230222213129238" style="zoom: 33%;" />
<p>Ëøô‰∏â‰∏™SliceËÆøÈóÆÂíå‰øÆÊîπÁöÑÈÉΩÊòØ<strong>Âêå‰∏Ä‰∏™Â∫ïÂ±ÇÊï∞ÁªÑ</strong>Ôºå<code>s1</code>Âíå<code>s2</code>Ëã•ËÆøÈóÆË∂ÖËøáÂÖ∂lenÁöÑÂÖÉÁ¥†Ôºå‰ºö‰∫ßÁîüËÆøÈóÆË∂äÁïå„ÄÇ</p>
<p><strong>‰∏äÂõæ‰∏≠ÔºåËã•ÂÜçÁªô<code>s2</code>Ê∑ªÂä†ÂÖÉÁ¥†‰ºöÊÄéÊ†∑Ôºü<strong>Ëøô‰∏™Â∫ïÂ±ÇÊï∞ÁªÑÊòØ‰∏çËÉΩÁî®‰∫ÜÔºåÂæóÂºÄËæüÊñ∞Êï∞ÁªÑÔºåÂéüÊù•ÁöÑÂÖÉÁ¥†Ë¶ÅÊã∑Ë¥ùËøáÂéªÔºåËøòË¶ÅÊ∑ªÂä†Êñ∞ÂÖÉÁ¥†ÔºåÊ≠§Êó∂<code>s2</code>Â∞±‰∏çÊåáÂêë</strong>ÂéüÂ∫ïÂ±ÇÊï∞ÁªÑ</strong>‰∫ÜÔºö</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230222213434400.png" alt="image-20230222213434400" style="zoom:33%;" />
<h4 id="1123-Êâ©ÂÆπËßÑÂàô">1.1.2.3 ==Êâ©ÂÆπËßÑÂàô==</h4>
<p>ÂΩì‰ΩøÁî®<code>append</code>Ê∑ªÂä†ÂÖÉÁ¥†ÔºåÂÆπÈáè‰∏çÂ§üÊó∂ÔºåËØ•ÊÄé‰πàÈáçÊñ∞<strong>ÂàÜÈÖçÂÆπÈáè</strong>Âë¢Ôºü</p>
<ol>
<li>
<p><strong>È¢Ñ‰º∞Êâ©ÂÆπÂêéÁöÑÂÆπÈáèÔºö</strong></p>
<p><strong>È¢Ñ‰º∞ËßÑÂàôÔºö</strong></p>
<ul>
<li><code>oldLen*2 &lt; cap</code>Ôºö<code>ÊóßÂÆπÈáè*2</code> ËøòÊòØÂ∞è‰∫éÊúÄÂ∞ëË¶ÅÂàÜÈÖçÁöÑÂÆπÈáèÔºåÈÇ£‰πàÂ∞±ÂàÜÈÖçÊúÄÂ∞ëË¶ÅÂàÜÈÖçÁöÑÂÆπÈáèÔºåÊ≠§Â§Ñ‰∏∫5Ôºõ</li>
<li>Âê¶ÂàôÔºö<code>oldLen &lt; 1024</code>Êó∂ÔºåÁõ¥Êé• *2Ôºå<code>oldLen &gt;= 1024</code>Êó∂ÔºåÂ∞±ÂÖàÊâ© 1/4„ÄÇ</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230222213854160.png" alt="image-20230222213854160" style="zoom:33%;" />
</li>
<li>
<p>**È¢Ñ‰º∞ÂÖÉÁ¥†ÈúÄË¶ÅÂç†Áî®Â§öÂ§ßÂÜÖÂ≠òÔºö**Áõ¥Êé•ÂàÜÈÖç <code>È¢Ñ‰º∞ÂÆπÈáè * ÂÖÉÁ¥†Á±ªÂûãÂ§ßÂ∞è</code> ÂÜÖÂ≠òÂèØ‰ª•ÂòõÔºü<strong>‰∏çÂèØ‰ª•ÁöÑÔºÅ<strong>Âõ†‰∏∫‰∏ç‰∏ÄÂÆöÊúâÂàöÂ•Ω‰∏ÄÊ†∑Â§ßÁöÑ</strong>È¢ÑÁΩÆËßÑÊ†º</strong>ÁöÑÂÜÖÂ≠òÂùó„ÄÇËøôÂ∞±ÊòØÁ¨¨‰∏âÊ≠•Ë¶ÅÂÅöÁöÑ‰∫ã„ÄÇ</p>
</li>
<li>
<p><strong>ÂåπÈÖçÂà∞ÂêàÈÄÇÁöÑÂÜÖÂ≠òËßÑÊ†ºÔºö<strong>‰πãÂâç‰æãÂ≠ê‰∏≠ÔºåÈ¢Ñ‰º∞ÂÆπÈáè‰∏∫ 5Ôºå64‰Ωç‰∏ãÂ∞±ÈúÄË¶ÅÁî≥ËØ∑ 40 Â≠óËäÇÂÜÖÂ≠òÔºåËÄå</strong>ÊúÄÊé•ËøëÁöÑÂÜÖÂ≠òËßÑÊ†º</strong>‰∏∫ 48 Â≠óËäÇ„ÄÇ‰πüÂ∞±ÊòØËÉΩË£Ö 6 ‰∏™ËØ•ÂÖÉÁ¥†ÔºåÊâÄ‰ª• <strong>Êâ©ÂÆπÂêéÂÆπÈáè‰∏∫ 6</strong>„ÄÇ</p>
</li>
</ol>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230222214929976.png" alt="image-20230222214929976" style="zoom:33%;" />
<ol start="4">
<li>ÂàÜÈÖçÂÆåÊñ∞ÁöÑÂ∫ïÂ±Ç Array Á©∫Èó¥ÂêéÔºåÂ∞±ÊääÂéü Array ‰∏≠ÁöÑÊï∞ÊçÆÊã∑Ë¥ùÂà∞Êñ∞ÁöÑ‰∏äÈù¢„ÄÇ</li>
</ol>
<blockquote>
<h4 id="ÈóÆslice-Âíå-array-ÊúâÂï•Âå∫Âà´">ÈóÆÔºöSlice Âíå Array ÊúâÂï•Âå∫Âà´Ôºü</h4>
</blockquote>
<ul>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">arr</span> <span class="o">:=</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">}</span> 	<span class="c1">// Â£∞Êòé‰∫Ü‰∏Ä‰∏™Êï∞ÁªÑ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">sli</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">}</span>		<span class="c1">// Â£∞Êòé‰∫Ü‰∏Ä‰∏™Slice
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Array ÈïøÂ∫¶ÊòØÂõ∫ÂÆöÁöÑÔºõSlice ÊòØÂä®ÊÄÅÊï∞ÁªÑÔºåÈïøÂ∫¶ÂèØÂèòÔºõ</p>
</li>
<li>
<p>Slice ÊòØÂú® Array Âü∫Á°Ä‰∏äÂÆûÁé∞ÁöÑÔºåSliceÊúâ‰ª®Â≠óÊÆµÔºåÈ¶ñ‰∏™Â∞±ÊòØÂØπÂ∫ïÂ±Ç Array ÁöÑ<strong>ÂºïÁî®</strong>ÔºåÊâÄ‰ª• Slice ÊòØÂºïÁî®Âûã„ÄÇ</p>
</li>
</ul>
<p>Âú® C ËØ≠Ë®Ä‰∏≠ÔºåÊï∞ÁªÑÂèòÈáèÊòØÊåáÂêëÁ¨¨‰∏Ä‰∏™ÂÖÉÁ¥†ÁöÑÊåáÈíàÔºå‰ΩÜÊòØ Go ËØ≠Ë®Ä‰∏≠Âπ∂‰∏çÊòØ„ÄÇ</p>
<p>Áî±‰∫éÂÄº‰º†ÈÄíÔºåÊï∞ÁªÑËøõË°åËµãÂÄº„ÄÅ‰º†ÈÄíÊó∂ÔºåÂÆûÈôÖ‰∏ä‰ºöÂ§çÂà∂Êï¥‰∏™Êï∞ÁªÑÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">a</span> <span class="o">:=</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">}</span> 	<span class="c1">// ... ‰ºöËá™Âä®ËÆ°ÁÆóÊï∞ÁªÑÈïøÂ∫¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">b</span> <span class="o">:=</span> <span class="nx">a</span>					<span class="c1">// ÂÄºÊã∑Ë¥ùÔºåÂ§çÂà∂Êï¥‰∏™Êï∞ÁªÑ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">=</span> <span class="mi">100</span>
</span></span><span class="line"><span class="cl"><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> 		<span class="c1">// [100 2 3] [1 2 3]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// ‰∏∫‰∫ÜÈÅøÂÖçÂ§çÂà∂Êï∞ÁªÑÔºå‰∏ÄËà¨‰ºö‰º†ÈÄíÊåáÂêëÊï∞ÁªÑÁöÑÊåáÈíà„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">a</span> <span class="o">:=</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">b</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nf">a</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="o">*</span><span class="nx">b</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="p">=</span> <span class="mi">100</span>
</span></span><span class="line"><span class="cl"><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="o">*</span><span class="nx">b</span><span class="p">)</span>		<span class="c1">// [100 2 3] [100 2 3]
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<h4 id="ÈóÆslice-ÁöÑÊÄßËÉΩÈô∑Èò±">ÈóÆÔºöSlice ÁöÑÊÄßËÉΩÈô∑Èò±Ôºü</h4>
</blockquote>
<ol>
<li><strong>Â§ßÈáèÂÜÖÂ≠òÂæó‰∏çÂà∞ÈáäÊîæ</strong></li>
</ol>
<p><strong>Âú®Â∑≤ÊúâÂàáÁâáÁöÑÂü∫Á°Ä‰∏äËøõË°åÂàáÁâáÔºå‰∏ç‰ºöÂàõÂª∫Êñ∞ÁöÑÂ∫ïÂ±ÇÊï∞ÁªÑ„ÄÇÂõ†‰∏∫ÂéüÊù•ÁöÑÂ∫ïÂ±ÇÊï∞ÁªÑÊ≤°ÊúâÂèëÁîüÂèòÂåñÔºåÂÜÖÂ≠ò‰ºö‰∏ÄÁõ¥Âç†Áî®ÔºåÁõ¥Âà∞Ê≤°ÊúâÂèòÈáèÂºïÁî®ËØ•Êï∞ÁªÑ</strong>„ÄÇÂõ†Ê≠§ÂæàÂèØËÉΩÂá∫Áé∞Ëøô‰πà‰∏ÄÁßçÊÉÖÂÜµÔºåÂéüÂàáÁâáÁî±Â§ßÈáèÁöÑÂÖÉÁ¥†ÊûÑÊàêÔºå‰ΩÜÊòØÊàë‰ª¨Âú®ÂéüÂàáÁâáÁöÑÂü∫Á°Ä‰∏äÂàáÁâáÔºåËôΩÁÑ∂Âè™‰ΩøÁî®‰∫ÜÂæàÂ∞è‰∏ÄÊÆµÔºå‰ΩÜÂ∫ïÂ±ÇÊï∞ÁªÑÂú®ÂÜÖÂ≠ò‰∏≠‰ªçÁÑ∂Âç†ÊçÆ‰∫ÜÂ§ßÈáèÁ©∫Èó¥ÔºåÂæó‰∏çÂà∞ÈáäÊîæ„ÄÇÊØîËæÉÊé®ËçêÁöÑÂÅöÊ≥ïÔºå‰ΩøÁî® <code>copy</code> Êõø‰ª£ <code>re-slice</code>„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// 1. Êó†Ê≥ïÈáäÊîæ originÔºåÈÄ†ÊàêÂÜÖÂ≠òÊµ™Ë¥π
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">lastNumsBySlice</span><span class="p">(</span><span class="nx">origin</span> <span class="p">[]</span><span class="kt">int</span><span class="p">)</span> <span class="p">[]</span><span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">origin</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nx">origin</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 2. Ëá™Âä®ÂõûÊî∂ originÔºåËäÇÁúÅÂÜÖÂ≠ò
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">lastNumsByCopy</span><span class="p">(</span><span class="nx">origin</span> <span class="p">[]</span><span class="kt">int</span><span class="p">)</span> <span class="p">[]</span><span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">result</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nb">copy</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">origin</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nx">origin</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">:])</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">result</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="113-ÁªìÊûÑ‰Ωì‰∏éÂÜÖÂ≠òÂØπÈΩê">1.1.3 ÁªìÊûÑ‰Ωì‰∏éÂÜÖÂ≠òÂØπÈΩê</h3>
<p>Â§™Âº∫‰∫ÜÔºåÁúãËßÜÈ¢ëÂêßÂéª„ÄÇÊã®‰∫ëËßÅÊó•ÔºåËåÖÂ°ûÈ°øÂºÄÔºÅ</p>
<hr>
<h4 id="1131-ËÆøÈóÆÂÜÖÂ≠ò">1.1.3.1 ËÆøÈóÆÂÜÖÂ≠ò</h4>
<p>CPUÊòØÂ∞Ü<strong>ÂÜÖÂ≠òÂú∞ÂùÄ</strong>ÈÄöËøá<strong>Âú∞ÂùÄÊÄªÁ∫ø</strong>‰º†ËæìÁªô<strong>ÂÜÖÂ≠ò</strong>Ôºå<strong>ÂÜÖÂ≠ò</strong>ÂáÜÂ§áÂ•ΩÊï∞ÊçÆÂêéÈÄöËøá<strong>Êï∞ÊçÆÊÄªÁ∫ø</strong>‰º†ÁªôCPUÔºö</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230222220413977.png" alt="image-20230222220413977" style="zoom:25%;" />
<p>Ëã•ÊÉ≥‰∏ÄÊ¨°ËØªÂèñ 8Â≠óËäÇ ÁöÑÊï∞ÊçÆÔºåÂ∞±ÈúÄË¶Å64‰ΩçÊï∞ÊçÆÊÄªÁ∫øÔºåËøôÈáåÁöÑÊï∞ÊçÆÊÄªÁ∫ø‰ΩçÊï∞Â∞±ÊòØ<strong>Êú∫Âô®Â≠óÈïø</strong>„ÄÇ<strong>Â¶Ç‰ΩïËÉΩÂè™‰º†Ëæì‰∏Ä‰∏™Âú∞ÂùÄÔºåËØªÂèñ 8Â≠óËäÇ Êï∞ÊçÆÂë¢Ôºü</strong></p>
<p>‰∏∫‰∫ÜÊõ¥È´òÁöÑËÆøÈóÆÊïàÁéáÔºåÂÜÖÂ≠òÂ∏ÉÂ±ÄÂ¶Ç‰∏ãÔºöÂ∞±ÊòØ8‰∏™<code>chip</code>ÊéíÂàóÂú®‰∏ÄËµ∑(ÊØè‰∏™<code>chip</code>Áî±8‰∏™<code>bank</code>ÁªÑÊàêÔºåÂç≥ 1Â≠óËäÇ ÂÜÖÂ≠ò)ÔºåÂÖ±Áî®Âêå‰∏Ä‰∏™ÂÜÖÂ≠òÂú∞ÂùÄÔºåÂêÑËá™ÂØªÊâæ 1Â≠óËäÇÔºåÁÑ∂ÂêéÁªÑÂêàËµ∑Êù•Êàê‰∏∫ 8Â≠óËäÇÔºö</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230222221021697.png" alt="image-20230222221021697" style="zoom:50%;" />
<p>ÊâÄ‰ª•ÊØèÊ¨°ËÆøÈóÆÂÜÖÂ≠òÈÉΩÂè™ËÉΩ‰ªé<code>Ëµ∑ÂßãÂú∞ÂùÄ%8==0</code>Â§ÑÂºÄÂßãËÆøÈóÆ„ÄÇ</p>
<h4 id="1132-ÂÜÖÂ≠òÂØπÈΩê">1.1.3.2 ÂÜÖÂ≠òÂØπÈΩê</h4>
<p>‰∏∫‰∫ÜÊèêÈ´òËÆøÈóÆÊïàÁéá(<strong>‰øùËØÅ‰∏ÄÊ¨°ËØªÂèñ</strong>)ÔºåÁºñËØëÂô®‰ºöÊääÂêÑÁßçÁ±ªÂûãÁöÑÊï∞ÊçÆ<strong>ÂÆâÊéíÂà∞ÂêàÈÄÇÁöÑÂú∞ÂùÄ</strong>ÔºåÂπ∂<strong>Âç†Áî®ÂêàÈÄÇÁöÑÈïøÂ∫¶</strong>„ÄÇ</p>
<p>ÂÜÖÂ≠òÂØπÈΩêË¶ÅÊ±Ç<strong>Êï∞ÊçÆÂ≠òÂÇ®Ëµ∑ÂßãÂú∞ÂùÄ</strong>ÔºåÂèä<strong>Âç†Áî®ÁöÑÂ≠óËäÇÊï∞</strong>ÈÉΩË¶ÅÊòØÂÆÉ<strong>ÂØπÈΩêËæπÁïå</strong>ÁöÑ<strong>ÂÄçÊï∞</strong>Ôºö</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230222222250526.png" alt="image-20230222222250526" style="zoom:33%;" />
<h4 id="1133-ÁªìÊûÑ‰ΩìÂØπÈΩê">1.1.3.3 ÁªìÊûÑ‰ΩìÂØπÈΩê</h4>
<p><strong>ÂÖ±‰∏§‰∏™Êù°‰ª∂Ôºö</strong></p>
<ul>
<li>ÂêÑÊàêÂëòË¶ÅÂØπÈΩêËæπÁïåÔºõ</li>
<li>ÁªìÊûÑ‰ΩìÊÄªÂÜÖÂ≠òÂ§ßÂ∞è % ÂØπÈΩêËæπÁïå == 0„ÄÇ</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230222223638378.png" alt="image-20230222223638378" style="zoom: 50%;" />
<p>ÂèØ‰ª•ÁúãÂá∫Ôºå<strong>ÁªìÊûÑ‰ΩìÂêÑÂ≠óÊÆµÁöÑÈ°∫Â∫è</strong>‰ºöÂΩ±Âìç<strong>ÁªìÊûÑ‰ΩìÂç†Áî®ÂÜÖÂ≠òÁöÑÂ§ßÂ∞è</strong>„ÄÇ</p>
<p>==<strong>‰∏∫‰ªÄ‰πàË¶ÅÊúâ<code>ÁªìÊûÑ‰ΩìÊÄªÂÜÖÂ≠òÂ§ßÂ∞è % ÂØπÈΩêËæπÁïå == 0</code>Ôºü</strong>==</p>
<p>Â¶Ç‰∏ãÊÉÖÂÜµÔºåËã•‰∏çÊòØÊï¥Êï∞ÂÄçÁöÑËØùÔºåÂè™ÊúâÁ¨¨‰∏Ä‰∏™TÁöÑÂÜÖÂ≠òÊòØÂØπÈΩêÁöÑÔºåÁ¨¨2‰∏™TÂ∞±Ê≤°ÊúâÂØπÈΩê„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230222223858695.png" alt="image-20230222223858695" style="zoom:33%;" />
<blockquote>
<h4 id="ÈóÆ‰ªÄ‰πàÊòØÂÜÖÂ≠òÂØπÈΩê">ÈóÆÔºö‰ªÄ‰πàÊòØÂÜÖÂ≠òÂØπÈΩêÔºü</h4>
</blockquote>
<p><strong>Á≠îÔºö<strong>‰∏∫‰∫ÜÊèêÈ´òËÆøÈóÆÊïàÁéáÔºåÁºñËØëÂô®‰ºöÊääÂêÑÁßçÁ±ªÂûãÁöÑÊï∞ÊçÆ</strong>ÂÆâÊéíÂà∞ÂêàÈÄÇÁöÑÂú∞ÂùÄ</strong>ÔºåÂπ∂<strong>Âç†Áî®ÂêàÈÄÇÁöÑÈïøÂ∫¶</strong>„ÄÇÂÜÖÂ≠òÂØπÈΩêË¶ÅÊ±Ç<strong>Êï∞ÊçÆÂ≠òÂÇ®Ëµ∑ÂßãÂú∞ÂùÄ</strong>ÔºåÂèä<strong>Âç†Áî®ÁöÑÂ≠óËäÇÊï∞</strong>ÈÉΩË¶ÅÊòØÂÆÉ**==ÂØπÂÖ∂ËæπÁïå==<strong>ÁöÑ</strong>ÂÄçÊï∞**„ÄÇ</p>
<blockquote>
<h4 id="ÈóÆÂ¶Ç‰ΩïÁ°ÆÂÆöÊï∞ÊçÆÁ±ªÂûãÁöÑÂØπÈΩêËæπÁïå">ÈóÆÔºöÂ¶Ç‰ΩïÁ°ÆÂÆöÊï∞ÊçÆÁ±ªÂûãÁöÑÂØπÈΩêËæπÁïåÔºü</h4>
</blockquote>
<p><strong>Êú∫Âô®Â≠óÈïø</strong>ÊòØ<strong>ÊúÄÂ§ßÂØπÈΩêËæπÁïå</strong>ÔºåËÄå<strong>Êï∞ÊçÆÁ±ªÂûãÁöÑÂØπÈΩêËæπÁïå</strong>ÊòØÔºö<code>min(Á±ªÂûãÂ§ßÂ∞è, ÊúÄÂ§ßÂØπÈΩêËæπÁïå)</code>„ÄÇ</p>
<p>==‰∏∫‰ªÄ‰πà‰∏ç<strong>Áªü‰∏ÄÊåâÁÖßÊúÄÂ§ßÂØπÈΩêËæπÁïå</strong>Êàñ<strong>Á±ªÂûãÂ§ßÂ∞è</strong>ÂàÜÈÖçÂë¢Ôºü==</p>
<p><strong>‰∏∫‰∫ÜÂáèÂ∞ëÊµ™Ë¥πÔºåÊèêÈ´òÊÄßËÉΩ„ÄÇ</strong></p>
<p>Â¶ÇÊûúÊòØ<code>int8</code>Á±ªÂûãÔºåÂè™Âç† 1Â≠óËäÇÔºåËã•ÂØπÈΩêÂà∞ÊúÄÂ§ßËæπÁïåÔºåÂ∞±‰ºöÊµ™Ë¥π 7Â≠óËäÇÔºåÊâÄ‰ª•ÂØπÈΩêÂà∞ 1Â≠óËäÇ ÊúÄÂêàÈÄÇÔºõ</p>
<p>Â¶ÇÊûúÊòØ<code>int64</code>Á±ªÂûãÔºåÂç†Áî® 8Â≠óËäÇÔºåËã•ÂØπÈΩêÂà∞ 8Â≠óËäÇÔºåÂ¶Ç‰∏ãÊÉÖÂÜµ‰∏≠Â∞±‰ºöÊµ™Ë¥πÂâçÈù¢ÁöÑ 6Â≠óËäÇÔºåÊâÄ‰ª•ÂØπÈΩêÂà∞ÊúÄÂ§ßÂØπÈΩêËæπÁïåÊúÄÂêàÈÄÇ„ÄÇ</p>
<p>Â¶ÇÊûúÊòØÁªìÊûÑ‰ΩìÁ±ªÂûãÔºåÂØπÈΩêËæπÁïåÂ∞±ÊòØÂåÖÂê´Á±ªÂûã‰∏≠ÊúÄÂ§ßÁöÑÂØπÈΩêËæπÁïå„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230222223422115.png" alt="image-20230222223422115" style="zoom: 33%;" />
<blockquote>
<h4 id="ÈóÆ‰∏∫‰ªÄ‰πàË¶ÅÂÜÖÂ≠òÂØπÈΩê">ÈóÆÔºö‰∏∫‰ªÄ‰πàË¶ÅÂÜÖÂ≠òÂØπÈΩêÔºü</h4>
</blockquote>
<p><strong>Êúâ‰∫õCPUËÉΩËÆøÈóÆ‰ªªÊÑèÂú∞ÂùÄ</strong>ÔºåÊòØÂõ†‰∏∫ÂÅö‰∫ÜÂ§ÑÁêÜÔºöÊØîÂ¶ÇËØª<code>1-8</code>ÁöÑÂÜÖÂ≠òÔºö‰ºöÂÖàËØª<code>0-7</code>ÔºåÂè™Âèñ<code>1-7</code>ÔºåÂÜçËØª<code>8-15</code>ÔºåÂè™Âèñ<code>8</code>ÔºåÁªÑÂêàËµ∑Êù•Â∞±ÊòØ<code>1-8</code>Ôºå‰ΩÜÊòØËøôÊ†∑‰ºöÈôç‰ΩéËÆøÈóÆÊïàÁéá„ÄÇ<strong>‰∏∫‰∫ÜÈÅøÂÖçËøôÊ†∑ËØªÂèñÔºåÂõ†Ê≠§Ë¶ÅÂÜÖÂ≠òÂØπÈΩê</strong>„ÄÇ</p>
<h3 id="114-map">1.1.4 Map</h3>
<h4 id="1141-Ê¶ÇËø∞">1.1.4.1 Ê¶ÇËø∞</h4>
<p>Map‰∏ªË¶ÅÁî±<strong>ÂìàÂ∏åÂáΩÊï∞</strong>Âíå<strong>Ê°∂</strong>ÁªÑÊàê„ÄÇ</p>
<ul>
<li>
<p><strong>ÂìàÂ∏åÂáΩÊï∞</strong>Áî®Êù•ÂÆûÁé∞<code>key-value</code>ÁöÑÊò†Â∞ÑÔºåÊòØÂÜ≥ÂÆöÂìàÂ∏åË°®ÁöÑËØªÂÜôÊÄßËÉΩÁöÑÂÖ≥ÈîÆÔºå<strong>ÂìàÂ∏åÂáΩÊï∞Êò†Â∞ÑÁöÑÁªìÊûú‰∏ÄÂÆöË¶ÅÂ∞ΩÂèØËÉΩÂùáÂåÄ</strong>„ÄÇÂ¶ÇÊûú‰ΩøÁî®ÁªìÊûúÂàÜÂ∏ÉËæÉ‰∏∫ÂùáÂåÄÁöÑÂìàÂ∏åÂáΩÊï∞ÔºåÈÇ£‰πàÂìàÂ∏åÁöÑÂ¢ûÂà†ÊîπÊü•ÁöÑÊó∂Èó¥Â§çÊùÇÂ∫¶‰∏∫ <code>O(1)</code>Ôºõ‰ΩÜÊòØÂ¶ÇÊûúÂìàÂ∏åÂáΩÊï∞ÁöÑÁªìÊûúÂàÜÂ∏É‰∏çÂùáÂåÄÔºåÈÇ£‰πàÊâÄÊúâÊìç‰ΩúÁöÑÊó∂Èó¥Â§çÊùÇÂ∫¶ÂèØËÉΩ‰ºöËææÂà∞ <code>O(n)</code>„ÄÇ</p>
</li>
<li>
<p><strong>Ê°∂</strong>Áî®Êù•Ëß£ÂÜ≥ÂìàÂ∏åÊò†Â∞ÑÁöÑÂÜ≤Á™ÅÈóÆÈ¢òÔºåÂ∏∏ËßÅÊñπÊ≥ïÊúâÔºö<strong>ÂºÄÊîæÂØªÂùÄÊ≥ï</strong>Âíå<strong>ÊãâÈìæÊ≥ï</strong>„ÄÇ</p>
</li>
</ul>
<p>==<strong>Point 1Ôºö</strong>==</p>
<p>Âõ†‰∏∫ÂìàÂ∏å‰πãÂêéÁöÑÂú∞ÂùÄÁ©∫Èó¥ÈÄöÂ∏∏ËøúÂ§ß‰∫éÂÆûÈôÖÂú∞ÂùÄÁ©∫Èó¥ÔºåÂõ†Ê≠§ÈúÄË¶ÅÂØπÂìàÂ∏åÂÄºËøõË°åÂ§ÑÁêÜÔºåÂ∏∏Áî®Êúâ‰∏§ÁßçÊñπÊ≥ïÔºö</p>
<ul>
<li>ÂèñÊ®°Ê≥ïÔºö<code>hash % m</code>Ôºõ</li>
<li><strong>‰∏éËøêÁÆó(GoÈááÁî®)Ôºö</strong><code>hash &amp; (m-1)</code>„ÄÇËøôÈáå<code>m</code>ÂøÖÈ°ªÊòØ<code>2</code>ÁöÑÊï¥Êï∞Ê¨°ÂπÇÔºåËøôÊ†∑ÂèØ‰ª•Á°Æ‰øù‰∏ç‰ºöÂá∫Áé∞<code>Á©∫Ê°∂</code>„ÄÇ</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221203151836038.png" alt="image-20221203151836038" style="zoom: 25%;" />
<p><strong>==Point 2Ôºö==</strong></p>
<p>‰∏äËø∞ÂØπÂìàÂ∏åÂÄºÁöÑÊìç‰Ωú‰ºöÈÄ†ÊàêÂìàÂ∏åÂÜ≤Á™ÅÔºåÂõ†Ê≠§ÈúÄË¶ÅÂØπÂìàÂ∏åÂÜ≤Á™ÅËøõË°åÂ§ÑÁêÜÔºåÂ∏∏Áî®Êúâ‰∏§ÁßçÊñπÊ≥ïÔºåÂ¶ÇÂõæÊâÄÁ§∫Ôºö</p>
<ul>
<li><strong>ÂºÄÊîæÂØªÂùÄÊ≥ïÔºö</strong>
<ul>
<li><strong>ÂÜôÂÖ•Ôºö<strong>ÂØπÂΩìÂâçÂÖÉÁ¥†ËøõË°åÂìàÂ∏åÊò†Â∞ÑÂæóÂà∞Âú∞ÂùÄÔºåËã•ËØ•Âú∞ÂùÄÁ©∫Èó≤ÔºåÂèØ‰ª•Áõ¥Êé•Â°´ÂÖ•ÔºõËã•Â∑≤Ë¢´Âç†Áî®ÔºåÂàôÈúÄË¶ÅÂ∞ÜÂΩìÂâçÂÖÉÁ¥†ÂàÜÈÖçÂú®ËØ•Âú∞ÂùÄ</strong>Âêé</strong>ÁöÑÁ©∫Èó≤Âú∞ÂùÄÔºõ</li>
<li>**ËØªÂèñÔºö**Ëã•Êò†Â∞ÑÂú∞ÂùÄ‰∏≠Â≠òÂÇ®ÂÖÉÁ¥†ÁöÑ<code>Key</code>‰∏éÂΩìÂâçÂÖÉÁ¥†ÁöÑ<code>Key</code>‰∏çÂêåÔºåÂàôÈúÄË¶ÅÈÅçÂéÜËØ•Âú∞ÂùÄ‰πãÂêéÁöÑÂú∞ÂùÄÁ©∫Èó¥ÔºåÁõ¥Âà∞Âú∞ÂùÄ‰∏∫Á©∫ÊàñÊâæÂà∞ÁõÆÊ†á<code>Key</code>„ÄÇ</li>
</ul>
</li>
<li><strong>ÊãâÈìæÊ≥ïÔºàÊúÄÂ∏∏Áî®ÔºâÔºö</strong>
<ul>
<li><strong>ÂÜôÂÖ•Ôºö<strong>ÂØπÂΩìÂâçÂÖÉÁ¥†ËøõË°åÂìàÂ∏åÊò†Â∞ÑÂæóÂà∞Âú∞ÂùÄÔºåËã•ËØ•Âú∞ÂùÄÁ©∫Èó≤ÔºåÂèØ‰ª•Áõ¥Êé•Â°´ÂÖ•ÔºõËã•Â∑≤Ë¢´Âç†Áî®ÔºåÂàôÈúÄË¶ÅÂú®ÈìæË°®ÁöÑ</strong>Êú´Â∞æËøΩÂä†</strong>Êñ∞ÁöÑÈîÆÂÄºÂØπÔºõ</li>
<li>**ËØªÂèñÔºö**ÈÅçÂéÜÊò†Â∞ÑÂú∞ÂùÄÁöÑÈîÆÂÄºÂØπÈìæË°®ÔºåÁõ¥Âà∞ÊêúÁ¥¢Âà∞Áõ∏ÂêåÁöÑ<code>Key</code>(Â≠òÂú®)ÊàñÈìæË°®Êú´Â∞æ(‰∏çÂ≠òÂú®)„ÄÇ</li>
</ul>
</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221203152250505.png" alt="image-20221203152250505" style="zoom: 25%;" />
<h4 id="1142-Êï∞ÊçÆÁªìÊûÑ">1.1.4.2 Êï∞ÊçÆÁªìÊûÑ</h4>
<p><a href="https://draveness.me/golang/tree/runtime.hmap" target="_blank" rel="noopener noreffer "><code>runtime.hmap</code></a> ÊòØÊúÄÊ†∏ÂøÉÁöÑÁªìÊûÑ‰ΩìÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">hmap</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">count</span>     <span class="kt">int</span>		<span class="c1">// ËÆ∞ÂΩï Â∑≤Â≠òÂÇ®ÈîÆÂÄºÂØπÁöÑÊï∞ÁõÆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">flags</span>     <span class="kt">uint8</span>		
</span></span><span class="line"><span class="cl">    <span class="nx">B</span>         <span class="kt">uint8</span>		<span class="c1">// ËÆ∞ÂΩï Ê°∂(buckets)ÁöÑÊï∞ÁõÆÊòØ2ÁöÑÂ§öÂ∞ëÊ¨°ÂπÇ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">noverflow</span> <span class="kt">uint16</span>	<span class="c1">// ËÆ∞ÂΩï ‰ΩøÁî®ÁöÑÊ∫¢Âá∫Ê°∂ÁöÑÊï∞ÁõÆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">hash0</span>     <span class="kt">uint32</span>	<span class="c1">// ÂìàÂ∏åÁöÑÁßçÂ≠êÔºå‰∏∫ÂìàÂ∏åÂáΩÊï∞ÁöÑÁªìÊûúÂºïÂÖ•ÈöèÊú∫ÊÄß
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="nx">buckets</span>    <span class="nx">unsafe</span><span class="p">.</span><span class="nx">Pointer</span>	<span class="c1">// ËÆ∞ÂΩï Ê°∂ÁöÑ‰ΩçÁΩÆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">oldbuckets</span> <span class="nx">unsafe</span><span class="p">.</span><span class="nx">Pointer</span>	<span class="c1">// ËÆ∞ÂΩï Êâ©ÂÆπÈò∂ÊÆµÊóßÊ°∂ÁöÑ‰ΩçÁΩÆÔºåÂ§ßÂ∞èÊòØÂΩìÂâç buckets ÁöÑ‰∏ÄÂçä
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">nevacuate</span>  <span class="kt">uintptr</span>			<span class="c1">// ËÆ∞ÂΩï Êâ©ÂÆπÈò∂ÊÆµÊóßÊ°∂ËøÅÁßªËøõÂ∫¶Ôºö‰∏ã‰∏Ä‰∏™Ë¶ÅËøõË°åËøÅÁßªÁöÑÊóßÊ°∂ÁºñÂè∑
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="nx">extra</span> <span class="o">*</span><span class="nx">mapextra</span>				<span class="c1">// ËÆ∞ÂΩï Ê∫¢Âá∫Ê°∂Áõ∏ÂÖ≥‰ø°ÊÅØ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ËÆ∞ÂΩïÊ∫¢Âá∫Ê°∂Áõ∏ÂÖ≥‰ø°ÊÅØ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">mapextra</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">overflow</span>    <span class="o">*</span><span class="p">[]</span><span class="o">*</span><span class="nx">bmap</span>		<span class="c1">// ËÆ∞ÂΩï ÁõÆÂâçÂ∑≤Ë¢´‰ΩøÁî®ÁöÑÊ∫¢Âá∫Ê°∂ÁöÑÂú∞ÂùÄ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">oldoverflow</span> <span class="o">*</span><span class="p">[]</span><span class="o">*</span><span class="nx">bmap</span>		<span class="c1">// ËÆ∞ÂΩï Êâ©ÂÆπÈò∂ÊÆµÊóßÊ°∂‰ΩøÁî®Âà∞ÁöÑÊ∫¢Âá∫Ê°∂ÁöÑÂú∞ÂùÄ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">nextOverflow</span> <span class="o">*</span><span class="nx">bmap</span>			<span class="c1">// ‰∏ã‰∏Ä‰∏™Á©∫Èó≤Ê∫¢Âá∫Ê°∂
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">bmap</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">topbits</span>  <span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="kt">uint8</span>		<span class="c1">// ÊØè‰∏™topbitÈÉΩÊòØÂØπÂ∫îhashÂÄºÁöÑÈ´ò8‰ΩçÔºåÁ¥¢Âºï
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">keys</span>     <span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="nx">keytype</span>
</span></span><span class="line"><span class="cl">    <span class="nx">values</span>   <span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="nx">valuetype</span>
</span></span><span class="line"><span class="cl">    <span class="nx">pad</span>      <span class="kt">uintptr</span>
</span></span><span class="line"><span class="cl">    <span class="nx">overflow</span> <span class="kt">uintptr</span>		<span class="c1">// Ê∫¢Âá∫Ê°∂ÔºåÂ∏ÉÂ±Ä‰∏éÂ∏∏ËßÑbmapÁõ∏ÂêåÔºåÊòØ‰∏∫‰∫ÜÂáèÂ∞ëÊâ©ÂÆπÊ¨°Êï∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>GoËØ≠Ë®Ä‰∏≠Ôºå<strong>MapÁ±ªÂûãÁöÑÂèòÈáè</strong>Êú¨Ë¥®‰∏äÊòØ‰∏Ä‰∏™ÊåáÂêë<code>hmap</code>ÁªìÊûÑ‰ΩìÁöÑ<strong>ÊåáÈíà</strong>„ÄÇ</p>
<p>‰ΩøÁî®ÁöÑ<strong>Ê°∂ÁöÑÊï∞ÊçÆÁªìÊûÑ</strong>‰∏∫<code>bmap</code>ÁªìÊûÑÔºåÊØè‰∏Ä‰∏™<code>bmap</code>ÈÉΩËÉΩÂ≠òÂÇ®<code>8</code>‰∏™ÈîÆÂÄºÂØπÔºåÂΩìÂìàÂ∏åË°®‰∏≠Â≠òÂÇ®ÁöÑÊï∞ÊçÆËøáÂ§öÔºåÂçï‰∏™Ê°∂Â∑≤ÁªèË£ÖÊª°Êó∂Â∞±‰ºö‰ΩøÁî® <code>extra.nextOverflow</code> ‰∏≠ÁöÑÊ°∂Â≠òÂÇ®Ê∫¢Âá∫ÁöÑÊï∞ÊçÆ„ÄÇÈöèÁùÄÂìàÂ∏åË°®Â≠òÂÇ®ÁöÑÊï∞ÊçÆÈÄêÊ∏êÂ¢ûÂ§öÔºåÊàë‰ª¨‰ºö<strong>Êâ©ÂÆπÂìàÂ∏åË°®</strong>ÊàñËÄÖ<strong>‰ΩøÁî®Êõ¥Â§öÊ∫¢Âá∫Ê°∂</strong>Â≠òÂÇ®Ê∫¢Âá∫ÁöÑÊï∞ÊçÆ„ÄÇ</p>
<h4 id="1143-ÂàùÂßãÂåñ">1.1.4.3 ÂàùÂßãÂåñ</h4>
<h5 id="Â≠óÈù¢Èáè">==Â≠óÈù¢ÈáèÔºö==</h5>
<p>GoËØ≠Ë®Ä‰∏≠ÈÄöËøá<code>key: value</code>ÁöÑÊñπÊ≥ïË°®Á§∫ÈîÆÂÄºÂØπÔºåÂèØ‰ª•ÈÄöËøáÂ¶Ç‰∏ãÊñπÂºèÂàùÂßãÂåñÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">hash</span> <span class="o">:=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;1&#34;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;3&#34;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;5&#34;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÂΩì**<code>ÂìàÂ∏åË°®‰∏≠ÁöÑÂÖÉÁ¥†Êï∞Èáè &lt;= 25 </code>**Êó∂ÔºåÁºñËØëÂô®‰ºöÂ∞ÜÂ≠óÈù¢ÈáèÂàùÂßãÂåñÁöÑÁªìÊûÑ‰ΩìËΩ¨Êç¢Êàê‰ª•‰∏ãÁöÑ‰ª£Á†ÅÔºåÂ∞ÜÊâÄÊúâÁöÑÈîÆÂÄºÂØπ‰∏ÄÊ¨°Âä†ÂÖ•Âà∞ÂìàÂ∏åË°®‰∏≠Ôºö</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">hash</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">hash</span><span class="p">[</span><span class="s">&#34;1&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="nx">hash</span><span class="p">[</span><span class="s">&#34;3&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="nx">hash</span><span class="p">[</span><span class="s">&#34;5&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="mi">6</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÂΩì**<code>ÂìàÂ∏åË°®‰∏≠ÁöÑÂÖÉÁ¥†Êï∞Èáè &gt; 25 </code>**Êó∂ÔºåÁºñËØëÂô®‰ºöÂ∞ÜÂ≠óÈù¢ÈáèÂàùÂßãÂåñÁöÑÁªìÊûÑ‰ΩìËΩ¨Êç¢Êàê‰ª•‰∏ãÁöÑ‰ª£Á†ÅÔºåÂ∞ÜÊâÄÊúâÁöÑÈîÆÂÄºÂØπ‰∏ÄÊ¨°Âä†ÂÖ•Âà∞ÂìàÂ∏åË°®‰∏≠Ôºö</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">hash</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="p">,</span> <span class="mi">26</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">vstatk</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;1&#34;</span><span class="p">,</span> <span class="s">&#34;2&#34;</span><span class="p">,</span> <span class="s">&#34;3&#34;</span><span class="p">,</span> <span class="o">...</span> <span class="err">Ôºå</span> <span class="s">&#34;26&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">vstatv</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="o">...</span> <span class="p">,</span> <span class="mi">26</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">vstak</span><span class="p">);</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">hash</span><span class="p">[</span><span class="nx">vstatk</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span> <span class="p">=</span> <span class="nx">vstatv</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="ËøêË°åÊó∂">==ËøêË°åÊó∂Ôºö==</h5>
<p>Ê†πÊçÆ‰º†ÂÖ•ÁöÑ<code>B</code>Êù•Á°ÆÂÆöÈúÄË¶ÅÂàõÂª∫ÁöÑÊ°∂ÁöÑÊï∞ÈáèÔºö</p>
<ul>
<li>Ëã•<code>Ê°∂ÁöÑÊï∞Èáè &lt; 2^4</code>ÔºåÊ≠§Êó∂ËÆ§‰∏∫Êï∞ÊçÆÈáèËæÉÂ∞èÔºå‰ΩøÁî®Ê∫¢Âá∫Ê°∂ÁöÑÊ¶ÇÁéáËæÉ‰ΩéÔºåÂõ†Ê≠§‰∏çÂàõÂª∫Ê∫¢Âá∫Ê°∂Ôºõ</li>
<li>Ëã•<code>Ê°∂ÁöÑÊï∞Èáè &gt; 2^4</code>Ôºå‰ºöÈ¢ùÂ§ñÂàõÂª∫<code>2^(B-4)</code>‰∏™Ê∫¢Âá∫Ê°∂„ÄÇ</li>
</ul>
<p>**Ê≥®ÊÑèÔºö**Ê≠£Â∏∏Ê°∂ÂíåÊ∫¢Âá∫Ê°∂Âú®ÂÜÖÂ≠ò‰∏≠ÁöÑÂ≠òÂÇ®Á©∫Èó¥ÊòØËøûÁª≠ÁöÑ„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221204155115482.png" alt="image-20221204155115482" style="zoom: 50%;" />
<h4 id="1144-ËØªÂÜôÊìç‰Ωú">1.1.4.4 ËØªÂÜôÊìç‰Ωú</h4>
<h5 id="ËÆøÈóÆ">==ËÆøÈóÆÔºö==</h5>
<p>ÂÖ±Êúâ‰∏§ÁßçËÆøÈóÆÊñπÂºèÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">v</span>     <span class="o">:=</span> <span class="nx">hash</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="c1">// =&gt; v     := *mapaccess1(maptype, hash, &amp;key)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">v</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">hash</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="c1">// =&gt; v, ok := mapaccess2(maptype, hash, &amp;key)
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ËµãÂÄºËØ≠Âè•Â∑¶‰æßÊé•ÂèóÂèÇÊï∞ÁöÑ‰∏™Êï∞‰ºöÂÜ≥ÂÆö‰ΩøÁî®ÁöÑËøêË°åÊó∂ÊñπÊ≥ïÔºö</p>
<ul>
<li>ÂΩìÊé•Âèó‰∏Ä‰∏™ÂèÇÊï∞Êó∂Ôºå‰ºö‰ΩøÁî® <a href="https://draveness.me/golang/tree/runtime.mapaccess1" target="_blank" rel="noopener noreffer "><code>runtime.mapaccess1</code></a>ÔºåËØ•ÂáΩÊï∞‰ªÖ‰ºöËøîÂõû‰∏Ä‰∏™ÊåáÂêëÁõÆÊ†áÂÄºÁöÑ<strong>ÊåáÈíà</strong>ÔºàÊÑüËßâËøôÈáåÁöÑÊåáÈíàÂπ∂‰∏çÊòØ‰∏Ä‰∏™Âú∞ÂùÄÔºåÊÑüËßâËøòÊòØÁõÆÊ†áÂÄºÔºâÔºõ</li>
<li>ÂΩìÊé•Âèó‰∏§‰∏™ÂèÇÊï∞Êó∂Ôºå‰ºö‰ΩøÁî® <a href="https://draveness.me/golang/tree/runtime.mapaccess2" target="_blank" rel="noopener noreffer "><code>runtime.mapaccess2</code></a>ÔºåÈô§‰∫ÜËøîÂõûÁõÆÊ†áÂÄº‰πãÂ§ñÔºåÂÆÉËøò‰ºöËøîÂõû‰∏Ä‰∏™Áî®‰∫éË°®Á§∫ÂΩìÂâçÈîÆÂØπÂ∫îÁöÑÂÄºÊòØÂê¶Â≠òÂú®ÁöÑ <code>bool</code> ÂÄº„ÄÇ</li>
</ul>
<p><strong>Êü•ÊâæËøáÁ®ã‚≠êÔºö<strong>ÂìàÂ∏å‰ºö‰æùÊ¨°ÈÅçÂéÜÊ≠£Â∏∏Ê°∂ÂíåÊ∫¢Âá∫Ê°∂‰∏≠ÁöÑÊï∞ÊçÆÔºåÂÆÉ‰ºöÂÖàÊØîËæÉÂìàÂ∏åÁöÑÈ´ò 8 ‰ΩçÂíåÊ°∂‰∏≠Â≠òÂÇ®ÁöÑ <code>tophash</code>(</strong>==ÂáèÂ∞ëkeyÁöÑÂØπÊØîÊ¨°Êï∞ÔºåÁº©Â∞èÊü•ÊâæÊàêÊú¨==</strong>)ÔºåÂêé<strong>ÊØîËæÉ‰º†ÂÖ•ÁöÑÂíåÊ°∂‰∏≠ÁöÑ<code>key</code></strong>(<strong>==Âõ†Ê≠§keyÈúÄË¶ÅÊòØÂèØÊØîËæÉÁ±ªÂûã==</strong>)‰ª•Âä†ÈÄüÊï∞ÊçÆÁöÑËØªÂÜô„ÄÇ</p>
<p><strong>ÊØè‰∏Ä‰∏™Ê°∂ÈÉΩÊòØ‰∏ÄÊï¥ÁâáÁöÑÂÜÖÂ≠òÁ©∫Èó¥</strong>ÔºåÂΩìÂèëÁé∞Ê°∂‰∏≠ÁöÑ <code>tophash</code> ‰∏é‰º†ÂÖ•ÈîÆÁöÑ <code>tophash</code> ÂåπÈÖç‰πãÂêéÔºåÊàë‰ª¨‰ºöÈÄöËøáÊåáÈíàÂíåÂÅèÁßªÈáèËé∑ÂèñÂìàÂ∏å‰∏≠Â≠òÂÇ®ÁöÑÈîÆ <code>keys[x]</code> Âπ∂‰∏é <code>key</code> ÊØîËæÉÔºåÂ¶ÇÊûú‰∏§ËÄÖÁõ∏ÂêåÂ∞±‰ºöËé∑ÂèñÁõÆÊ†áÂÄºÁöÑÊåáÈíà <code>values[x]</code> Âπ∂ËøîÂõû„ÄÇ</p>
<h5 id="ÂÜôÂÖ•">==ÂÜôÂÖ•Ôºö==</h5>
<p>È¶ñÂÖà‰ºöÊ†πÊçÆ‰º†ÂÖ•ÁöÑ<code>key</code>ÊãøÂà∞ÂØπÂ∫îÁöÑÂìàÂ∏åÂíåÊ°∂ÔºåÁÑ∂ÂêéÈÄöËøáÈÅçÂéÜÊØîËæÉÊ°∂‰∏≠Â≠òÂÇ®ÁöÑ <code>tophash</code> Âíå<code>key</code>ÁöÑÂìàÂ∏åÔºå</p>
<ul>
<li>Â¶ÇÊûúÂΩìÂâçÈîÆÂÄºÂØπÂú®ÂìàÂ∏å‰∏≠<strong>Â≠òÂú®</strong>ÔºåÈÇ£‰πàÂ∞±‰ºöÁõ¥Êé•ËøîÂõûÁõÆÊ†áÂå∫ÂüüÁöÑÂÜÖÂ≠òÂú∞ÂùÄÔºõ</li>
<li>Â¶ÇÊûúÂΩìÂâçÈîÆÂÄºÂØπÂú®ÂìàÂ∏å‰∏≠<strong>‰∏çÂ≠òÂú®</strong>ÔºåÂìàÂ∏å‰ºö‰∏∫Êñ∞ÈîÆÂÄºÂØπËßÑÂàíÂ≠òÂÇ®ÁöÑÂÜÖÂ≠òÂú∞ÂùÄÂπ∂Â≠òÂÖ•„ÄÇ</li>
</ul>
<h4 id="1145-Êâ©ÂÆπ">1.1.4.5 ‚≠êÊâ©ÂÆπ</h4>
<p>Èô§‰∫ÜÁî®<strong>Êï£ÂàóÂùáÂåÄÁöÑÂìàÂ∏åÂáΩÊï∞</strong>Êù•ÊèêÈ´òËØªÂÜôÊÄßËÉΩÔºåËøòÂèØ‰ª•ÈÄöËøá<strong>ÂØπÂú∞ÂùÄÁ©∫Èó¥ÈÄÇÊó∂Êâ©ÂÆπ</strong>ÂáèÂ∞ëÂìàÂ∏åÂÜ≤Á™Å‰ª•ÊèêÈ´òÊÄßËÉΩ„ÄÇ</p>
<p><strong>Ë¥üËΩΩÂõ†Â≠êÔºö</strong><code>count/(2^B)</code>ÔºåÂç≥<code>Â≠òÂÇ®ÈîÆÂÄºÂØπÁöÑÊï∞ÁõÆ/Ê°∂ÁöÑÊï∞ÁõÆ</code>Ôºå<strong>Áî®Êù•Âà§Êñ≠ÊòØÂê¶ÈúÄË¶ÅËøõË°åÊâ©ÂÆπ</strong>„ÄÇ<strong>‰∏çÈöæÁêÜËß£</strong>ÔºåË£ÖËΩΩÂõ†Â≠êË∂äÂ§ßÔºåÂìàÂ∏åÁöÑËØªÂÜôÊÄßËÉΩÂ∞±Ë∂äÂ∑Æ„ÄÇ</p>
<p><strong>Êâ©ÂÆπËßÑÂàôÔºö</strong></p>
<ul>
<li><code>count/(2^B) &gt; 6.5</code> ‚Äì&gt; <strong>ÁøªÂÄçÊâ©ÂÆπ</strong>(<code>hamp.B++</code>)Ôºõ</li>
<li>‰ΩøÁî®‰∫Ü&quot;ËøáÂ§ö&quot;ÁöÑÊ∫¢Âá∫Ê°∂ -&gt; <strong>Á≠âÈáèÊâ©ÂÆπ</strong>„ÄÇ</li>
</ul>
<p><strong>Ê≥®Ôºö</strong>&ldquo;ËøáÂ§ö&rdquo; ÊåáÔºö</p>
<pre><code>1. `B &lt;= 15`Êó∂Ôºå`noverflow &gt;= 2^B`Ôºõ
1. `B &gt; 15`Êó∂Ôºå`noverflow &gt;= 2^15`„ÄÇ
</code></pre>
<p>**ÁøªÂÄçÊâ©ÂÆπÔºö**‰ºöÂàõÂª∫ÊóßÊ°∂Êï∞ÁõÆ2ÂÄçÁöÑÊñ∞Ê°∂ÔºåÁÑ∂ÂêéÂ∞ÜÊóßÊ°∂‰∏≠ÁöÑÈîÆÂÄºÂØπÂàÜÊµÅÂà∞ÂØπÂ∫îÁöÑ‰∏§‰∏™Êñ∞Ê°∂‰∏≠Ôºåb = hash(key) &amp; (2^B-1)Ôºå(Ëøô‰∏™Âú∞ÊñπÂæàÊúâÊÑèÊÄù)„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221204163810403.png" alt="image-20221204163810403" style="zoom: 33%;" />
<p><strong>Á≠âÈáèÊâ©ÂÆπÔºö<strong>ÊâÄË∞ì</strong>Á≠âÈáèÊâ©ÂÆπ</strong>Â∞±ÊòØÂàõÂª∫ÂíåÊóßÊ°∂Êï∞ÁõÆ‰∏ÄÊ†∑Â§öÁöÑÊñ∞Ê°∂ÔºåÁÑ∂ÂêéÊääÂéüÊù•ÁöÑÈîÆÂÄºÂØπËøÅÁßªÂà∞Êñ∞Ê°∂‰∏≠„ÄÇ**ËøôÈáåÊúâ‰∏Ä‰∏™ÈóÆÈ¢òÔºö**Êó¢ÁÑ∂ÊòØÁ≠âÈáèÁöÑÔºåÈÇ£‰ΩïÂøÖÊâ©ÂÆπÂë¢Ôºü</p>
<p>**Á≠îÔºö**ÂΩìÂèëÁîüÂ§ßËßÑÊ®°Âà†Èô§Êìç‰ΩúÊó∂ÔºåÊóßÊ°∂‰∏≠Â≠òÊîæÁöÑÈîÆÂÄºÂØπÂèØËÉΩÈùûÂ∏∏Á®ÄÁñèÔºåÂõ†Ê≠§‰∏∫‰∫ÜÁ¥ßÂáëÂÜÖÂ≠òÔºåÈúÄË¶ÅÂ∞ÜËøô‰∫õÈîÆÂÄºÂØπÈáçÊñ∞ÊéíÂàóÂà∞Êñ∞Ê°∂‰∏≠„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221204163312783.png" alt="image-20221204163312783" style="zoom: 33%;" />
<p><strong>==Point 3==</strong></p>
<p>Êâ©ÂÆπÊó∂Ôºå<strong>ÈúÄË¶ÅÊääÊóßÊ°∂‰∏≠ÁöÑÊï∞ÊçÆËøÅÁßªÂà∞Êñ∞Ê°∂</strong>Ôºå‰ΩÜÂπ∂‰∏çÈúÄË¶Å‰∏ÄÊ¨°ÊÄßËøÅÁßªÂÆå„ÄÇ</p>
<p><strong>Ê∏êËøõÂºèÊâ©ÂÆπÔºö<strong>Êää</strong>ÈîÆÂÄºÂØπËøÅÁßªÁöÑÊó∂Èó¥</strong>ÂàÜÊëäÂà∞<strong>Â§öÊ¨°ÂìàÂ∏åË°®Êìç‰Ωú</strong>‰∏≠ÔºåÂèØ‰ª•<strong>ÈÅøÂÖçÁû¨Êó∂ÁöÑÊÄßËÉΩÊäñÂä®</strong>„ÄÇÂú®ÂìàÂ∏åË°®ÊØèÊ¨°ËøõË°åËØªÂÜôÊìç‰ΩúÊó∂ÔºåÂ¶ÇÊûúÊ£ÄÊµãÂà∞ÂΩìÂâçÂ§Ñ‰∫é<strong>Êâ©ÂÆπÈò∂ÊÆµ</strong>ÔºåÂ∞±ÂÆåÊàê‰∏ÄÈÉ®ÂàÜ<strong>ÈîÆÂÄºÂØπËøÅÁßª‰ªªÂä°</strong>ÔºåÁõ¥Âà∞ÊâÄÊúâÁöÑÊóßÊ°∂ËøÅÁßªÂÆåÊØï„ÄÇ</p>
<p>**ÂÖ∑‰ΩìËøáÁ®ãÔºö**Êâ©ÂÆπÊó∂ÔºåÂ≠óÊÆµ<code>oldbuckets</code>ÊåáÂêëÊóßÊ°∂Ôºå<code>nevacuate</code>ËÆ∞ÂΩï‰∏ã‰∏Ä‰∏™ÂæÖËøÅÁßªÁöÑÊóßÊ°∂„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221203160841963.png" alt="image-20221203160841963" style="zoom:25%;" />
<p>‰∏™‰∫∫ËßâÂæóÔºåGoÊú¨Ë¥®‰∏äËøòÊòØÊãâÈìæÊ≥ïÔºå‰ΩÜÊòØÂÆÉÂÅö‰∫Ü‰∏Ä‰∫õÂÜÖÂ≠ò‰∏äÁöÑ‰ºòÂåñÔºå‰ª•Á©∫Èó¥Êç¢Êó∂Èó¥ÔºåÁªôÊØè‰∏™Ê°∂È¢ÑÂÖàÂàÜÈÖçÂèØ‰ª•Êîæ8‰∏™Êï∞ÊçÆÁöÑÁ©∫Èó¥ÔºåÂíå‰º†ÁªüÁöÑÊãâÈìæÊ≥ïÁõ∏ÊØîÔºå<strong>Â•ΩÂ§ÑÂ∞±ÊòØ‰∏çÈúÄË¶ÅÈ¢ëÁπÅÁöÑÂàÜÈÖçÂÜÖÂ≠ò</strong>ÔºåÂêåÊó∂Âú®Êüê‰∫õÊûÅÈôêÊÉÖÂÜµ‰∏ãÔºå‰πüÂèØ‰ª•ËäÇÁúÅ‰∏Ä‰∫õÁ©∫Èó¥Ôºå‰º†ÁªüÁöÑÊãâÈìæÊ≥ïËøòÈúÄË¶ÅÂ≠òÊîæÂâçÂêéÊï∞ÊçÆÁöÑÊåáÈíàÔºåÂú®64‰ΩçÊú∫Âô®‰∏äÂèàÊòØ16‰∏™Â≠óËäÇÁöÑÂºÄÈîÄÔºå‰ΩÜÊòØÁî®Êï∞ÁªÑÁöÑÊñπÂºèÁªÑÁªáÁöÑËØùÔºåÂ∞±‰∏çÈúÄË¶ÅÂ≠òÂÇ®ÂâçÂêéÁöÑÊåáÈíà„ÄÇÂ¶ÇÊûú‰∏Ä‰∏™Ê°∂ÈáåÈù¢Â≠òÊîæ‰∫ÜË∂ÖËøá8‰∏™Êï∞ÊçÆÔºåËøòÊòØÈúÄË¶ÅÂè¶‰∏Ä‰∏™bmapÊù•ÊîæÂ§ö‰ΩôÁöÑÊï∞ÔºåÁÑ∂ÂêéÊää‰∏§‰∏™bmapËøûÊé•Ëµ∑Êù•„ÄÇÊàëËßâÂæóÂØπÊØî‰∏Ä‰∏ãÔºå‰º†ÁªüÁöÑÊãâÈìæÊ≥ïÂ∞±ÊòØ‰∏Ä‰∏™ËäÇÁÇπÂè™ËÉΩÊîæ‰∏Ä‰∏™Êï∞ÊçÆÔºåËÄågoÊòØ‰∏Ä‰∏™ËäÇÁÇπÂèØ‰ª•Êîæ8‰∏™Êï∞ÊçÆÔºåËøô8‰∏™Êï∞ÊçÆÊòØÊåâÁÖßÊï∞ÁªÑÊù•ÁªÑÁªáÁöÑ„ÄÇ</p>
<h4 id="1145-Â∞èÁªì">1.1.4.5 Â∞èÁªì</h4>
<p>Go ËØ≠Ë®Ä‰ΩøÁî®<strong>ÊãâÈìæÊ≥ï</strong>Êù•Ëß£ÂÜ≥ÂìàÂ∏åÁ¢∞ÊíûÁöÑÈóÆÈ¢òÂÆûÁé∞‰∫ÜÂìàÂ∏åË°®ÔºåÂÆÉÁöÑËÆøÈóÆ„ÄÅÂÜôÂÖ•ÂíåÂà†Èô§Á≠âÊìç‰ΩúÈÉΩÂú®ÁºñËØëÊúüÈó¥ËΩ¨Êç¢Êàê‰∫ÜËøêË°åÊó∂ÁöÑÂáΩÊï∞ÊàñËÄÖÊñπÊ≥ï„ÄÇÂìàÂ∏åÂú®ÊØè‰∏Ä‰∏™Ê°∂‰∏≠Â≠òÂÇ®ÈîÆÂØπÂ∫îÂìàÂ∏åÁöÑÂâç 8 ‰ΩçÔºåÂΩìÂØπÂìàÂ∏åËøõË°åÊìç‰ΩúÊó∂ÔºåËøô‰∫õ <code>tophash</code> Â∞±Êàê‰∏∫ÂèØ‰ª•Â∏ÆÂä©ÂìàÂ∏åÂø´ÈÄüÈÅçÂéÜÊ°∂‰∏≠ÂÖÉÁ¥†ÁöÑÁºìÂ≠ò„ÄÇ</p>
<p><strong>ÂìàÂ∏åË°®ÁöÑÊØè‰∏™Ê°∂ÈÉΩÂè™ËÉΩÂ≠òÂÇ® 8 ‰∏™ÈîÆÂÄºÂØπ</strong>Ôºå‰∏ÄÊó¶ÂΩìÂâçÂìàÂ∏åÁöÑÊüê‰∏™Ê°∂Ë∂ÖÂá∫ 8 ‰∏™ÔºåÊñ∞ÁöÑÈîÆÂÄºÂØπÂ∞±‰ºöÂ≠òÂÇ®Âà∞ÂìàÂ∏åÁöÑ<strong>Ê∫¢Âá∫Ê°∂</strong>‰∏≠„ÄÇÈöèÁùÄÈîÆÂÄºÂØπÊï∞ÈáèÁöÑÂ¢ûÂä†ÔºåÊ∫¢Âá∫Ê°∂ÁöÑÊï∞ÈáèÂíåÂìàÂ∏åÁöÑË£ÖËΩΩÂõ†Â≠ê‰πü‰ºöÈÄêÊ∏êÂçáÈ´òÔºåË∂ÖËøá‰∏ÄÂÆöËåÉÂõ¥Â∞±‰ºöËß¶ÂèëÊâ©ÂÆπÔºåÊâ©ÂÆπ‰ºöÂ∞ÜÊ°∂ÁöÑÊï∞ÈáèÁøªÂÄçÔºåÂÖÉÁ¥†ÂÜçÂàÜÈÖçÁöÑËøáÁ®ã‰πüÊòØÂú®Ë∞ÉÁî®<strong>ÂÜôÊìç‰Ωú</strong>Êó∂Â¢ûÈáèËøõË°åÁöÑÔºå‰∏ç‰ºöÈÄ†ÊàêÊÄßËÉΩÁöÑÁû¨Êó∂Â∑®Â§ßÊäñÂä®„ÄÇ</p>
<h3 id="115-syncmap">1.1.5 sync.map</h3>
<blockquote>
<h4 id="ÈóÆsyncmap-Âíå-mutexmap-ÊúâÂï•Âå∫Âà´syncmap-‰∏∫Âï•Ë¶ÅÊúâ‰ø©-mapreaddirty‰∏Ä‰∏™‰∏çË°åÂêó">ÈóÆÔºösync.map Âíå mutex+map ÊúâÂï•Âå∫Âà´Ôºüsync.map ‰∏∫Âï•Ë¶ÅÊúâ‰ø© map(read+dirty)Ôºü‰∏Ä‰∏™‰∏çË°åÂêóÔºü</h4>
</blockquote>
<p>‰∏Ä‰∏™ÊòØ‰∏çË°åÁöÑÔºå‰Ω†ÊÄª‰∏çËÉΩËØª‰∏çÂä†ÈîÅÔºåÂÜôÂä†ÈîÅÂêßÔºüËøôÊ†∑ÁÖßÊ†∑‰ºöÊúâÂπ∂ÂèëËÆøÈóÆÁöÑÈóÆÈ¢ò(ÊòØ‰ºöÊä•ÈîôÁöÑ)„ÄÇ‰ΩÜÊòØÂ¶ÇÊûúÊòØ read+dirtyÔºåÂ∞±ÂèØ‰ª•ÂØπ read ÁöÑÊâÄÊúâÊìç‰ΩúÈÉΩ‰∏çÂä†ÈîÅÔºåÂØπ dirty ÁöÑÊâÄÊúâÊìç‰ΩúÈÉΩË¶ÅÂä†ÈîÅÔºåÂ∞±ÂèØ‰ª•ÈÅøÂÖçÂπ∂ÂèëÈóÆÈ¢ò„ÄÇÊàëËßâÂæóÊúÄÂÖ≥ÈîÆÁöÑÂ∑ÆÂà´Â∞±ÊòØËøô‰∏™Âú∞ÊñπÔºÅ‰πüÊòØÂæàÁ≤æÂ¶ôÁöÑÂú∞ÊñπÔºÅ</p>
<hr>
<p>ÂèÇËÄÉÊñáÁ´†Ôºö</p>
<ul>
<li>
<p><a href="https://eddycjy.com/posts/go/sync-map/" target="_blank" rel="noopener noreffer ">https://eddycjy.com/posts/go/sync-map/</a></p>
</li>
<li>
<p><a href="https://mp.weixin.qq.com/s/vtvlye801ePWRY7RvtkDmA" target="_blank" rel="noopener noreffer ">https://mp.weixin.qq.com/s/vtvlye801ePWRY7RvtkDmA</a> ‚≠ê</p>
</li>
</ul>
<p>ÂÖàÊù•ÁúãÁúã <code>sync.map</code> ÁöÑÂ∫ïÂ±ÇÊï∞ÊçÆÁªìÊûÑÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Map</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">mu</span> <span class="nx">Mutex</span>						<span class="c1">// ‰øùÊä§ dirty Âíå read
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">read</span> <span class="nx">atomic</span><span class="p">.</span><span class="nx">Value</span> 				<span class="c1">// readOnlyÔºåÂè™ËØªÁ±ªÂûãÔºåÊâÄ‰ª•ÊòØÂπ∂ÂèëÂÆâÂÖ®ÁöÑ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">dirty</span> <span class="kd">map</span><span class="p">[</span><span class="kd">interface</span><span class="p">{}]</span><span class="o">*</span><span class="nx">entry</span>	<span class="c1">// ‰∏Ä‰∏™ÈùûÁ∫øÁ®ãÂÆâÂÖ®ÁöÑÂéüÂßã map
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">misses</span> <span class="kt">int</span>						<span class="c1">// ËÆ°Êï∞‰ΩúÁî®„ÄÇÂΩìËØªÊï∞ÊçÆÊó∂ÔºåËØ•Â≠óÊÆµ‰∏çÂú® read ‰∏≠ÔºåÂ∞ùËØï‰ªé dirty ‰∏≠ËØªÂèñÔºå‰∏çÁÆ°ÊòØÂê¶Âú® dirty ‰∏≠ËØªÂèñÂà∞Êï∞ÊçÆÔºåmisses+1„ÄÇÂΩì misses Á¥ØËÆ°Âà∞ len(dirty) Êó∂Ôºå‰ºöÂ∞Ü dirty Êã∑Ë¥ùÂà∞ read ‰∏≠ÔºåÂπ∂Â∞Ü dirty Ê∏ÖÁ©∫Ôºå‰ª•Ê≠§ÊèêÂçáËØªÊÄßËÉΩ„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// read ÁöÑÁ±ªÂûã‰∏∫ atomic.ValueÔºåÂÆÉ‰ºöÈÄöËøá atomic.Value ÁöÑ Load ÊñπÊ≥ïÂ∞ÜÂÖ∂Êñ≠Ë®Ä‰∏∫ readOnly ÂØπË±°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">read</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">read</span><span class="p">.</span><span class="nf">Load</span><span class="p">().(</span><span class="nx">readOnly</span><span class="p">)</span> <span class="c1">// m ‰∏∫ sync.Map
</span></span></span><span class="line"><span class="cl"><span class="c1">// read ÁöÑÁúüÂÆûÁ±ªÂûãÂç≥ÊòØ readOnly
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">readOnly</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">m</span>       <span class="kd">map</span><span class="p">[</span><span class="kd">interface</span><span class="p">{}]</span><span class="o">*</span><span class="nx">entry</span>	<span class="c1">// read ‰∏≠ÁöÑ go ÂÜÖÁΩÆ map Á±ªÂûãÔºå‰ΩÜÊòØÂÆÉ‰∏çÈúÄË¶ÅÈîÅ„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">amended</span> <span class="kt">bool</span>	<span class="c1">// ÂΩì sync.Map.diry ‰∏≠ÁöÑÂåÖÂê´‰∫ÜÊüê‰∫õ‰∏çÂú® m ‰∏≠ÁöÑ key Êó∂Ôºåamended ÁöÑÂÄº‰∏∫ true.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// map Â≠òÂÇ®ÁöÑÂÄºÁ±ªÂûãÊòØ *entryÔºåÂÆÉÂåÖÂê´‰∏Ä‰∏™ÊåáÈíà pÔºåÊåáÂêëÁî®Êà∑Â≠òÂÇ®ÁöÑ value ÂÄº„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">entry</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">p</span> <span class="nx">unsafe</span><span class="p">.</span><span class="nx">Pointer</span> <span class="c1">// *interface{}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong><code>mu</code></strong>Ôºö<strong>‰øùÊä§ dirty</strong>Ôºõ</li>
<li><strong><code>read</code></strong>Ôºö<strong>Â≠òÂè™ËØªÊï∞ÊçÆ</strong>„ÄÇËØªÊòØÂπ∂ÂèëÂÆâÂÖ®ÁöÑÔºå‰ΩÜÂ¶ÇÊûúË¶ÅÊõ¥Êñ∞ <code>read</code>ÔºåÂàôÈúÄË¶ÅÂä†ÈîÅ‰øùÊä§Ôºõ</li>
<li><strong><code>dirty</code></strong>Ôºö<strong>ÂåÖÂê´ÊúÄÊñ∞ÂÜôÂÖ•ÁöÑÊï∞ÊçÆ</strong>„ÄÇÂΩì misses ËÆ°Êï∞ËææÂà∞‰∏ÄÂÆöÂÄºÔºåÂ∞ÜÂÖ∂ËµãÂÄºÁªô readÔºõ</li>
<li><strong><code>misses</code></strong>Ôºö<strong>ËÆ°Êï∞‰ΩúÁî®</strong>„ÄÇÂΩìËØªÊï∞ÊçÆÊó∂ÔºåËØ•Â≠óÊÆµ‰∏çÂú® read ‰∏≠ÔºåÂ∞ùËØï‰ªé dirty ‰∏≠ËØªÂèñÔºå‰∏çÁÆ°ÊòØÂê¶Âú® dirty ‰∏≠ËØªÂèñÂà∞Êï∞ÊçÆÔºåmisses+1„ÄÇÂΩì misses Á¥ØËÆ°Âà∞ len(dirty) Êó∂Ôºå‰ºöÂ∞Ü dirty Êã∑Ë¥ùÂà∞ read ‰∏≠ÔºåÂπ∂Â∞Ü dirty Ê∏ÖÁ©∫Ôºå‰ª•Ê≠§ÊèêÂçáËØªÊÄßËÉΩ„ÄÇ</li>
</ul>
<h4 id="1151-Êü•ËØ¢Êï∞ÊçÆ">1.1.5.1 Êü•ËØ¢Êï∞ÊçÆ</h4>
<p><code>Load()</code>:</p>
<ul>
<li>È¶ñÂÖàÔºå<strong>‰ªéÂè™ËØªÊï∞ÊçÆ<code>read</code>‰∏≠ËØªÂèñ</strong>(Âõ†‰∏∫‰∏çÁî®Âä†ÈîÅ)ÔºåËã•ÊúâÂ∞±Áõ¥Êé•ËøîÂõûÔºåËã•Êó†ÂÜçÁªßÁª≠ÂæÄ‰∏ãÔºõ</li>
<li>Ëã•<code>read</code>Ê≤°ÊúâÔºå‰∏î<code>dirty</code>‰∏≠ÊúâÊñ∞Êï∞ÊçÆÔºåÂ∞±‰ºö<strong>Âéª<code>dirty</code>Êü•Êâæ</strong>Ôºõ</li>
<li><strong>ÂÖàÂä†ÈîÅ</strong>ÔºåÁÑ∂ÂêéÂÜçÊ¨°Ê£ÄÊü•<code>read</code>ÔºåËã•ËøòÊ≤°ÊúâÔºåÊâç<strong>ÁúüÊ≠£Âéª<code>dirty</code>Êü•Êâæ</strong>ÔºåÂπ∂‰∏îÂØπ<code>miss</code>ËÆ°Êï∞Âô®+1(Êó†ËÆ∫ÊòØÂê¶ÊâæÂà∞)Ôºõ</li>
<li>Ëã•<code>miss</code>ÁöÑÂÄº &gt;= <code>dirty</code>‰∏≠ÁöÑÂÖÉÁ¥†Êï∞ÈáèÔºåÂ∞±Êää<code>dirty</code>ËµãÁªô<code>read</code>ÔºåÂõ†‰∏∫Á©øÈÄèÊ¨°Êï∞Â§™Â§ö‰∫ÜÔºåÁÑ∂ÂêéÂ∞±ÂèØ‰ª•Êää<code>dirty</code>ÁΩÆ‰∏∫Á©∫‰∫Ü„ÄÇ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="o">*</span><span class="nx">Map</span><span class="p">)</span> <span class="nf">Load</span><span class="p">(</span><span class="nx">key</span> <span class="kd">interface</span><span class="p">{})</span> <span class="p">(</span><span class="nx">value</span> <span class="kd">interface</span><span class="p">{},</span> <span class="nx">ok</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// È¶ñÂÖà‰ªé m.read ‰∏≠ÈÄöËøá Load ÊñπÊ≥ïÂæóÂà∞ readOnly
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">read</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">read</span><span class="p">.</span><span class="nf">Load</span><span class="p">().(</span><span class="nx">readOnly</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ‰ªé read ‰∏≠ÁöÑ map ‰∏≠Êü•Êâæ key
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">e</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">read</span><span class="p">.</span><span class="nx">m</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// Â¶ÇÊûú read Ê≤°ÊúâÔºåÂπ∂‰∏î dirty ÊúâÊñ∞Êï∞ÊçÆÔºåÈÇ£‰πàÂéª dirty ‰∏≠Êü•Êâæ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">!</span><span class="nx">ok</span> <span class="o">&amp;&amp;</span> <span class="nx">read</span><span class="p">.</span><span class="nx">amended</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">m</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nf">Lock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ÂèåÈáçÊ£ÄÊü•ÔºöÈÅøÂÖçÂú®Êú¨Ê¨°Âä†ÈîÅÁöÑÊó∂ÂÄôÔºåÊúâÂÖ∂‰ªñ goroutine Ê≠£Â•ΩÂ∞Ü Map ‰∏≠ÁöÑ dirty Êï∞ÊçÆÂ§çÂà∂Âà∞‰∫Ü read ‰∏≠„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">read</span><span class="p">,</span> <span class="nx">_</span> <span class="p">=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">read</span><span class="p">.</span><span class="nf">Load</span><span class="p">().(</span><span class="nx">readOnly</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">e</span><span class="p">,</span> <span class="nx">ok</span> <span class="p">=</span> <span class="nx">read</span><span class="p">.</span><span class="nx">m</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1">// Â¶ÇÊûú read ‰∏≠ËøòÊòØ‰∏çÂ≠òÂú®ÔºåÂπ∂‰∏î dirty ‰∏≠ÊúâÊñ∞Êï∞ÊçÆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">!</span><span class="nx">ok</span> <span class="o">&amp;&amp;</span> <span class="nx">read</span><span class="p">.</span><span class="nx">amended</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">e</span><span class="p">,</span> <span class="nx">ok</span> <span class="p">=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">dirty</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// m ËÆ°Êï∞ +1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">m</span><span class="p">.</span><span class="nf">missLocked</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="nx">m</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nf">Unlock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">!</span><span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">e</span><span class="p">.</span><span class="nf">load</span><span class="p">()</span>	<span class="c1">// ËøîÂõûÊåáÈíàÊåáÂêëÁöÑÂÄº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="o">*</span><span class="nx">Map</span><span class="p">)</span> <span class="nf">missLocked</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">m</span><span class="p">.</span><span class="nx">misses</span><span class="o">++</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">m</span><span class="p">.</span><span class="nx">misses</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">dirty</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// Â∞ÜdirtyÁΩÆÁªôreadÔºåÂõ†‰∏∫Á©øÈÄèÊ¶ÇÁéáÂ§™Â§ß‰∫Ü(ÂéüÂ≠êÊìç‰ΩúÔºåËÄóÊó∂ÂæàÂ∞è)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">m</span><span class="p">.</span><span class="nx">read</span><span class="p">.</span><span class="nf">Store</span><span class="p">(</span><span class="nx">readOnly</span><span class="p">{</span><span class="nx">m</span><span class="p">:</span> <span class="nx">m</span><span class="p">.</span><span class="nx">dirty</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="nx">m</span><span class="p">.</span><span class="nx">dirty</span> <span class="p">=</span> <span class="kc">nil</span>	<span class="c1">// Ê∏ÖÁ©∫ dirty
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">m</span><span class="p">.</span><span class="nx">misses</span> <span class="p">=</span> <span class="mi">0</span>	<span class="c1">// ÈáçÁΩÆ misses
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="1152-Âà†Èô§Êï∞ÊçÆ">1.1.5.2 Âà†Èô§Êï∞ÊçÆ</h4>
<p><code>Delete()</code>Ôºö</p>
<ul>
<li>È¶ñÂÖàÔºå‰ªéÂè™ËØªÊï∞ÊçÆ<code>read</code>‰∏≠ËØªÂèñÔºåËã•ÊúâÁöÑËØùÔºåÂ∞±Áõ¥Êé•‰ªé<code>read</code>‰∏≠&quot;Âà†Èô§&quot;(Âπ∂ÈùûÁúüÁöÑÂà†Èô§ÔºåÂè™ÊòØÊ†áËÆ∞‰∏Ä‰∏ã)Ôºõ</li>
<li>Ëã•<code>read</code>‰∏≠Ê≤°ÊúâÔºåÂ∞±Ëé∑ÂæóÈîÅÔºåÁÑ∂ÂêéÂÜçÊ£ÄÊü•‰∏ÄÈÅç<code>read</code>ÔºåÁÑ∂ÂêéÂ∞±‰ªé<code>dirty</code>‰∏≠Âà†Èô§Ôºõ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="o">*</span><span class="nx">Map</span><span class="p">)</span> <span class="nf">Delete</span><span class="p">(</span><span class="nx">key</span> <span class="kd">interface</span><span class="p">{})</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ËØªÂá∫ readÔºåÊñ≠Ë®Ä‰∏∫readOnly Á±ªÂûã
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">read</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">read</span><span class="p">.</span><span class="nf">Load</span><span class="p">().(</span><span class="nx">readOnly</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">e</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">read</span><span class="p">.</span><span class="nx">m</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Â¶ÇÊûú read ‰∏≠Ê≤°ÊúâÔºåÂπ∂‰∏î dirty ‰∏≠ÊúâÊñ∞ÂÖÉÁ¥†ÔºåÈÇ£‰πàÂ∞±Âéª dirty ‰∏≠ÂéªÊâæ„ÄÇËøôÈáåÁî®Âà∞‰∫Ü amendedÔºåÂΩì read ‰∏é dirty ‰∏çÂêåÊó∂‰∏∫ trueÔºåËØ¥Êòé dirty ‰∏≠Êúâ read Ê≤°ÊúâÁöÑÊï∞ÊçÆ„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">!</span><span class="nx">ok</span> <span class="o">&amp;&amp;</span> <span class="nx">read</span><span class="p">.</span><span class="nx">amended</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">m</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nf">Lock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ÂÜçÊ£ÄÊü•‰∏ÄÊ¨°ÔºåÂõ†‰∏∫ÂâçÊñáÁöÑÂà§Êñ≠ÂíåÈîÅ‰∏çÊòØÂéüÂ≠êÊìç‰ΩúÔºåÈò≤Ê≠¢ÊúüÈó¥ÂèëÁîü‰∫ÜÂèòÂåñ„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">read</span><span class="p">,</span> <span class="nx">_</span> <span class="p">=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">read</span><span class="p">.</span><span class="nf">Load</span><span class="p">().(</span><span class="nx">readOnly</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">e</span><span class="p">,</span> <span class="nx">ok</span> <span class="p">=</span> <span class="nx">read</span><span class="p">.</span><span class="nx">m</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">!</span><span class="nx">ok</span> <span class="o">&amp;&amp;</span> <span class="nx">read</span><span class="p">.</span><span class="nx">amended</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// Áõ¥Êé•Âà†Èô§
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nb">delete</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">dirty</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nx">m</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nf">Unlock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Â¶ÇÊûú read ‰∏≠Â≠òÂú®ËØ• keyÔºåÂàôÂ∞ÜËØ• value ËµãÂÄº nil(ÈááÁî®Ê†áËÆ∞ÁöÑÊñπÂºèÂà†Èô§ÔºÅ)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">e</span><span class="p">.</span><span class="nb">delete</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Â¶ÇÊûú read ‰∏≠ÊúâËØ•ÈîÆÔºåÂàô‰ªé read ‰∏≠Âà†Èô§ÔºåÂÖ∂Âà†Èô§ÊñπÂºèÊòØÈÄöËøáÂéüÂ≠êÊìç‰Ωú
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">e</span> <span class="o">*</span><span class="nx">entry</span><span class="p">)</span> <span class="nb">delete</span><span class="p">()</span> <span class="p">(</span><span class="nx">hadValue</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">p</span> <span class="o">:=</span> <span class="nx">atomic</span><span class="p">.</span><span class="nf">LoadPointer</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">e</span><span class="p">.</span><span class="nx">p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Â¶ÇÊûú p ÊåáÈíà‰∏∫Á©∫ÔºåÊàñËÄÖË¢´Ê†áËÆ∞Ê∏ÖÈô§
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="nx">p</span> <span class="o">==</span> <span class="kc">nil</span> <span class="o">||</span> <span class="nx">p</span> <span class="o">==</span> <span class="nx">expunged</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1">// ÈÄöËøáÂéüÂ≠êÊìç‰ΩúÔºåÂ∞Ü e.p Ê†áËÆ∞‰∏∫ nil
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="nx">atomic</span><span class="p">.</span><span class="nf">CompareAndSwapPointer</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">e</span><span class="p">.</span><span class="nx">p</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="1153-Â¢ûÊîπÊï∞ÊçÆ">1.1.5.3 Â¢ûÊîπÊï∞ÊçÆ</h4>
<p><code>Store()</code>Ôºö</p>
<ul>
<li>È¶ñÂÖàÔºå‰ªéÂè™ËØªÊï∞ÊçÆ<code>read</code>‰∏≠Ëé∑ÂèñËØ•<code>key</code>ÔºåËã•Â≠òÂú®ÔºåÂπ∂‰∏îÊ≤°ÊúâË¢´Ê†áËÆ∞Âà†Èô§ÔºåÂ∞±Â∞ùËØïÊõ¥Êñ∞Ôºõ</li>
<li>Â¶ÇÊûúÂú®<code>read</code>‰∏≠‰∏çÂ≠òÂú®ÊàñÂ∑≤Ë¢´Ê†áËÆ∞Âà†Èô§ÔºåÂ∞±Âú®<code>dirty</code>‰∏≠Âà§Êñ≠ÊòØÂê¶Â≠òÂú®ÔºåËã•Â∑≤Â≠òÂú®ÔºåÂ∞±Â∞ùËØïÊõ¥Êñ∞Ôºõ</li>
<li>Ëã•Âú®<code>dirty</code>‰∏≠‰∏çÂ≠òÂú®ÔºåÂ∞±Âä†ÂÖ•<code>dirty</code>Ôºõ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="o">*</span><span class="nx">Map</span><span class="p">)</span> <span class="nf">Store</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="kd">interface</span><span class="p">{})</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Â¶ÇÊûú m.read ‰∏≠Â≠òÂú®ËØ•ÈîÆÔºå‰∏îËØ•ÈîÆÊ≤°ÊúâË¢´Ê†áËÆ∞Âà†Èô§(expunged)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// ÂàôÂ∞ùËØïÁõ¥Êé•Â≠òÂÇ®(ËßÅ entry ÁöÑ tryStore ÊñπÊ≥ï)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// Ê≥®ÊÑèÔºöÂ¶ÇÊûú m.dirty ‰∏≠‰πüÊúâËØ•ÈîÆ(key ÂØπÂ∫îÁöÑ entry)ÔºåÁî±‰∫éÈÉΩÊòØÈÄöËøáÊåáÈíàÊåáÂêëÔºåÊâÄÊúâ m.dirty ‰∏≠‰πü‰ºö‰øùÊåÅÊúÄÊñ∞ entry ÂÄº„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">read</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">read</span><span class="p">.</span><span class="nf">Load</span><span class="p">().(</span><span class="nx">readOnly</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">e</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">read</span><span class="p">.</span><span class="nx">m</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span> <span class="nx">ok</span> <span class="o">&amp;&amp;</span> <span class="nx">e</span><span class="p">.</span><span class="nf">tryStore</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// Â¶ÇÊûú‰∏çÊª°Ë∂≥‰∏äËø∞Êù°‰ª∂ÔºåÂç≥ read ‰∏çÂ≠òÂú®ÊàñËÄÖÂ∑≤ÁªèË¢´Ê†áËÆ∞Âà†Èô§
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">m</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nf">Lock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="nx">read</span><span class="p">,</span> <span class="nx">_</span> <span class="p">=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">read</span><span class="p">.</span><span class="nf">Load</span><span class="p">().(</span><span class="nx">readOnly</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">e</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">read</span><span class="p">.</span><span class="nx">m</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span> <span class="nx">ok</span> <span class="p">{</span> <span class="c1">// read Â≠òÂú®ËØ• key
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// Â¶ÇÊûú entry Ë¢´Ê†áËÆ∞ expungeÔºåÂàôË°®Êòé dirty Ê≤°Êúâ keyÔºåÂèØÊ∑ªÂä†ÂÖ• dirtyÔºåÂπ∂Êõ¥Êñ∞ entry„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="nx">e</span><span class="p">.</span><span class="nf">unexpungeLocked</span><span class="p">()</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">            <span class="c1">// Âä†ÂÖ• dirty ‰∏≠ÔºåËøôÂÑøÊòØÊåáÈíà
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">m</span><span class="p">.</span><span class="nx">dirty</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="p">=</span> <span class="nx">e</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Êõ¥Êñ∞ entry ÊåáÂêëÊñ∞ÁöÑ value Âú∞ÂùÄ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">e</span><span class="p">.</span><span class="nf">storeLocked</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">value</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="nx">e</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">dirty</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span> <span class="nx">ok</span> <span class="p">{</span> <span class="c1">// read ‰∏çÂ≠òÂú®ËØ• keyÔºå‰ΩÜ dirty Â≠òÂú®ËØ• keyÔºåÊõ¥Êñ∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">e</span><span class="p">.</span><span class="nf">storeLocked</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// read Âíå dirty ÈÉΩÊ≤°Êúâ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// Â¶ÇÊûú read ‰∏é dirty Áõ∏ÂêåÔºåÂàôËß¶Âèë‰∏ÄÊ¨° dirty Âà∑Êñ∞(Âõ†‰∏∫ÂΩì read ÈáçÁΩÆÁöÑÊó∂ÂÄôÔºådirty Â∑≤ÁΩÆ‰∏∫ nil ‰∫Ü)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">!</span><span class="nx">read</span><span class="p">.</span><span class="nx">amended</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">            <span class="c1">// Â∞Ü read ‰∏≠Êú™Âà†Èô§ÁöÑÊï∞ÊçÆÂä†ÂÖ•Âà∞ dirty ‰∏≠
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">m</span><span class="p">.</span><span class="nf">dirtyLocked</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl">            <span class="c1">// amended Ê†áËÆ∞‰∏∫ read ‰∏é dirty ‰∏çÁõ∏ÂêåÔºåÂõ†‰∏∫ÂêéÈù¢Âç≥Â∞ÜÂä†ÂÖ•Êñ∞Êï∞ÊçÆ„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">m</span><span class="p">.</span><span class="nx">read</span><span class="p">.</span><span class="nf">Store</span><span class="p">(</span><span class="nx">readOnly</span><span class="p">{</span><span class="nx">m</span><span class="p">:</span> <span class="nx">read</span><span class="p">.</span><span class="nx">m</span><span class="p">,</span> <span class="nx">amended</span><span class="p">:</span> <span class="kc">true</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nx">m</span><span class="p">.</span><span class="nx">dirty</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="p">=</span> <span class="nf">newEntry</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">m</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nf">Unlock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Â∞Ü read ‰∏≠Êú™Âà†Èô§ÁöÑÊï∞ÊçÆÂä†ÂÖ•Âà∞ dirty ‰∏≠
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="o">*</span><span class="nx">Map</span><span class="p">)</span> <span class="nf">dirtyLocked</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">m</span><span class="p">.</span><span class="nx">dirty</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nx">read</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">read</span><span class="p">.</span><span class="nf">Load</span><span class="p">().(</span><span class="nx">readOnly</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">m</span><span class="p">.</span><span class="nx">dirty</span> <span class="p">=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kd">interface</span><span class="p">{}]</span><span class="o">*</span><span class="nx">entry</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">read</span><span class="p">.</span><span class="nx">m</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// ÈÅçÂéÜ read
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">for</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">e</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">read</span><span class="p">.</span><span class="nx">m</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ÈÄöËøáÊ≠§Ê¨°Êìç‰ΩúÔºådirty ‰∏≠ÁöÑÂÖÉÁ¥†ÈÉΩÊòØÊú™Ë¢´Âà†Èô§ÁöÑÔºåÂèØËßÅÊ†áËÆ∞‰∏∫ expunged ÁöÑÂÖÉÁ¥†‰∏çÂú® dirty ‰∏≠ÔºÅÔºÅÔºÅ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">!</span><span class="nx">e</span><span class="p">.</span><span class="nf">tryExpungeLocked</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">m</span><span class="p">.</span><span class="nx">dirty</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="p">=</span> <span class="nx">e</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Âà§Êñ≠ entry ÊòØÂê¶Ë¢´Ê†áËÆ∞Âà†Èô§ÔºåÂπ∂‰∏îÂ∞ÜÊ†áËÆ∞‰∏∫ nil ÁöÑ entry Êõ¥Êñ∞Ê†áËÆ∞‰∏∫ expunge
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">e</span> <span class="o">*</span><span class="nx">entry</span><span class="p">)</span> <span class="nf">tryExpungeLocked</span><span class="p">()</span> <span class="p">(</span><span class="nx">isExpunged</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">p</span> <span class="o">:=</span> <span class="nx">atomic</span><span class="p">.</span><span class="nf">LoadPointer</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">e</span><span class="p">.</span><span class="nx">p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="nx">p</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Â∞ÜÂ∑≤ÁªèÂà†Èô§Ê†áËÆ∞‰∏∫ nil ÁöÑÊï∞ÊçÆÊ†áËÆ∞‰∏∫ expunged
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="nx">atomic</span><span class="p">.</span><span class="nf">CompareAndSwapPointer</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">e</span><span class="p">.</span><span class="nx">p</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">expunged</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nx">p</span> <span class="p">=</span> <span class="nx">atomic</span><span class="p">.</span><span class="nf">LoadPointer</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">e</span><span class="p">.</span><span class="nx">p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">p</span> <span class="o">==</span> <span class="nx">expunged</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ÂØπ entry Â∞ùËØïÊõ¥Êñ∞(ÂéüÂ≠ê cas Êìç‰Ωú)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">e</span> <span class="o">*</span><span class="nx">entry</span><span class="p">)</span> <span class="nf">tryStore</span><span class="p">(</span><span class="nx">i</span> <span class="o">*</span><span class="kd">interface</span><span class="p">{})</span> <span class="kt">bool</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">p</span> <span class="o">:=</span> <span class="nx">atomic</span><span class="p">.</span><span class="nf">LoadPointer</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">e</span><span class="p">.</span><span class="nx">p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">p</span> <span class="o">==</span> <span class="nx">expunged</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nx">atomic</span><span class="p">.</span><span class="nf">CompareAndSwapPointer</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">e</span><span class="p">.</span><span class="nx">p</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">unsafe</span><span class="p">.</span><span class="nf">Pointer</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nx">p</span> <span class="p">=</span> <span class="nx">atomic</span><span class="p">.</span><span class="nf">LoadPointer</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">e</span><span class="p">.</span><span class="nx">p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nx">p</span> <span class="o">==</span> <span class="nx">expunged</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// read ÈáåÂ∞ÜÊ†áËÆ∞‰∏∫ expunge ÁöÑÊõ¥Êñ∞‰∏∫ nil
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">e</span> <span class="o">*</span><span class="nx">entry</span><span class="p">)</span> <span class="nf">unexpungeLocked</span><span class="p">()</span> <span class="p">(</span><span class="nx">wasExpunged</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">atomic</span><span class="p">.</span><span class="nf">CompareAndSwapPointer</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">e</span><span class="p">.</span><span class="nx">p</span><span class="p">,</span> <span class="nx">expunged</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Êõ¥Êñ∞ entry
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">e</span> <span class="o">*</span><span class="nx">entry</span><span class="p">)</span> <span class="nf">storeLocked</span><span class="p">(</span><span class="nx">i</span> <span class="o">*</span><span class="kd">interface</span><span class="p">{})</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">atomic</span><span class="p">.</span><span class="nf">StorePointer</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">e</span><span class="p">.</span><span class="nx">p</span><span class="p">,</span> <span class="nx">unsafe</span><span class="p">.</span><span class="nf">Pointer</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<p>Âú®Ê≠§ÔºåÁªôÂá∫ map+ÈîÅ Âíå sync.map ÁöÑÊÄßËÉΩÊµãËØï‰ª£Á†ÅÔºö</p>
<p><code>benchmark-for-map.go</code>Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span><span class="lnt">97
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">mapbench</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="s">&#34;sync&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">MyMap</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span>
</span></span><span class="line"><span class="cl">	<span class="nx">m</span> <span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="kt">int</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">MyRwMap</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">sync</span><span class="p">.</span><span class="nx">RWMutex</span>
</span></span><span class="line"><span class="cl">	<span class="nx">m</span> <span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="kt">int</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">myMap</span> <span class="o">*</span><span class="nx">MyMap</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">myRwMap</span> <span class="o">*</span><span class="nx">MyRwMap</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">syncMap</span> <span class="o">*</span><span class="nx">sync</span><span class="p">.</span><span class="nx">Map</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">myMap</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">MyMap</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">m</span><span class="p">:</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="kt">int</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">myRwMap</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">MyRwMap</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">m</span><span class="p">:</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="kt">int</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">syncMap</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">sync</span><span class="p">.</span><span class="nx">Map</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">builtinMapStore</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">myMap</span><span class="p">.</span><span class="nf">Lock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="nx">myMap</span><span class="p">.</span><span class="nf">Unlock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">myMap</span><span class="p">.</span><span class="nx">m</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="p">=</span> <span class="nx">v</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">builtinMapLookup</span><span class="p">(</span><span class="nx">k</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">myMap</span><span class="p">.</span><span class="nf">Lock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="nx">myMap</span><span class="p">.</span><span class="nf">Unlock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">myMap</span><span class="p">.</span><span class="nx">m</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span> <span class="p">!</span><span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">v</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">builtinMapDelete</span><span class="p">(</span><span class="nx">k</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">myMap</span><span class="p">.</span><span class="nf">Lock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="nx">myMap</span><span class="p">.</span><span class="nf">Unlock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">myMap</span><span class="p">.</span><span class="nx">m</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span> <span class="p">!</span><span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">delete</span><span class="p">(</span><span class="nx">myMap</span><span class="p">.</span><span class="nx">m</span><span class="p">,</span> <span class="nx">k</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">builtinRwMapStore</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">myRwMap</span><span class="p">.</span><span class="nf">Lock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="nx">myRwMap</span><span class="p">.</span><span class="nf">Unlock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">myRwMap</span><span class="p">.</span><span class="nx">m</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="p">=</span> <span class="nx">v</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">builtinRwMapLookup</span><span class="p">(</span><span class="nx">k</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">myRwMap</span><span class="p">.</span><span class="nf">RLock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="nx">myRwMap</span><span class="p">.</span><span class="nf">RUnlock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">myRwMap</span><span class="p">.</span><span class="nx">m</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span> <span class="p">!</span><span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">v</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">builtinRwMapDelete</span><span class="p">(</span><span class="nx">k</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">myRwMap</span><span class="p">.</span><span class="nf">Lock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="nx">myRwMap</span><span class="p">.</span><span class="nf">Unlock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">myRwMap</span><span class="p">.</span><span class="nx">m</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span> <span class="p">!</span><span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">delete</span><span class="p">(</span><span class="nx">myRwMap</span><span class="p">.</span><span class="nx">m</span><span class="p">,</span> <span class="nx">k</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">syncMapStore</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">syncMap</span><span class="p">.</span><span class="nf">Store</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">syncMapLookup</span><span class="p">(</span><span class="nx">k</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">v</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">syncMap</span><span class="p">.</span><span class="nf">Load</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">!</span><span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">v</span><span class="p">.(</span><span class="kt">int</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">syncMapDelete</span><span class="p">(</span><span class="nx">k</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">syncMap</span><span class="p">.</span><span class="nf">Delete</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>benchmark-for-map_test.go</code>Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">mapbench</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;math/rand&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;testing&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;time&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">BenchmarkBuiltinMapStoreParalell</span><span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">b</span><span class="p">.</span><span class="nf">RunParallel</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">pb</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">PB</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">r</span> <span class="o">:=</span> <span class="nx">rand</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="nx">rand</span><span class="p">.</span><span class="nf">NewSource</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">Unix</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="nx">pb</span><span class="p">.</span><span class="nf">Next</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// The loop body is executed b.N times total across all goroutines.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">k</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.</span><span class="nf">Intn</span><span class="p">(</span><span class="mi">100000000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="nf">builtinMapStore</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">k</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">BenchmarkBuiltinRwMapStoreParalell</span><span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">b</span><span class="p">.</span><span class="nf">RunParallel</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">pb</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">PB</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">r</span> <span class="o">:=</span> <span class="nx">rand</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="nx">rand</span><span class="p">.</span><span class="nf">NewSource</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">Unix</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="nx">pb</span><span class="p">.</span><span class="nf">Next</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// The loop body is executed b.N times total across all goroutines.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">k</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.</span><span class="nf">Intn</span><span class="p">(</span><span class="mi">100000000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="nf">builtinRwMapStore</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">k</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">BenchmarkSyncMapStoreParalell</span><span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">b</span><span class="p">.</span><span class="nf">RunParallel</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">pb</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">PB</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">r</span> <span class="o">:=</span> <span class="nx">rand</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="nx">rand</span><span class="p">.</span><span class="nf">NewSource</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">Unix</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="nx">pb</span><span class="p">.</span><span class="nf">Next</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// The loop body is executed b.N times total across all goroutines.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">k</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.</span><span class="nf">Intn</span><span class="p">(</span><span class="mi">100000000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="nf">syncMapStore</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">k</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">BenchmarkBuiltinMapLookupParalell</span><span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">b</span><span class="p">.</span><span class="nf">RunParallel</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">pb</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">PB</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">r</span> <span class="o">:=</span> <span class="nx">rand</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="nx">rand</span><span class="p">.</span><span class="nf">NewSource</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">Unix</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="nx">pb</span><span class="p">.</span><span class="nf">Next</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// The loop body is executed b.N times total across all goroutines.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="c1">//k := r.Int()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">k</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.</span><span class="nf">Intn</span><span class="p">(</span><span class="mi">100000000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="nf">builtinMapLookup</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">BenchmarkBuiltinRwMapLookupParalell</span><span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">b</span><span class="p">.</span><span class="nf">RunParallel</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">pb</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">PB</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">r</span> <span class="o">:=</span> <span class="nx">rand</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="nx">rand</span><span class="p">.</span><span class="nf">NewSource</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">Unix</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="nx">pb</span><span class="p">.</span><span class="nf">Next</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// The loop body is executed b.N times total across all goroutines.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="c1">//k := r.Int()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">k</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.</span><span class="nf">Intn</span><span class="p">(</span><span class="mi">100000000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="nf">builtinRwMapLookup</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">BenchmarkSyncMapLookupParalell</span><span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">b</span><span class="p">.</span><span class="nf">RunParallel</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">pb</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">PB</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">r</span> <span class="o">:=</span> <span class="nx">rand</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="nx">rand</span><span class="p">.</span><span class="nf">NewSource</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">Unix</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="nx">pb</span><span class="p">.</span><span class="nf">Next</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// The loop body is executed b.N times total across all goroutines.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">k</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.</span><span class="nf">Intn</span><span class="p">(</span><span class="mi">100000000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="nf">syncMapLookup</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">BenchmarkBuiltinMapDeleteParalell</span><span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">b</span><span class="p">.</span><span class="nf">RunParallel</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">pb</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">PB</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">r</span> <span class="o">:=</span> <span class="nx">rand</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="nx">rand</span><span class="p">.</span><span class="nf">NewSource</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">Unix</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="nx">pb</span><span class="p">.</span><span class="nf">Next</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// The loop body is executed b.N times total across all goroutines.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">k</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.</span><span class="nf">Intn</span><span class="p">(</span><span class="mi">100000000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="nf">builtinMapDelete</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">BenchmarkBuiltinRwMapDeleteParalell</span><span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">b</span><span class="p">.</span><span class="nf">RunParallel</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">pb</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">PB</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">r</span> <span class="o">:=</span> <span class="nx">rand</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="nx">rand</span><span class="p">.</span><span class="nf">NewSource</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">Unix</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="nx">pb</span><span class="p">.</span><span class="nf">Next</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// The loop body is executed b.N times total across all goroutines.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">k</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.</span><span class="nf">Intn</span><span class="p">(</span><span class="mi">100000000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="nf">builtinRwMapDelete</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">BenchmarkSyncMapDeleteParalell</span><span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">b</span><span class="p">.</span><span class="nf">RunParallel</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">pb</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">PB</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">r</span> <span class="o">:=</span> <span class="nx">rand</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="nx">rand</span><span class="p">.</span><span class="nf">NewSource</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">Unix</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="nx">pb</span><span class="p">.</span><span class="nf">Next</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// The loop body is executed b.N times total across all goroutines.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">k</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.</span><span class="nf">Intn</span><span class="p">(</span><span class="mi">100000000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="nf">syncMapDelete</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="12-ËØ≠Ë®ÄÂü∫Á°Ä">1.2 ËØ≠Ë®ÄÂü∫Á°Ä</h2>
<h3 id="121-ÂáΩÊï∞Ë∞ÉÁî®">1.2.1 ÂáΩÊï∞Ë∞ÉÁî®</h3>
<h4 id="1211-Ê†àÂ∏ßÂ∏ÉÂ±Ä">1.2.1.1 Ê†àÂ∏ßÂ∏ÉÂ±Ä</h4>
<p>ÊåâÁÖßÁºñÁ®ãËØ≠Ë®ÄÂÆö‰πâÁöÑ<strong>ÂáΩÊï∞</strong>Ôºå‰ºöË¢´ÁºñËØëÂô®ÁºñËØë‰∏∫‰∏ÄÂ†Ü<strong>Êú∫Âô®Êåá‰ª§</strong>ÔºåÂÜôÂÖ•<strong>ÂèØÊâßË°åÊñá‰ª∂</strong>ÔºåÂú®<strong>ËøêË°åÊó∂</strong>Ë¢´Âä†ËΩΩÂà∞ÂÜÖÂ≠òÔºå‰Ωç‰∫éËôöÊãüÂú∞ÂùÄÁ©∫Èó¥ÁöÑ<strong>‰ª£Á†ÅÊÆµ</strong>„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221204170330812.png" alt="image-20221204170330812" style="zoom:33%;" />
<p>ÂΩìÂá∫Áé∞<strong>ÂáΩÊï∞Ë∞ÉÁî®</strong>Êó∂ÔºåÁºñËØëÂô®Â∞±‰ºöÂØπÂ∫îÁîüÊàê‰∏ÄÊù°<code>call</code>Êåá‰ª§ÔºåÁ®ãÂ∫èÊâßË°åÂà∞ËøôÊù°Êåá‰ª§Êó∂ÔºåÂ∞±‰ºöË∑≥ËΩ¨Âà∞ÂØπÂ∫î<strong>ÂáΩÊï∞ÂÖ•Âè£Â§Ñ</strong>ÊâßË°åÔºåËÄåÊØè‰∏™ÂáΩÊï∞ÊúÄÂêéÈÉΩÊúâ‰∏Ä‰∏™<code>ret</code>Êåá‰ª§ÔºåË¥üË¥£Âú®ÂáΩÊï∞Ë∞ÉÁî®ÁªìÊùüÂêéÔºå<strong>Ë∑≥ËΩ¨ÂõûË∞ÉÁî®Â§Ñ</strong>ÁªßÁª≠ÊâßË°å„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221204170633999.png" alt="image-20221204170633999" style="zoom:33%;" />
<p>ÂáΩÊï∞ÊâßË°åÊó∂ÈúÄË¶ÅË∂≥Â§üÁöÑÂÜÖÂ≠òÁ©∫Èó¥Êù•Â≠òÊîæÂ±ÄÈÉ®ÂèòÈáè„ÄÅÂèÇÊï∞„ÄÅËøîÂõûÂÄºÁ≠âÊï∞ÊçÆÔºåËøô‰∫õÊï∞ÊçÆÂØπÂ∫îÂà∞ËôöÊãüÂú∞ÂùÄÁ©∫Èó¥ÁöÑ<strong>Ê†à</strong>„ÄÇ</p>
<p>Ê†àÁöÑÊâßË°åÈ°∫Â∫èÊòØ‰ªé<strong>‰ΩéÂú∞ÂùÄÂà∞È´òÂú∞ÂùÄ</strong>ÔºåÊâÄÊúâÂáΩÊï∞ÁöÑ<strong>Ê†àÂ∏ß</strong>Ê†ºÂºèÈÉΩÊòØÁªü‰∏ÄÁöÑ„ÄÇÊâßË°åÂà∞<code>call</code>Êåá‰ª§‰ºöÂÅö‰∏§‰ª∂‰∫ãÊÉÖÔºö</p>
<ul>
<li>È¶ñÂÖàÊòØÂ∞Ü‰∏ã‰∏ÄÊù°Êåá‰ª§ÂÖ•Ê†àÔºå‰πüÂç≥<strong>ËøîÂõûÂú∞ÂùÄ</strong>ÔºåÂΩìÊâßË°åÂÆåË∞ÉÁî®ÂáΩÊï∞Â∞±‰ºöË∑≥ËΩ¨ÂõûËøôÈáåÔºõ</li>
<li>ÁÑ∂Âêé‰ºöË∑≥ËΩ¨Âà∞Ë¢´Ë∞ÉÁî®ÂáΩÊï∞ÂÖ•Âè£Â§ÑÂºÄÂßãÊâßË°åÔºåËøô‰∏™ËøáÁ®ãÊòØÈÄöËøá<strong>ÂÅèÁßªÈáè+Ê†àÊåáÈíàsp</strong>ÂÆåÊàêÁöÑ„ÄÇ</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221204171042711.png" alt="image-20221204171042711" style="zoom:33%;" />
<p>Êåá‰ª§ËøêË°åÊó∂ÔºåCPUÁî®ÁâπÂÆöÂØÑÂ≠òÂô®Êù•Â≠òÂÇ®ËøêË°åÊó∂ÁöÑ<strong>Ê†àÂü∫ÂíåÊ†àÊåáÈíà</strong>ÔºåÂêåÊó∂‰πüÊúâÊåá‰ª§ÊåáÈíàÂØÑÂ≠òÂô®Áî®Êù•Â≠òÊîæ<strong>‰∏ã‰∏ÄÊù°Ë¶ÅËøêË°åÁöÑÊåá‰ª§</strong>„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221204171752850.png" alt="image-20221204171752850" style="zoom:33%;" />
<p>GoËØ≠Ë®Ä‰∏≠<strong>‰∏çÊòØÈÄêÊ≠•Êâ©Âº†Ê†àÂ∏ß</strong>ÁöÑÔºåËÄåÊòØ<strong>‰∏ÄÊ¨°ÊÄßÂàÜÈÖç</strong>„ÄÇÁÑ∂ÂêéÈÄöËøá<strong>Ê†àÊåáÈíà+ÂÅèÁßªÂÄº</strong>‰ΩøÁî®Ê†àÂ∏ß„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221204172009476.png" alt="image-20221204172009476" style="zoom:33%;" />
<p><strong>==PointÔºö==</strong></p>
<p><strong>‰∏ÄÊ¨°ÊÄßÂàÜÈÖçÊ†àÂ∏ß</strong>‰∏ªË¶ÅÊòØ‰∏∫‰∫Ü<strong>ÈÅøÂÖçÊ†àËÆøÈóÆË∂äÁïå</strong>„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221204172323096.png" alt="image-20221204172323096" style="zoom: 33%;" />
<p>ËÄåGoËØ≠Ë®ÄÁºñËØëÂô®‰ºöÂú®<strong>ÂáΩÊï∞Â§¥ÈÉ®ÊèíÂÖ•Ê£ÄÊµã‰ª£Á†Å</strong>ÔºåÂΩìÂèëÁé∞ÈúÄË¶ÅËøõË°å**&ldquo;Ê†àÂ¢ûÈïø&rdquo;**ÔºåÂ∞±‰ºöÂè¶Â§ñÂàÜÈÖç‰∏ÄÊÆµË∂≥Â§üÂ§ßÁöÑÊ†àÁ©∫Èó¥ÔºåÂπ∂ÊääÂéüÊù•Ê†à‰∏äÁöÑÊï∞ÊçÆÊã∑Ë¥ùËøáÊù•ÔºåÂêåÊó∂ÈáäÊîæÂéüÊù•ÈÇ£ÊÆµÊ†àÁ©∫Èó¥„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221204172553847.png" alt="image-20221204172553847" style="zoom:33%;" />
<p>**==callÂíåretÊåá‰ª§==Ôºö**Ê≠§Â§ÑÊúÄÂ•ΩÊòØÁúãËßÜÈ¢ëÁêÜËß£„ÄÇ</p>
<p>ÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºåÂèØÊâßË°åÊñá‰ª∂Â≠òÊîæÂú®<strong>‰ª£Á†ÅÊÆµ</strong>ÔºåÊâÄÁî®ÁöÑÂèÇÊï∞„ÄÅÂèòÈáèÁ≠âÂ≠òÊîæÂú®<strong>Ê†àÁ©∫Èó¥</strong>Ôºå<strong>ÂØÑÂ≠òÂô®</strong>ÊòØÊåáÂêëÊ†àÁ©∫Èó¥ÁöÑÔºÅ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221204173040262.png" alt="image-20221204173040262" style="zoom:33%;" />
<h4 id="1212-‰º†ÂèÇ‰∏éËøîÂõûÂÄº">1.2.1.2 ‰º†ÂèÇ‰∏éËøîÂõûÂÄº</h4>
<h5 id="‰º†ÂÄº‰∏é‰º†ÂºïÁî®">==‰º†ÂÄº‰∏é‰º†ÂºïÁî®Ôºö==</h5>
<ul>
<li>**‰º†ÂÄºÔºö**ÂáΩÊï∞Ë∞ÉÁî®Êó∂‰ºöÂØπÂèÇÊï∞ËøõË°åÊã∑Ë¥ùÔºåË¢´Ë∞ÉÁî®ÊñπÂíåË∞ÉÁî®Êñπ‰∏§ËÄÖÊåÅÊúâ‰∏çÁõ∏ÂÖ≥ÁöÑ‰∏§‰ªΩÊï∞ÊçÆÔºõ</li>
<li>**‰º†ÂºïÁî®Ôºö**ÂáΩÊï∞Ë∞ÉÁî®Êó∂‰ºö‰º†ÈÄíÂèÇÊï∞ÁöÑÊåáÈíàÔºåË¢´Ë∞ÉÁî®ÊñπÂíåË∞ÉÁî®Êñπ‰∏§ËÄÖÊåÅÊúâÁõ∏ÂêåÁöÑÊï∞ÊçÆÔºå‰ªªÊÑè‰∏ÄÊñπÂÅöÂá∫ÁöÑ‰øÆÊîπÈÉΩ‰ºöÂΩ±ÂìçÂè¶‰∏ÄÊñπ„ÄÇ</li>
</ul>
<p>‰∏çÂêåËØ≠Ë®Ä‰ºöÈÄâÊã©‰∏çÂêåÁöÑÊñπÂºè‰º†ÈÄíÂèÇÊï∞ÔºåGo ËØ≠Ë®ÄÈÄâÊã©‰∫Ü<strong>‰º†ÂÄº</strong>ÁöÑÊñπÂºèÔºå<strong>Êó†ËÆ∫ÊòØ‰º†ÈÄíÂü∫Êú¨Á±ªÂûã„ÄÅÁªìÊûÑ‰ΩìËøòÊòØÊåáÈíàÔºåÈÉΩ‰ºöÂØπ‰º†ÈÄíÁöÑÂèÇÊï∞ËøõË°åÊã∑Ë¥ù</strong>„ÄÇ</p>
<h5 id="‰º†ÂèÇ">==‰º†ÂèÇÔºö==</h5>
<p>**ËøáÁ®ãÔºö**‰∏ãÂõæ<code>swap</code>ÂáΩÊï∞Âπ∂‰∏çËÉΩÂÆûÁé∞‰∫§Êç¢a, bÁöÑ‰ΩúÁî®„ÄÇ</p>
<ol>
<li>È¶ñÂÖàÈúÄË¶ÅÂàÜÈÖç<code>main</code>ÁöÑÊ†àÂ∏ßÁ©∫Èó¥ÔºåÂç≥<code>BP of main</code> Âíå <code>SP of main</code>‰∏≠Èó¥ÁöÑÁ©∫Èó¥Ôºõ</li>
<li>Â∞Ü<code>main</code>‰∏≠ÁöÑÂ±ÄÈÉ®ÂèòÈáèÂÖ•Ê†àÔºõ</li>
<li><strong>‰ªéÂè≥Ëá≥Â∑¶</strong>‰æùÊ¨°Â∞ÜÂèÇÊï∞ÂÖ•Ê†à(<strong>ÂÄºÊã∑Ë¥ù</strong>)Ôºõ</li>
<li><code>call</code>‰ºöÂ∞ÜËøîÂõûÂú∞ÂùÄÂÖ•Ê†àÔºåÂç≥<code>return addr</code>Ôºõ</li>
<li>ÁÑ∂ÂêéÂ∞±ÊòØ<code>swap</code>ÁöÑÊ†àÂ∏ß‰∫ÜÔºõ</li>
<li>ÂèØ‰ª•ÂèëÁé∞ÔºåÊâßË°å‰∫§Êç¢Êìç‰ΩúÂè™ÊòØÂØπÂèÇÊï∞(ÂêåÊó∂‰πüÊòØ<code>swap</code>ÁöÑÂÜÖÈÉ®ÂèòÈáè)ËøõË°åÊìç‰ΩúÔºåÂØπ<code>main</code>‰∏≠ÂéüÊú¨ÁöÑÊï∞ÊçÆÂπ∂‰∏çËÉΩÈÄ†ÊàêÂΩ±ÂìçÔºåÂõ†Ê≠§‰∫§Êç¢Â§±Ë¥•„ÄÇ</li>
</ol>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221205104655719.png" alt="image-20221205104655719" style="zoom: 33%;" />
<p><strong>‰∏ãÂõæ<code>swap</code>ÂáΩÊï∞ËÉΩÂÆûÁé∞‰∫§Êç¢a, bÁöÑ‰ΩúÁî®„ÄÇ</strong></p>
<ol>
<li>Ââç‰∏§Ê≠•Âêå‰∏äÔºõ</li>
<li><strong>‰ªéÂè≥Ëá≥Â∑¶</strong>‰æùÊ¨°Â∞ÜÂèÇÊï∞ÂÖ•Ê†àÔºåËøôÈáåÂêåÊ†∑ÊòØ<strong>ÂÄºÊã∑Ë¥ù</strong>ÔºåÂè™‰∏çËøáÂÄº‰∏∫a„ÄÅbÁöÑÂú∞ÂùÄÔºõ</li>
<li>‰∫§Êç¢Êó∂ÔºåÊòØÁõ¥Êé•Â∞Ü<code>addrA</code>Âíå<code>addrB</code>ÊåáÂêëÁöÑÊï∞ÊçÆËøõË°å‰∫§Êç¢ÔºåÂõ†Ê≠§ÂèØ‰ª•‰∫§Êç¢ÊàêÂäü„ÄÇ</li>
</ol>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221205105352049.png" alt="image-20221205105352049" style="zoom:33%;" />
<p><strong>==PointÔºö==</strong></p>
<p><strong>Go ËØ≠Ë®Ä‰∏≠‰º†ÊåáÈíà‰πüÊòØ‰º†ÂÄº„ÄÇ<strong>Â∞ÜÊåáÈíà‰Ωú‰∏∫ÂèÇÊï∞‰º†ÂÖ•Êüê‰∏™ÂáΩÊï∞Êó∂Ôºå<strong>ÂáΩÊï∞ÂÜÖÈÉ®‰ºöÂ§çÂà∂ÊåáÈíà</strong>Ôºå‰πüÂ∞±ÊòØ‰ºöÂêåÊó∂Âá∫Áé∞‰∏§‰∏™ÊåáÈíàÊåáÂêëÂéüÊúâÁöÑÂÜÖÂ≠òÁ©∫Èó¥„ÄÇÂõ†Ê≠§ÔºåÂú®‰º†ÈÄíÊï∞ÁªÑÊàñËÄÖÂÜÖÂ≠òÂç†Áî®ÈùûÂ∏∏Â§ßÁöÑÁªìÊûÑ‰ΩìÊó∂ÔºåÊàë‰ª¨Â∫îËØ•Â∞ΩÈáè‰ΩøÁî®</strong>ÊåáÈíà</strong>‰Ωú‰∏∫ÂèÇÊï∞Á±ªÂûãÊù•ÈÅøÂÖçÂèëÁîüÊï∞ÊçÆÊã∑Ë¥ùËøõËÄåÂΩ±ÂìçÊÄßËÉΩ„ÄÇ</p>
<h5 id="ËøîÂõûÂÄº">==ËøîÂõûÂÄºÔºö==</h5>
<p>ÈÄöÂ∏∏ËøîÂõûÂÄºÊòØÈÄöËøáÂØÑÂ≠òÂô®ËøîÂõûÔºå‰ΩÜÊòØGoÊîØÊåÅËøîÂõû<strong>Â§ö‰∏™ËøîÂõûÂÄº</strong>Ôºå‰πüÂ∞±ÊòØÊúâÂèØËÉΩ<strong>ËøîÂõûÂÄºÁöÑÊï∞ÁõÆÂ§ß‰∫éÂØÑÂ≠òÂô®‰∏™Êï∞</strong>ÔºåÂõ†Ê≠§GoÈÄâÊã©Âú®<strong>Ê†à‰∏äÂ≠òÂÇ®ËøîÂõûÂÄº</strong>„ÄÇ</p>
<p>**ÂåøÂêçËøîÂõûÂÄºÔºö**‰∏ãÂõæËøîÂõûÁªìÊûú‰∏∫1„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221205110334567.png" alt="image-20221205110334567" style="zoom:33%;" />
<p><strong>Ë¢´Ë∞ÉÁî®ÂáΩÊï∞</strong>ÊâßË°åÂÆåÊØïÔºå<code>ret</code>‰ºöÁªô<strong>ËøîÂõûÂÄºËµãÂÄº</strong>ÔºåÂπ∂<strong>ÊâßË°å<code>defer</code>ÂáΩÊï∞</strong>ÔºåËøôÈáåÊúâ‰∏Ä‰∏™ÈóÆÈ¢òÔºöÊòØÂÖàÁªô<strong>ËøîÂõûÂÄºËµãÂÄº</strong>ËøòÊòØÂÖà<strong>ÊâßË°å<code>defer</code>ÂáΩÊï∞</strong>Âë¢Ôºü</p>
<p>**Á≠îÔºö**ÂÖàÁªôËøîÂõûÂÄºËµãÂÄºÔºåÂÜçÊâßË°å<code>defer</code>ÂáΩÊï∞„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221205110746761.png" alt="image-20221205110746761" style="zoom:33%;" />
<p><strong>ÂëΩÂêçËøîÂõûÂÄºÔºö</strong></p>
<p>Âíå‰∏äËæπÈÇ£‰∏™ÂÆåÂÖ®Áõ∏ÂêåÔºå<strong>Âè™ÊîπÂä®‰∏Ä‰∏™Âú∞Êñπ</strong>ÔºåËøîÂõûÁªìÊûú‰∏∫2„ÄÇ<strong>==ËøôÊòØÂõ†‰∏∫Ë¢´Ë∞ÉÁî®ÂáΩÊï∞ÁöÑËøîÂõûÂÄºb‰∏ÄÁõ¥Âú®Ë∞ÉÁî®ËÄÖÊ†àÂ∏ß‰∏≠„ÄÇ==</strong></p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221205111156927.png" alt="image-20221205111156927" style="zoom:33%;" />
<p><strong>ÂèÇÊï∞Á©∫Èó¥ÂàÜÈÖçÔºö</strong></p>
<p>Ëã•Ë∞ÉÁî®Â§ö‰∏™ÂáΩÊï∞ÔºåÂ∞Ü‰ª•<strong>ÊúÄÂ§ßÁöÑÂèÇÊï∞+ËøîÂõûÂÄºÁ©∫Èó¥</strong>‰∏∫Ê†áÂáÜÊù•ÂàÜÈÖç„ÄÇÂ¶Ç‰∏ãÂõæÔºåÂ∞Ü‰ºöÊåâÁÖß<code>B</code>ÁöÑÂèÇÊï∞+ËøîÂõûÂÄºÁ©∫Èó¥ËøõË°åÂàÜÈÖçÔºå<code>B</code>ÊâßË°åÂÆåÂêéÔºåCÁöÑÂèÇÊï∞+ËøîÂõûÂÄº‰ºö<strong>‰ªé‰ΩéÂú∞ÂùÄÂà∞È´òÂú∞ÂùÄ</strong>ËøõË°åÂàÜÈÖçÔºå<strong>‰∏çÊª°ÁöÑÁ©∫Èó¥Â∞±Á©∫ÁùÄ</strong>„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221205112136866.png" alt="image-20221205112136866" style="zoom: 33%;" />
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221205112622817.png" alt="image-20221205112622817" style="zoom: 50%;" />
<h4 id="1213-Â∞èÁªì">1.2.1.3 Â∞èÁªì</h4>
<p>Go ÈÄöËøá<strong>Ê†à</strong>‰º†ÈÄíÂáΩÊï∞ÁöÑ<strong>ÂèÇÊï∞ÂíåËøîÂõûÂÄº</strong>Ôºå==<strong>ÂèÇÊï∞</strong>Âíå<strong>ËøîÂõûÂÄº</strong>Â±ÖÁÑ∂ÊòØÂú®<strong>Ë∞ÉÁî®ËÄÖÁöÑÊ†àÂ∏ß</strong>‰∏≠ÔºÅÔºÅÔºÅ==Âú®<strong>Ë∞ÉÁî®ÂáΩÊï∞‰πãÂâç</strong>‰ºöÂú®Ê†à‰∏ä‰∏∫ËøîÂõûÂÄºÂàÜÈÖçÂêàÈÄÇÁöÑÂÜÖÂ≠òÁ©∫Èó¥ÔºåÈöèÂêéÂ∞ÜÂÖ•ÂèÇ<strong>‰ªéÂè≥Âà∞Â∑¶</strong>ÊåâÈ°∫Â∫èÂéãÊ†àÂπ∂Êã∑Ë¥ùÂèÇÊï∞ÔºåËøîÂõûÂÄº‰ºöË¢´Â≠òÂÇ®Âà∞Ë∞ÉÁî®ÊñπÈ¢ÑÁïôÂ•ΩÁöÑÊ†àÁ©∫Èó¥‰∏äÔºåÊàë‰ª¨ÂèØ‰ª•ÁÆÄÂçïÊÄªÁªìÂá∫‰ª•‰∏ãÂá†Êù°ËßÑÂàôÔºö</p>
<ol>
<li>ÈÄöËøáÂ†ÜÊ†à‰º†ÈÄíÂèÇÊï∞ÔºåÂÖ•Ê†àÁöÑÈ°∫Â∫èÊòØ<strong>‰ªéÂè≥Âà∞Â∑¶</strong>ÔºåËÄåÂèÇÊï∞ÁöÑËÆ°ÁÆóÊòØ<strong>‰ªéÂ∑¶Âà∞Âè≥</strong>Ôºõ</li>
<li>ÂáΩÊï∞ËøîÂõûÂÄºÈÄöËøáÂ†ÜÊ†à‰º†ÈÄíÂπ∂Áî±Ë∞ÉÁî®ËÄÖ<strong>È¢ÑÂÖà</strong>ÂàÜÈÖçÂÜÖÂ≠òÁ©∫Èó¥Ôºõ</li>
<li>Ë∞ÉÁî®ÂáΩÊï∞Êó∂ÈÉΩÊòØ<strong>‰º†ÂÄº</strong>ÔºåÊé•Êî∂Êñπ‰ºöÂØπÂÖ•ÂèÇËøõË°åÂ§çÂà∂ÂÜçËÆ°ÁÆóÔºõ</li>
</ol>
<h3 id="122-Èó≠ÂåÖ">1.2.2 Èó≠ÂåÖ</h3>
<p>ÂáΩÊï∞ÔºåÂèØ‰ª•‰Ωú‰∏∫<strong>ÂèÇÊï∞‰º†ÈÄí</strong>ÔºåÂèØ‰ª•ÂÅö<strong>ÂáΩÊï∞ËøîÂõûÂÄº</strong>Ôºå‰πüÂèØ‰ª•ÁªëÂÆöÂà∞<strong>ÂèòÈáè</strong>„ÄÇÁß∞ËøôÊ†∑ÁöÑÂèÇÊï∞„ÄÅËøîÂõûÂÄºÊàñÂèòÈáè‰∏∫**<code>function value</code>**„ÄÇ</p>
<p><code>function value</code>Êú¨Ë¥®‰∏äÊòØ‰∏Ä‰∏™ÊåáÈíàÔºå‰ΩÜÊòØÂπ∂‰∏çÁõ¥Êé•ÊåáÂêëÂáΩÊï∞Êåá‰ª§ÂÖ•Âè£ÔºåËÄåÊòØÊåáÂêë‰∏Ä‰∏™<code>runtime.funcval</code>ÁöÑÁªìÊûÑ‰ΩìÔºåËøô‰∏™ÁªìÊûÑ‰ΩìÈáåÂè™Êúâ‰∏Ä‰∏™Âú∞ÂùÄÔºåÂ∞±ÊòØËøô‰∏™‰∫åÂáΩÊï∞Êåá‰ª§ÁöÑÂÖ•Âè£Âú∞ÂùÄ„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230223210607640.png" alt="image-20230223210607640" style="zoom:33%;" />
<p>Â∞Ü‰∏Ä‰∏™ÂáΩÊï∞ËµãÂÄºÁªôÂ§ö‰∏™ÂèòÈáèÔºåËøô‰∫õÂèòÈáè‰ºöÂÖ±Áî®Âêå‰∏Ä‰∏™<code>funcval</code>„ÄÇ</p>
<p>ÈÇ£‰πàÊó¢ÁÑ∂<code>funcval</code>‰∏≠Âè™Êúâ‰∏Ä‰∏™Âú∞ÂùÄÔºå‰∏∫Âï•‰∏çÁõ¥Êé•‰ΩøÁî®Ëøô‰∏™Âú∞ÂùÄÂë¢Ôºü</p>
<p><strong>ËøôÊòØ‰∏∫‰∫ÜÂ§ÑÁêÜÈó≠ÂåÖ„ÄÇ</strong></p>
<p>Èó≠ÂåÖÁöÑ‰∏Ä‰∏™Á§∫‰æãÔºö</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230223211130381.png" alt="image-20230223211130381" style="zoom:33%;" />
<p>Go ËØ≠Ë®Ä‰∏≠ÔºåÈó≠ÂåÖÂ∞±ÊòØÊúâÊçïËé∑ÂàóË°®ÁöÑ<code>Function Value</code>„ÄÇÊçïËé∑ÂàóË°®‰∏≠Â≠òÂÇ®ÁöÑÂÄºÔºåÈÄöËøá<code>funcval</code>ÁöÑÂú∞ÂùÄ+ÂÅèÁßªÈáèÊù•Ëé∑Âèñ„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230223212134241.png" alt="image-20230223212134241" style="zoom:25%;" />
<p><strong>==Èó≠ÂåÖÈúÄË¶ÅÁª¥ÊåÅÊçïËé∑ÂèòÈáèÂú®Â§ñÂ±ÇÂáΩÊï∞ÂíåÂÜÖÂ±ÇÂáΩÊï∞‰∏≠ÁöÑ‰∏ÄËá¥ÊÄß„ÄÇ==</strong></p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230223212638218.png" alt="image-20230223212638218" style="zoom: 25%;" />
<h3 id="123-ÊñπÊ≥ï">1.2.3 ÊñπÊ≥ï</h3>
<h4 id="1231-ÊñπÊ≥ïÁöÑÊú¨Ë¥®">1.2.3.1 ÊñπÊ≥ïÁöÑÊú¨Ë¥®</h4>
<p>Â¶ÇÊûúÂÆö‰πâ‰∏Ä‰∏™Á±ªÂûãAÔºåÂπ∂Áªô‰ªñÂÖ≥ËÅî‰∏Ä‰∏™ÊñπÊ≥ïÔºåÁÑ∂ÂêéÂ∞±ÂèØ‰ª•ÈÄöËøáÁ±ªÂûãAÁöÑ<strong>ÂèòÈáè</strong>Êù•Ë∞ÉÁî®Ëøô‰∏™ÊñπÊ≥ïÔºåËøôÁßçË∞ÉÁî®ÊñπÂºèÂÖ∂ÂÆûÊòØ&quot;ËØ≠Ê≥ïÁ≥ñ&quot;ÔºåÂÆûÈôÖ‰∏äÂíå‰∏ãËæπÈÇ£‰∏™Ë∞ÉÁî®ÊñπÂºè‰∏ÄÊ†∑„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221205145309906.png" alt="image-20221205145309906" style="zoom:33%;" />
<p>GoËØ≠Ë®Ä‰∏≠Ôºå<strong>ÂáΩÊï∞Á±ªÂûã</strong>Âè™Âíå<strong>ÂèÇÊï∞‰∏éËøîÂõûÂÄº</strong>Áõ∏ÂÖ≥ÔºåÊâÄ‰ª•‰∏ãËæπËæìÂá∫‰∏∫<code>True</code>ÔºåÂèØ‰ª•ËØ¥Êòé==<strong>ÊñπÊ≥ï</strong>Êú¨Ë¥®‰∏äÂ∞±ÊòØ<strong>ÊôÆÈÄöÂáΩÊï∞</strong>Ôºå<strong>Êé•Êî∂ËÄÖÂ∞±ÊòØÈöêÂê´ÁöÑÁ¨¨‰∏Ä‰∏™ÂèÇÊï∞</strong>==„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221205150521000.png" alt="image-20221205150521000" style="zoom:33%;" />
<h4 id="1232-ÊñπÊ≥ïË∞ÉÁî®">1.2.3.2 ÊñπÊ≥ïË∞ÉÁî®</h4>
<p>ÂÖ∂ÂÆûÂíåÂáΩÊï∞Ë∞ÉÁî®‰∏ÄÊ†∑„ÄÇ</p>
<p><strong>‰∏æ‰æãËØ¥ÊòéËøáÁ®ãÔºö</strong></p>
<ol>
<li>GoËØ≠Ë®Ä‰∏≠‰º†ÂèÇÂÄºÊã∑Ë¥ùÔºåÊ≠§Â§Ñ‰∏∫<strong>ÂÄºÊé•Êî∂ËÄÖ</strong>ÔºåÊâÄ‰ª•ÂèÇÊï∞È¶ñÂÖà‰∏∫Ôºö<code>data=addr1 4</code>Ôºõ</li>
<li>ÊâßË°å<code>Name()</code>‰∏≠Á¨¨‰∏ÄË°åÊó∂Ôºå<code>data</code>ÊåáÂêëÊñ∞ÁöÑ<code>string</code>ÔºåÊõ¥Êñ∞‰∏∫Ôºö<code>data=addr2 8</code>Ôºõ</li>
<li>ËøîÂõûÂÄºÂ∞±ÊòØÂÄºÊã∑Ë¥ùÁöÑÂèÇÊï∞ÔºåÂõ†Ê≠§<code>main</code>‰∏≠ÁöÑÂ±ÄÈÉ®ÂèòÈáèÂπ∂Êú™ÂèóÂà∞ÂΩ±Âìç„ÄÇ</li>
</ol>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221205151005651.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221205151005651.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221205151005651.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221205151005651.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221205151005651.png"
        title="image-20221205151005651" /></p>
<p><strong>ÂÜç‰∏æ‰∏™‰æãÂ≠êÂØπÊØîÔºö</strong></p>
<ol>
<li>GoËØ≠Ë®Ä‰∏≠‰º†ÂèÇÂÄºÊã∑Ë¥ùÔºåÊ≠§Â§Ñ‰∏∫<strong>ÊåáÈíàÊé•Êî∂ËÄÖ</strong>ÔºåÊâÄ‰ª•ÂèÇÊï∞È¶ñÂÖà‰∏∫Ôºö<code>pa=&amp;a</code>Ôºõ</li>
<li>ÊâßË°å<code>Name()</code>‰∏≠Á¨¨‰∏ÄË°åÊó∂Ôºå‰øÆÊîπ<code>pa</code>Âú∞ÂùÄÂ§ÑÁöÑÂèòÈáèÔºå‰πüÂ∞±ÊòØ<code>a</code>Ôºå<code>a</code>ÊåáÂêëÊñ∞ÁöÑ<code>string</code>ÔºåÊõ¥Êñ∞‰∏∫Ôºö<code>data=addr2 8</code>Ôºõ</li>
<li>ËøîÂõûÂÄºÂ∞±ÊòØÂÄºÊã∑Ë¥ùÁöÑÂèÇÊï∞ÔºåÂç≥<code>a</code>ÊåáÂêëÁöÑÂèòÈáè„ÄÇÊ≠§Â§Ñ<code>main</code>‰∏≠ÁöÑÂ±ÄÈÉ®ÂèòÈáè<code>a</code>‰πü‰ºöË¢´‰øÆÊîπ„ÄÇ</li>
</ol>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221205152132567.png" alt="image-20221205152132567" style="zoom:50%;" />
<p>‰∏äËø∞‰æãÂ≠ê‰∏≠ÔºåÈÄöËøá<strong>ÂÄº</strong>Ë∞ÉÁî®<strong>ÂÄºÊé•Êî∂ËÄÖÁöÑÊñπÊ≥ï</strong>ÔºåÈÄöËøá<strong>ÊåáÈíà</strong>Ë∞ÉÁî®<strong>ÊåáÈíàÊé•Êî∂ËÄÖÁöÑÊñπÊ≥ï</strong>ÔºåÈÇ£‰πàÂ¶ÇÊûúÁî®<strong>ÂÄº</strong>Ë∞ÉÁî®<strong>ÊåáÈíàÊé•Êî∂ËÄÖÁöÑÊñπÊ≥ï</strong>ÊàñÁî®<strong>ÊåáÈíà</strong>Ë∞ÉÁî®<strong>ÂÄºÊé•Êî∂ËÄÖÁöÑÊñπÊ≥ï</strong>ÔºåÊòØÂê¶ÂèØË°åÂë¢Ôºü</p>
<p><strong>Á≠îÔºö<strong>ÂèØË°åÔºåËøô‰∫õ‰πüÊòØ&quot;ËØ≠Ê≥ïÁ≥ñ&quot;ÔºåÂú®</strong>ÁºñËØëÈò∂ÊÆµ</strong>ÔºåÁºñËØëÂô®‰ºöËøõË°åËΩ¨Êç¢„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221205152718495.png" alt="image-20221205152718495" style="zoom:50%;" />
<h4 id="1233-ÊñπÊ≥ïË°®ËææÂºèÂíåÊñπÊ≥ïÂèòÈáè">1.2.3.3 ÊñπÊ≥ïË°®ËææÂºèÂíåÊñπÊ≥ïÂèòÈáè</h4>
<p>Êù•ÁúãÁúãÂ∞Ü‰∏Ä‰∏™<strong>ÊñπÊ≥ï</strong>ËµãÁªô‰∏Ä‰∏™<strong>ÂèòÈáè</strong>ÊòØÊÄé‰πà‰∏ÄÂõû‰∫ãÔºü</p>
<p>GoËØ≠Ë®Ä‰∏≠Ôºå<strong>ÂáΩÊï∞</strong>‰Ωú‰∏∫<strong>ÂèòÈáè„ÄÅÂèÇÊï∞ÂíåËøîÂõûÂÄº</strong>Êó∂ÈÉΩÊòØ‰ª•<code>Function Value</code>ÂΩ¢ÂºèÂ≠òÂú®ÁöÑÔºå<strong>Èó≠ÂåÖ</strong>‰πüÂè™ÊòØÊúâ<strong>ÊçïËé∑ÂàóË°®</strong>ÁöÑ<code>Function Value</code>ËÄåÂ∑≤„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221205154108887.png" alt="image-20221205154108887" style="zoom: 50%;" />
<p>ÂÖàÊù•ÁúãÁúã‰ªÄ‰πàÊòØ<strong>ÊñπÊ≥ïË°®ËææÂºè</strong>Âíå<strong>ÊñπÊ≥ïÂèòÈáè</strong>Ôºö</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221205154459886.png" alt="image-20221205154459886" style="zoom:50%;" />
<p><strong>‰ªéÊú¨Ë¥®‰∏äËÆ≤ÔºåÊñπÊ≥ïË°®ËææÂºèÂíåÊñπÊ≥ïÂèòÈáèÈÉΩÊòØ<code>Function Value</code>„ÄÇ</strong></p>
<p>ÁúãËøôÊÆµ‰ª£Á†ÅÔºö</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221205155047495.png" alt="image-20221205155047495" style="zoom:50%;" />
<h3 id="124-Êé•Âè£">1.2.4 Êé•Âè£</h3>
<h4 id="1241-Ê¶ÇËø∞">1.2.4.1 Ê¶ÇËø∞</h4>
<p><strong>ËÆ°ÁÆóÊú∫ÁßëÂ≠¶</strong>‰∏≠ÔºåÊé•Âè£ÊòØËÆ°ÁÆóÊú∫Á≥ªÁªü‰∏≠Â§ö‰∏™ÁªÑ‰ª∂ÂÖ±‰∫´ÁöÑËæπÁïåÔºå‰∏çÂêåÁöÑÁªÑ‰ª∂ËÉΩÂ§üÂú®ËæπÁïå‰∏ä‰∫§Êç¢‰ø°ÊÅØ„ÄÇÂ¶Ç‰∏ãÂõæÊâÄÁ§∫ÔºåÊé•Âè£ÁöÑÊú¨Ë¥®ÊòØÂºïÂÖ•‰∏Ä‰∏™Êñ∞ÁöÑ‰∏≠Èó¥Â±ÇÔºåË∞ÉÁî®ÊñπÂèØ‰ª•ÈÄöËøáÊé•Âè£‰∏éÂÖ∑‰ΩìÂÆûÁé∞ÂàÜÁ¶ªÔºåËß£Èô§‰∏ä‰∏ãÊ∏∏ÁöÑËÄ¶ÂêàÔºå‰∏äÂ±ÇÁöÑÊ®°Âùó‰∏çÂÜçÈúÄË¶Å‰æùËµñ‰∏ãÂ±ÇÁöÑÂÖ∑‰ΩìÊ®°ÂùóÔºåÂè™ÈúÄË¶Å‰æùËµñ‰∏Ä‰∏™Á∫¶ÂÆöÂ•ΩÁöÑÊé•Âè£„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221206204054161.png" alt="image-20221206204054161" style="zoom:50%;" />
<p><strong>Go ËØ≠Ë®Ä</strong>‰∏≠ÁöÑÊé•Âè£ÊòØ‰∏ÄÁßçÂÜÖÁΩÆÁöÑÁ±ªÂûãÔºåÂÆÉÂÆö‰πâ‰∫Ü‰∏ÄÁªÑÊñπÊ≥ïÁöÑÁ≠æÂêç„ÄÇGo ËØ≠Ë®Ä‰∏≠<strong>Êé•Âè£ÁöÑÂÆûÁé∞ÈÉΩÊòØÈöêÂºèÁöÑ</strong>ÔºåÁ±ªÂûãÂÆûÁé∞Êé•Âè£Êó∂Âè™ÈúÄË¶ÅÂÆûÁé∞Êé•Âè£‰∏≠ÁöÑÂÖ®ÈÉ®ÊñπÊ≥ï„ÄÇ</p>
<ul>
<li>Âú® Java ‰∏≠ÔºöÂÆûÁé∞Êé•Âè£ÈúÄË¶ÅÊòæÂºèÂú∞Â£∞ÊòéÊé•Âè£Âπ∂ÂÆûÁé∞ÊâÄÊúâÊñπÊ≥ïÔºõ</li>
<li>Âú® Go ‰∏≠ÔºöÂÆûÁé∞Êé•Âè£ÁöÑÊâÄÊúâÊñπÊ≥ïÂ∞±ÈöêÂºèÂú∞ÂÆûÁé∞‰∫ÜÊé•Âè£Ôºõ</li>
</ul>
<h4 id="1242-Êï∞ÊçÆÁªìÊûÑ">1.2.4.2 Êï∞ÊçÆÁªìÊûÑ</h4>
<p>Go ËØ≠Ë®ÄÊ†πÊçÆÊé•Âè£Á±ªÂûã<strong>ÊòØÂê¶</strong>ÂåÖÂê´<strong>‰∏ÄÁªÑÊñπÊ≥ï</strong>Â∞ÜÊé•Âè£Á±ªÂûãÂàÜÊàê‰∫Ü‰∏§Á±ªÔºö</p>
<ul>
<li>‰ΩøÁî® <a href="https://draveness.me/golang/tree/runtime.iface" target="_blank" rel="noopener noreffer "><code>runtime.iface</code></a> ÁªìÊûÑ‰ΩìË°®Á§∫<strong>ÂåÖÂê´ÊñπÊ≥ï</strong>ÁöÑÊé•Âè£ÔºåÂèàÁß∞<strong>ÈùûÁ©∫Êé•Âè£Á±ªÂûã</strong>Ôºõ</li>
<li>‰ΩøÁî® <a href="https://draveness.me/golang/tree/runtime.eface" target="_blank" rel="noopener noreffer "><code>runtime.eface</code></a> ÁªìÊûÑ‰ΩìË°®Á§∫<strong>‰∏çÂåÖÂê´‰ªª‰ΩïÊñπÊ≥ï</strong>ÁöÑ <code>interface{}</code> Á±ªÂûãÔºåÂèàÁß∞<strong>Á©∫Êé•Âè£Á±ªÂûã</strong>ÔºåÂèØ‰ª•Êé•Êî∂‰ªªÊÑèÁ±ªÂûãÁöÑÊï∞ÊçÆÔºõ</li>
</ul>
<p><strong><a href="https://draveness.me/golang/tree/runtime.eface" target="_blank" rel="noopener noreffer "><code>runtime.eface</code></a> ÁªìÊûÑ‰ΩìÔºö</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">eface</span> <span class="kd">struct</span> <span class="p">{</span> <span class="c1">// 16 Â≠óËäÇ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">_type</span> <span class="o">*</span><span class="nx">_type</span>			<span class="c1">// Âä®ÊÄÅÁ±ªÂûãÔºöË°®Á§∫Á±ªÂûãÂÖÉÊï∞ÊçÆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">data</span>  <span class="nx">unsafe</span><span class="p">.</span><span class="nx">Pointer</span>	<span class="c1">// Âä®ÊÄÅÂÄºÔºöËÆ∞ÂΩïÂú®Âì™
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰∏æ‰æãËØ¥ÊòéÔºöËµãÂÄºÂâç<code>_type</code>Âíå<code>data</code>Â≠óÊÆµÈÉΩ‰∏∫<code>nil</code>ÔºåËµãÂÄºÂêéÔºö</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221206210352897.png" alt="image-20221206210352897" style="zoom:50%;" />
<p><strong><a href="https://draveness.me/golang/tree/runtime.iface" target="_blank" rel="noopener noreffer "><code>runtime.iface</code></a> ÁªìÊûÑ‰ΩìÔºö</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">iface</span> <span class="kd">struct</span> <span class="p">{</span> <span class="c1">// 16 Â≠óËäÇ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">tab</span>  <span class="o">*</span><span class="nx">itab</span>				<span class="c1">// ËÆ∞ÂΩïÂä®ÊÄÅÁ±ªÂûãÂíåÊñπÊ≥ïÂàóË°®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">data</span> <span class="nx">unsafe</span><span class="p">.</span><span class="nx">Pointer</span>		<span class="c1">// Âä®ÊÄÅÂÄº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">itab</span> <span class="kd">struct</span> <span class="p">{</span> <span class="c1">// 32 Â≠óËäÇ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">inter</span> <span class="o">*</span><span class="nx">interfacetype</span>	<span class="c1">// Êé•Âè£ÁöÑÁ±ªÂûãÂÖÉÊï∞ÊçÆÔºåÂåÖÂê´Êé•Âè£ÁöÑÊñπÊ≥ïÂàóË°®ÔºöÈúÄË¶ÅÂÆûÁé∞ÁöÑÊñπÊ≥ï
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">_type</span> <span class="o">*</span><span class="nx">_type</span>			<span class="c1">// Êé•Âè£ÁöÑÂä®ÊÄÅÁ±ªÂûãÂÖÉÊï∞ÊçÆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">hash</span>  <span class="kt">uint32</span>			<span class="c1">// Á±ªÂûãÂìàÂ∏åÂÄºÔºöÁî®‰∫éÂø´ÈÄüÂà§Êñ≠Á±ªÂûãÊòØÂê¶Áõ∏Á≠âÔºåÁ±ªÂûãÊñ≠Ë®ÄÊó∂‰ºöÁî®Âà∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">_</span>     <span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="kt">byte</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fun</span>   <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="kt">uintptr</span>		<span class="c1">// ÊñπÊ≥ïÂú∞ÂùÄÊï∞ÁªÑÔºöÁî®‰∫éÂø´ÈÄüË∞ÉÁî®ÊñπÊ≥ïÔºåÊó†ÈúÄÂÜçÂéªÊé•Âè£ÁöÑÁ±ªÂûãÂÖÉÊï∞ÊçÆÂØªÊâæÊñπÊ≥ïÂú∞ÂùÄ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>hash</code> ÊòØÂØπ <code>_type.hash</code> ÁöÑÊã∑Ë¥ùÔºåÂΩìÊàë‰ª¨ÊÉ≥Â∞Ü <code>interface</code> Á±ªÂûãËΩ¨Êç¢ÊàêÂÖ∑‰ΩìÁ±ªÂûãÊó∂ÔºåÂèØ‰ª•‰ΩøÁî®ËØ•Â≠óÊÆµÂø´ÈÄüÂà§Êñ≠ÁõÆÊ†áÁ±ªÂûãÂíåÂÖ∑‰ΩìÁ±ªÂûã <a href="https://draveness.me/golang/tree/runtime._type" target="_blank" rel="noopener noreffer "><code>runtime._type</code></a> ÊòØÂê¶‰∏ÄËá¥Ôºõ</li>
<li><code>fun</code> ÊòØ‰∏Ä‰∏™Âä®ÊÄÅÂ§ßÂ∞èÁöÑÊï∞ÁªÑÔºåÂÆÉÊòØ‰∏Ä‰∏™Áî®‰∫éÂä®ÊÄÅÊ¥æÂèëÁöÑËôöÂáΩÊï∞Ë°®ÔºåÂ≠òÂÇ®‰∫Ü‰∏ÄÁªÑÂáΩÊï∞ÊåáÈíà„ÄÇËôΩÁÑ∂ËØ•ÂèòÈáèË¢´Â£∞ÊòéÊàêÂ§ßÂ∞èÂõ∫ÂÆöÁöÑÊï∞ÁªÑÔºå‰ΩÜÊòØÂú®‰ΩøÁî®Êó∂‰ºöÈÄöËøáÂéüÂßãÊåáÈíàËé∑ÂèñÂÖ∂‰∏≠ÁöÑÊï∞ÊçÆÔºåÊâÄ‰ª• <code>fun</code> Êï∞ÁªÑ‰∏≠‰øùÂ≠òÁöÑÂÖÉÁ¥†Êï∞ÈáèÊòØ‰∏çÁ°ÆÂÆöÁöÑ„ÄÇ</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221206212446139.png" alt="image-20221206212446139" style="zoom:50%;" />
<p>‰∏æ‰æãËØ¥ÊòéÔºöËµãÂÄºÂâç<code>tab</code>Âíå<code>data</code>Â≠óÊÆµÈÉΩ‰∏∫<code>nil</code>ÔºåËµãÂÄºÂêéÔºö</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221206211141071.png" alt="image-20221206211141071" style="zoom:50%;" />
<p><strong>==PointÔºö==</strong></p>
<p><code>itab</code>ÁªìÊûÑ‰ΩìÂÜÖÂÆπ‰∏ÄÊó¶Á°ÆÂÆö(Êé•Âè£Á±ªÂûãÂíåÂä®ÊÄÅÁ±ªÂûã)ÔºåÂÆûÈôÖ‰∏äÊòØ‰∏ç‰ºöÊîπÂèòÁöÑÔºåÂõ†Ê≠§ÊòØÂèØÂ§çÁî®ÁöÑ„ÄÇGoËØ≠Ë®Ä‰ºöÂ∞Ü<code>itab</code>ÁºìÂ≠òËµ∑Êù•ÔºåÂπ∂‰∏î‰ª•Êé•Âè£Á±ªÂûãÂíåÂä®ÊÄÅÁ±ªÂûãÁöÑÁªÑÂêà‰∏∫<code>key</code>(<code>Êé•Âè£Á±ªÂûãÁöÑhash</code> ^ <code>Âä®ÊÄÅÁ±ªÂûãÁöÑhash</code>)Ôºå‰ª•<code>&amp;itab</code>‰∏∫<code>value</code>ÊûÑÈÄ†‰∏Ä‰∏™ÂìàÂ∏åË°®„ÄÇÈúÄË¶Å‰∏Ä‰∏™<code>itab</code>Êó∂Ôºå‰ºöÂÖàÂú®ËøôÈáåËæπÂØªÊâæÔºåÂ¶ÇÊûúÂ∑≤ÁªèÊúâÂØπÂ∫îÁöÑ<code>itab</code>ÔºåÂ∞±Áõ¥Êé•ÊãøÊù•Áî®ÔºåÂ¶ÇÊûúÊ≤°ÊúâÔºåÂ∞±Êñ∞ÂàõÂª∫Âπ∂Ê∑ªÂä†„ÄÇ</p>
<h3 id="125-Á±ªÂûãÊñ≠Ë®Ä">1.2.5 Á±ªÂûãÊñ≠Ë®Ä</h3>
<p>Á±ªÂûãÊñ≠Ë®Ä‰ΩúÁî®Âú®<strong>ÊäΩË±°Á±ªÂûã</strong>‰∏äÔºåÂåÖÊã¨Ôºö<strong>Á©∫Êé•Âè£ÂíåÈùûÁ©∫Êé•Âè£</strong>„ÄÇËÄå<strong>Êñ≠Ë®ÄÁöÑÁõÆÊ†áÁ±ªÂûã</strong>ÂèØ‰ª•ÊòØ<strong>ÂÖ∑‰ΩìÁ±ªÂûã</strong>Êàñ<strong>ÈùûÁ©∫Êé•Âè£Á±ªÂûã</strong>„ÄÇËøôÊ†∑Â∞±ÁªÑÂêàÂá∫Êù•‰∫ÜÂõõÁßçÁ±ªÂûãÊñ≠Ë®ÄÔºö</p>
<ul>
<li>Á©∫Êé•Âè£.(ÂÖ∑‰ΩìÁ±ªÂûã)</li>
<li>ÈùûÁ©∫Êé•Âè£.(ÂÖ∑‰ΩìÁ±ªÂûã)</li>
<li>Á©∫Êé•Âè£.(ÈùûÁ©∫Êé•Âè£)</li>
<li>ÈùûÁ©∫Êé•Âè£.(ÈùûÁ©∫Êé•Âè£)</li>
</ul>
<h4 id="1251-Á©∫Êé•Âè£ÂÖ∑‰ΩìÁ±ªÂûã">1.2.5.1 Á©∫Êé•Âè£.(ÂÖ∑‰ΩìÁ±ªÂûã)</h4>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221209152915781.png" alt="image-20221209152915781" style="zoom:50%;" />
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221209153010631.png" alt="image-20221209153010631" style="zoom:50%;" />
<h4 id="1252-ÈùûÁ©∫Êé•Âè£ÂÖ∑‰ΩìÁ±ªÂûã">1.2.5.2 ÈùûÁ©∫Êé•Âè£.(ÂÖ∑‰ΩìÁ±ªÂûã)</h4>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221209153420393.png" alt="image-20221209153420393" style="zoom:50%;" />
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221209153459034.png" alt="image-20221209153459034" style="zoom:50%;" />
<h4 id="1253-Á©∫Êé•Âè£ÈùûÁ©∫Êé•Âè£">1.2.5.3 Á©∫Êé•Âè£.(ÈùûÁ©∫Êé•Âè£)</h4>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221209154140906.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221209154140906.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221209154140906.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221209154140906.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221209154140906.png"
        title="image-20221209154140906" /></p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221209154454602.png" alt="image-20221209154454602" style="zoom:50%;" />
<h4 id="1254-ÈùûÁ©∫Êé•Âè£ÈùûÁ©∫Êé•Âè£">1.2.5.4 ÈùûÁ©∫Êé•Âè£.(ÈùûÁ©∫Êé•Âè£)</h4>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221209154710761.png" alt="image-20221209154710761" style="zoom:50%;" />
<h4 id="1255-Â∞èÁªì">1.2.5.5 Â∞èÁªì</h4>
<p>Á±ªÂûãÊñ≠Ë®ÄÁöÑÂÖ≥ÈîÆÊòØÔºöÊòéÁ°ÆÊé•Âè£ÁöÑ**==Âä®ÊÄÅÁ±ªÂûã==<strong>ÂèäÂØπÂ∫îÁöÑ</strong>Âä®ÊÄÅÁ±ªÂûãÂÆûÁé∞‰∫ÜÂì™‰∫õÊñπÊ≥ï**ÔºåËÄåÊòéÁ°ÆËøô‰∫õÁöÑÂÖ≥ÈîÆÂèàÂú®‰∫éÂä®ÊÄÅÁ±ªÂûãÁöÑ<strong>Á±ªÂûãÂÖÉÊï∞ÊçÆ</strong>Ôºå‰ª•Âèä<strong>Á©∫Êé•Âè£</strong>‰∏é<strong>ÈùûÁ©∫Êé•Âè£</strong>ÁöÑ**&ldquo;Êï∞ÊçÆÁªìÊûÑ&rdquo;**„ÄÇ</p>
<h3 id="126-ÂèçÂ∞Ñ">1.2.6 ÂèçÂ∞Ñ</h3>
<p><strong>ÂèçÂ∞ÑÁöÑ‰ΩúÁî®</strong>Â∞±ÊòØ<strong>ÊääÁ±ªÂûãÂÖÉÊï∞ÊçÆÊö¥Èú≤ÁªôÁî®Êà∑‰ΩøÁî®</strong>„ÄÇ</p>
<p>ÂèçÂ∞ÑÂåÖ‰∏≠Êúâ‰∏§ÂØπÈùûÂ∏∏ÈáçË¶ÅÁöÑÂáΩÊï∞ÂíåÁ±ªÂûãÔºå‰∏§‰∏™ÂáΩÊï∞ÂàÜÂà´ÊòØÔºö</p>
<ul>
<li><a href="https://draveness.me/golang/tree/reflect.TypeOf" target="_blank" rel="noopener noreffer "><code>reflect.TypeOf</code></a> ËÉΩËé∑ÂèñÁ±ªÂûã‰ø°ÊÅØÔºõ</li>
<li><a href="https://draveness.me/golang/tree/reflect.ValueOf" target="_blank" rel="noopener noreffer "><code>reflect.ValueOf</code></a> ËÉΩËé∑ÂèñÊï∞ÊçÆÁöÑËøêË°åÊó∂Ë°®Á§∫„ÄÇ</li>
</ul>
<p>‰∏§‰∏™Á±ªÂûãÊòØ <a href="https://draveness.me/golang/tree/reflect.Type" target="_blank" rel="noopener noreffer "><code>reflect.Type</code></a> Âíå <a href="https://draveness.me/golang/tree/reflect.Value" target="_blank" rel="noopener noreffer "><code>reflect.Value</code></a>ÔºåÂÆÉ‰ª¨‰∏éÂáΩÊï∞ÊòØ‰∏Ä‰∏ÄÂØπÂ∫îÁöÑÂÖ≥Á≥ªÔºö</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221209173456424.png" alt="image-20221209173456424" style="zoom:50%;" />
<h4 id="1261-‰∏âÂ§ßÊ≥ïÂàô">1.2.6.1 ‰∏âÂ§ßÊ≥ïÂàô</h4>
<p><strong>Go ËØ≠Ë®ÄÂèçÂ∞ÑÁöÑ‰∏âÂ§ßÊ≥ïÂàôÔºö</strong></p>
<ol>
<li>‰ªé <code>interface{}</code> ÂèòÈáèÂèØ‰ª•ÂèçÂ∞ÑÂá∫ÂèçÂ∞ÑÂØπË±°Ôºõ</li>
<li>‰ªéÂèçÂ∞ÑÂØπË±°ÂèØ‰ª•Ëé∑Âèñ <code>interface{}</code> ÂèòÈáèÔºõ</li>
<li>Ë¶Å‰øÆÊîπÂèçÂ∞ÑÂØπË±°ÔºåÂÖ∂ÂÄºÂøÖÈ°ªÂèØËÆæÁΩÆÔºõ</li>
</ol>
<h5 id="Ê≥ïÂàô1">Ê≥ïÂàô1</h5>
<p>‰∏∫‰ªÄ‰πàÊòØ‰ªé <code>interface{}</code> ÂèòÈáèÂà∞ÂèçÂ∞ÑÂØπË±°ÔºüÊàë‰ª¨‰πüÂèØ‰ª•ÊâßË°å<code>reflect.ValueOf(1)</code>ÂëÄÔºå1ÊòØ<code>int</code>Á±ªÂûãÂëÄÔºåÂπ∂‰∏çÊòØ<code>interface{}</code>Ôºü</p>
<p>Áî±‰∫é <a href="https://draveness.me/golang/tree/reflect.TypeOf" target="_blank" rel="noopener noreffer "><code>reflect.TypeOf</code></a>„ÄÅ<a href="https://draveness.me/golang/tree/reflect.ValueOf" target="_blank" rel="noopener noreffer "><code>reflect.ValueOf</code></a> ‰∏§‰∏™ÊñπÊ≥ïÁöÑÂÖ•ÂèÇÈÉΩÊòØ <code>interface{}</code> Á±ªÂûãÔºåÊâÄ‰ª•Âú®ÊñπÊ≥ïÊâßË°åÁöÑËøáÁ®ã‰∏≠ÂèëÁîü‰∫ÜÁ±ªÂûãËΩ¨Êç¢„ÄÇÂõ†‰∏∫ Go ËØ≠Ë®ÄÁöÑÂáΩÊï∞Ë∞ÉÁî®ÈÉΩÊòØÂÄº‰º†ÈÄíÁöÑÔºåÊâÄ‰ª•ÂèòÈáè‰ºöÂú®<strong>ÂáΩÊï∞Ë∞ÉÁî®Êó∂</strong>ËøõË°åÁ±ªÂûãËΩ¨Êç¢„ÄÇÂü∫Êú¨Á±ªÂûã <code>int</code> ‰ºöËΩ¨Êç¢Êàê <code>interface{}</code> Á±ªÂûãÔºåËøô‰πüÂ∞±ÊòØ‰∏∫‰ªÄ‰πàÁ¨¨‰∏ÄÊù°Ê≥ïÂàôÊòØ‰ªéÊé•Âè£Âà∞ÂèçÂ∞ÑÂØπË±°„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221210154544265.png" alt="image-20221210154544265" style="zoom:50%;" />
<ul>
<li>ÈÄöËøá<code>TypeOf</code>Ëé∑ÂæóÂèòÈáèÁ±ªÂûãÔºõ</li>
<li>ÈÄöËøá<code>ValueOf</code>Ëé∑ÂæóÂèòÈáèÂÄºÔºõ</li>
<li>ÁÑ∂ÂêéÂ∞±ÂèØ‰ª•ÈÄöËøá<code>Method</code>Ëé∑ÂæóÁ±ªÂûãÂÆûÁé∞ÁöÑÊñπÊ≥ïÔºõ</li>
<li>ÈÄöËøá<code>Field</code>Ëé∑ÂæóÁ±ªÂûãÂåÖÂê´ÁöÑÂÖ®ÈÉ®Â≠óÊÆµ„ÄÇ</li>
</ul>
<h5 id="Ê≥ïÂàô2">Ê≥ïÂàô2</h5>
<p>‰ªéÂèçÂ∞ÑÂØπË±°ÂèØ‰ª•Ëé∑Âèñ <code>interface{}</code> ÂèòÈáè„ÄÇ<a href="https://golang.org/pkg/reflect/" target="_blank" rel="noopener noreffer "><code>reflect</code></a> ‰∏≠ÁöÑ <a href="https://draveness.me/golang/tree/reflect.Value.Interface" target="_blank" rel="noopener noreffer "><code>reflect.Value.Interface</code></a> Â∞±ËÉΩÂÆåÊàêËøôÈ°πÂ∑•‰Ωú„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221210155135702.png" alt="image-20221210155135702" style="zoom:50%;" />
<p>‰∏çËøáË∞ÉÁî® <a href="https://draveness.me/golang/tree/reflect.Value.Interface" target="_blank" rel="noopener noreffer "><code>reflect.Value.Interface</code></a> ÊñπÊ≥ïÂè™ËÉΩËé∑Âæó <code>interface{}</code> Á±ªÂûãÁöÑÂèòÈáèÔºåËøòÈúÄË¶ÅËøõË°åÁ±ªÂûãÊñ≠Ë®ÄÊâçËÉΩÂèòÊàêÂéüÁ±ªÂûã„ÄÇ</p>
<p><strong>‰ªéÂèçÂ∞ÑÂØπË±°Âà∞Êé•Âè£ÂÄºÁöÑËøáÁ®ãÊòØ‰ªéÊé•Âè£ÂÄºÂà∞ÂèçÂ∞ÑÂØπË±°ÁöÑÈïúÈù¢ËøáÁ®ãÔºå‰∏§‰∏™ËøáÁ®ãÈÉΩÈúÄË¶ÅÁªèÂéÜ‰∏§Ê¨°ËΩ¨Êç¢Ôºö</strong></p>
<ul>
<li>‰ªéÊé•Âè£ÂÄºÂà∞ÂèçÂ∞ÑÂØπË±°Ôºö
<ul>
<li>‰ªéÂü∫Êú¨Á±ªÂûãÂà∞Êé•Âè£Á±ªÂûãÁöÑÁ±ªÂûãËΩ¨Êç¢Ôºõ</li>
<li>‰ªéÊé•Âè£Á±ªÂûãÂà∞ÂèçÂ∞ÑÂØπË±°ÁöÑËΩ¨Êç¢Ôºõ</li>
</ul>
</li>
<li>‰ªéÂèçÂ∞ÑÂØπË±°Âà∞Êé•Âè£ÂÄºÔºö
<ul>
<li>ÂèçÂ∞ÑÂØπË±°ËΩ¨Êç¢ÊàêÊé•Âè£Á±ªÂûãÔºõ</li>
<li>ÈÄöËøáÊòæÂºèÁ±ªÂûãËΩ¨Êç¢ÂèòÊàêÂéüÂßãÁ±ªÂûã(Â¶ÇÊûúÂéüÊù•Â∞±ÊòØÊé•Âè£Á±ªÂûãÔºåÈÇ£‰πà‰∏çÂøÖËøô‰∏ÄÊ≠•)„ÄÇ</li>
</ul>
</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221210155748212.png" alt="image-20221210155748212" style="zoom:50%;" />
<h5 id="Ê≥ïÂàô3">Ê≥ïÂàô3</h5>
<p>ÂÅáÂ¶ÇÊÉ≥Ë¶ÅÊõ¥Êñ∞ÂéüÂèòÈáèÁöÑÂÄºÔºåÂ¶ÇÊûúËøôÊ†∑ÂÜôÔºåÊòØ‰∏çË°åÁöÑÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">i</span> <span class="o">:=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">	<span class="nx">v</span> <span class="o">:=</span> <span class="nx">reflect</span><span class="p">.</span><span class="nf">ValueOf</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">v</span><span class="p">.</span><span class="nf">SetInt</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÈúÄË¶ÅËøôÊ†∑ÂÜôÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">i</span> <span class="o">:=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">	<span class="nx">v</span> <span class="o">:=</span> <span class="nx">reflect</span><span class="p">.</span><span class="nf">ValueOf</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">v</span><span class="p">.</span><span class="nf">Elem</span><span class="p">().</span><span class="nf">SetInt</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li>Ë∞ÉÁî® <a href="https://draveness.me/golang/tree/reflect.ValueOf" target="_blank" rel="noopener noreffer "><code>reflect.ValueOf</code></a> Ëé∑ÂèñÂèòÈáèÊåáÈíàÔºõ</li>
<li>Ë∞ÉÁî® <a href="https://draveness.me/golang/tree/reflect.Value.Elem" target="_blank" rel="noopener noreffer "><code>reflect.Value.Elem</code></a> Ëé∑ÂèñÊåáÈíàÊåáÂêëÁöÑÂèòÈáèÔºõ</li>
<li>Ë∞ÉÁî® <a href="https://draveness.me/golang/tree/reflect.Value.SetInt" target="_blank" rel="noopener noreffer "><code>reflect.Value.SetInt</code></a> Êõ¥Êñ∞ÂèòÈáèÁöÑÂÄºÔºö</li>
</ol>
<h4 id="1262-Á±ªÂûãÂíåÂÄº">1.2.6.2 Á±ªÂûãÂíåÂÄº</h4>
<h5 id="typeof">TypeOf</h5>
<h6 id="Â¶Ç‰Ωï‰º†ÈÄíÂèÇÊï∞">Â¶Ç‰Ωï‰º†ÈÄíÂèÇÊï∞</h6>
<p>ÂèØ‰ª•ÊÄùËÄÉ‰∏Ä‰∏ãÊ≠§Â§ÑÊ†à‰∏äÂèÇÊï∞ÂàóË°®Â∫îËØ•ÊòØÊÄéÊ†∑ÁöÑÔºü</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221210162119892.png" alt="image-20221210162119892" style="zoom:50%;" />
<p>Áî±‰∫é<code>TypeOf</code>ÁöÑÂèÇÊï∞ÊòØÁ©∫Êé•Âè£Á±ªÂûãÔºå<strong>Á©∫Êé•Âè£ÊòØÂä®ÊÄÅÁ±ªÂûã</strong>ÔºåÂÆûÈôÖÂ§ßÂ∞è‰∏çÁü•ÈÅìÔºåÂõ†Ê≠§ÈúÄË¶Å‰º†ÈÄíÂú∞ÂùÄÔºå‰ΩÜÊòØÂ¶ÇÊûú‰º†ÈÄí<code>a</code>ÁöÑÂú∞ÂùÄËøõÂéªÔºåÂ∞±‰ºöËøùËÉåGoËØ≠Ë®ÄÂÄºÊã∑Ë¥ùÁöÑÁâπÊÄßÔºåÂèØËÉΩ‰ºö‰øÆÊîπÂéü<code>a</code>ÁöÑÂÄºÔºåÈÇ£‰πàÂ∫îËØ•ÊÄé‰πàÂÅöÂë¢Ôºü</p>
<p>ÂÆûÈôÖ‰∏äÂú®ÁºñËØëÈò∂ÊÆµÔºå‰ºöÂØπ<code>a</code>ËøõË°åcopyÔºåÂÆûÈôÖ‰º†ÁöÑÊòØ<code>copy of a</code>ÁöÑÂú∞ÂùÄÔºå<strong>ÊâÄÊúâÂèÇÊï∞‰∏∫Á©∫Êé•Âè£Á±ªÂûãÁöÑÊÉÖÂÜµÔºåÈÉΩÊòØËøôÊ†∑</strong>„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221210162601767.png" alt="image-20221210162601767" style="zoom:50%;" />
<h6 id="ËøîÂõûÂÄºÊòØ‰ªÄ‰πà">ËøîÂõûÂÄºÊòØ‰ªÄ‰πàÔºü</h6>
<p>ÈÄöËøá<code>TypeOf</code>ËøîÂõûÁöÑÔºåÂÖ∂ÂÆûÊòØ‰∏Ä‰∏™ÈùûÁ©∫Êé•Âè£ÂèòÈáèÔºö</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221210163130131.png" alt="image-20221210163130131" style="zoom:50%;" />
<h5 id="valueof">ValueOf</h5>
<h6 id="ÂèÇÊï∞‰º†ÈÄí">ÂèÇÊï∞‰º†ÈÄí</h6>
<p>Âêå<code>TypeOf</code>ÔºåÂêåÊó∂Ôºå<code>ValueOf</code>‰ºöÂ∞ÜËøô‰∏™‰∏¥Êó∂ÂèòÈáèÂú∞ÂùÄÊòæÂºèÁöÑ<strong>ÈÄÉÈÄ∏Âà∞Â†Ü‰∏ä</strong>„ÄÇ</p>
<p>‰æãÔºö</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221210163726208.png" alt="image-20221210163726208" style="zoom:50%;" />
<p><code>a</code>ÁöÑÂú∞ÂùÄË¢´ÊòæÂºèÁöÑÈÄÉÈÄ∏Âà∞Â†ÜÔºåÊ≥®ÊÑèÊ≠§Â§ÑÁöÑËøîÂõûÂÄº<code>ptr=&amp;a</code>Ôºö</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221210163931017.png" alt="image-20221210163931017" style="zoom:50%;" />
<p>Êé•‰∏ãÊù•Ë∞ÉÁî®<code>v.Elem()</code>Ôºå‰ºöÊãøÂà∞<code>v.ptr</code>ÊåáÂêëÁöÑÂèòÈáè<code>a</code>ÔºåÂπ∂ÊääÂÆÉ<strong>ÂåÖË£ÖÊàê<code>reflect.Value</code>Á±ªÂûãÁöÑËøîÂõûÂÄº</strong>(ptrÂèàÂèò‰∏∫&amp;a)ÔºåËµãÂÄºÁªô<code>v</code>Ôºö</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221210164411855.png" alt="image-20221210164411855" style="zoom:50%;" />
<p>ÁÑ∂ÂêéÂú®Ë∞ÉÁî®<code>v.SetString()</code>ÔºåÊ≠§Êó∂ÈÄöËøáÂèÇÊï∞<code>v</code>ÊãøÂà∞<code>a</code>ÁöÑÂú∞ÂùÄÔºå‰øÆÊîπÁöÑÂ∞±ÊòØÂéüÊù•ÁöÑ<code>a</code>Ôºö</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221210164522130.png" alt="image-20221210164522130" style="zoom:50%;" />
<h3 id="127-ÊñπÊ≥ïÈõÜ">1.2.7 ÊñπÊ≥ïÈõÜ</h3>
<blockquote>
<h4 id="ÈóÆÈ¢òtÂíåtÁöÑÊñπÊ≥ïÈõÜÊòØÂï•ÂÖ≥Á≥ª"><strong>ÈóÆÈ¢òÔºö</strong><code>T</code>Âíå<code>*T</code>ÁöÑÊñπÊ≥ïÈõÜÊòØÂï•ÂÖ≥Á≥ªÔºü</h4>
</blockquote>
<p><code>T</code>Âíå<code>*T</code>ÊòØ‰∏§ÁßçÁ±ªÂûãÔºåÂàÜÂà´ÊúâÁùÄËá™Â∑±ÁöÑÁ±ªÂûãÂÖÉÊï∞ÊçÆÔºåËÄåÊ†πÊçÆËá™ÂÆö‰πâÁ±ªÂûãÁöÑÁ±ªÂûãÂÖÉÊï∞ÊçÆÔºåÂèØ‰ª•ÊâæÂà∞ËØ•Á±ªÂûãÂÖ≥ËÅîÁöÑÊñπÊ≥ïÂàóË°®ÔºåÊó¢ÁÑ∂<code>T</code>Âíå<code>*T</code>ÂêÑÊúâÂêÑÁöÑÊñπÊ≥ïÈõÜÔºå<strong>ÈÇ£‰∏∫‰ªÄ‰πàËøòË¶ÅÈôêÂà∂<code>T</code>Âíå<code>*T</code>‰∏çËÉΩÂÆö‰πâÂêåÂêçÊñπÊ≥ïÔºü<strong>ÂèàÊÄé‰πà‰ºöÊúâ</strong>&quot;<code>*T</code>ÁöÑÊñπÊ≥ïÈõÜÂåÖÂê´<code>T</code>ÁöÑÊñπÊ≥ïÈõÜ&quot;ËøôÁßçËØ¥Ê≥ïÔºü</strong></p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230104202426028.png" alt="image-20230104202426028" style="zoom:33%;" />
<p>**Á≠îÔºö**È¶ñÂÖàÔºåÂèØ‰ª•Á°ÆÂÆöÁöÑÊòØÔºå<code>T</code>ÁöÑÊñπÊ≥ïÈõÜÈáåÔºåÂÖ®ÈÉ®ÈÉΩÊòØÊúâÊòéÁ°ÆÂÆö‰πâÁöÑÊé•Êî∂ËÄÖ‰∏∫<code>T</code>Á±ªÂûãÁöÑÊñπÊ≥ïÔºõËÄå<code>*T</code>ÁöÑÊñπÊ≥ïÈõÜÈáåÔºåÈô§‰∫ÜÊúâÊòéÁ°ÆÂÆö‰πâÁöÑÊé•Êî∂ËÄÖ‰∏∫<code>*T</code>ÁöÑÊñπÊ≥ï‰ª•Â§ñÔºå**Ëøò‰ºöÊúâÁºñËØëÂô®ÁîüÊàêÁöÑ‰∏Ä‰∫õ&quot;ÂåÖË£ÖÊñπÊ≥ï&quot;Ôºö**Ëøô‰∫õÂåÖË£ÖÊñπÊ≥ïÊòØÂØπÊé•Êî∂ËÄÖ‰∏∫<code>T</code>Á±ªÂûãÁöÑÂêåÂêçÊñπÊ≥ïÁöÑ&quot;ÂåÖË£Ö&quot;Ôºå<strong>‰∏∫‰ªÄ‰πàÁºñËØëÂô®Ë¶Å‰∏∫Êé•Êî∂ËÄÖ‰∏∫<code>T</code>ÁöÑÊñπÊ≥ïÂåÖË£Ö‰∏Ä‰∏™Êé•Êî∂ËÄÖ‰∏∫<code>*T</code>ÁöÑÂêåÂêçÊñπÊ≥ïÂë¢Ôºü</strong></p>
<p>‰Ω†ÂèØËÉΩ‰ºöÊÉ≥Âà∞ Go ÊîØÊåÅÈÄöËøáÊåáÈíàÂèòÈáèËÆøÈóÆÊñπÊ≥ï„ÄÇ<strong>‰ΩÜËøôÈáåÈ¶ñÂÖàË¶ÅÊòéÁ°Æ‰∏ÄÁÇπ</strong>ÔºöÈÄöËøá<code>*T</code>Á±ªÂûãÁöÑÂèòÈáèÁõ¥Êé•Ë∞ÉÁî®<code>T</code>Á±ªÂûãÊé•Êî∂ËÄÖÁöÑÊñπÊ≥ïÂè™ÊòØ‰∏ÄÁßç<strong>ËØ≠Ê≥ïÁ≥ñ</strong>ÔºåÁªèÈ™åËØÅÔºåËøôÁßçË∞ÉÁî®ÊñπÂºèÔºåÁºñËØëÂô®‰ºöÂÜçË∞ÉÁî®Á´ØËøõË°åÊåáÈíàËß£ÂºïÁî®Ôºå<strong>Âπ∂‰∏ç‰ºöÁî®Âà∞ËøôÈáåÁöÑÂåÖË£ÖÊñπÊ≥ï</strong>„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230104203305015.png" alt="image-20230104203305015" style="zoom:33%;" />
<p>==<strong>ÂÆûÈôÖ‰∏äÔºå<strong>ÁºñËØëÂô®ÁîüÊàêÂåÖË£ÖÊñπÊ≥ï‰∏ªË¶ÅÊòØ</strong>‰∏∫‰∫ÜÊîØÊåÅÊé•Âè£</strong>„ÄÇ==</p>
<p>ÈùûÁ©∫Êé•Âè£ÁöÑÊï∞ÊçÆÁªìÊûÑÂè™ÂåÖÂê´‰∏§‰∏™ÊåáÈíàÔºå‰∏Ä‰∏™ÂíåÁ±ªÂûãÂÖÉÊï∞ÊçÆÁõ∏ÂÖ≥Ôºå‰∏Ä‰∏™ÂíåÊé•Âè£Ë£ÖËΩΩÁöÑÊï∞ÊçÆÁõ∏ÂÖ≥ÔºåËôΩÁÑ∂ÊúâÊï∞ÊçÆÊåáÈíàÔºå‰ΩÜÂç¥‰∏çËÉΩÂÉè‰∏äËø∞ËØ≠Ê≥ïÁ≥ñÈÇ£Ê†∑ÔºåÈÄöËøáÊåáÈíàËß£ÂºïÁî®Êù•Ë∞ÉÁî®ÂÄºÊé•Êî∂ËÄÖÁöÑÊñπÊ≥ï„ÄÇ**ÂéüÂõ†Ôºö**ÊñπÊ≥ïÁöÑÊé•Êî∂ËÄÖÊòØÊñπÊ≥ïË∞ÉÁî®Êó∂ÈöêÂê´ÁöÑÁ¨¨‰∏Ä‰∏™ÂèÇÊï∞ÔºåGo ‰∏≠ÁöÑÂáΩÊï∞ÂèÇÊï∞ÊòØÈÄöËøáÊ†àÊù•‰º†ÈÄíÁöÑÔºåÂ¶ÇÊûúÂèÇÊï∞ÊåáÈíàÁ±ªÂûãÔºåÈÇ£Â∞±ÂæàÂ•ΩÂÆûÁé∞ÔºöÂπ≥Âè∞Á°ÆÂÆö‰∫ÜÔºåÊåáÈíàÂ§ßÂ∞èÂ∞±Á°ÆÂÆö‰∫Ü„ÄÇ‰ΩÜÂ¶ÇÊûúË¶ÅËß£ÂºïÁî®‰∏∫ÂÄºÁ±ªÂûãÔºåÂ∞±Ë¶ÅÊúâÊòéÁ°ÆÁöÑÁ±ªÂûã‰ø°ÊÅØÔºåÁºñËØëÂô®ÊâçËÉΩÁ°ÆÂÆöËøô‰∏™ÂèÇÊï∞Ë¶ÅÂú®Ê†à‰∏äÂç†Áî®Â§öÂ§ßÁöÑÂÜÖÂ≠òÁ©∫Èó¥„ÄÇ<strong>ËÄåÂØπ‰∫éÊé•Âè£</strong>ÔºåÁºñËØëÈò∂ÊÆµÂπ∂‰∏çËÉΩÁ°ÆÂÆöÂÆÉ‰ºöË£ÖËΩΩÂì™‰∏ÄÁ±ªÁöÑÊï∞ÊçÆÔºåÊâÄ‰ª•ÁºñËØëÂô®Âπ∂‰∏çËÉΩÁîüÊàêÂØπÂ∫îÁöÑÊåá‰ª§Êù•Ëß£ÂºïÁî®„ÄÇ</p>
<p><strong>ÊÄªËÄåË®Ä‰πãÔºå==Êé•Âè£‰∏çËÉΩÁõ¥Êé•‰ΩøÁî®Êé•Êî∂ËÄÖ‰∏∫ÂÄºÁ±ªÂûãÁöÑÊñπÊ≥ï==„ÄÇ</strong></p>
<p>ÈíàÂØπËøô‰∏™ÈóÆÈ¢òÔºåÁºñËØëÂô®ÈÄâÊã©‰∏∫ÂÄºÁ±ªÂûãÊé•Êî∂ËÄÖÁöÑÊñπÊ≥ïÔºå<strong>ÁîüÊàêÊåáÈíàÊé•Êî∂ËÄÖ&quot;ÂêåÂêç&quot;ÂåÖË£ÖÊñπÊ≥ï</strong>Ëøô‰∏ÄËß£ÂÜ≥ÊñπÊ°à„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230104204206737.png" alt="image-20230104204206737" style="zoom: 33%;" />
<p><strong>Âõ†Ê≠§Ôºå<strong>ÂõûÂà∞ÊúÄÂàùÁöÑÈóÆÈ¢òÔºö</strong>&ldquo;‰∏∫‰ªÄ‰πàËøòË¶ÅÈôêÂà∂<code>T</code>Âíå<code>*T</code>‰∏çËÉΩÂÆö‰πâÂêåÂêçÊñπÊ≥ïÔºü&rdquo;</strong>ÔºåÂ¶ÇÊûúÁªô<code>T</code>Âíå<code>*T</code>ÂÆö‰πâ‰∫ÜÂêåÂêçÊñπÊ≥ïÔºåÂ∞±ÊúâÂèØËÉΩÂíåÁºñËØëÂô®ÁîüÊàêÁöÑÂåÖË£ÖÊñπÊ≥ïÂèëÁîüÂÜ≤Á™ÅÔºåÊâÄ‰ª• Go Âπ≤ËÑÜ‰∏çÂÖÅËÆ∏‰∏∫<code>T</code>Âíå<code>*T</code>ÂÆö‰πâÂêåÂêçÊñπÊ≥ï„ÄÇ</p>
<p>Ëá≥‰∫éÔºå<strong>&quot;<code>*T</code>ÁöÑÊñπÊ≥ïÈõÜÂåÖÂê´<code>T</code>ÁöÑÊñπÊ≥ïÈõÜÁöÑÊâÄÊúâÊñπÊ≥ï&quot;</strong>ÔºåËøôÁßçËØ¥Ê≥ïÂèØ‰ª•ËøôÊ†∑ÁêÜËß£„ÄÇËôΩÁÑ∂<strong>ÁºñËØëÂô®‰ºö‰∏∫ÊâÄÊúâÊé•Êî∂ËÄÖ‰∏∫<code>T</code>ÁöÑÊñπÊ≥ïÁîüÊàêÊé•Êî∂ËÄÖ‰∏∫<code>*T</code>ÁöÑÂåÖË£ÖÊñπÊ≥ï</strong>Ôºå‰ΩÜÊòØ<strong>ÈìæÊé•Âô®‰ºöÊääÁ®ãÂ∫è‰∏≠Á°ÆÂÆöÁî®‰∏çÂà∞ÁöÑÊñπÊ≥ïÈÉΩË£ÅÂâ™Êéâ</strong>ÔºåÊâÄ‰ª•Â¶ÇÊûúÂéªÂàÜÊûêÂèØÊâßË°åÊñá‰ª∂ÁöÑËØùÔºåÂ∞±‰ºöÂèëÁé∞‰∏çÊ≠¢ÊòØËøô‰∫õÂåÖË£ÖÊñπÊ≥ïÔºåÂ∞±ËøûÊàë‰ª¨ÊòéÁ°ÆÂÆö‰πâÁöÑÊñπÊ≥ïÔºå‰πü‰∏ç‰∏ÄÂÆö‰ºöÂ≠òÂú®‰∫éÂèØÊâßË°åÊñá‰ª∂‰∏≠„ÄÇ‰∏çËøáÔºå‰∏ÄÂÆöË¶Å‰ªéÂèØÊâßË°åÊñá‰ª∂‰∏≠ÂéªÂàÜÊûêÔºå<strong>‰∏çËÉΩÈÄöËøáÂèçÂ∞ÑÂéªÈ™åËØÅ</strong>ÔºåÂõ†‰∏∫ÂèçÂ∞ÑÁöÑÂÆûÁé∞‰πüÊòØÂü∫‰∫éÊé•Âè£„ÄÇËã•ÈÄöËøáÂèçÂ∞ÑÊù•È™åËØÅÔºå‰ºöË¢´ÈìæÊé•Âô®ËÆ§‰∏∫Áî®Âà∞‰∫ÜËøô‰∏™ÊñπÊ≥ïÔºå‰ªéËÄåÊääÂÆÉ‰øùÁïô‰∏ãÊù•ÔºåËøôÂ∞±&quot;Êµã‰∏çÂáÜ&quot;‰∫Ü„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230104205023358.png" alt="image-20230104205023358" style="zoom:33%;" />
<h3 id="128-Ê≥õÂûã">1.2.8 Ê≥õÂûã</h3>
<h4 id="go-117">go 1.17</h4>
<p>Âú®‰ª£Á†Å‰∏≠ÁªèÂ∏∏‰ºöÁî®Âà∞‰∏Ä‰∫õÊú¨Âú∞ÁºìÂ≠òÁªÑ‰ª∂ÔºåÂÆÉ‰ª¨ÊòØÂ§çÁî®ÊÄßÊûÅÈ´òÁöÑÂü∫Á°ÄÁªÑ‰ª∂ÔºåÂú®‰ΩøÁî®‰ΩìÈ™å‰∏äÂíå<code>map</code>Â∑Æ‰∏çÂ§öÔºåÈÉΩÊèê‰æõ‰∫Ü<code>Set</code>Âíå<code>Get</code>ÊñπÊ≥ï„ÄÇ<strong>‰∏∫‰∫ÜÊîØÊåÅ‰ªªÊÑèÁ±ªÂûã</strong>ÔºåËøô‰∫õÊñπÊ≥ïÈÉΩ‰ΩøÁî®‰∫ÜÁ©∫Êé•Âè£Á±ªÂûãÁöÑÂèÇÊï∞ÔºåÂÜÖÈÉ®ÂÆûÈôÖÂ≠òÂÇ®Êï∞ÊçÆÁöÑÊòØ‰∏™ÂÄºÁ±ªÂûã‰∏∫Á©∫Êé•Âè£ÁöÑ<code>map</code>„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230110162400295.png" alt="image-20230110162400295" style="zoom:33%;" />
<p>‰ΩøÁî®<code>Set</code>ÊñπÊ≥ïÊó∂Ôºå‰∏ÄËà¨‰∏ç‰ºöËßâÂæóÊúâ‰ªÄ‰πà‰∏çÊñπ‰æøÔºåÂõ†‰∏∫‰ªéÂÖ∑‰ΩìÁ±ªÂûãÊàñÊé•Âè£Á±ªÂûãÔºåÂà∞Á©∫Êé•Âè£ÁöÑËµãÂÄº‰∏çÈúÄË¶ÅÈ¢ùÂ§ñÂ§ÑÁêÜ„ÄÇ‰ΩÜÊòØ<code>Get</code>ÊñπÊ≥ï‰ΩøÁî®Êó∂ÔºåÈúÄË¶ÅÈÄöËøáÁ±ªÂûãÊñ≠Ë®ÄÔºåÊääÂèñÂá∫Êù•ÁöÑÊï∞ÊçÆËΩ¨Êç¢ÊàêÈ¢ÑÊúüÁöÑÁ±ªÂûã„ÄÇÊØîÂ¶ÇÊÉ≥‰ªéÊú¨Âú∞ÁºìÂ≠ò<code>c</code>ÈáåÈù¢ÂèñÂá∫Êù•‰∏Ä‰∏™<code>string</code>ÔºåÂ∞±ÈúÄË¶ÅËøôÊ†∑ÂÜôÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="k">if</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="s">&#34;key&#34;</span><span class="p">);</span> <span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">v</span><span class="p">.(</span><span class="kt">string</span><span class="p">);</span> <span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// use s
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Â¶ÇÊûúÊòØ‰ªÖ‰ªÖÂ§öËøô‰∏ÄÊ≠•ÔºåÈÇ£‰πüÊó†ÂèØÂéöÈùûÔºåÂèØÂÆûÈôÖ‰∏äÂπ∂‰∏çËøô‰πàÁÆÄÂçï„ÄÇ</p>
<p>**Á©∫Êé•Âè£Êú¨Ë¥®‰∏äÊòØ‰∏ÄÂØπÊåáÈíàÔºåÁî®Êù•Ë£ÖËΩΩÂÄºÁ±ªÂûãÊó∂‰ºöÂèëÁîüË£ÖÁÆ±ÔºåÈÄ†ÊàêÂèòÈáèÈÄÉÈÄ∏„ÄÇ**‰æãÂ¶ÇÁî®<code>Cache</code>Êù•ÁºìÂ≠ò<code>int64</code>Á±ªÂûãÔºåÁºìÂ≠òÂØπË±°<code>c</code>Â∫ïÂ±ÇÊòØ‰∏™<code>map</code>ÔºåÂú®<code>map</code>ÁöÑ<code>buckets</code>‰∏≠Â≠òÂÇ®ÁùÄÂÖÉÁ¥†ÁöÑÂìàÂ∏åÂÄº„ÄÅ<code>key</code>Âíå<code>value</code>ÔºåÂØπ‰∫é<code>c</code>ËÄåË®ÄÔºå<code>bucket</code>ËøôÈáåÂ≠òÂÇ®ÁöÑ<code>value</code>ÊòØ‰∏Ä‰∏™‰∏Ä‰∏™ÁöÑÁ©∫Êé•Âè£ÔºåËÄåÂÆûÈôÖ‰∏äÁöÑ<code>int64</code>‰ºöÂú®Â†Ü‰∏äÂçïÁã¨ÂàÜÈÖçÔºåÁ©∫Êé•Âè£ÁöÑ<code>data</code>ÊåáÈíàÊåáÂêëÂ†Ü‰∏äÁöÑ<code>int64</code>ÔºåÁõ∏ËæÉ‰∫éÁõ¥Êé•Êää<code>int64</code>Â≠òÂÇ®Âú®<code>map</code>ÁöÑ<code>bucket</code>ÈáåÔºåÂ†ÜÂàÜÈÖçÊñπÂºèÂá≠Á©∫Â§öÂá∫Êù•‰∏ÄÊ¨°Â†ÜÂàÜÈÖçÔºåËÄå‰∏îËøòÂ§öÂç†Áî®‰∫Ü‰∏§ÂÄçÁöÑÂÜÖÂ≠òÁ©∫Èó¥„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230111162036321.png" alt="image-20230111162036321" style="zoom:33%;" />
<p>ÈíàÂØπËøô‰∏™ÈóÆÈ¢òÔºåÊîπÈÄ†‰∏äËø∞ÁºìÂ≠ò‰∏∫Ê≥õÂûãÁºìÂ≠ò„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230111162647627.png" alt="image-20230111162647627" style="zoom:33%;" />
<ul>
<li>Â∞Ü<code>Cache</code>Êîπ‰∏∫<code>cache</code>ÔºåÂõ†‰∏∫ Go 1.17 ÁöÑÊ≥õÂûãÂÆûÁé∞Ëøò‰∏çÊîØÊåÅÂØºÂá∫ÔºåÊ≥õÂûãÁõ∏ÂÖ≥ÁöÑÁ±ªÂûãÂíåÂáΩÊï∞Âè™ËÉΩÂú®ÂΩìÂâçÂåÖ‰∏≠‰ΩøÁî®Ôºõ</li>
<li>Go 1.17 ÁöÑÊ≥õÂûãÊîØÊåÅÈªòËÆ§ÊòØÂÖ≥Èó≠ÁöÑÔºåÊûÑÂª∫ÂèØÊâßË°åÊñá‰ª∂Êó∂Â∫îÊåáÂÆöÂèÇÊï∞Êù•ÊòæÂºèÁöÑÂºÄÂêØÔºåËÄå‰∏îÔºåÊçÆËßÇÂØü<code>build</code>ÂëΩ‰ª§Âè™ÊúâÂú®ÁºñËØë<code>main</code>ÂåÖÊó∂ÔºåÊâç‰ºöÈÄè‰º†Ëøô‰∏™ÂèÇÊï∞ÔºåËøôÂ∞±ÈôêÂà∂‰∫ÜÂè™ËÉΩÂú®<code>main</code>ÂåÖ‰∏≠‰ΩøÁî®Ê≥õÂûã„ÄÇ</li>
</ul>
<p>ÊîπÈÄ†Â•ΩÂêéÔºåÂêåÊ†∑Áî®Êù•Â≠òÂÇ®<code>int64</code>Á±ªÂûãÁöÑÊï∞ÂÄºÔºåÁÑ∂ÂêéÔºåÈÄöËøáÂèçÂ∞ÑËßÇÂØüÂ∫ïÂ±Ç<code>map</code>Â≠òÂÇ®ÁöÑÊòØ‰ªÄ‰πàÊ†∑Á±ªÂûãÁöÑÂÖÉÁ¥†Ôºå‰∏ãËæπÁöÑ‰ª£Á†Å‰ºöÊâìÂç∞<code>int64</code>Ôºå‰πüÂ∞±ÊòØËØ¥ÔºåÊ≥õÂûãÁºìÂ≠ò<code>cache</code>ÁöÑÂ∫ïÂ±Ç<code>map</code>‰ºöÁõ¥Êé•Âú®<code>bucket</code>‰∏≠Â≠òÂÇ®<code>int64</code>Á±ªÂûãÁöÑÊï∞ÂÄºÔºåÊ≤°ÊúâÈ¢ùÂ§ñÁöÑÂ†ÜÂàÜÈÖç„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230111162701301.png" alt="image-20230111162701301" style="zoom:33%;" />
<p>ÂèØ‰ª•ÁúãÂá∫ÔºåÊ≥õÂûãËÉΩÂ§üËß£ÂÜ≥Ëøô‰∏™ÈóÆÈ¢ò„ÄÇ<strong>‰ΩÜÊòØÔºåËøô‰∏çÊòØÊ≤°Êúâ‰ª£‰ª∑ÁöÑ„ÄÇ</strong></p>
<p><strong>Ê≥õÂûãÁöÑÂÆûÁé∞Ôºö</strong></p>
<p>‰ΩøÁî®Ê≥õÂûãÊúÄÁõ¥Êé•ÁöÑ‰ª£‰ª∑Â∞±ÊòØÔºö<strong>ÁºñËØëÂô®‰ºö‰∏∫Âêå‰∏ÄÂ•óÊ®°ÊùøÁöÑÊØè‰∏™Á±ªÂûãÔºåÈÉΩÁîüÊàê‰∏ÄÂ•ó‰ª£Á†Å</strong>ÔºåÂèØËÉΩ‰ºöÂØºËá¥ÂèØÊâßË°åÊñá‰ª∂Â§ßÂ∞èÊúâÊâÄÂ¢ûÂä†ÔºõËÄå‰∏îÔºåÂç≥‰æø‰ΩøÁî®Ê≥õÂûãÔºåË¶ÅÊÉ≥Âú®‰∏Ä‰∏™ÁºìÂ≠òÂØπË±°ÈáåÈù¢Â≠òÂÇ®Â§öÁßç‰∏çÂêåÁ±ªÂûãÁöÑÂÄºÔºå‰æùÁÑ∂Ë¶Å‰ΩøÁî®Á©∫Êé•Âè£ÔºåÂê¶ÂàôÔºå‰∏Ä‰∏™ÁºìÂ≠òÂØπË±°Â∞±Âè™ËÉΩÂ≠òÂÇ®‰∏ÄÁßçÁ±ªÂûãÁöÑÂÄº„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230111163205226.png" alt="image-20230111163205226" style="zoom:33%;" />
<p>ÊâÄ‰ª•ËØ¥Ôºå<strong>Ê≥õÂûãÊú¨Ë¥®‰∏äÊòØ</strong>ÁºñËØëÈò∂ÊÆµÁöÑ‰ª£Á†ÅÁîüÊàêÔºåÂÆÉÂπ∂‰∏ç‰ºöÊõø‰ª£Á©∫Êé•Âè£Ôºå<strong>Á©∫Êé•Âè£‰∏ªË¶ÅÁî®Êù•ÂÆûÁé∞ËØ≠Ë®ÄÁöÑÂä®ÊÄÅÁâπÊÄß</strong>ÔºåÂÆÉ‰ª¨ÁöÑÈÄÇÁî®Âú∫ÊôØÊ†πÊú¨‰∏çÂêå~</p>
<h4 id="go-118">go 1.18</h4>
<p>Go ‰ªé 1.18 Ê≠£ÂºèÂºÄÂßãÊîØÊåÅÊ≥õÂûãÔºåËøôÈáåÁöÑ<code>T</code>Â∞±ÊòØÁ±ªÂûãÂèÇÊï∞Ôºå‰∏é<code>java</code>„ÄÅ<code>c++</code>ÂØπÊØîÔºåÊ≤°Êúâ‰ΩøÁî®<code>&lt;&gt;</code>ÔºåËÄåÊòØ‰ΩøÁî®<code>[]</code>Ôºö</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230117214908572.png" alt="image-20230117214908572" style="zoom: 33%;" />
<p>ÂêåÊó∂Ôºå‰∏∫‰∫ÜËÆ©ÁºñËØëÂô®ËÉΩÂ§üÊõ¥È´òÊïàÁöÑÊ£ÄÊü•Á±ªÂûãÂèÇÊï∞ÁöÑÂêàÊ≥ïÊÄßÔºåËøòÂºïÂÖ•‰∫Ü<strong>Á±ªÂûãÂèÇÊï∞ÁöÑÁ∫¶ÊùüÊù°‰ª∂</strong>„ÄÇËøô‰∏™Á∫¶ÊùüÊù°‰ª∂Âú®ËØ≠Ê≥ïÂ±ÇÈù¢ÊòØÈÄöËøá<strong>Êé•Âè£</strong>Êù•ÂÆûÁé∞ÁöÑÔºåÂÆÉÊòéÁ°ÆÊèèËø∞‰∫ÜË∞ÉÁî®Êñπ‰º†ÂÖ•ÁöÑÁ±ªÂûãÂèÇÊï∞ÔºåÈúÄË¶ÅÁ¨¶Âêà‰ªÄ‰πàÊ†∑ÁöÑË¶ÅÊ±Ç„ÄÇ</p>
<p>ËøôÈáåÁöÑ<code>fmt.Stringer</code>Êé•Âè£ÈôêÂà∂‰∫ÜË∞ÉÁî®<code>ToString</code>ÊñπÊ≥ïÊó∂Ôºå‰º†ÂÖ•ÁöÑÂèÇÊï∞ÂøÖÈ°ªÂÆûÁé∞‰∫Ü<code>String()</code>ÊñπÊ≥ïÔºåÂ¶ÇÊûú‰º†ÂÖ•ÁöÑÂèÇÊï∞‰∏çÁ¨¶ÂêàË¶ÅÊ±ÇÔºåÂ∞±Êó†Ê≥ïÈÄöËøáÁºñËØë„ÄÇÂΩìÁÑ∂ÔºåÊ≠§Â§ÑÁöÑÊé•Âè£‰πüÂπ∂‰∏çÊòØÂéüÊù•ÁöÑÊé•Âè£„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230117215636985.png" alt="image-20230117215636985" style="zoom: 33%;" />
<p>Ëã•‰ΩøÁî®<strong>ÂéüÊù•ÁöÑÊé•Âè£</strong>ÔºåÂ∞±Âè™ËÉΩÈÄöËøá<strong>Êé•Âè£ÁöÑÊñπÊ≥ïÈõÜ</strong>Êù•Á∫¶ÊùüÁ±ªÂûãÂèÇÊï∞Ôºå‰ΩÜËøôÊúâÊó∂ÊòØË°å‰∏çÈÄöÁöÑ„ÄÇÂõ†‰∏∫ÔºåËøô‰∫õÂÜÖÁΩÆÁ±ªÂûãÊòØÊ≤°ÊúâÂÆûÁé∞‰ªª‰ΩïÊñπÊ≥ïÁöÑÔºåÊØîÂ¶Ç<code>int32</code>„ÄÅ<code>int64</code>„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230117215956554.png" alt="image-20230117215956554" style="zoom: 33%;" />
<p>‰æãÂ¶ÇÔºåÂÜô‰∫Ü‰∏Ä‰∏™<code>Sum()</code>ÂáΩÊï∞ÔºåÊÉ≥ËÆ©ÂÆÉÊîØÊåÅÊâÄÊúâÊï¥ÂûãÁ±ªÂûãÔºåËØ•Â¶Ç‰ΩïÂÆûÁé∞Âë¢Ôºü</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230117220236547.png" alt="image-20230117220236547" style="zoom:33%;" />
<p>Go 1.18 Â∞ÜÊé•Âè£Êâ©Â±ï‰∫Ü‰∏Ä‰∏ã„ÄÇÂéüÊù•ÁöÑÊé•Âè£Âè™ËÉΩÂÆö‰πâ<code>ÊñπÊ≥ïÈõÜ</code>Ôºå<strong>Êâ©Â±ïÂêéÁöÑÊé•Âè£Â¢ûÂä†‰∫Ü<code>Á±ªÂûãÈõÜ</code>ÔºåÈÄöËøá<code>Á±ªÂûãÈõÜ</code>ÊåáÊòéÂì™‰∫õÁ±ªÂûãÊòØË¢´ÊîØÊåÅÁöÑ</strong>„ÄÇ</p>
<p>‰æãÂ¶ÇÔºå<code>Integer</code>Êé•Âè£Áî®‰ΩúÁ∫¶ÊùüÊù°‰ª∂Êó∂ÔºåÂ∞±ÂèØ‰ª•ÊîØÊåÅÊâÄÊúâÁöÑÊúâÁ¨¶Âè∑Êï¥Âûã„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230117220749258.png" alt="image-20230117220749258" style="zoom:25%;" />
<p><strong>‰ΩÜËøô‰æùÁÑ∂‰∏çÂ§ü</strong>ÔºåÂ¶ÇÊûúÊàë‰ª¨Ëá™ÂÆö‰πâ‰∫Ü<code>type MyInt int</code>Á±ªÂûãÔºåÂêåÊ†∑‰πüÂ∏åÊúõË¢´ÊîØÊåÅÔºåËøô‰∏™Á∫¶ÊùüÊù°‰ª∂ÂèàËØ•ÊÄé‰πàÂÜôÂë¢ÔºüÊÄª‰∏çËÉΩÊØèÊ¨°Êñ∞Â¢ûÂä†Ëá™ÂÆö‰πâÁ±ªÂûãÈÉΩÂéªÊîπ‰∏Ä‰∏ãÊé•Âè£ÁöÑÁ±ªÂûãÈõÜÂêßÔºü</p>
<p>‰∏∫‰∫ÜËß£ÂÜ≥Ëøô‰∏™ÈóÆÈ¢òÔºåGo Êñ∞Â¢ûÂä†‰∫ÜÁ¨¶Âè∑<code>~</code>ÔºåÂè™Ë¶ÅÂÜô<code>~int</code>ÔºåÂ∞±ÂèØ‰ª•ÊîØÊåÅ**<code>int</code>Á±ªÂûã<strong>‰ª•Âèä</strong>Âü∫‰∫é<code>int</code>ÂàõÂª∫ÁöÑÊâÄÊúâËá™ÂÆö‰πâÁ±ªÂûã**Ôºå</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230117220812122.png" alt="image-20230117220812122" style="zoom:33%;" />
<p>**Ê≥®ÊÑèÔºö**ËøôÁßçÊâ©Â±ïÂêéÁöÑÊé•Âè£ÔºåÁõÆÂâçÂè™Áî®‰∫éÊ≥õÂûãÁöÑÁ∫¶ÊùüÊù°‰ª∂„ÄÇ</p>
<p>Áé∞Âú®Êúâ‰∫ÜÊ≥õÂûãÔºåÂè™ÈúÄË¶ÅÂÆûÁé∞‰∏ÄÈÅçÂäüËÉΩÂáΩÊï∞ÔºåÂ∞±ÂèØ‰ª•ÈÄöËøáÂ§öÁßçÁ±ªÂûãÂèÇÊï∞Êù•Ë∞ÉÁî®„ÄÇ</p>
<p>**ÈóÆÈ¢òÔºö**ÁºñËØëÂô®‰ºö‰∏ç‰ºöÁªôÊØèÁßçÊîØÊåÅÁöÑÁ±ªÂûãÈÉΩÁîüÊàê‰∏ÄÂ•ó‰ª£Á†ÅÂë¢Ôºü// ==TODO==</p>
<p>Ë≤å‰ºº‰∏çÁî®„ÄÇÈÄöËøáÂ≠óÂÖ∏ÂíågcshapeÂÆûÁé∞„ÄÇÊ≤°Âê¨ÊáÇ„ÄÇÂÖàËøôÊ†∑Âêß„ÄÇ„ÄÇ„ÄÇ</p>
<h2 id="13-Â∏∏Áî®ÂÖ≥ÈîÆÂ≠ó">1.3 Â∏∏Áî®ÂÖ≥ÈîÆÂ≠ó</h2>
<h3 id="131-defer">1.3.1 defer</h3>
<p>‰ΩøÁî®<code>defer</code>ÁöÑÊúÄÂ∏∏ËßÅÂú∫ÊôØÊòØÂú®ÂáΩÊï∞Ë∞ÉÁî®ÁªìÊùüÂêéÂÆåÊàê‰∏Ä‰∫õÊî∂Â∞æÂ∑•‰ΩúÔºåÈÄöÂ∏∏Áî®Êù•Ôºö</p>
<ul>
<li>ÂÖ≥Èó≠Êñá‰ª∂ÊèèËø∞Á¨¶Ôºõ</li>
<li>ÂÖ≥Èó≠Êï∞ÊçÆÂ∫ìËøûÊé•Ôºõ</li>
<li>Ëß£ÈîÅËµÑÊ∫ê</li>
</ul>
<p>ÈÄöÂ∏∏‰ΩøÁî®<code>defer</code>‰ºöÈÅáÂà∞‰∏§‰∏™Â∏∏ËßÅÁöÑÈóÆÈ¢òÔºö</p>
<ul>
<li><code>defer</code> ÂÖ≥ÈîÆÂ≠óÁöÑ<strong>Ë∞ÉÁî®Êó∂Êú∫</strong>‰ª•ÂèäÂ§öÊ¨°Ë∞ÉÁî® <code>defer</code> Êó∂<strong>ÊâßË°åÈ°∫Â∫è</strong>ÊòØÂ¶Ç‰ΩïÁ°ÆÂÆöÁöÑÔºõ</li>
<li><code>defer</code> ÂÖ≥ÈîÆÂ≠ó‰ΩøÁî®<strong>‰º†ÂÄº</strong>ÁöÑÊñπÂºè‰º†ÈÄíÂèÇÊï∞Êó∂‰ºöËøõË°åÈ¢ÑËÆ°ÁÆóÔºåÂØºËá¥‰∏çÁ¨¶ÂêàÈ¢ÑÊúüÁöÑÁªìÊûú„ÄÇ</li>
</ul>
<h5 id="ÊâßË°åÈ°∫Â∫è">==ÊâßË°åÈ°∫Â∫è==</h5>
<p><code>deferProc()</code>Ë¥üË¥£ÊääË¶ÅÊâßË°åÁöÑÂáΩÊï∞‰ø°ÊÅØ‰øùÂ≠òËµ∑Êù•ÔºåÁß∞‰πã‰∏∫**<code>defer</code>Ê≥®ÂÜå**Ôºõ<code>defer</code>Ê≥®ÂÜåÂÆåÊàêÂêéÔºå‰ºöÁªßÁª≠ÊâßË°åÂêéÈù¢ÁöÑÈÄªËæëÔºåÁõ¥Âà∞ËøîÂõû‰πãÂâçÈÄöËøá<code>deferreturn</code>ÊâßË°åÊ≥®ÂÜåÁöÑ<code>defer</code>ÂáΩÊï∞„ÄÇ<strong>Âç≥ÔºöÂÖàÊ≥®ÂÜåÔºåÂÜçÂª∂ËøüË∞ÉÁî®„ÄÇ</strong></p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221211161841348.png" alt="image-20221211161841348" style="zoom:50%;" />
<p><code>defer</code>‰ºöÂú®ÂáΩÊï∞ËøîÂõû‰πãÂâçÔºåÊåâÁÖß<strong>ÂÄíÂ∫è</strong>ÊâßË°å„ÄÇËøôÊòØÂõ†‰∏∫<code>goroutine</code>ËøêË°åÊó∂‰ºöÊúâ‰∏Ä‰∏™ÂØπÂ∫îÁöÑ<code>ÁªìÊûÑ‰Ωìg</code>ÔºåÂÖ∂‰∏≠Êúâ‰∏Ä‰∏™Â≠óÊÆµÊåáÂêë<code>defer</code>ÈìæË°®Â§¥Ôºå<code>defer</code>ÈìæË°®ÈìæËµ∑Êù•ÁöÑÊòØ‰∏Ä‰∏™‰∏™<code>_defer</code>ÁªìÊûÑ‰ΩìÔºå<strong>Êñ∞Ê≥®ÂÜåÁöÑ<code>defer</code>‰ºöÊ∑ªÂä†Âà∞ÈìæË°®Â§¥ÔºåÊâßË°åÊó∂‰ªéÂ§¥ÂºÄÂßã</strong>ÔºåÂõ†Ê≠§ÊâßË°åÈ°∫Â∫èÊòØ<strong>Ê≥®ÂÜåÈ°∫Â∫èÁöÑÂÄíÂ∫è</strong>„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221206203611957.png" alt="image-20221206203611957" style="zoom:50%;" />
<h5 id="È¢ÑËÆ°ÁÆóÂèÇÊï∞">==È¢ÑËÆ°ÁÆóÂèÇÊï∞==</h5>
<p>Go ËØ≠Ë®Ä‰∏≠ÊâÄÊúâÁöÑÂáΩÊï∞Ë∞ÉÁî®ÈÉΩÊòØ‰º†ÂÄºÁöÑÔºåËôΩÁÑ∂ <code>defer</code> ÊòØÂÖ≥ÈîÆÂ≠óÔºå‰ΩÜÊòØ‰πüÁªßÊâø‰∫ÜËøô‰∏™ÁâπÊÄß„ÄÇÂ¶Ç‰∏ã‰ª£Á†ÅÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">startedAt</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nf">Since</span><span class="p">(</span><span class="nx">startedAt</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="nx">time</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">$</span> <span class="k">go</span> <span class="nx">run</span> <span class="nx">main</span><span class="p">.</span><span class="k">go</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span><span class="nx">s</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰∏∫‰ªÄ‰πà‰ºöËæìÂá∫0Âë¢Ôºü<strong>ËøôÊòØÂõ†‰∏∫Ôºö<strong>Ë∞ÉÁî® <code>defer</code> ÂÖ≥ÈîÆÂ≠ó‰ºö</strong>Á´ãÂàªÊã∑Ë¥ùÂáΩÊï∞‰∏≠ÂºïÁî®ÁöÑÂ§ñÈÉ®ÂèÇÊï∞</strong>ÔºåÊâÄ‰ª• <code>time.Since(startedAt)</code> ÁöÑÁªìÊûú‰∏çÊòØÂú® <code>main</code> ÂáΩÊï∞ÈÄÄÂá∫‰πãÂâçËÆ°ÁÆóÁöÑÔºåËÄåÊòØÂú® <code>defer</code> ÂÖ≥ÈîÆÂ≠óË∞ÉÁî®Êó∂ËÆ°ÁÆóÁöÑÔºåÊúÄÁªàÂØºËá¥‰∏äËø∞‰ª£Á†ÅËæìÂá∫ 0s„ÄÇ</p>
<p>ÊÉ≥Ë¶ÅËß£ÂÜ≥Ëøô‰∏™ÈóÆÈ¢òÁöÑÊñπÊ≥ïÈùûÂ∏∏ÁÆÄÂçïÔºåÊàë‰ª¨Âè™ÈúÄË¶ÅÂêë <code>defer</code> ÂÖ≥ÈîÆÂ≠ó‰º†ÂÖ•ÂåøÂêçÂáΩÊï∞Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">startedAt</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nf">Since</span><span class="p">(</span><span class="nx">startedAt</span><span class="p">))</span> <span class="p">}()</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="nx">time</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">$</span> <span class="k">go</span> <span class="nx">run</span> <span class="nx">main</span><span class="p">.</span><span class="k">go</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span><span class="nx">s</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="1311-Êï∞ÊçÆÁªìÊûÑ">1.3.1.1 Êï∞ÊçÆÁªìÊûÑ</h4>
<p><code>defer</code>Âú®GoËØ≠Ë®Ä‰∏≠ÁöÑÁªìÊûÑÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">_defer</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">siz</span>       <span class="kt">int32</span>		<span class="c1">// ÂèÇÊï∞ÂíåËøîÂõûÂÄºÂÖ±Âç†Â§öÂ∞ëÂ≠óËäÇ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">started</span>   <span class="kt">bool</span>		<span class="c1">// Ê†áËÆ∞deferÊòØÂê¶Â∑≤ÁªèÊâßË°å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">openDefer</span> <span class="kt">bool</span>		<span class="c1">// 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">sp</span>        <span class="kt">uintptr</span>	<span class="c1">// Ë∞ÉÁî®ËÄÖÊ†àÊåáÈíà
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">pc</span>        <span class="kt">uintptr</span>	<span class="c1">// ËøîÂõûÂú∞ÂùÄ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">fn</span>        <span class="o">*</span><span class="nx">funcval</span>	<span class="c1">// defer ÂÖ≥ÈîÆÂ≠ó‰∏≠‰º†ÂÖ•ÁöÑÂáΩÊï∞ÔºåÂç≥Ê≥®ÂÜåÂáΩÊï∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">_panic</span>    <span class="o">*</span><span class="nx">_panic</span>	<span class="c1">// Ëß¶ÂèëÂª∂ËøüË∞ÉÁî®ÁöÑÁªìÊûÑ‰ΩìÔºåÂèØËÉΩ‰∏∫Á©∫
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">link</span>      <span class="o">*</span><span class="nx">_defer</span>	<span class="c1">// ‰∏ã‰∏Ä‰∏™_deferÊåáÈíà
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂèØ‰ª•ÁúãÂá∫<a href="https://draveness.me/golang/tree/runtime._defer" target="_blank" rel="noopener noreffer "><code>runtime._defer</code></a> ÁªìÊûÑ‰ΩìÂÖ∂ÂÆûÊòØ<code>_defer</code>Ë∞ÉÁî®ÈìæË°®‰∏äÁöÑ‰∏Ä‰∏™ÂÖÉÁ¥†ÔºåÊâÄÊúâÁöÑÁªìÊûÑ‰ΩìÈÉΩ‰ºöÈÄöËøá <code>link</code> Â≠óÊÆµ‰∏≤ËÅîÊàêÈìæË°®„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221211155916102.png" alt="image-20221211155916102" style="zoom:50%;" />
<h4 id="1312-ÊâßË°åÊú∫Âà∂">1.3.1.2 ÊâßË°åÊú∫Âà∂</h4>
<p><strong>Â†ÜÂàÜÈÖç</strong>„ÄÅ<strong>Ê†àÂàÜÈÖç</strong>Âíå<strong>ÂºÄÊîæÁºñÁ†Å</strong>ÊòØÂ§ÑÁêÜ <code>defer</code> ÂÖ≥ÈîÆÂ≠óÁöÑ‰∏âÁßçÊñπÊ≥ï„ÄÇ</p>
<ul>
<li>
<p>Go 1.12 ÂºïÂÖ•ÔºöÂ†ÜÂàÜÈÖç<a href="https://draveness.me/golang/tree/runtime._defer" target="_blank" rel="noopener noreffer "><code>runtime._defer</code></a> ÁªìÊûÑ‰ΩìÔºõ</p>
</li>
<li>
<p>Go 1.13 ÂºïÂÖ•ÔºöÊ†àÂàÜÈÖçÁöÑÁªìÊûÑ‰ΩìÔºõ</p>
</li>
<li>
<p>Go 1.14- ÂºïÂÖ•ÔºöÂü∫‰∫éÂºÄÊîæÁºñÁ†ÅÁöÑ <code>defer</code>„ÄÇ</p>
</li>
</ul>
<h4 id="1313-Â†ÜÂàÜÈÖç">1.3.1.3 Â†ÜÂàÜÈÖç</h4>
<p><code>deferproc</code>ÂáΩÊï∞ÊâßË°åÊó∂ÔºåÈúÄË¶ÅÂ†ÜÂàÜÈÖç‰∏ÄÊÆµÁ©∫Èó¥ÔºåÂ≠òÊîæ<code>_defer</code>ÁªìÊûÑ‰ΩìÂèäÂèÇÊï∞‰∏éËøîÂõûÂÄº„ÄÇÂÆûÈôÖ‰∏äGoËØ≠Ë®Ä‰πü‰ºöÈ¢ÑÂàÜÈÖç‰∏çÂêåËßÑÊ†ºÁöÑ<code>_defer</code>Ê±†ÔºåÊâßË°åÊó∂‰ªéÁ©∫Èó≤<code>_defer</code>Ê±†‰∏≠ÂèñÂá∫‰∏Ä‰∏™ÔºåÊ≤°ÊúâÂêàÈÄÇÁöÑÊàñÁ©∫Èó≤ÁöÑÂ∞±‰ºöËøõË°åÂ†ÜÂàÜÈÖçÔºåÁî®ÂÆå‰πãÂêéÂÜçÊîæÂÖ•<code>_defer</code>Ê±†Ôºå‰ª•ÈÅøÂÖçÈ¢ëÁπÅÁöÑÂ†ÜÂàÜÈÖç‰∏éÂõûÊî∂„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221211163551700.png" alt="image-20221211163551700" style="zoom:50%;" />
<p>Go 1.12 <code>defer</code>ÂæàÊÖ¢ÔºÅÂéüÂõ†Ôºö</p>
<ul>
<li><code>_defer</code>ÁªìÊûÑ‰ΩìÂ†ÜÂàÜÈÖçÔºöÂç≥‰ΩøÊúâÈ¢ÑÂàÜÈÖçÁöÑ<code>deferpool</code>Ôºå‰πüÈúÄË¶ÅÂéªÂ†Ü‰∏äËé∑ÂèñÂíåÈáäÊîæÔºåËÄå‰∏îÔºåÂèÇÊï∞ËøòË¶ÅÂú®Â†ÜÊ†àÈó¥Êù•ÂõûÊã∑Ë¥ùÔºõ</li>
<li><code>_defer</code>Ê≥®ÂÜåÈÄöËøáÈìæË°®ÔºöÈìæË°®Êú¨Ë∫´ÁöÑÊìç‰ΩúÂ∞±ÊÖ¢ÔºÅ</li>
</ul>
<h4 id="1314-Ê†à‰∏äÂàÜÈÖç">1.3.1.4 Ê†à‰∏äÂàÜÈÖç</h4>
<p>ÂÖàÊù•ÂØπÊØî‰∏Ä‰∏ã1.12ÁâàÊú¨Âíå1.13ÁâàÊú¨‰∏≠Ôºå<code>defer</code>Êåá‰ª§ÁºñËØëÂêéÊúâ‰ªÄ‰πà‰∏çÂêåÔºü</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221212160435327.png" alt="image-20221212160435327" style="zoom:50%;" />
<p>1.12 Â∞Ü<code>_defer</code>ÁªìÊûÑ‰ΩìÂàÜÈÖçÂú®Â†Ü‰∏ä„ÄÇÂú®1.13‰∏≠ÔºåÈÄöËøáÂú®ÁºñËØëÈò∂ÊÆµÔºåÂ¢ûÂä†Â±ÄÈÉ®ÂèòÈáèÔºåÊää<code>defer</code>‰ø°ÊÅØ‰øùÂ≠òÂà∞<strong>ÂΩìÂâçÂáΩÊï∞Ê†à</strong>ÁöÑÂ±ÄÈÉ®ÂèòÈáèÂå∫ÂüüÔºåÂÜçÈÄöËøá<code>deferprocStack</code>ÊääÊ†à‰∏äËøô‰∏™<code>_defer</code>ÁªìÊûÑ‰ΩìÊ≥®ÂÜåÂà∞<code>_defer</code>ÈìæË°®‰∏≠ÔºåÊâßË°å‰æùÁÑ∂ÊòØÈÄöËøá<code>deferreturn</code>ÂÆûÁé∞„ÄÇ<strong>‰ºòÂåñÁÇπÔºöÂáèÂ∞ë<code>defer</code>‰ø°ÊÅØÁöÑÂ†ÜÂàÜÈÖç„ÄÇ</strong></p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221212161026409.png" alt="image-20221212161026409" style="zoom:50%;" />
<p>1.13‰∏≠ÁöÑ<code>defer</code>ÔºåÂÆòÊñπÊèê‰æõÁöÑÊÄßËÉΩÊèêÂçáÊòØ30%„ÄÇ</p>
<h4 id="1315-ÂºÄÊîæÁºñÁ†Å">1.3.1.5 ÂºÄÊîæÁºñÁ†Å</h4>
<p>Go 1.14ÊòØÈÄöËøáÂú®ÁºñËØëÈò∂ÊÆµÊèíÂÖ•‰ª£Á†ÅÔºåÊää<code>defer</code>ÂáΩÊï∞ÁöÑÊâßË°åÈÄªËæëÂ±ïÂºÄÂú®ÊâÄÂ±ûÂáΩÊï∞ÂÜÖÔºå‰ªéËÄåÂÖç‰∫éÂàõÂª∫<code>_defer</code>ÁªìÊûÑ‰ΩìÔºåËÄå‰∏î‰∏çÈúÄË¶ÅÊ≥®ÂÜåÂà∞<code>_defer</code>ÈìæË°®„ÄÇËøôÁßçÊñπÂºèÁúÅÂéª‰∫ÜÊûÑÈÄ†<code>_defer</code>ÈìæË°®È°πÔºåÂπ∂Ê≥®ÂÜåÂà∞ÈìæË°®ÁöÑËøáÁ®ã„ÄÇ‰∏æ‰æãËØ¥ÊòéÔºö</p>
<p><code>A1</code>ÂèØ‰ª•ÁÆÄÂçïÁöÑÈÄöËøáÔºöÂÆö‰πâÂ±ÄÈÉ®ÂèòÈáèÔºåÂπ∂Âú®<code>return</code>ÂâçÊèíÂÖ•Ë∞ÉÁî®<code>A1</code>ÁöÑÊåá‰ª§ Êù•ÂÆûÁé∞Âª∂ËøüË∞ÉÁî®ÊïàÊûú„ÄÇ‰ΩÜÊòØÂØπ‰∫é<code>A2</code>Âë¢Ôºü‰ªñÂú®ÁºñËØëÈò∂ÊÆµÊòØÊó†Ê≥ïÁ°ÆÂÆöÊòØÂê¶Ë¢´Ë∞ÉÁî®ÁöÑÔºåÂõ†Ê≠§ÈúÄË¶Å‰∏Ä‰∫õÂ§ÑÁêÜ„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221212161710592.png" alt="image-20221212161710592" style="zoom:50%;" />
<p>GoËØ≠Ë®ÄÈÄöËøá‰∏Ä‰∏™**Ê†áËØÜÂèòÈáè<code>df</code>**Êù•Ëß£ÂÜ≥Ëøô‰∏™ÈóÆÈ¢ò„ÄÇ</p>
<p><strong><code>df</code>ÂèòÈáè‰∏≠ÁöÑÊØè‰∏Ä‰ΩçÂØπÂ∫î‰∏Ä‰∏™<code>defer</code>ÂáΩÊï∞ÊòØÂê¶Ë¶ÅË¢´ÊâßË°å„ÄÇ</strong></p>
<p><strong>ËøôÈáåÂÖà‰ª•<code>A1</code>‰∏æ‰æãÔºö</strong></p>
<ul>
<li><code>df</code>ÂèòÈáèÈ¶ñÂÖàÈúÄË¶ÅÈÄöËøáÂºÇÊàñËøêÁÆó<code>|=</code>Â∞ÜÁ¨¨1‰ΩçÁΩÆ‰∏∫1Ôºõ</li>
<li><code>return</code>ÂâçÊèíÂÖ•ÁöÑË∞ÉÁî®Êåá‰ª§‰πüÂ∫îËØ•ËøõË°å‰øÆÊîπÔºåÈúÄË¶ÅÂà§Êñ≠<code>df</code>ÂèòÈáèÁ¨¨1‰ΩçÊòØÂê¶&gt;0ÔºåËã•&gt;0ÔºåÂú®Ë∞ÉÁî®<code>A1</code>ÂâçÔºåÈúÄË¶ÅÂ∞Ü<code>df</code>ÂèòÈáèÁöÑÁ¨¨1‰ΩçÁΩÆ‰∏∫0ÔºåËøôÊòØ‰∏∫‰∫ÜÈÅøÂÖçÈáçÂ§çË∞ÉÁî®„ÄÇ</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221212162439970.png" alt="image-20221212162439970" style="zoom:50%;" />
<p><strong>ÂÜç‰ª•<code>A2</code>‰∏æ‰æãÔºö</strong></p>
<ul>
<li>È¶ñÂÖàÊèíÂÖ• <strong>Âà§Êñ≠ÊòØÂê¶ÈúÄË¶ÅÂ∞Ü<code>A2</code>ÁöÑÊ†áÂøó‰ΩçÁΩÆ‰∏∫1</strong> ÁöÑ‰ª£Á†ÅÔºõ</li>
<li>ÁÑ∂ÂêéÂú®<code>return</code>ÂâçÊèíÂÖ• <strong>Ê£ÄÊü•<code>df</code>Ê†áÂøó‰Ωç</strong> ÁöÑ‰ª£Á†Å„ÄÇ</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221212162804767.png" alt="image-20221212162804767" style="zoom:50%;" />
<p><strong>ËøôÁßçÊñπÊ≥ïÂ∞ÜÊÄßËÉΩÊèêÈ´ò‰∫Ü‰∏Ä‰∏™Êï∞ÈáèÁ∫ßÔºå‰ΩÜ‰∏çÊòØÊ≤°Êúâ‰ª£‰ª∑„ÄÇ</strong></p>
<p>Â¶ÇÊûúÂú®<code>code to do something</code>Ôºå‰πüÂ∞±ÊòØËøòÊú™ÊâßË°åÂà∞<code>defer</code>ÂáΩÊï∞Ë∞ÉÁî®Â§ÑÔºåÂ∞±ÂèëÁîü‰∫Ü<code>panic</code>Êàñ<code>runtime.Goexit</code>ÂáΩÊï∞ÔºåÂêéÈù¢Ëøô‰∫õ‰ª£Á†ÅÊ†πÊú¨Êó†Ê≥ïÊâßË°åÂà∞ÔºåÂõ†Ê≠§ÈúÄË¶ÅÈÄöËøá<strong>Ê†àÊâ´Êèè</strong>ÁöÑÊñπÂºèÊù•ÂèëÁé∞„ÄÇ<strong>ÊâÄ‰ª•Ôºå<code>defer</code>ÂèòÂø´‰∫ÜÔºå‰ΩÜ<code>panic</code>ÂèòÂæóÊõ¥ÊÖ¢‰∫Ü„ÄÇ</strong></p>
<h4 id="1316-Â∞èÁªì">1.3.1.6 Â∞èÁªì</h4>
<p><strong>ÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºåÊ†à‰∏äÂàÜÈÖçÂíåÂºÄÊîæÁºñÁ†ÅÁöÑÊñπÊ≥ïÂùá‰∏çÈÄÇÁî®‰∫éÂæ™ÁéØ‰∏≠ÁöÑ<code>defer</code>ÔºåÂõ†Ê≠§‰πü‰øùÁïô1.12‰∏≠ÁöÑÂ†ÜÂàÜÈÖçÊñπÊ≥ï„ÄÇ</strong></p>
<h3 id="132-panicÂíårecover">1.3.2 panicÂíårecover</h3>
<ul>
<li><strong><code>panic</code></strong> ËÉΩÂ§üÊîπÂèòÁ®ãÂ∫èÁöÑÊéßÂà∂ÊµÅÔºåË∞ÉÁî® <code>panic</code> Âêé‰ºö<strong>Á´ãÂàªÂÅúÊ≠¢ÊâßË°åÂΩìÂâçÂáΩÊï∞</strong>ÁöÑÂâ©‰Ωô‰ª£Á†ÅÔºåÂπ∂Âú®ÂΩìÂâç Goroutine ‰∏≠ÈÄíÂΩíÊâßË°åË∞ÉÁî®ÊñπÁöÑ <code>defer</code>Ôºõ</li>
<li><strong><code>recover</code></strong> ÂèØ‰ª•‰∏≠Ê≠¢ <code>panic</code> ÈÄ†ÊàêÁöÑÁ®ãÂ∫èÂ¥©Ê∫É„ÄÇÂÆÉÊòØ‰∏Ä‰∏™<strong>Âè™ËÉΩÂú® <code>defer</code> ‰∏≠ÂèëÊå•‰ΩúÁî®</strong>ÁöÑÂáΩÊï∞ÔºåÂú®ÂÖ∂‰ªñ‰ΩúÁî®Âüü‰∏≠Ë∞ÉÁî®‰∏ç‰ºöÂèëÊå•‰ΩúÁî®„ÄÇ</li>
</ul>
<h4 id="1321-Áé∞Ë±°">1.3.2.1 Áé∞Ë±°</h4>
<ul>
<li><strong>Ë∑®ÂçèÁ®ãÂ§±ÊïàÔºö</strong><code>panic</code> Âè™‰ºöËß¶ÂèëÂΩìÂâç Goroutine ÁöÑ <code>defer</code>Ôºõ</li>
<li><strong>Â§±ÊïàÁöÑÂ¥©Ê∫ÉÊÅ¢Â§çÔºö</strong><code>recover</code> Âè™ÊúâÂú® <code>defer</code> ‰∏≠Ë∞ÉÁî®Êâç‰ºöÁîüÊïàÔºõ</li>
<li><strong>ÂµåÂ•óÂ¥©Ê∫ÉÔºö</strong><code>panic</code> ÂÖÅËÆ∏Âú® <code>defer</code> ‰∏≠ÂµåÂ•óÂ§öÊ¨°Ë∞ÉÁî®„ÄÇ</li>
</ul>
<h5 id="Ë∑®ÂçèÁ®ãÂ§±Êïà">Ë∑®ÂçèÁ®ãÂ§±Êïà</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="nb">println</span><span class="p">(</span><span class="s">&#34;in main&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">defer</span> <span class="nb">println</span><span class="p">(</span><span class="s">&#34;in goroutine&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nb">panic</span><span class="p">(</span><span class="s">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">time</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">‚ùØ</span> <span class="k">go</span> <span class="nx">run</span> <span class="nx">test_go</span><span class="p">.</span><span class="k">go</span>
</span></span><span class="line"><span class="cl"><span class="nx">in</span> <span class="nx">goroutine</span>
</span></span><span class="line"><span class="cl"><span class="nx">panic</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰∏äËø∞‰ª£Á†ÅÊ≤°ÊúâÊâßË°å<code>main</code>‰∏≠ÁöÑ<code>defer</code>ÔºåÂè™ÊâßË°å‰∫Ü goroutine ‰∏≠ÁöÑ<code>defer</code>„ÄÇ</p>
<p>**ÊÄªÁªìÔºö**ÂΩìÁ®ãÂ∫èÂèëÁîüÂ¥©Ê∫ÉÊó∂Âè™‰ºöË∞ÉÁî®ÂΩìÂâç goroutine ÁöÑ<code>defer</code>„ÄÇ</p>
<h5 id="Â§±ÊïàÁöÑÂ¥©Ê∫ÉÊÅ¢Â§ç">Â§±ÊïàÁöÑÂ¥©Ê∫ÉÊÅ¢Â§ç</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="nb">println</span><span class="p">(</span><span class="s">&#34;in main&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nb">recover</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nb">panic</span><span class="p">(</span><span class="s">&#34;unknown err&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">‚ùØ</span> <span class="k">go</span> <span class="nx">run</span> <span class="nx">test_go</span><span class="p">.</span><span class="k">go</span>
</span></span><span class="line"><span class="cl"><span class="nx">in</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl"><span class="nx">panic</span><span class="p">:</span> <span class="nx">unknown</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Âú®‰∏ªÁ®ãÂ∫è‰∏≠Ë∞ÉÁî® <code>recover</code> ËØïÂõæ‰∏≠Ê≠¢Á®ãÂ∫èÁöÑÂ¥©Ê∫ÉÔºå‰ΩÜÊòØ‰ªéËøêË°åÁöÑÁªìÊûú‰∏≠Êàë‰ª¨‰πüËÉΩÁúãÂá∫ÔºåÁ®ãÂ∫èÊ≤°ÊúâÊ≠£Â∏∏ÈÄÄÂá∫„ÄÇÂ∫îËØ•Â¶Ç‰∏ãÈù¢ËøôÊ†∑ÂÜôÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="nb">println</span><span class="p">(</span><span class="s">&#34;in main&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nb">recover</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;ÈîôËØØÂèëÁé∞:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}()</span>
</span></span><span class="line"><span class="cl">	<span class="nb">panic</span><span class="p">(</span><span class="s">&#34;unknown err&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">‚ùØ</span> <span class="k">go</span> <span class="nx">run</span> <span class="nx">test_go</span><span class="p">.</span><span class="k">go</span>
</span></span><span class="line"><span class="cl"><span class="err">ÈîôËØØÂèëÁé∞</span><span class="p">:</span> <span class="nx">unknown</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl"><span class="nx">in</span> <span class="nx">main</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂèØ‰ª•ÂèëÁé∞Á®ãÂ∫èÊ≠£Â∏∏ÊâßË°å„ÄÇ</p>
<p><strong>ÊÄªÁªìÔºö<code>recover</code> Âè™ÊúâÂú®ÂèëÁîü <code>panic</code> ‰πãÂêéË∞ÉÁî®Êâç‰ºöÁîüÊïà„ÄÇ<strong>ÁÑ∂ËÄåÂú®‰∏äÈù¢ÁöÑÊéßÂà∂ÊµÅ‰∏≠Ôºå<code>recover</code> ÊòØÂú® <code>panic</code> ‰πãÂâçË∞ÉÁî®ÁöÑÔºåÂπ∂‰∏çÊª°Ë∂≥ÁîüÊïàÁöÑÊù°‰ª∂ÔºåÊâÄ‰ª•</strong>ÈúÄË¶ÅÂú® <code>defer</code> ‰∏≠‰ΩøÁî® <code>recover</code> ÂÖ≥ÈîÆÂ≠ó„ÄÇ</strong></p>
<h5 id="ÂµåÂ•óÂ¥©Ê∫É">ÂµåÂ•óÂ¥©Ê∫É</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="nb">println</span><span class="p">(</span><span class="s">&#34;in main&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">defer</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nb">panic</span><span class="p">(</span><span class="s">&#34;panic again and again&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}()</span>
</span></span><span class="line"><span class="cl">		<span class="nb">panic</span><span class="p">(</span><span class="s">&#34;panic again&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nb">panic</span><span class="p">(</span><span class="s">&#34;panic once&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">‚ùØ</span> <span class="k">go</span> <span class="nx">run</span> <span class="nx">test_go</span><span class="p">.</span><span class="k">go</span>
</span></span><span class="line"><span class="cl"><span class="nx">in</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl"><span class="nx">panic</span><span class="p">:</span> <span class="nx">panic</span> <span class="nx">once</span>
</span></span><span class="line"><span class="cl">        <span class="nx">panic</span><span class="p">:</span> <span class="nx">panic</span> <span class="nx">again</span>
</span></span><span class="line"><span class="cl">        <span class="nx">panic</span><span class="p">:</span> <span class="nx">panic</span> <span class="nx">again</span> <span class="nx">and</span> <span class="nx">again</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂèØ‰ª•Á°ÆÂÆöÁ®ãÂ∫èÂ§öÊ¨°Ë∞ÉÁî® <code>panic</code> ‰πü‰∏ç‰ºöÂΩ±Âìç <code>defer</code> ÂáΩÊï∞ÁöÑÊ≠£Â∏∏ÊâßË°åÔºåÊâÄ‰ª•<strong>‰ΩøÁî® <code>defer</code> ËøõË°åÊî∂Â∞æÂ∑•‰Ωú</strong>‰∏ÄËà¨Êù•ËØ¥ÈÉΩÊòØÂÆâÂÖ®ÁöÑ„ÄÇ</p>
<h4 id="1322-Êï∞ÊçÆÁªìÊûÑ">1.3.2.2 Êï∞ÊçÆÁªìÊûÑ</h4>
<p><code>panic</code> ÂÖ≥ÈîÆÂ≠óÂú® Go ËØ≠Ë®ÄÁöÑÊ∫ê‰ª£Á†ÅÊòØÁî±Êï∞ÊçÆÁªìÊûÑ <a href="https://draveness.me/golang/tree/runtime._panic" target="_blank" rel="noopener noreffer "><code>runtime._panic</code></a> Ë°®Á§∫ÁöÑÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">_panic</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">argp</span>      <span class="nx">unsafe</span><span class="p">.</span><span class="nx">Pointer</span>	<span class="c1">// deferÁöÑÂèÇÊï∞Á©∫Èó¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">arg</span>       <span class="kd">interface</span><span class="p">{}</span>		<span class="c1">// panicÁöÑÂèÇÊï∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">link</span>      <span class="o">*</span><span class="nx">_panic</span>			<span class="c1">// link to earlier panic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">recovered</span> <span class="kt">bool</span>				<span class="c1">// ÊòØÂê¶Ë¢´ recover ÊÅ¢Â§ç
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">aborted</span>   <span class="kt">bool</span>				<span class="c1">// ÊòØÂê¶Ë¢´ÁªàÊ≠¢
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">pc</span>        <span class="kt">uintptr</span>
</span></span><span class="line"><span class="cl">	<span class="nx">sp</span>        <span class="nx">unsafe</span><span class="p">.</span><span class="nx">Pointer</span>
</span></span><span class="line"><span class="cl">	<span class="nx">goexit</span>    <span class="kt">bool</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Âíå<code>defer</code>‰∏ÄÊ†∑Ôºå<code>panic</code>‰πüÊòØ‰∏Ä‰∏™ÈìæË°®ÔºåÂΩìÊúâÊñ∞ÁöÑ<code>panic</code>Âá∫Áé∞Ôºå‰πüÊòØÂú®ÈìæË°®Â§¥ÊèíÂÖ•Êñ∞ÁöÑ<code>_panic</code>ÁªìÊûÑ‰Ωì„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221213213343330.png" alt="image-20221213213343330" style="zoom:33%;" />
<p><code>panic</code>ÊâßË°å<code>defer</code>Êó∂ÔºåÊòØ‰ªéÂ§¥ÂºÄÂßãÊâßË°åÁöÑ„ÄÇÈ¶ñÂÖàÊää<code>_defer</code>ÁöÑ<code>started</code>Â≠óÊÆµÁΩÆ‰∏∫<code>true</code>ÔºåÊ†áËÆ∞ËØ•<code>defer</code>Â∑≤ÁªèÂºÄÂßãÊâßË°åÔºåÂπ∂‰∏î‰ºöÊää<code>panic</code>Â≠óÊÆµÊåáÂêëÂΩìÂâçÊâßË°åÁöÑ<code>panic</code>ÔºåË°®Á§∫Ëøô‰∏™<code>defer</code>ÊòØÁî±Ëøô‰∏™<code>panic</code>Ëß¶ÂèëÁöÑ„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221214152803635.png" alt="image-20221214152803635" style="zoom:50%;" />
<p>Â¶ÇÊûúÂáΩÊï∞<code>A2</code>ËÉΩÂ§üÊ≠£Â∏∏ÊâßË°åÔºåÈÇ£‰πàÂ∞±‰ºöÁßªÈô§<code>A2</code>„ÄÇ</p>
<p>‰πãÊâÄ‰ª•ËøôÊ†∑ËÆæËÆ°ÔºåÊòØ<strong>‰∏∫‰∫ÜÂ∫îÂØπ<code>defer</code>ÂáΩÊï∞Ê≤°ÊúâÊ≠£Â∏∏ÁªìÊùüÁöÑÊÉÖÂÜµ</strong>„ÄÇÂÅáÂ¶ÇÊ≠§Êó∂<code>A2</code>È°∫Âà©ÊâßË°åÔºåÈÇ£‰πàÊâßË°å<code>A1</code>Ôºö</p>
<p>Âõ†‰∏∫<code>A1</code>‰πü‰ºöËß¶Âèë<code>panic</code>ÔºåÈÇ£‰πàÈúÄË¶ÅÂ∞Ü<code>panicA1</code>ÈìæÂú®<code>panic</code>Â§¥ÈÉ®ÔºåÊ≠§Êó∂Ê≠£Âú®ÊâßË°åÁöÑ<code>panic</code>Â∞±ÂèòÊàê‰∫Ü<code>panicA1</code>ÔºåÁÑ∂Âêé‰πü‰ºöÂéªÊâßË°å<code>defer</code>ÈìæË°®Ôºå‰ªéÊ†áËÆ∞Â≠óÊÆµ‰ºöÂèëÁé∞<code>A1</code>Â∑≤ÁªèÂú®ÊâßË°å‰∫ÜÔºå‰∏îËß¶Âèë‰ªñÁöÑ<code>panic</code>ÊòØ<code>panicA</code>ÔºåÊâÄ‰ª•‰ºöÊ†πÊçÆËØ•ÊåáÈíàÊâæÂà∞<code>panicA</code>ÔºåÊää‰ªñ**<code>aborted</code>Ê†áËÆ∞‰∏∫Â∑≤ÁªàÊ≠¢**„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221214153050041.png" alt="image-20221214153050041" style="zoom:50%;" />
<p>ÊâÄ‰ª•Áé∞Âú®<code>panicA</code>Â∑≤ÁªàÊ≠¢Ôºå<code>A1</code>‰πüÊâßË°åÂÆåÊØïÔºå<code>A1</code>‰ºöË¢´ÁßªÈô§ÔºåÂΩìÂâç<code>defer</code>ÈìæË°®‰∏∫Á©∫„ÄÇ</p>
<p>Êé•‰∏ãÊù•Â∞±ËØ•ÊâìÂç∞<code>panic</code>‰ø°ÊÅØ‰∫ÜÔºåÊ≥®ÊÑèÔºö**<code>panic</code>ÊâìÂç∞ÂºÇÂ∏∏‰ø°ÊÅØÊó∂Ôºå‰ºö‰ªéÈìæË°®Â∞æÂºÄÂßãÔºåÂç≥<code>panic</code>ÁöÑÂèëÁîüÈ°∫Â∫èÈÄê‰∏™ËæìÂá∫„ÄÇ**ÊâÄ‰ª•Ê≠§Â§Ñ‰ºöÂÖà<code>panicA</code>ÔºåÂÜç<code>panic A1</code>„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221214153611418.png" alt="image-20221214153611418" style="zoom:50%;" />
<h4 id="1323-recover">1.3.2.3 recover</h4>
<p>‰∏äËø∞ËøáÁ®ãÊ≤°ÊúâÊ∑ªÂä†<code>recover</code>ÔºåÊé•‰∏ãÊù•ÁúãÁúãÊ∑ªÂä†<code>recover</code>‰πãÂêéÁöÑÊÉÖÂÜµ„ÄÇ</p>
<p><code>recover</code>Âè™ÂÅö‰∏Ä‰ª∂‰∫ãÔºåÂ∞±ÊòØ<strong>ÊääÂΩìÂâç<code>panic</code>ÁöÑ<code>recovered</code>Â≠óÊÆµÂèò‰∏∫<code>true</code>„ÄÇ</strong></p>
<hr>
<p>**‰ª•‰∏ã‰∏∫‰æã„ÄÇ**ÂΩìÊâßË°åÂÆå<code>A2</code>Êó∂Ôºå‰ºöÂ∞ÜÂΩìÂâç<code>panicA</code>ÁöÑ<code>recovered=true</code>„ÄÇ<strong>ÊØè‰∏™<code>defer</code>ÊâßË°åÂÆåÊØïÔºå<code>panic</code>ÈÉΩ‰ºöÊ£ÄÊü•ÂΩìÂâç<code>recovered</code>ÊòØÂê¶‰∏∫<code>true</code></strong>„ÄÇÊ≠§Êó∂‰ºöÂèëÁé∞<code>panicA</code>Â∑≤ÁªèË¢´ÊÅ¢Â§ç‰∫ÜÔºåÂ∞±‰ºöÊää‰ªñ‰ªé<code>panic</code>ÈìæË°®‰∏≠ÁßªÈô§ÔºåÂπ∂‰∏îÁßªÈô§<code>A2</code>„ÄÇ<strong>‰∏çËøá<code>A2</code>Ë¢´ÁßªÈô§‰πãÂâçÔºåË¶Å‰øùÂ≠ò<code>_defer.sp</code>Âíå<code>_defer.pc</code></strong>ÔºåÊé•‰∏ãÊù•Â∞±Ë¶ÅÂà©Áî®Ëøô‰∏§‰∏™ÂÄºË∑≥Âá∫<code>panicA</code>ÁöÑÂ§ÑÁêÜÊµÅÁ®ã„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221214154559842.png" alt="image-20221214154559842" style="zoom:50%;" />
<p><strong><code>sp</code>Âíå<code>pc</code>ÊòØÊ≥®ÂÜå<code>defer</code>ÂáΩÊï∞Êó∂‰øùÂ≠òÁöÑ</strong>„ÄÇËøôÈáå<code>sp</code>Â∞±ÊòØ<strong>ÂáΩÊï∞<code>A</code>ÁöÑÊ†àÊåáÈíà</strong>ÔºåËÄå<code>pc</code>Â∞±ÊòØ<strong>Ë∞ÉÁî®<code>deferproc</code>ÂáΩÊï∞ÁöÑËøîÂõûÂú∞ÂùÄ</strong>„ÄÇ</p>
<p>ÈÄöËøá<code>sp</code>ÂèØ‰ª•ËøîÂõûÂà∞ÂáΩÊï∞<code>A</code>ÁöÑÊ†àÂ∏ßÔºåÈÄöËøá<code>pc</code>ÂèØ‰ª•ËøîÂõûÂà∞Ë∞ÉÁî®<code>deferproc</code>Â§Ñ(Âç≥Âà§ÂÆör&gt;0)Â§Ñ„ÄÇËã•Ê≠§Êó∂<code>r=0</code>ÔºåÈÇ£‰πà<code>code to do something</code>Â∞±‰ºöË¢´ÈáçÂ§çÊâßË°åÔºåÊâÄ‰ª•‰ºöÂ∞ÜÂØÑÂ≠òÂô®‰∏≠ÁöÑ<code>r=1</code>ÔºåËøôÊ†∑Â∞±ÂèØ‰ª•Ë∑≥ËΩ¨Âà∞<code>deferreturn</code>Â§ÑÔºåÁªßÁª≠ÊâßË°å<code>defer</code>ÈìæË°®„ÄÇ**Ê≥®ÊÑèÔºö<code>deferreturn</code>Âè™Ë¥üË¥£ÊâßË°åÂΩìÂâçÂáΩÊï∞<code>A</code>Ê≥®ÂÜåÁöÑ<code>defer</code>ÂáΩÊï∞Ôºå**‰ªñÊòØÈÄöËøáÊ†àÊåáÈíàÊù•Âà§Êñ≠ÁöÑ„ÄÇ</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221214155631217.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221214155631217.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221214155631217.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221214155631217.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221214155631217.png"
        title="image-20221214155631217" /></p>
<p>ÊâÄ‰ª•Ôºå<code>A2</code>ÊâßË°åÂÆåÊØïÔºåËøò‰ºöÁªßÁª≠ÊâßË°å<code>A1</code>ÔºåÊâßË°åÂÆåÊØïÂ∞±ÁªìÊùü‰∫Ü„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221214160115738.png" alt="image-20221214160115738" style="zoom:50%;" />
<hr>
<p>**ËøôÈáåË¶ÅÊ≥®ÊÑèÔºö**Âè™ÊúâÂΩì<code>defer</code>ÂáΩÊï∞ÊâßË°åÂÆåÊØïÔºå<code>panic</code>Êâç‰ºöÂéªÊ£ÄÊü•ÊòØÂê¶Ë¢´ÊÅ¢Â§ç„ÄÇ‰ΩÜÊòØÂ¶ÇÊûú<code>defer</code>ÂÖà<code>recover</code>ÔºåÁÑ∂ÂêéÂèà<code>panic</code>‰∫ÜÂë¢Ôºü</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221214160550712.png" alt="image-20221214160550712" style="zoom:50%;" />
<p>Ê≠§Êó∂ÔºåÁî±‰∫éÂèëÁîü‰∫Ü<code>panic</code>ÔºåÊâÄ‰ª•‰ºöÂ∞Ü<code>panicA2</code>Ê≥®ÂÜåÂà∞<code>panic</code>ÈìæË°®Â§¥ÔºåÂπ∂Êàê‰∏∫ÂΩìÂâçÁöÑ<code>panic</code>Ôºå‰ªñ‰ºöÂéªÊâßË°å<code>defer</code>ÈìæË°®ÔºåÂΩìÊâßË°å<code>A2</code>Êó∂Ôºå‰ªéÊ†áËÆ∞Â≠óÊÆµÂèëÁé∞<code>A2</code>Â∑≤ÁªèÂºÄÂßãÊâßË°åÔºåÂπ∂‰∏îËß¶ÂèëËÄÖÊòØ<code>panicA</code>ÔºåÈÇ£‰πà‰ºöÂ∞Ü<code>panicA</code>ÁªàÊ≠¢(<code>aborted=true</code>)ÔºåÂπ∂Êää<code>A2</code>‰ªé<code>defer</code>ÈìæË°®ÁßªÈô§„ÄÇÁªßÁª≠ÊâßË°å‰∏ã‰∏Ä‰∏™<code>defer</code>Ôºå<code>A1</code>Â∞±ÊòØÁî±<code>panicA2</code>Ëß¶ÂèëÁöÑ‰∫Ü„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221214160906485.png" alt="image-20221214160906485" style="zoom:50%;" />
<p><code>A1</code>ÊâßË°åÂÆåÊØïÂêéÔºå‰ºöË¢´ÁßªÈô§ÔºåÊ≠§Êó∂<code>defer</code>ÈìæË°®‰∏∫Á©∫„ÄÇ</p>
<p>Êé•‰∏ãÊù•Â∞±Ë¶ÅËæìÂá∫<code>panic</code>‰ø°ÊÅØ‰∫Ü„ÄÇ</p>
<p><strong>Ê≥®ÊÑèÔºöÂú®ËæìÂá∫Â∑≤ÁªèË¢´<code>recover</code>ÁöÑ<code>panic</code>Êó∂ÔºåÊâìÂç∞Êó∂‰ºöÂ∏¶‰∏ä<code>recovered</code>Ê†áËÆ∞„ÄÇ</strong><code>panic</code>ÊØè‰∏ÄÈ°πË¢´ËæìÂá∫ÂêéÔºåÁ®ãÂ∫èÈÄÄÂá∫„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221214161119978.png" alt="image-20221214161119978" style="zoom:50%;" />
<h4 id="Â∞èÁªì">Â∞èÁªì</h4>
<ul>
<li>
<p>Áî®<code>defer</code>ËøõË°åÊî∂Â∞æÂ∑•‰ΩúÈÄöÂ∏∏ÊòØÂÆâÂÖ®ÁöÑÔºåËøôÊòØÂõ†‰∏∫<code>panic</code>ÂèØ‰ª•ÁªàÊ≠¢ÂÖ∂‰ªñ‰ª£Á†ÅÁöÑÊâßË°åÔºå‰ΩÜ‰∏ç‰ºöÂΩ±ÂìçÂà∞<code>defer</code>ÁöÑÊâßË°å„ÄÇ</p>
</li>
<li>
<p>Âú®Âà§Êñ≠<code>panic</code>ÁöÑÊâßË°åËøáÁ®ãÊó∂ÔºåÂè™ÈúÄË¶ÅÊääÊè°‰Ωè‰∏§‰∏™ÈìæË°®<code>defer</code>Âíå<code>panic</code>ÁöÑÊâßË°åÈ°∫Â∫èÂç≥ÂèØ„ÄÇ</p>
</li>
</ul>
<h1 id="‰∫åËøêË°åÊó∂">‰∫å„ÄÅËøêË°åÊó∂</h1>
<h2 id="21-Âπ∂ÂèëÁºñÁ®ã">2.1 Âπ∂ÂèëÁºñÁ®ã</h2>
<h3 id="211-gmp">2.1.1 GMP</h3>
<h4 id="2111-Ê¶ÇËø∞">2.1.1.1 Ê¶ÇËø∞</h4>
<p>GoËØ≠Ë®ÄÂú®Âπ∂ÂèëÁºñÁ®ãÊñπÈù¢ÊúâÂº∫Â§ßÁöÑËÉΩÂäõÔºåËøôÁ¶ª‰∏çÂºÄËØ≠Ë®ÄÂ±ÇÈù¢ÂØπÂπ∂ÂèëÁºñÁ®ãÁöÑÊîØÊåÅ„ÄÇË∞àÂà∞GoËØ≠Ë®ÄË∞ÉÂ∫¶Âô®ÔºåÁªï‰∏çÂºÄÁöÑÊòØÊìç‰ΩúÁ≥ªÁªü„ÄÅËøõÁ®ã‰∏éÁ∫øÁ®ãËøô‰∫õÊ¶ÇÂøµ„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221217160458921.png" alt="image-20221217160458921" style="zoom: 50%;" />
<p>**Â§ö‰∏™Á∫øÁ®ãÂèØ‰ª•Â±û‰∫éÂêå‰∏Ä‰∏™ËøõÁ®ãÂπ∂ÂÖ±‰∫´ÂÜÖÂ≠òÁ©∫Èó¥„ÄÇ**Âõ†‰∏∫Â§öÁ∫øÁ®ã‰∏çÈúÄË¶ÅÂàõÂª∫Êñ∞ÁöÑËôöÊãüÂÜÖÂ≠òÁ©∫Èó¥ÔºåÊâÄ‰ª•ÂÆÉ‰ª¨‰πü‰∏çÈúÄË¶ÅÂÜÖÂ≠òÁÆ°ÁêÜÂçïÂÖÉÂ§ÑÁêÜ‰∏ä‰∏ãÊñáÁöÑÂàáÊç¢ÔºåÁ∫øÁ®ã‰πãÈó¥ÁöÑÈÄö‰ø°‰πüÊ≠£ÊòØÂü∫‰∫éÂÖ±‰∫´ÁöÑÂÜÖÂ≠òËøõË°åÁöÑÔºå‰∏éÈáçÈáèÁ∫ßÁöÑËøõÁ®ãÁõ∏ÊØîÔºåÁ∫øÁ®ãÊòæÂæóÊØîËæÉËΩªÈáè„ÄÇËøô‰∏çÊòØÊå∫Â•ΩÁöÑÂòõÔºå‰∏∫Âï•ËøòË¶ÅÂºïÂÖ•<code>goroutine</code>Ôºü</p>
<p>**ÂºïÂÖ•<code>goroutine</code>ÁöÑÂéüÂõ†Ôºö**ËôΩÁÑ∂Á∫øÁ®ãÊØîËæÉËΩªÈáèÔºå‰ΩÜÊòØÂú®Ë∞ÉÂ∫¶Êó∂‰πüÊúâÊØîËæÉÂ§ßÁöÑÈ¢ùÂ§ñÂºÄÈîÄ„ÄÇÊØè‰∏™Á∫øÁ®ãÈÉΩ‰ºöÂç†Áî® 1M ‰ª•‰∏äÁöÑÂÜÖÂ≠òÁ©∫Èó¥ÔºåÂú®ÂàáÊç¢Á∫øÁ®ãÊó∂‰∏çÊ≠¢‰ºöÊ∂àËÄóËæÉÂ§öÁöÑÂÜÖÂ≠òÔºåÊÅ¢Â§çÂØÑÂ≠òÂô®‰∏≠ÁöÑÂÜÖÂÆπËøòÈúÄË¶ÅÂêëÊìç‰ΩúÁ≥ªÁªüÁî≥ËØ∑ÊàñËÄÖÈîÄÊØÅËµÑÊ∫êÔºåÊØè‰∏ÄÊ¨°Á∫øÁ®ã‰∏ä‰∏ãÊñáÁöÑÂàáÊç¢ÈÉΩÈúÄË¶ÅÊ∂àËÄó ~1us Â∑¶Âè≥ÁöÑÊó∂Èó¥Ôºå‰ΩÜÊòØ Go Ë∞ÉÂ∫¶Âô®ÂØπ Goroutine ÁöÑ‰∏ä‰∏ãÊñáÂàáÊç¢Á∫¶‰∏∫ ~0.2usÔºåÂáèÂ∞ë‰∫Ü 80% ÁöÑÈ¢ùÂ§ñÂºÄÈîÄ„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221217161508540.png" alt="image-20221217161508540" style="zoom:50%;" />
<p><strong>==PointÔºö==</strong></p>
<p>GoËØ≠Ë®Ä‰∏≠Ôºö</p>
<ul>
<li><strong>ÂçèÁ®ã</strong>ÂØπÂ∫îÁöÑÊï∞ÊçÆÁªìÊûÑÊòØ<code>runtime.g</code>Ôºõ</li>
<li><strong>Â∑•‰ΩúÁ∫øÁ®ã</strong>ÂØπÂ∫îÁöÑÊï∞ÊçÆÁªìÊûÑÊòØ<code>runtime.m</code>Ôºõ</li>
<li>ÂêéÊù•ÂºïÂÖ•‰∫Ü<code>runtine.p</code>Ôºå**ÂºïÂÖ•ÂéüÂõ†Ôºö**‰∏ÄÂºÄÂßãÊâÄÊúâÁöÑ<code>g</code>ÈÉΩÂú®‰∏Ä‰∏™ÂÖ®Â±ÄÈòüÂàó‰∏≠ÔºåÂ§ö‰∏™<code>m</code>‰ªéÂÖ®Â±ÄÈòüÂàó‰∏≠Ëé∑Âèñ<code>g</code>Êó∂ÈúÄË¶ÅÈ¢ëÁπÅÁöÑÂä†Ëß£ÈîÅÂèäÁ≠âÂæÖÔºõÂºïÂÖ•<code>p</code>ÂêéÔºå<code>m</code>Â∞±ÂèØ‰ª•Áõ¥Êé•‰ªéÂÖ≥ËÅîÁöÑ<code>p</code>Â§ÑËé∑ÂèñÂæÖÊâßË°åÁöÑ<code>g</code>Ôºå‰∏çÁî®ÊØèÊ¨°ÈÉΩÂíå‰ºóÂ§ö<code>m</code>‰ªé‰∏Ä‰∏™ÂÖ®Â±ÄÈòüÂàó‰∏≠‰∫âÊä¢‰ªªÂä°ÔºåÊèêÈ´ò‰∫ÜÂπ∂ÂèëÊÄßËÉΩ„ÄÇ</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221220154053343.png" alt="image-20221220154053343" style="zoom:50%;" />
<p>ÂÖ∂‰∏≠Ôºå<code>allgs</code>„ÄÅ<code>allm</code>„ÄÅ<code>allp</code>ÂàÜÂà´ËÆ∞ÂΩïÊâÄÊúâÁöÑ<code>g</code>„ÄÅ<code>m</code>Âíå<code>p</code>„ÄÇ</p>
<h5 id="È¶ñÂÖàÁúã‰∏Ä‰∏™ÁÆÄÂçïÁöÑÂú∫ÊôØ">È¶ñÂÖàÁúã‰∏Ä‰∏™ÁÆÄÂçïÁöÑÂú∫ÊôØ</h5>
<p>Âè™Êúâ‰∏Ä‰∏™<code>mian.main</code>„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221220154815913.png" alt="image-20221220154815913" style="zoom:50%;" />
<p>Âú®<code>main goroutine</code>ÂàõÂª∫ÂâçÔºå<code>G</code>„ÄÅ<code>P</code>„ÄÅ<code>M</code>ÁöÑÊÉÖÂÜµÂ¶Ç‰∏äÂõæ„ÄÇ</p>
<ul>
<li><code>main goroutine</code>ÂàõÂª∫ÂêéÔºåË¢´Âä†ÂÖ•ÂΩìÂâç<code>P</code>ÁöÑÊú¨Âú∞ÈòüÂàó‰∏≠Ôºõ</li>
<li>ÁÑ∂ÂêéÈÄöËøá<code>mstart</code>ÂºÄÂêØË∞ÉÂ∫¶Âæ™ÁéØ„ÄÇËøô‰∏™<code>mstart</code>ÊòØÊâÄÊúâÂ∑•‰ΩúÁ∫øÁ®ãÁöÑÂÖ•Âè£Ôºå‰∏ªË¶ÅÂ∞±ÊòØË∞ÉÁî®<code>schedule</code>ÂáΩÊï∞Ôºå‰πüÂ∞±ÊòØÊâßË°åË∞ÉÂ∫¶Âæ™ÁéØ„ÄÇ</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221220155225867.png" alt="image-20221220155225867" style="zoom:50%;" />
<ul>
<li>
<p>ÂΩìÂâçÈòüÂàó‰∏≠Âè™Êúâ<code>main goroutine</code>Á≠âÂæÖÊâßË°åÔºåÊâÄ‰ª•<code>m0</code>ÂàáÊç¢Âà∞<code>main goroutine</code>Ôºõ</p>
</li>
<li>
<p>ÊâßË°åÂÖ•Âè£Ëá™ÁÑ∂ÊòØ<code>runtime.main</code>ÔºåÂÆÉ‰ºöÂÅöÂæàÂ§ö‰∫ãÊÉÖÔºöÂàõÂª∫ÁõëÊéßÁ∫øÁ®ã„ÄÅËøõË°åÂåÖÂàùÂßãÂåñÁ≠âÔºåÂåÖÊã¨Ë∞ÉÁî®<code>main.main</code>ÔºåÁÑ∂ÂêéÂ∞±ÂèØ‰ª•ÊâßË°å<code>main.main</code>‰∫ÜÔºÅ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221220155629894.png" alt="image-20221220155629894" style="zoom:50%;" />
</li>
</ul>
<h5 id="‰∏Ä‰∏™ÊîπËøõÁöÑÂú∫ÊôØ">‰∏Ä‰∏™ÊîπËøõÁöÑÂú∫ÊôØ</h5>
<p>Âú®<code>main.main</code>‰∏≠ÂèàÂàõÂª∫Êñ∞ÁöÑ<code>goroutine</code>„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221220155829901.png" alt="image-20221220155829901" style="zoom:33%;" />
<ul>
<li>Êàë‰ª¨<strong>ÈÄöËøá<code>go</code>ÂÖ≥ÈîÆÂ≠óÂàõÂª∫<code>goroutine</code>Ôºå‰ºöË¢´ÁºñËØëÂô®ËΩ¨Êç¢‰∏∫<code>newproc</code>ÂáΩÊï∞Ë∞ÉÁî®„ÄÇ(<code>main goroutine</code>‰πüÊòØÁî±<code>newproc</code>ÂàõÂª∫ÁöÑ)</strong></li>
<li>ÂàõÂª∫<code>goroutine</code>Êó∂ÔºåÊàë‰ª¨Âè™Ë¥üË¥£ÊåáÂÆöÂÖ•Âè£„ÄÅÂèÇÊï∞ÔºåËÄå<code>newproc</code>‰ºöÁªô<code>goroutine</code>ÊûÑÈÄ†‰∏Ä‰∏™Ê†àÂ∏ßÔºåÁõÆÁöÑÊòØËÆ©ÂçèÁ®ã‰ªªÂä°ÁªìÊùüÂêéÔºåËøîÂõûÂà∞<code>go exit</code>ÂáΩÊï∞‰∏≠ÔºåËøõË°åÂçèÁ®ãËµÑÊ∫êÂõûÊî∂Â§ÑÁêÜÁ≠âÂ∑•‰Ωú„ÄÇ</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221220160301974.png" alt="image-20221220160301974" style="zoom:50%;" />
<ul>
<li>Êñ∞ÂàõÂª∫ÁöÑ<code>goroutine</code>ÔºåÊ≠§Â§ÑÂè´ÂÅö<code>hello goroutine</code>Ôºå‰ºöË¢´Ê∑ªÂä†Âà∞ÂΩìÂâç<code>P</code>ÁöÑÊú¨Âú∞<code>runq</code>‰∏≠Ôºõ</li>
<li>ÁÑ∂Âêé<code>main.main</code>Â∞±‰ºöËøîÂõû‰∫ÜÔºåÁÑ∂Âêé<code>exit()</code>ÂáΩÊï∞Ë¢´Ë∞ÉÁî®ÔºåËøõÁ®ãÂ∞±ÁªìÊùü‰∫Ü„ÄÇÊâÄ‰ª•Ê≠§Â§Ñ<code>hello goroutine</code>Âπ∂Êú™ËÉΩÊâßË°å„ÄÇ</li>
</ul>
<p>**ÈóÆÈ¢òÔºö**ÈóÆÈ¢òÂú®‰∫éÔºåÂΩì<code>main.main</code>ËøîÂõûÂêéÔºåÁõ¥Êé•‰ºöË∞ÉÁî®<code>exit()</code>ÂáΩÊï∞Ôºå‰ºöÊääËøõÁ®ãÈÉΩÁªìÊùüÊéâÔºåÊ≤°Áªô<code>hello goroutine</code>Ë∞ÉÂ∫¶ÊâßË°åÁöÑÊó∂Èó¥„ÄÇÊâÄ‰ª•Â∫îËØ•Âú®<code>main.main</code>ËøîÂõûÂâçÔºåÊãñÂª∂ÁÇπÊó∂Èó¥Áªô<code>hello goroutine</code>ÊâßË°å„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221220160532266.png" alt="image-20221220160532266" style="zoom:50%;" />
<h4 id="2112-goroutineÂàõÂª∫ËÆ©Âá∫‰∏éÊÅ¢Â§ç">2.1.1.2 goroutineÂàõÂª∫„ÄÅËÆ©Âá∫‰∏éÊÅ¢Â§ç</h4>
<p>ËøòÈÄöËøá‰∏Ä‰∏™‰æãÂ≠êÊù•Áúã‰∏Ä‰∏ã„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221220171138313.png" alt="image-20221220171138313" style="zoom:33%;" />
<p>ÈÄöËøáÂáΩÊï∞Ê†àÂ∏ßÁúã‰∏Ä‰∏ã<code>newproc</code>ÁöÑË∞ÉÁî®ËøáÁ®ãÔºö</p>
<ul>
<li><code>main</code>ÂáΩÊï∞Ê†àÂ∏ßËá™ÁÑ∂ÂàÜÈÖçÂú®<code>main goroutine</code>ÁöÑÂçèÁ®ãÊ†à‰∏≠Ôºõ</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221220171515758.png" alt="image-20221220171515758" style="zoom:50%;" />
<ul>
<li>
<p><code>newproc</code>‰∏ªË¶ÅÂÅöÁöÑÂ∞±ÊòØ<strong>ÂàáÊç¢Âà∞<code>g0</code>Ê†àÂéªË∞ÉÁî®<code>newproc1</code>ÂáΩÊï∞</strong>Ôºõ<strong>‰∏∫‰ªÄ‰πàË¶ÅÂàáÊç¢Âà∞<code>g0</code>Ê†àÂë¢Ôºü<strong>ÁÆÄÂçïÊù•ËØ¥Ôºå<code>g0</code>Ê†àÁ©∫Èó¥Â§ß„ÄÇÂõ†‰∏∫<code>runtime</code>‰∏≠ÂæàÂ§öÂáΩÊï∞ÈÉΩÊúâ<code>no-split</code>Ê†áËÆ∞ÔºåÊÑèÂë≥ÁùÄËøô‰∏™ÂáΩÊï∞‰∏çÊîØÊåÅÊ†àÂ¢ûÈïøÔºåËÄå</strong>ÂçèÁ®ãÊ†à</strong>Á©∫Èó¥Êú¨Êù•Â∞±Â∞èÔºåÂÆπÊòìÊ†àÊ∫¢Âá∫ÔºåËÄå<code>g0</code>ÁöÑÊ†àÁõ¥Êé•ÂàÜÈÖçÂú®<strong>Á∫øÁ®ãÊ†à</strong>‰∏äÔºåÊ†àÁ©∫Èó¥Ë∂≥Â§üÂ§ß„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221220172217709.png" alt="image-20221220172217709" style="zoom:50%;" />
</li>
<li>
<p><code>newproc1(ÂçèÁ®ãÂÖ•Âè£, ÂèÇÊï∞Âú∞ÂùÄ, ÂèÇÊï∞Â§ßÂ∞è, Áà∂ÂçèÁ®ã, ËøîÂõûÂú∞ÂùÄ)</code>Ôºõ</p>
</li>
<li>
<p><code>newproc1</code>È¶ñÂÖàÈÄöËøá<code>acquirem()</code>Á¶ÅÊ≠¢ÂΩìÂâç<code>m</code>Ë¢´Êä¢Âç†„ÄÇ**‰∏∫‰ªÄ‰πà‰∏çËÉΩË¢´Êä¢Âç†Ôºü**Âõ†‰∏∫Êé•‰∏ãÊù•Ë¶ÅÊâßË°åÁöÑÁ®ãÂ∫è‰∏≠ÔºåÂèØËÉΩ‰ºöÊääÂΩìÂâç<code>p</code>‰øùÂ≠òÂà∞Â±ÄÈÉ®ÂèòÈáè‰∏≠ÔºåËã•Ê≠§Êó∂<code>m</code>Ë¢´Êä¢Âç†Ôºå<code>p</code>ÂÖ≥ËÅîÂà∞Âà´ÁöÑ<code>m</code>ÔºåÁ≠âÂÜçÊ¨°ÊÅ¢Â§çÊó∂ÔºåÁªßÁª≠‰ΩøÁî®Ëøô‰∏™Â±ÄÈÉ®ÂèòÈáèÈáå‰øùÂ≠òÁöÑ<code>p</code>ÔºåÂ∞±‰ºöÈÄ†ÊàêÈóÆÈ¢ò„ÄÇÊâÄ‰ª•‰∏∫‰∫Ü‰øùÊåÅÊï∞ÊçÆÁöÑ‰∏ÄËá¥ÊÄßÔºå‰ºöÊöÇÊó∂Á¶ÅÊ≠¢<code>m</code>Ë¢´Êä¢Âç†„ÄÇ</p>
</li>
<li>
<p>Êé•‰∏ãÊù•Ôºå‰ºöÂ∞ùËØïËé∑Âèñ‰∏Ä‰∏™Á©∫Èó≤ÁöÑ<code>g</code>ÔºåÂ¶ÇÊûúÂΩìÂâç<code>p</code>ÂíåË∞ÉÂ∫¶Âô®‰∏≠ÈÉΩÊ≤°ÊúâÁ©∫Èó≤ÁöÑ<code>g</code>ÔºåÂ∞±ÂàõÂª∫‰∏Ä‰∏™Âπ∂Ê∑ªÂä†Âà∞ÂÖ®Â±ÄÂèòÈáè<code>allgs</code>‰∏≠„ÄÇÊ≠§Â§ÑÊàë‰ª¨‰æùÁÑ∂Â∞ÜÊ≠§Ê∑ªÂä†ÁöÑ<code>g</code>ËÆ∞‰∏∫<code>hello goroutine</code>ÔºåÊ≠§Êó∂ÂÆÉÁöÑÁä∂ÊÄÅÊòØ<code>_Gdead</code>ÔºåËÄå‰∏îÂ∑≤ÁÑ∂Êã•ÊúâËá™Â∑±ÁöÑÂçèÁ®ãÊ†à„ÄÇ</p>
</li>
<li>
<p>Êé•‰∏ãÊù•ÔºåÂ¶ÇÊûúÂçèÁ®ãÂÖ•Âè£ÂáΩÊï∞ÊúâÂèÇÊï∞ÔºåÂ∞±ÊääÂèÇÊï∞ÁßªÂä®(Êã∑Ë¥ù)Âà∞ÂçèÁ®ãÊ†à‰∏ä„ÄÇ</p>
</li>
<li>
<p>Êé•‰∏ãÊù•Ôºå‰ºöÊää<code>goexit()</code>ÁöÑÂú∞ÂùÄ+1ÔºåÂéãÂÖ•ÂçèÁ®ãÊ†àÔºåÂç≥ËøîÂõûÂú∞ÂùÄÔºõ</p>
</li>
<li>
<p>ÂÜçÊääÂçèÁ®ã(<code>hello goroutine</code>)ÂØπÂ∫îÁöÑ<code>g</code>ÁöÑ<code>startpc</code>ÁΩÆ‰∏∫ÂçèÁ®ãÂÖ•Âè£ÂáΩÊï∞ÁöÑËµ∑ÂßãÂú∞ÂùÄÔºå<code>gopc</code>ÁΩÆ‰∏∫Áà∂ÂçèÁ®ãË∞ÉÁî®<code>newproc</code>ÂêéÁöÑËøîÂõûÂú∞ÂùÄÔºå<code>g.sched</code>ÁªìÊûÑ‰ΩìÁî®‰∫é‰øùÂ≠òÁé∞Âú∫Ôºö<code>g.sched.sp</code>ÁΩÆ‰∏∫ÂçèÁ®ãÊ†àÊåáÈíàÔºå<code>g.sched.pc</code>ÁΩÆ‰∏∫ÂçèÁ®ãÂÖ•Âè£ÂáΩÊï∞ÁöÑËµ∑ÂßãÂú∞ÂùÄ„ÄÇ</p>
</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221220173903125.png" alt="image-20221220173903125" style="zoom:50%;" />
<ul>
<li>Á≠âÂà∞Ëøô‰∏™ÂçèÁ®ãÂæóÂà∞Ë∞ÉÂ∫¶ÊâßË°åÁöÑÊó∂ÂÄôÔºåÈÄöËøá<code>g.sched</code>ÊÅ¢Â§çÁé∞Âú∫ÔºåÂ∞±‰ºö‰ªéÂçèÁ®ãÂÖ•Âè£ÂáΩÊï∞Â§ÑÂºÄÂßãÊâßË°åÔºåËÄåÂáΩÊï∞ÁªìÊùüÂêé‰æø‰ºöËøîÂõûÂà∞<code>goexit()</code>‰∏≠ÔºåÊâßË°åÂçèÁ®ãËµÑÊ∫êÂõûÊî∂Á≠âÊî∂Â∞æÂ∑•‰Ωú„ÄÇ<strong>Âà∞Ê≠§ÔºåÂçèÁ®ãÂ¶Ç‰ΩïÂá∫Âú∫‰∏éÊî∂Âú∫Â∞±ÈÉΩÊúâ‰∫ÜÁùÄËêΩ„ÄÇ</strong></li>
<li>Êé•‰∏ãÊù•Ôºå<code>newproc1</code>Ëøò‰ºöÁªôÊñ∞Âª∫ÁöÑ<code>goroutine</code>Ëµã‰∫à‰∏Ä‰∏™ÂîØ‰∏Ä<code>id</code>„ÄÇÁªô<code>g.goid</code>ËµãÂÄºÂâçÔºå‰ºöÊääÂçèÁ®ãÁöÑÁä∂ÊÄÅÁΩÆ‰∏∫<code>_Grunnable</code>ÔºåËøô‰∏™Áä∂ÊÄÅÊÑèÂë≥ÁùÄËøô‰∏™<code>g</code>ÂèØ‰ª•ËøõÂà∞<code>run queue</code>‰∏≠‰∫Ü„ÄÇ</li>
<li>ÊâÄ‰ª•Êé•‰∏ãÊù•‰ºöË∞ÉÁî®<code>runqput</code>ÊääËøô‰∏™<code>g</code>ÊîæÂà∞ÂΩìÂâç<code>p</code>ÁöÑÊú¨Âú∞ÈòüÂàó‰∏≠„ÄÇ</li>
<li>Êé•‰∏ãÊù•Âà§Êñ≠ÔºåÂ¶ÇÊûúÂΩìÂâçÊúâÁ©∫Èó≤<code>p</code>ÔºåËÄå‰∏îÊ≤°ÊúâÂ§Ñ‰∫é<code>spinning</code>Áä∂ÊÄÅÁöÑ<code>m</code>ÔºåÂç≥ÊâÄÊúâ<code>m</code>ÈÉΩÂøôÔºåËÄå‰∏î‰∏ªÂçèÁ®ãÂ∑≤ÁªèÂºÄÂßãÊâßË°å‰∫ÜÔºåÈÇ£‰πàÂ∞±Ë∞ÉÁî®<code>wakep()</code>ÔºöÂêØÂä®‰∏Ä‰∏™<code>m</code>Âπ∂ÊääÂÆÉÁΩÆ‰∏∫<code>spinning</code>Áä∂ÊÄÅ„ÄÇ</li>
<li>ÊúÄÂêé‰∏é‰∏ÄÂºÄÂßãÁöÑ<code>acquirem()</code>ÂëºÂ∫îÔºå‰ºöË∞ÉÁî®<code>releasem()</code>ÂÖÅËÆ∏ÂΩìÂâç<code>m</code>Ë¢´Êä¢Âç†ÔºõËÄå<code>spinning</code>Áä∂ÊÄÅÁöÑ<code>m</code>ÂêØÂä®ÂêéÔºå‰ºö‰∏ÄÁõ¥ÊâßË°åË∞ÉÂ∫¶Âæ™ÁéØÂØªÊâæ‰ªªÂä°Ôºå‰ªéÊú¨Âú∞<code>runq</code>Âà∞ÂÖ®Â±Ä<code>runq</code>ÂÜçÂà∞ÂÖ∂‰ªñ<code>p</code>ÁöÑ<code>runq</code>ÔºåÂè™‰∏∫ÊâæÂà∞‰∏™ÂæÖÊâßË°åÁöÑ<code>g</code>„ÄÇ‰ΩÜÊ≠§Êó∂ÔºåËã•<code>main.main</code>Â∑≤ÁªèËøîÂõûÔºåÈÇ£‰πü‰∏ç‰ºöÊâßË°åÂâ©‰ΩôÁöÑ<code>g</code>„ÄÇ</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221220175604483.png" alt="image-20221220175604483" style="zoom:50%;" />
<p><strong>Ê≠§Â§ÑÊàë‰ª¨ÈÄöËøáÁ≠âÂæÖ‰∏Ä‰∏™<code>channel</code>Êù•ÂÆûÁé∞Ë∞ÉÂ∫¶ÊâßË°å<code>g</code>„ÄÇ</strong></p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221220175922653.png" alt="image-20221220175922653" style="zoom:33%;" />
<ul>
<li>ÂΩìÂâç<code>main goroutine</code>‰ºöÈòªÂ°ûÂú®<code>&lt;-ch</code>ËøôÈáåÁ≠âÂæÖÊï∞ÊçÆÔºõ</li>
<li>ÁÑ∂Âêé<code>chanrecv()</code>ÈÄöËøá<code>gopark()</code>ÂáΩÊï∞ÊåÇËµ∑ÂΩìÂâç<code>goroutine</code>ÔºåËÆ©Âá∫<code>cpu</code>Ôºõ</li>
<li><code>gopark()</code>È¶ñÂÖà‰ºöË∞ÉÁî®<code>acquirem()</code>Á¶ÅÊ≠¢ÂΩìÂâç<code>m</code>Ë¢´Êä¢Âç†ÔºåÁÑ∂ÂêéÊää<code>main goroutine</code>ÁöÑÁä∂ÊÄÅ‰ªé<code>_Grunning</code>‰øÆÊîπ‰∏∫<code>_Gwaiting</code>Ôºå<code>main goroutine</code>Â∞±‰∏çÂÜçÊòØÊâßË°å‰∏≠Áä∂ÊÄÅ‰∫ÜÔºõ</li>
<li>Êé•‰∏ãÊù•Ë∞ÉÁî®<code>releasem()</code>Ëß£Èô§<code>m</code>ÁöÑÊä¢Âç†Á¶Å‰ª§Ôºõ</li>
<li>ÊúÄÂêéË∞ÉÁî®<code>mcall(park_m)</code>ÔºöË¥üË¥£‰øùÂ≠òÂΩìÂâçÂçèÁ®ãÁöÑÊâßË°åÁé∞Âú∫Ôºõ</li>
<li>ÁÑ∂ÂêéÂàáÊç¢Âà∞<code>g0</code>Ê†àÔºåË∞ÉÁî®Áî±<code>mcall</code>ÁöÑÂèÇÊï∞‰º†ÂÖ•ÁöÑËøô‰∏™ÂáΩÊï∞ÔºåÂØπÂ∫îÂà∞ËøôÈáåÂ∞±ÊòØ<code>park_m()</code>ÂáΩÊï∞Ôºõ</li>
<li><code>park_m()</code>ÂáΩÊï∞‰ºöÊ†πÊçÆ<code>g0</code>ÊâæÂà∞ÂΩìÂâç<code>m</code>ÔºåÊää<code>m.curg</code>ÁΩÆ‰∏∫<code>nil</code>„ÄÇÊ≠§Êó∂ÂΩìÂâç<code>m</code>Ê≠£Âú®ÊâßË°åÁöÑ<code>g</code>‰æø‰∏çÂÜçÊòØ<code>main goroutine</code>‰∫ÜÔºõ</li>
<li>ÊúÄÂêé‰ºöË∞ÉÁî®<code>schedule()</code>ÂØªÊâæ‰∏ã‰∏Ä‰∏™ÂæÖÊâßË°åÁöÑ<code>g</code>„ÄÇ</li>
<li>ÁÑ∂ÂêéÔºå<code>hello goroutine</code>Ë¶Å‰πàË¢´ÂΩìÂâç<code>m0</code>Ë∞ÉÂ∫¶ÊâßË°åÔºåË¶Å‰πàË¢´ÂÖ∂‰ªñ<code>m</code>Ë∞ÉÂ∫¶ÊâßË°åÔºåÊÄªÂΩíÊòØËÉΩÊâßË°å‰∫Ü„ÄÇ</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221220181026564.png" alt="image-20221220181026564" style="zoom:50%;" />
<ul>
<li>Á≠âÂà∞<code>hello goroutine</code>ÊâßË°åÂÆåÊØïÔºåÂÖ≥Èó≠<code>main gorutine</code>Á≠âÂæÖÁöÑ<code>channel</code>Êó∂Ôºå‰∏çÊ≠¢‰ºö‰øÆÊîπ<code>channel</code>ÁöÑ<code>closed</code>Áä∂ÊÄÅÔºåËøò‰ºöÂ§ÑÁêÜÁ≠âÂæÖÈòüÂàó‰∏≠ÁöÑ<code>g</code>ÔºåÊúÄÁªàË∞ÉÁî®<code>goready()</code>ÂáΩÊï∞Êù•ÁªìÊùüËøô‰∏™<code>g</code>ÁöÑÁ≠âÂæÖÁä∂ÊÄÅÔºõ</li>
<li>ËÄå<code>goready()</code>ÂáΩÊï∞‰ºöÂàáÊç¢Âà∞<code>g0</code>Ê†àÔºåÂπ∂ÊâßË°å<code>runtime.ready()</code>ÂáΩÊï∞ÔºåÁõÆÂâçÂæÖ<code>ready</code>ÁöÑÂçèÁ®ãËá™ÁÑ∂ÊòØ<code>main goroutine</code>ÔºåÊ≠§Êó∂ÂÆÉÁöÑÁä∂ÊÄÅÊòØ<code>_Gwaiting</code>ÔºåÊé•‰∏ãÊù•‰ºöË¢´‰øÆÊîπ‰∏∫<code>_Grunnable</code>ÔºåË°®Á§∫ÂÆÉÂèàÂèØ‰ª•Ë¢´Ë∞ÉÂ∫¶ÊâßË°å‰∫Ü„ÄÇ</li>
<li>ÁÑ∂ÂêéÔºåÂÆÉ‰ºöË¢´ÊîæÂÖ•ÂΩìÂâç<code>p</code>ÁöÑÊú¨Âú∞<code>runq</code>‰∏≠ÔºåÂêåÂçèÁ®ãÂàõÂª∫Êó∂‰∏ÄÊ†∑ÔºåÊé•‰∏ãÊù•‰πü‰ºöÊ£ÄÊü•ÊòØÂê¶ÊúâÁ©∫Èó≤ÁöÑ<code>p</code>ÔºåÂπ∂‰∏îÊ≤°Êúâ<code>spinning</code>Áä∂ÊÄÅÁöÑ<code>m</code>ÔºåÊòØÁöÑËØùÔºå‰πü‰ºöË∞ÉÁî®<code>weakp()</code>ÂáΩÊï∞ÂêØÂä®Êñ∞ÁöÑ<code>m</code>Ôºõ</li>
<li>Êé•‰∏ãÊù•<code>hello goroutine</code>ÁªìÊùüÔºå<code>main goroutine</code>ÂæóÂà∞Ë∞ÉÂ∫¶ÊâßË°åÔºåÊúÄÁªàÁªìÊùüËøõÁ®ã„ÄÇ</li>
</ul>
<p><strong>ÊÄªÁªìÔºöÂ∫ïÂ±ÇÈÄöËøá<code>newproc</code>ÂàõÂª∫<code>goroutine</code>ÔºåÈÄöËøá<code>gopark</code>ÂÆûÁé∞ÂçèÁ®ãËÆ©Âá∫Ôºå‰ΩøÁî®<code>goready</code>ÊääÂçèÁ®ãÊÅ¢Â§çÂà∞<code>runnable</code>Áä∂ÊÄÅÊîæÂõûÂà∞<code>runq</code>‰∏≠</strong></p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221220203946776.png" alt="image-20221220203946776" style="zoom:50%;" />
<p>Êé•‰∏ãÊù•ÔºåÂ∞±ÈúÄË¶Å‰∫ÜËß£Ë∞ÉÂ∫¶Âæ™ÁéØ<code>schedule()</code>ÊòØÂÅöÂï•ÁöÑ‰∫ÜÔºå‰ª•ÂèäÂ¶Ç‰ΩïÊää‰∏Ä‰∏™ÂèØËøêË°åÁöÑÂçèÁ®ãÁúüÊ≠£ÁöÑËøêË°åËµ∑Êù•Ôºü</p>
<h4 id="2113-goroutineËÆ©Âá∫Êä¢Âç†ÁõëÊéßÂíåË∞ÉÂ∫¶">2.1.1.3 goroutineËÆ©Âá∫„ÄÅÊä¢Âç†„ÄÅÁõëÊéßÂíåË∞ÉÂ∫¶</h4>
<p>ÂçèÁ®ãËÆ©Âá∫CPUÂàÜ‰∏∫‰∏§ÁßçÔºö<strong>‰∏ªÂä®ËÆ©Âá∫</strong>Âíå<strong>Ë¢´Âä®ËÆ©Âá∫(Êä¢Âç†)</strong>„ÄÇÂÖ∂‰∏≠Ôºå‰∏ªÂä®ËÆ©Âá∫ÊåáÂçèÁ®ãËá™Ë∫´Ë¶ÅÁ≠âÂæÖÊüêÁßçÊù°‰ª∂ËÄå‰∏ªÂä®ËÆ©Âá∫ÔºåË¢´Âä®ËÆ©Âá∫ÊåáË∞ÉÂ∫¶Âô®ÈÄöËøáÊüêÁßçËßÑÂàôÂº∫Âà∂‰ΩøÂçèÁ®ãËÆ©Âá∫„ÄÇ</p>
<h5 id="‰∏ªÂä®ËÆ©Âá∫">‰∏ªÂä®ËÆ©Âá∫</h5>
<p><strong>‰∏ªÂä®ËÆ©Âá∫</strong>‰∏ªË¶ÅÂåÖÊã¨‰∏âÁßçÂΩ¢ÂºèÔºö<code>time.Sleep()</code>Ôºå<code>&lt;-chan</code>Âíå<code>I/OÊìç‰Ωú</code>„ÄÇ</p>
<ol>
<li><code>time.Sleep()</code></li>
</ol>
<p><strong>Êï¥‰ΩìËøáÁ®ãÔºö<strong>ÂçèÁ®ãÊâßË°å<code>time.Sleep()</code>Êó∂ÔºåÁä∂ÊÄÅ‰ºö‰ªé<code>_Grunning</code>Âèò‰∏∫<code>_Gwaiting</code>ÔºåÂπ∂ËøõÂÖ•Âà∞ÂØπÂ∫îÁöÑ<code>timer</code>‰∏≠Á≠âÂæÖÔºåËÄå<code>timer</code>‰∏≠ÊåÅÊúâ‰∏Ä‰∏™ÂõûË∞ÉÂáΩÊï∞ÔºåÂú®ÊåáÂÆöÊó∂Èó¥Âà∞ËææÂêé</strong>Ë∞ÉÁî®</strong>Ëøô‰∏™ÂõûË∞ÉÂáΩÊï∞ÔºåÊääÁ≠âÂú®ËøôÈáåÁöÑÂçèÁ®ãÊÅ¢Â§çÂà∞<code>_Grunnable</code>Áä∂ÊÄÅÂπ∂ÊîæÂõûÂà∞<code>runq</code>‰∏≠„ÄÇ</p>
<p>**ËøôÈáåÊúâ‰∏Ä‰∏™ÈóÆÈ¢òÔºü**Ë∞ÅË¥üË¥£Ëß¶Âèë<code>timer</code>Ê≥®ÂÜåÁöÑÂõûË∞ÉÂáΩÊï∞Âë¢Ôºü</p>
<p><strong>Á≠îÔºö<strong>ÂÖ∂ÂÆûÊØè‰∏™<code>p</code>ÈÉΩÊúâ‰∏Ä‰∏™</strong>ÊúÄÂ∞èÂ†Ü</strong>ÔºåÂ≠òÂÇ®Âú®<code>p.timers</code>‰∏≠ÔºåÁî®‰∫éÁÆ°ÁêÜËá™Â∑±ÁöÑ<code>timer</code>ÔºåÂ†ÜÈ°∂ÁöÑ<code>timer</code>Â∞±ÊòØÊé•‰∏ãÊù•Ë¶ÅËß¶ÂèëÁöÑÈÇ£‰∏Ä‰∏™„ÄÇËÄåÊØèÊ¨°Ë∞ÉÂ∫¶Êó∂ÔºåÈÉΩ‰ºöË∞ÉÁî®<code>checkTimers()</code>ÂáΩÊï∞ÔºåÊ£ÄÊü•Âπ∂ÊâßË°åÈÇ£‰∫õÂ∑≤ÁªèÂà∞Êó∂Èó¥ÁöÑ<code>timer</code>„ÄÇ<strong>‰∏çËøáËøô‰∏çÂ§üÁ®≥Â¶•</strong>Ôºå‰∏á‰∏ÄÊâÄÊúâÁöÑ<code>m</code>ÈÉΩÂú®ÂøôÔºåÈÇ£‰πàÂ∞±‰∏çËÉΩÂèäÊó∂Ëß¶ÂèëË∞ÉÂ∫¶‰∫ÜÔºåÂèØËÉΩ‰ºöÂØºËá¥<code>timer</code>ÊâßË°åÊó∂Èó¥ÂèëÁîüËæÉÂ§ßÂÅèÂ∑Æ„ÄÇÊâÄ‰ª•Ëøò‰ºöÈÄöËøá<strong>ÁõëÊéßÁ∫øÁ®ã</strong>Êù•Â¢ûÂä†‰∏ÄÂ±Ç‰øùÈöú„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221221161626609.png" alt="image-20221221161626609" style="zoom:50%;" />
<p>(Êé•‰∏ä)„ÄÇ<strong>ÁõëÊéßÁ∫øÁ®ã</strong>ÊòØÁî±<code>main goroutine</code>ÂàõÂª∫ÁöÑÔºå‰∏é<code>GPM</code>‰∏≠ÁöÑÂ∑•‰ΩúÁ∫øÁ®ã‰∏çÂêåÔºåÂπ∂<strong>‰∏çÈúÄË¶Å‰æùËµñ<code>p</code>Ôºå‰πü‰∏çÁî±<code>GPM</code>Ë∞ÉÂ∫¶</strong>„ÄÇ</p>
<p>ÁõëÊéßÁ∫øÁ®ãÊúâÂ§ö‰∏™‰ªªÂä°ÔºåÂÖ∂‰∏≠‰∏ÄÈ°π‰æøÊòØ<strong>‰øùÈöú<code>timer</code>ÁöÑÊ≠£Â∏∏ÊâßË°å</strong>„ÄÇÁõëÊéßÁ∫øÁ®ãÊ£ÄÊµãÂà∞Êé•‰∏ãÊù•Êúâ<code>timer</code>Ë¶ÅÊâßË°åÊó∂ÔºåËã•Ê≠§Êó∂Êó†Á©∫Èó≤<code>m</code>Ôºå‰æø‰ºöÂàõÂª∫Êñ∞ÁöÑÂ∑•‰ΩúÁ∫øÁ®ã<code>m</code>‰ª•‰øùÈöú<code>timer</code>ÂèØ‰ª•È°∫Âà©ÊâßË°å„ÄÇ</p>
<ol start="2">
<li><code>&lt;-chan</code></li>
</ol>
<p>**Êï¥‰ΩìËøáÁ®ãÔºö**ÂçèÁ®ãÁ≠âÂæÖ‰∏Ä‰∏™<code>channel</code>Êó∂ÔºåÂÖ∂Áä∂ÊÄÅ‰πü‰ºö‰ªé<code>_Grunning</code>Âèò‰∏∫<code>_Gwaiting</code>ÔºåÂπ∂ËøõÂÖ•Âà∞ÂØπÂ∫î<code>channel</code>ÁöÑËØªÈòüÂàóÊàñÂÜôÈòüÂàó‰∏≠Á≠âÂæÖÔºåÁ≠âÂæÖÁöÑ<code>channel</code>ÂèØËØª„ÄÅÂèØÂÜô‰∫Ü‰ºöÈÄöÁü•Âà∞Áõ∏ÂÖ≥ÂçèÁ®ã„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221221164504027.png" alt="image-20221221164504027" style="zoom:33%;" />
<ol start="3">
<li><code>I/O</code></li>
</ol>
<p><strong>Êï¥‰ΩìËøáÁ®ãÔºö<strong>ÂçèÁ®ãÁ≠âÂæÖ‰∏Ä‰∏™<code>I/O‰∫ã‰ª∂</code>Ôºå‰πüÈúÄË¶ÅËøõË°åËÆ©Âá∫„ÄÇ‰ª•<code>epoll</code>‰∏∫‰æãÔºåËã•<code>I/O‰∫ã‰ª∂</code>Â∞öÊú™Â∞±Áª™ÔºåÈúÄË¶ÅÊ≥®ÂÜåË¶ÅÁ≠âÂæÖÁöÑ<code>I/O‰∫ã‰ª∂</code>Âà∞ÁõëÂê¨ÈòüÂàó‰∏≠ÔºåËÄåÊØè‰∏™ÁõëÂê¨ÂØπË±°ÈÉΩÂèØ‰ª•ÂÖ≥ËÅî‰∏Ä‰∏™<code>event data</code>ÔºåÊâÄ‰ª•Â∞±Âú®ËøôÈáåËÆ∞ÂΩïÊòØÂì™‰∏™ÂçèÁ®ãÂú®Á≠âÂæÖÔºåÁ≠âÂà∞‰∫ã‰ª∂Â∞±Áª™Êó∂ÂÜçÊääÂÆÉÊÅ¢Â§çÂà∞<code>runq</code>‰∏≠Âç≥ÂèØ„ÄÇ‰∏é<code>timer</code>Âíå<code>channel</code>‰∏çÂêåÁöÑÊòØÔºåÊ≤°ÊúâË∞ÅËÉΩÈÄöÁü•ÂçèÁ®ãÊòØÂê¶Â∞±Áª™ÔºåÂõ†Ê≠§ÊÉ≥Ë¶ÅËé∑Âèñ<code>I/O‰∫ã‰ª∂</code>Â∞±Áª™ÊÉÖÂÜµÈúÄË¶Å</strong>‰∏ªÂä®ËΩÆËØ¢(netpoll)</strong>ÔºåËøôÈáåÁöÑ<strong>‰∏ªÂä®ËΩÆËØ¢</strong>ÊòØÊåáÈùûÈòªÂ°ûÁöÑÊü•ËØ¢ÊòØÂê¶ÊúâÂ∑≤Â∞±Áª™ÁöÑIO‰∫ã‰ª∂„ÄÇÂÖ®Â±ÄÂèòÈáè<code>sched</code>‰ºöËÆ∞ÂΩï‰∏äÊ¨°<code>netpoll</code>ÊâßË°åÁöÑÊó∂Èó¥<code>lastpoll</code>Ôºå<strong>ÁõëÊéßÁ∫øÁ®ã</strong>Ê£ÄÊµãÂà∞Ë∑ùÁ¶ª‰∏äÊ¨°ËΩÆËØ¢Â∑≤ÁªèË∂ÖËøá<code>10ms</code>‰æø‰ºöÂÜçÊ¨°ÊâßË°å<code>netpoll</code>„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221221165530425.png" alt="image-20221221165530425" style="zoom:33%;" />
<h5 id="Êä¢Âç†">Êä¢Âç†</h5>
<p><strong>ÁõëÊéßÁ∫øÁ®ã</strong>Ë¶ÅÊú¨ÁùÄ<strong>ÂÖ¨Âπ≥Ë∞ÉÂ∫¶</strong>ÁöÑÂéüÂàôÔºåÂØπËøêË°åÊó∂Èó¥ËøáÈïøÁöÑ<code>p</code>ÂÆûË°å**&ldquo;Êä¢Âç†&rdquo;**Êìç‰Ωú„ÄÇÂ∞±ÊòØÂëäËØâÈÇ£‰∫õËøêË°åÊó∂Èó¥Ë∂ÖËøáÁâπÂÆöÈòàÂÄº(10ms)ÁöÑ<code>g</code>ÔºåËØ•ËÆ©Âá∫‰∫ÜÔºÅ</p>
<p><strong>ÈóÆÈ¢òÔºöÈÇ£‰πàÔºåÊÄé‰πàÁü•ÈÅìËøêË°åÊó∂Èó¥ËøáÈïø‰∫ÜÂë¢Ôºü</strong></p>
<p><code>p</code>ÈáåÈù¢Êúâ‰∏Ä‰∏™<code>schedtick</code>Â≠óÊÆµÔºåÊØèÂΩìË∞ÉÂ∫¶ÊâßË°å‰∏Ä‰∏™Êñ∞ÁöÑ<code>g</code>ÔºåÂπ∂‰∏î‰∏çÁªßÊâø‰∏ä‰∏™<code>g</code>ÁöÑÊó∂Èó¥ÁâáÊó∂ÔºåÂ∞±‰ºöÊää<code>p.schedtick++</code>ÔºåËÄå<code>sysmontick.schedwhen</code>ËÆ∞ÂΩï‰∏ä‰∏ÄÊ¨°Ë∞ÉÂ∫¶ÁöÑÊó∂Èó¥„ÄÇÁõëÊéßÁ∫øÁ®ãÂ¶ÇÊûúÁõëÊµãÂà∞<code>sysmontick.schedtick</code>‰∏é<code>p.schedtick</code>‰∏çÁõ∏Á≠âÔºåËØ¥ÊòéËøô‰∏™<code>p</code>ÂèëÁîü‰∫ÜÊñ∞ÁöÑË∞ÉÂ∫¶ÔºåÂ∞±‰ºöÂêåÊ≠•<code>sysmontick.schedtick</code>ÁöÑÂÄºÔºåÂπ∂Êõ¥Êñ∞Ë∞ÉÂ∫¶Êó∂Èó¥<code>sysmontick.schedwhen</code>Ôºõ‰ΩÜËã•‰∫åËÄÖÁõ∏Á≠âÔºåËØ¥ÊòéÊ≤°ÂèëÁîüÊñ∞ÁöÑË∞ÉÂ∫¶ÔºåÊàñËÄÖÂç≥‰ΩøÂèëÁîü‰∫ÜÊñ∞ÁöÑË∞ÉÂ∫¶Ôºå‰πüÊ≤øÁî®‰∫Ü‰πãÂâçÁöÑÊó∂Èó¥ÁâáÔºåÊâÄ‰ª•ÂèØ‰ª•ÈÄöËøáÂΩìÂâçÊó∂Èó¥‰∏é<code>sysmontick.schedwhen</code>ÁöÑÂ∑ÆÂÄºÊù•Âà§Êñ≠ÂΩìÂâç<code>p</code>‰∏äÁöÑ<code>g</code>ÊòØÂê¶ËøêË°åÊó∂Èó¥ËøáÈïø„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221221172659457.png" alt="image-20221221172659457" style="zoom: 33%;" />
<p><strong>ÈóÆÈ¢òÔºöÈÇ£Â¶ÇÊûúÁúüÁöÑËøêË°åÊó∂Èó¥ËøáÈïø‰∫ÜÔºåÊÄé‰πàÈÄöÁü•ÂÆÉËÆ©Âá∫Âë¢Ôºü</strong></p>
<p><strong>Á≠îÔºö</strong><code>Go 1.14</code>‰πãÂâç‰ΩøÁî®ÁöÑÊòØ<strong>Ê†àÂ¢ûÈïø</strong>„ÄÇÊ†àÂ¢ûÈïøÂÖ±‰∏âÁßçÊÉÖÂÜµÔºö</p>
<p>ÂÖ∂‰∏≠ÔºåÂíå<strong>ÂçèÁ®ãË∞ÉÂ∫¶</strong>Áõ∏ÂÖ≥ÁöÑÊòØÁ¨¨‰∏âÁßç„ÄÇÂΩì<code>runtime</code>Â∏åÊúõÊüê‰∏™ÂçèÁ®ãËÆ©Âá∫CPUÊó∂ÔºåÂ∞±‰ºöÊää‰ªñÁöÑ<code>stackguard0</code>(Ê†à‰∏ãÁïå)ËµãÂÄº‰∏∫<code>stackPreempt</code>ÔºåËøôÊòØ‰∏Ä‰∏™ÈùûÂ∏∏Â§ßÁöÑÂÄºÔºåÁúüÊ≠£ÁöÑÊ†àÊåáÈíà‰∏ç‰ºöÊåáÂêëËøô‰∏™‰ΩçÁΩÆÔºåÂõ†Ê≠§Áî®‰Ωú<strong>ÁâπÊÆäÊ†áËØÜ</strong>„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221221171258248.png" alt="image-20221221171258248" style="zoom: 50%;" />
<p>ËøõËÄå‰ºöË∑≥ËΩ¨Âà∞<code>morestack</code>Â§ÑÔºåËÄå<code>morestack</code>‰ºöË∞ÉÁî®<code>runtime.newstack()</code>ÂáΩÊï∞ÔºåË¥üË¥£Ê†àÂ¢ûÈïøÂ∑•‰Ωú„ÄÇ‰∏çËøá‰ªñÂú®ËøõË°åÊ†àÂ¢ûÈïøÂ∑•‰ΩúÂâç‰ºöÂÖà<strong>Âà§Êñ≠<code>stackguard0</code>ÊòØÂê¶Á≠â‰∫é<code>stackPreempt</code></strong>ÔºåÁ≠â‰∫éÁöÑËØùÂ∞±‰∏çËøõË°åÊ†àÂ¢ûÈïø‰∫ÜÔºå<strong>ËÄåÊòØÊâßË°å‰∏ÄÊ¨°ÂçèÁ®ãË∞ÉÂ∫¶</strong>„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221221171537047.png" alt="image-20221221171537047" style="zoom:33%;" />
<p>ÊâÄ‰ª•Ôºå<code>Go 1.14</code>‰πãÂâçÂÆûÈôÖ‰∏äÊòØÈÄöËøáËÆæÁΩÆ<code>stackguard</code>‰∏∫<code>stackPreempt</code>Êù•ÂÆåÊàêÂçèÁ®ãËÆ©Âá∫ÁöÑ„ÄÇ</p>
<p>ËøôÁßçÊñπÂºèÁöÑÁº∫ÁÇπÊòØËøáÂ∫¶‰æùËµñÊ†àÂ¢ûÈïø‰ª£Á†ÅÔºåÂ¶ÇÊûúÊù•‰∏™Á©∫ÁöÑ<code>for{}</code>Âæ™ÁéØÔºåÂõ†‰∏∫‰∏éÊ†àÂ¢ûÈïøÊó†ÂÖ≥ÔºåÁ®ãÂ∫èÂ∞±‰ºöÂç°Ê≠ªÂú®Ëøô‰∏™Âú∞Êñπ„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221221171902137.png" alt="image-20221221171902137" style="zoom:50%;" />
<p>Ëøô‰∏ÄÈóÆÈ¢òÂú®<code>Go 1.14</code>ÁâàÊú¨ÂæóÂà∞Ëß£ÂÜ≥„ÄÇÂõ†‰∏∫ÂÆûÁé∞‰∫Ü<strong>ÂºÇÊ≠•Êä¢Âç†</strong>„ÄÇ</p>
<p>‰∏çÂêåÁ≥ªÁªü‰∏≠ÁöÑÂÆûÁé∞‰∏çÂ∞ΩÁõ∏ÂêåÔºåÂ¶Ç<code>Unix</code>‰∏≠„ÄÇ‰ºöÂêëÂçèÁ®ãÂÖ≥ËÅîÁöÑ<code>m</code>ÂèëÈÄÅ‰ø°Âè∑(sigPreempt)ÔºåÊé•‰∏ãÊù•ÁõÆÊ†áÁ∫øÁ®ã‰ºöË¢´‰ø°Âè∑‰∏≠Êñ≠ÔºåËΩ¨ÂéªÊâßË°å<code>runtime.sighandler()</code>ÔºåÂú®<code>sighandler()</code>ÂáΩÊï∞‰∏≠Ê£ÄÊµãÂà∞‰ø°Âè∑‰∏∫<code>sigPreempt</code>ÂêéÔºåÂ∞±‰ºöË∞ÉÁî®<code>runtime.doSigPreempt()</code>ÔºåÂÆÉ‰ºöÂêëÂΩìÂâçË¢´ÊâìÊñ≠ÁöÑÂçèÁ®ã‰∏ä‰∏ãÊñá‰∏≠Ê≥®ÂÖ•‰∏Ä‰∏™ÂºÇÊ≠•Êä¢Âç†ÂáΩÊï∞Ë∞ÉÁî®ÔºåÂ§ÑÁêÜÂÆå‰ø°Âè∑Âêé<code>sighandler()</code>ËøîÂõûÔºå<strong>Ë¢´‰∏≠Êñ≠ÁöÑÂçèÁ®ãÂæóÂà∞ÊÅ¢Â§ç</strong>Ôºå<strong>Á´ãÂàªÊâßË°åË¢´Ê≥®ÂÖ•ÁöÑÂºÇÊ≠•Êä¢Âç†ÂáΩÊï∞</strong>ÔºåËØ•ÂáΩÊï∞ÊúÄÁªà‰ºöË∞ÉÁî®<code>runtime</code>‰∏≠ÁöÑË∞ÉÂ∫¶ÈÄªËæëÔºåËøôÂ∞±ËÆ©Âá∫‰∫ÜÔºÅ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221221172540730.png" alt="image-20221221172540730" style="zoom:33%;" />
<p>‰∏äËø∞Â∑≤ÁªèÂõûÁ≠î‰∫ÜÈóÆÈ¢ò„ÄÇ</p>
<p>ÂÖ∂ÂÆûÔºå‰∏∫‰∫ÜÂÖÖÂàÜÂà©Áî®CPUÔºåÁõëÊéßÁ∫øÁ®ãËøò‰ºöÊä¢Âç†Â§ÑÂú®Á≥ªÁªüË∞ÉÁî®‰∏≠ÁöÑ<code>p</code>ÔºåÂõ†‰∏∫‰∏Ä‰∏™ÂçèÁ®ãË¶ÅÊâßË°åÁ≥ªÁªüË∞ÉÁî®ÔºåÂ∞±Ë¶ÅÂàáÊç¢Âà∞<code>g0</code>Ê†àÔºåÂú®Á≥ªÁªüË∞ÉÁî®Ê≤°ÊâßË°åÂÆå‰πãÂâçÔºåËøô‰∏™**<code>m</code>Âíå<code>g</code>ÂÖ∂ÂÆûÁªëÂÆö‰∫Ü**Ôºå‰∏çËÉΩË¢´ÂàÜÂºÄÔºå‰πüÂ∞±<strong>Áî®‰∏çÂà∞<code>p</code></strong>ÔºåÊâÄ‰ª•Âú®Èô∑ÂÖ•Á≥ªÁªüË∞ÉÁî®ÂâçÔºåÂΩìÂâç<code>m</code>‰ºöËÆ©Âá∫<code>p</code>ÔºåËß£Èô§<code>m.p</code>‰∏éÂΩìÂâç<code>p</code>ÁöÑÂº∫ÂÖ≥ËÅîÔºåÂè™Âú®<code>m.oldp</code>‰∏≠ËÆ∞ÂΩïËøô‰∏™<code>p</code>„ÄÇ<code>p</code>ÁöÑÊï∞ÁõÆÊØïÁ´üÊúâÈôêÔºåÂ¶ÇÊûúÊúâÂÖ∂‰ªñÂçèÁ®ãÊ≠£Âú®Á≠âÂæÖÊâßË°åÔºåÈÇ£Â∞±‰ºöÊää‰ªñÂÖ≥ËÅîÂà∞ÂÖ∂‰ªñ<code>m</code>„ÄÇ‰∏çËøáÂ¶ÇÊûúÂΩìÂâç<code>m</code>‰ªéÁ≥ªÁªüË∞ÉÁî®‰∏≠ÊÅ¢Â§çÔºå‰ºöÂÖàÊ£ÄÊµã‰πãÂâçÁöÑ<code>p</code>ÊòØÂê¶Ë¢´Âç†Áî®ÔºåÊ≤°ÊúâÁöÑËØùÂ∞±ÁªßÁª≠‰ΩøÁî®ÔºåÂê¶ÂàôÂÜçÂéªÁî≥ËØ∑‰∏Ä‰∏™ÔºåÊ≤°Áî≥ËØ∑Âà∞ÁöÑËØùÔºåÂ∞±ÊääÂΩìÂâç<code>g</code>ÊîæÂÖ•ÂÖ®Â±Ä<code>runq</code>‰∏≠ÔºåÁÑ∂ÂêéÂΩìÂâçÁ∫øÁ®ãÂ∞±Áù°Áú†‰∫Ü„ÄÇ</p>
<h5 id="Ë∞ÉÂ∫¶">Ë∞ÉÂ∫¶</h5>
<p>ÂçèÁ®ãËÆ©Âá∫‰∫Ü„ÄÅÊä¢Âç†‰∫Ü‰πãÂêéÔºåÊÄªÈúÄË¶Å<strong>ÁªôËøô‰∏™<code>m</code>ÂÜçÊâæ‰∏™ÂæÖÊâßË°åÁöÑ<code>g</code>Êù•ÊâßË°å</strong>ÂêßÔºüËøôÂ∞±Áî®Âà∞‰∫Ü**<code>schedule()</code>**„ÄÇ</p>
<ul>
<li>È¶ñÂÖàÔºåË¶ÅÁ°ÆÂÆöÂΩìÂâç<code>m</code>ÊòØÂê¶ÂíåÂΩìÂâç<code>g</code>ÁªëÂÆö‰∫Ü„ÄÇÂ¶ÇÊûúÁªëÂÆö‰∫ÜÔºåÈÇ£ÂΩìÂâç<code>m</code>Â∞±‰∏çËÉΩÊâßË°åÂÖ∂‰ªñ<code>g</code>Ôºå‰ºöÈòªÂ°ûÂΩìÂâç<code>m</code>ÔºåÁ≠âÂà∞ÂΩìÂâç<code>g</code>ÂÜçÊ¨°ÂæóÂà∞Ë∞ÉÂ∫¶ÊâßË°åÊó∂ÔºåÂ∞±‰ºöÊää<code>m</code>Âî§ÈÜíÔºõÂ¶ÇÊûúÊ≤°ÊúâÁªëÂÆöÔºåÂ∞±ÂÖàÁúãÁúã<code>GC</code>ÊòØ‰∏çÊòØÂú®Á≠âÂæÖÊâßË°å„ÄÇÂ¶ÇÊûú<code>GC</code>Ê≠£Á≠âÂæÖÊâßË°åÔºåÂ∞±ÂéªÊâßË°å<code>GC</code>ÔºåÂõûÊù•ÂÜçÁªßÁª≠ÊâßË°åË∞ÉÂ∫¶Á®ãÂ∫èÔºõ</li>
<li>Êé•‰∏ãÊù•Ôºå‰ºöÊ£ÄÊü•ÊúâÊ≤°ÊúâË¶ÅÊâßË°åÁöÑ<code>timer</code>Ôºõ</li>
<li>Ëé∑Âèñ‰∏ã‰∏Ä‰∏™Ë¶ÅÊâßË°åÁöÑ<code>g</code>Êó∂Ôºå‰ºöÂÖàÂéªÊú¨Âú∞<code>runq</code>‰∏≠Êü•ÊâæÔºåÊ≤°ÊúâÁöÑËØùÂ∞±Ë∞ÉÁî®<code>findrunnable()</code>ÔºåËøô‰∏™ÂáΩÊï∞Áõ¥Âà∞Ëé∑ÂèñÂà∞ÂæÖÊâßË°åÁöÑ<code>g</code>Êâç‰ºöËøîÂõûÔºöÂú®<code>findrunnable()</code>Â§ÑÔºå‰πü‰ºö<strong>ÂÖàÂà§Êñ≠ÊòØÂê¶Ë¶ÅÊâßË°å<code>GC</code></strong>ÔºåÁÑ∂ÂêéÂÖà<strong>Â∞ùËØï‰ªéÊú¨Âú∞<code>runq</code>‰∏≠Ëé∑Âèñ</strong>ÔºåÊ≤°ÊúâÁöÑËØùÂ∞±<strong>‰ªéÂÖ®Â±Ä<code>runq</code>‰∏≠Ëé∑Âèñ‰∏ÄÈÉ®ÂàÜ</strong>ÔºåÂ¶ÇÊûúËøòÊ≤°ÊúâÔºåÂ∞±ÂÖàÂ∞ùËØï<strong>ÊâßË°å<code>netpoll</code>ÔºåÊÅ¢Â§çÈÇ£‰∫õ<code>I/O‰∫ã‰ª∂</code>Â∑≤ÁªèÂ∞±Áª™ÁöÑ<code>g</code></strong>ÔºåÂÆÉ‰ª¨‰ºöË¢´ÊîæÂõûÂÖ®Â±Ä<code>runq</code>‰∏≠ÔºåÁÑ∂ÂêéÊâç‰ºöÂ∞ùËØï‰ªé<strong>ÂÖ∂‰ªñ<code>p</code>ÈÇ£Èáå<code>steal</code>‰∏Ä‰∫õ‰ªªÂä°</strong>Ôºõ</li>
<li>ÂΩìË∞ÉÂ∫¶Á®ãÂ∫èÁªà‰∫éËé∑Âæó‰∏Ä‰∏™ÂæÖÊâßË°åÁöÑ<code>g</code>ÂêéÔºåËøòÈúÄË¶ÅÊ£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÁªëÂÆöÊüê‰∏™<code>m</code>ÔºåÂ¶ÇÊûúÂ∑≤ÁªèÁªëÂÆö‰∫ÜÊüê‰∏™<code>m</code>ÔºåËøòÂæóÊääËøô‰∏™<code>g</code>ÈÄÅÂõûÂéªÔºåËÄåÂΩìÂâç<code>m</code>‰∏çÂæó‰∏çÂÜçÊ¨°ËøõË°å<code>schedule()</code>Ë∞ÉÂ∫¶ÔºõÂ¶ÇÊûúÊ≤°ÊúâÁªëÂÆöÁöÑ<code>m</code>ÔºåÂ∞±Ë∞ÉÁî®<code>execute()</code>Âú®ÂΩìÂâç<code>m</code>‰∏äÊâßË°åËøô‰∏™<code>g</code>Ôºõ</li>
<li><code>execute()</code>‰ºöÂª∫Á´ãÂΩìÂâç<code>m</code>‰∏é<code>g</code>ÁöÑÂÖ≥ËÅîÂÖ≥Á≥ªÔºåÂπ∂Êää<code>g</code>ÁöÑÁä∂ÊÄÅ‰ªé<code>_Grunnable</code>Êîπ‰∏∫<code>_Grunning</code>ÔºåÂ¶ÇÊûú‰∏çÁªßÊâø‰∏ä‰∏Ä‰∏™ÂçèÁ®ãÁöÑÊó∂Èó¥ÁâáÔºåÂ∞±Êää<code>p</code>ËøôÈáåÁöÑË∞ÉÂ∫¶ËÆ°Êï∞<code>p.schedtick</code>+1Ôºõ</li>
<li>ÊúÄÂêéÔºå‰ºöË∞ÉÁî®<code>gogo()</code>ÂáΩÊï∞Ôºå‰ªé<code>g.sched</code>ËøôÈáåÊÅ¢Â§çÂçèÁ®ãÊ†àÊåáÈíà„ÄÅÊåá‰ª§ÊåáÈíàÁ≠âÁªßÁª≠ÊâßË°å„ÄÇ</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221221180655313.png" alt="image-20221221180655313" style="zoom:50%;" />
<h3 id="212-mutex">2.1.2 Mutex</h3>
<p><code>Mutex</code>ÁöÑÁî±Êù•ÔºåÂ∫îËØ•ÊòØ<code>mutual exclusion</code>ÁöÑÂâçÁºÄÁªÑÂêàÔºåÁß∞‰∏∫&quot;‰∫íÊñ•ÈîÅ&quot;„ÄÇ</p>
<h4 id="2121-‰∏§ÁßçÊ®°Âºè">2.1.2.1 ‰∏§ÁßçÊ®°Âºè</h4>
<p>GoËØ≠Ë®Ä<code>sync</code>ÂåÖ‰∏≠<code>Mutex</code>ÁöÑ<strong>Êï∞ÊçÆÁªìÊûÑ</strong>ÊòØËøôÊ†∑ÁöÑÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Mutex</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">state</span> <span class="kt">int32</span>		<span class="c1">// Â≠òÂÇ®‰∫íÊñ•ÈîÅÁöÑÁä∂ÊÄÅ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">sema</span>  <span class="kt">uint32</span>	<span class="c1">// ‰ø°Âè∑Èáè, Áî®‰ΩúÁ≠âÂæÖÈòüÂàó
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>state</code>Â≠òÂÇ®‰∫íÊñ•ÈîÅÁöÑÁä∂ÊÄÅÔºåÂä†ÈîÅÂíåËß£ÈîÅÈÉΩÊòØÈÄöËøá<code>atomic</code>ÂåÖÊèê‰æõÁöÑÂáΩÊï∞ÂéüÂ≠êÊÄßÁöÑÊìç‰ΩúËØ•Â≠óÊÆµÔºö</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230103165015315.png" alt="image-20230103165015315" style="zoom:50%;" />
<ul>
<li><code>sema</code>Áî®‰Ωú‰∏Ä‰∏™‰ø°Âè∑ÈáèÔºå‰∏ªË¶ÅÁî®‰ΩúÁ≠âÂæÖÈòüÂàó„ÄÇ</li>
</ul>
<p><code>Mutex</code>Êúâ<strong>‰∏§ÁßçÊ®°Âºè</strong>Ôºö</p>
<ul>
<li>**Ê≠£Â∏∏Ê®°ÂºèÔºö<strong>Âú®Ê≠£Â∏∏Ê®°Âºè‰∏ãÔºå‰∏Ä‰∏™Â∞ùËØïÂä†ÈîÅÁöÑ<code>goroutine</code>‰ºöÂÖàËá™ÊóãÂá†Ê¨°ÔºåÂ∞ùËØïÈÄöËøáÂéüÂ≠êÊìç‰ΩúËé∑ÂæóÈîÅ„ÄÇËã•</strong>Âá†Ê¨°Ëá™Êóã(Ëá™ÊóãÈò∂ÊÆµ)**Âêé‰ªç‰∏çËÉΩËé∑ÂæóÈîÅÔºåÂàôÈÄöËøá‰ø°Âè∑ÈáèÊéíÈòüÁ≠âÂæÖÔºåÊâÄÊúâÁ≠âÂæÖËÄÖ‰ºöÊåâÁÖßÂÖàÂÖ•ÂÖàÂá∫(<code>FIFO</code>)ÁöÑÈ°∫Â∫èÊéíÈòü„ÄÇ</li>
</ul>
<p>‰ΩÜÊòØÂΩìÈîÅË¢´ÈáäÊîæÔºåÁ¨¨‰∏Ä‰∏™Á≠âÂæÖËÄÖË¢´Âî§ÈÜíÂêéÂπ∂‰∏ç‰ºöÁõ¥Êé•Êã•ÊúâÈîÅÔºåËÄåÊòØÈúÄË¶ÅÂíåÂêéÊù•ËÄÖÁ´û‰∫âÔºå‰πüÂ∞±ÊòØÈÇ£‰∫õÂ§Ñ‰∫é<strong>Ëá™ÊóãÈò∂ÊÆµ</strong>ÔºåÂ∞öÊú™ÊéíÈòüÁ≠âÂæÖÁöÑ<code>goroutine</code>ÔºåËøôÁßçÊÉÖÂÜµ‰∏ãÂêéÊù•ËÄÖÊõ¥Êúâ‰ºòÂäøÔºö‰∏ÄÊñπÈù¢ÔºåÂÆÉ‰ª¨Ê≠£Âú®CPUËøêË°åÔºåËá™ÁÑ∂ÊØîÂàöÂî§ÈÜíÁöÑ<code>goroutine</code>Êõ¥Êúâ‰ºòÂäøÔºåÂè¶‰∏ÄÊñπÈù¢Â§Ñ‰∫éËá™ÊóãÁä∂ÊÄÅÁöÑ<code>goroutine</code>ÂèØ‰ª•ÊúâÂæàÂ§öÔºåËÄåË¢´Âî§ÈÜíÁöÑ<code>goroutine</code>ÊØèÊ¨°Âè™Êúâ‰∏Ä‰∏™ÔºåÊâÄ‰ª•Ë¢´Âî§ÈÜíÁöÑ<code>goroutine</code>ÊúâÂæàÂ§ßÊ¶ÇÁéáÊãø‰∏çÂà∞ÈîÅ„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230103165828162.png" alt="image-20230103165828162" style="zoom:33%;" />
<p>ËøôÁßçÊÉÖÂÜµ‰∏ãÂÆÉ‰ºöË¢´ÈáçÊñ∞ÊèíÂÖ•Âà∞ÈòüÂàóÁöÑÂ§¥ÈÉ®ÔºåËÄå‰∏çÊòØÂ∞æÈÉ®„ÄÇËÄåÂΩì‰∏Ä‰∏™<code>goroutine</code>Êú¨Ê¨°Âä†ÈîÅÁ≠âÂæÖÁöÑÊó∂Èó¥Ë∂ÖËøá<code>1ms</code>ÂêéÔºåÂÆÉ‰ºöÊääÂΩìÂâç<code>Mutex</code>‰ªé<strong>Ê≠£Â∏∏Ê®°Âºè</strong>ÂàáÊç¢Ëá≥<strong>È••È•øÊ®°Âºè</strong>„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230103170121363.png" alt="image-20230103170121363" style="zoom:50%;" />
<ul>
<li>**È••È•øÊ®°ÂºèÔºö**Âú®È••È•øÊ®°Âºè‰∏ãÔºå<code>Mutex</code>ÁöÑÊâÄÊúâÊùÉ‰ªéÊâßË°å<code>Unlock</code>ÁöÑ<code>goroutine</code>ÔºåÁõ¥Êé•‰º†ÈÄíÁªôÁ≠âÂæÖÈòüÂàóÂ§¥ÈÉ®ÁöÑ<code>goroutine</code>„ÄÇÂêéÊù•ËÄÖ‰∏ç‰ºöËá™ÊóãÔºå‰πü‰∏ç‰ºöÂ∞ùËØïËé∑ÂæóÈîÅÔºåÂç≥‰Ωø<code>Mutex</code>Â§Ñ‰∫é<code>Unlocked</code>Áä∂ÊÄÅ„ÄÇÂÆÉ‰ª¨‰ºöÁõ¥Êé•‰ªéÈòüÂàóÁöÑÂ∞æÈÉ®ÊéíÈòüÁ≠âÂæÖ„ÄÇ</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230103170438409.png" alt="image-20230103170438409" style="zoom:50%;" />
<p>ÂΩì‰∏Ä‰∏™Á≠âÂæÖËÄÖËé∑ÂæóÈîÅÂêéÔºåÂÆÉ‰ºöÂú®‰ª•‰∏ã‰∏§ÁßçÊÉÖÂÜµÊó∂Â∞Ü<code>Mutex</code>Áî±<strong>È••È•øÊ®°Âºè</strong>ÂàáÊç¢Âõû<strong>Ê≠£Â∏∏Ê®°Âºè</strong>Ôºö</p>
<ul>
<li>Ê≠§ËΩÆËé∑ÂæóÈîÅÁöÑÁ≠âÂæÖËÄÖÁöÑÁ≠âÂæÖÊó∂Èó¥Â∞è‰∫é<code>1ms</code>Ôºå‰πüÂ∞±ÊòØÂÆÉÂàöÊù•‰∏ç‰πÖÔºõ</li>
<li>ÂÆÉÊòØÊúÄÂêé‰∏Ä‰∏™Á≠âÂæÖËÄÖÔºåÁ≠âÂæÖÈòüÂàóÂ∑≤ÁªèÁ©∫‰∫ÜÔºåÂêéÈù¢Ëá™ÁÑ∂Â∞±Ê≤°ÊúâÈ••È•øÁöÑ<code>goroutine</code>‰∫Ü„ÄÇ</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230103170714988.png" alt="image-20230103170714988" style="zoom:33%;" />
<p><strong>Áªº‰∏äÊâÄËø∞Ôºö<strong>Âú®</strong>Ê≠£Â∏∏Ê®°Âºè</strong>‰∏ãËá™ÊóãÂíåÊéíÈòüÊó∂ÂêåÊó∂Â≠òÂú®ÁöÑÔºåÊâßË°å<code>Lock</code>ÁöÑ<code>goroutine</code>‰ºöÂÖà‰∏ÄËæπËá™ÊóãÔºåÂ∞ùËØïËøáÂá†Ê¨°ÂêéÂ¶ÇÊûúËøòÊ≤°ÊãøÂà∞ÈîÅÔºåÂ∞±ÈúÄË¶ÅÂéªÊéíÈòüÁ≠âÂæÖ‰∫Ü„ÄÇËøôÁßçÂú®ÊéíÈòü‰πãÂâçÂÖàËÆ©Â§ßÂÆ∂Êù•Êä¢ÁöÑÊ®°ÂºèÔºåËÉΩÂ§üÊúâÊõ¥È´òÁöÑÂêûÂêêÈáèÔºåÂõ†‰∏∫È¢ëÁπÅÁöÑÊåÇËµ∑„ÄÅÂî§ÈÜí<code>goroutine</code>‰ºöÂ∏¶Êù•ËæÉÂ§öÁöÑÂºÄÈîÄ„ÄÇ‰ΩÜÊòØÂèà‰∏çËÉΩÊó†ÈôêÂà∂ÁöÑËá™ÊóãÔºåË¶ÅÊääËá™ÊóãÁöÑÂºÄÈîÄÊéßÂà∂Âú®ËæÉÂ∞èÁöÑËåÉÂõ¥ÂÜÖ„ÄÇÊâÄ‰ª•ÔºåÂú®Ê≠£Â∏∏Ê®°Âºè‰∏ãÔºå<code>Mutex</code>‰ºöÊúâÊõ¥Â•ΩÁöÑÊÄßËÉΩÔºå‰ΩÜÊòØÂèØËÉΩ‰ºöÂá∫Áé∞ÈòüÂàóÂ∞æÁ´ØÁöÑ<code>goroutine</code>ËøüËøüÊä¢‰∏çÂà∞ÈîÅÁöÑÊÉÖÂÜµ(Â∞æÁ´ØÂª∂Ëøü)„ÄÇ</p>
<p>ËÄå<strong>È••È•øÊ®°Âºè</strong>‰∏ã‰∏çÂÜçÂ∞ùËØïËá™ÊóãÔºåÊâÄÊúâ<code>goroutine</code>ÈÉΩË¶ÅÊéíÈòüÔºå‰∏•Ê†ºÁöÑÂÖàÊù•ÂêéÂà∞ÔºåÂØπ‰∫é<strong>Èò≤Ê≠¢Âá∫Áé∞Â∞æÁ´ØÂª∂Ëøü</strong>ÈùûÂ∏∏ÈáçË¶Å„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230103171327094.png" alt="image-20230103171327094" style="zoom:33%;" />
<h4 id="2122-lockÂíåunlock">2.1.2.2 LockÂíåUnlock</h4>
<p>È¶ñÂÖàÁúã‰∏Ä‰∏ãÂÖ≥‰∫é<code>Mutex.state</code>ÁöÑÂá†‰∏™<strong>Â∏∏ÈáèÂÆö‰πâ</strong>Ôºö<code>state</code>ÁöÑÁ±ªÂûãÊòØ<code>int32</code>„ÄÇ</p>
<ul>
<li>Á¨¨‰∏Ä‰ΩçÁî®‰Ωú<strong>ÈîÅÁä∂ÊÄÅÊ†áËØÜ</strong>ÔºåÁΩÆ‰∏∫<code>1</code>Â∞±Ë°®Á§∫Â∑≤Âä†ÈîÅÔºåÂØπÂ∫îÊé©Á†ÅÂ∏∏Èáè‰∏∫<code>mutexLocked</code>„ÄÇ</li>
<li>Á¨¨‰∫å‰ΩçÁî®‰∫é<strong>ËÆ∞ÂΩïÊòØÂê¶Â∑≤Êúâ<code>goroutine</code>Ë¢´Âî§ÈÜí</strong>‰∫ÜÔºåÁΩÆ‰∏∫<code>1</code>Ë°®Á§∫Â∑≤Âî§ÈÜíÔºåÂØπÂ∫îÊé©Á†ÅÂ∏∏Èáè‰∏∫<code>mutexWoken</code>„ÄÇ</li>
<li>Á¨¨‰∏â‰Ωç<strong>Ê†áËØÜ<code>Mutex</code>ÁöÑÂ∑•‰ΩúÊ®°Âºè</strong>Ôºå<code>0</code>‰ª£Ë°®Ê≠£Â∏∏Ê®°ÂºèÔºå<code>1</code>‰ª£Ë°®È••È•øÊ®°ÂºèÔºåÂØπÂ∫îÊé©Á†ÅÂ∏∏Èáè‰∏∫<code>mutexStarving</code>„ÄÇ</li>
<li>ËÄåÂ∏∏Èáè<code>mutexWaiterShift</code>Á≠â‰∫é<code>3</code>ÔºåË°®Á§∫Èô§‰∫ÜÊúÄ‰Ωé3‰Ωç‰ª•Â§ñÔºå<code>state</code>ÁöÑÂÖ∂‰ªñ‰ΩçÁî®Êù•<strong>ËÆ∞ÂΩïÊúâÂ§öÂ∞ë‰∏™Á≠âÂæÖËÄÖÂú®ÊéíÈòü</strong>„ÄÇ</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230103172843866.png" alt="image-20230103172843866" style="zoom:33%;" />
<p>Êé•‰∏ãÊù•Áúã‰∏Ä‰∏ã<code>Lock</code>Âíå<code>Unlock</code>ÁöÑ‰ª£Á†ÅÔºåÁ≤æÁÆÄÊéâÊ≥®ÈáäÂíåÈÉ®ÂàÜ<code>race</code>Ê£ÄÊµãÁõ∏ÂÖ≥ÁöÑ‰ª£Á†Å„ÄÇ</p>
<p>‰∏§‰∏™ÊñπÊ≥ï‰∏≠‰∏ªË¶ÅÈÄöËøá<code>atomic</code>ÂáΩÊï∞ÂÆûÁé∞‰∫Ü<code>Fast path</code>ÔºåÁõ∏Â∫îÁöÑ<code>Slow path</code>Ë¢´ÂçïÁã¨ÊîæÂú®‰∫Ü<code>lockSlow</code>Âíå<code>unlockSlow</code>ÊñπÊ≥ï‰∏≠ÔºåËøôÊ†∑ÊòØ‰∏∫‰∫Ü‰æø‰∫éÁºñËØëÂô®ÂØπ<code>Fast path</code>ËøõË°åÂÜÖËÅî‰ºòÂåñ„ÄÇ</p>
<p><code>Lock</code>ÊñπÊ≥ï‰∏≠ÁöÑ<code>Fast path</code>ÊúüÊúõ<code>Mutex</code>Â§Ñ‰∫é<code>Unlocked</code>Áä∂ÊÄÅÔºåÊ≤°Êúâ<code>goroutine</code>Âú®ÊéíÈòüÔºåÊõ¥‰∏ç‰ºöÈ••È•ø„ÄÇÁêÜÊÉ≥Áä∂ÂÜµ‰∏ãÔºå‰∏Ä‰∏™<code>CAS</code>Êìç‰ΩúÂ∞±ÂèØ‰ª•Ëé∑ÂæóÈîÅ„ÄÇ‰ΩÜÊòØÂ¶ÇÊûú<code>CAS</code>Êìç‰ΩúÊ≤°ËÉΩËé∑ÂæóÈîÅÔºåÂ∞±ÈúÄË¶ÅËøõÂÖ•<code>Slow path</code>Ôºå‰πüÂ∞±ÊòØ<code>lockSlow</code>ÊñπÊ≥ï„ÄÇ</p>
<p><code>Unlock</code>ÊñπÊ≥ïÂêåÁêÜÔºåÈ¶ñÂÖàÈÄöËøáÂéüÂ≠êÊìç‰Ωú‰ªé<code>state</code>‰∏≠ÂáèÂéª<code>mutexLocked</code>Ôºå‰πüÂ∞±ÊòØÈáäÊîæÈîÅ„ÄÇÁÑ∂ÂêéÊ†πÊçÆ<code>state</code>ÁöÑÊñ∞ÂÄºÊù•Âà§Êñ≠ÊòØÂê¶ÈúÄË¶ÅÊâßË°å<code>Slow path</code>„ÄÇÂ¶ÇÊûúÊñ∞ÂÄº‰∏∫<code>0</code>Ôºå‰πüÂ∞±ÊÑèÂë≥ÁùÄÊ≤°ÊúâÂÖ∂‰ªñ<code>goroutine</code>Âú®ÊéíÈòüÔºåÊâÄ‰ª•‰∏çÈúÄË¶ÅÊâßË°åÈ¢ùÂ§ñÊìç‰ΩúÔºõÂ¶ÇÊûúÊñ∞ÂÄº‰∏ç‰∏∫<code>0</code>ÔºåÈÇ£Â∞±ÈúÄË¶ÅËøõÂÖ•<code>Slow path</code>ÔºåÁúãÁúãÊòØ‰∏çÊòØÈúÄË¶ÅÂî§ÈÜíÊüê‰∏™<code>goroutine</code>„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230103173816295.png" alt="image-20230103173816295" style="zoom:33%;" />
<h4 id="2123-slow-path">2.1.2.3 Slow path</h4>
<p>**ÈóÆÈ¢òÔºö**ÂΩì‰∏Ä‰∏™<code>goroutine</code>Â∞ùËØïÁªô<code>mutex</code>Âä†ÈîÅÊó∂ÔºåÂ¶ÇÊûúÂÖ∂‰ªñ<code>goroutine</code>Â∑≤ÁªèÂä†‰∫ÜÈîÅËøòÊ≤°ÊúâÈáäÊîæÔºåËÄå‰∏îÂΩìÂâç<code>mutex</code>Â∑•‰ΩúÂú®Ê≠£Â∏∏Ê®°Âºè‰∏ãÔºå<strong>ÊòØ‰∏çÊòØÂ∞±Ë¶ÅÂºÄÂßãËá™Êóã‰∫ÜÂë¢Ôºü</strong></p>
<p><strong>Á≠îÔºö<strong>‰∏ç‰∏ÄÂÆö„ÄÇÂõ†‰∏∫Â¶ÇÊûúÂΩìÂâçÊòØ</strong>ÂçïÊ†∏</strong>Âú∫ÊôØÔºåÊàñËÄÖ <strong><code>GOMAXPROCS=1</code></strong>ÔºåÊàñËÄÖ<strong>ÂΩìÂâçÊ≤°ÊúâÂÖ∂‰ªñ<code>P</code>Ê≠£Âú®ËøêË°å</strong>„ÄÇËøô‰∫õÊÉÖÂÜµ‰∏ã<strong>Ëá™ÊóãÊòØÊ≤°ÊúâÊÑè‰πâÁöÑ</strong>Ôºö</p>
<ul>
<li>Ëá™ÊóãÁöÑ<code>goroutine</code>Âú®Á≠âÂæÖÊåÅÊúâÈîÅÁöÑ<code>goroutine</code>ÈáäÊîæÈîÅÔºåËÄåÊåÅÊúâÈîÅÁöÑ<code>goroutine</code>Âú®Á≠âÂæÖËá™ÊóãÁöÑ<code>goroutine</code>ËÆ©Âá∫CPU„ÄÇ</li>
<li>Èô§Ê≠§‰πãÂ§ñÔºåÂ¶ÇÊûúÂΩìÂâç<code>P</code>ÁöÑÊú¨Âú∞<code>runq</code>‰∏ç‰∏∫Á©∫ÔºåÁõ∏ËæÉ‰∫éËá™ÊóãÊù•ËØ¥ÔºåÂàáÊç¢Âà∞Êú¨Âú∞<code>goroutine</code>Êõ¥ÊúâÊïàÁéáÔºåÊâÄ‰ª•‰∏∫‰øùÈöúÂêûÂêêÈáè<strong>‰πü‰∏ç‰ºöËá™Êóã</strong>„ÄÇ</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230103174535064.png" alt="image-20230103174535064" style="zoom:33%;" />
<blockquote>
<h4 id="ÈóÆgoroutine-Ëá™ÊóãÁöÑÊù°‰ª∂">ÈóÆÔºöGoroutine Ëá™ÊóãÁöÑÊù°‰ª∂Ôºü</h4>
</blockquote>
<p>ÊúÄÁªàÔºå==Âè™ÊúâÂú®<strong>Â§öÊ†∏</strong>Âú∫ÊôØ‰∏ãÔºå‰∏î<code>GOMAXPROCS &gt; 1</code>Ôºå‰∏îËá≥Â∞ëÊúâ‰∏Ä‰∏™ÂÖ∂‰ªñÁöÑ<code>P</code>Ê≠£Âú®<code>running</code>Ôºå‰∏îÂΩìÂâç<code>P</code>ÁöÑÊú¨Âú∞<code>runq</code>‰∏∫Á©∫ÁöÑÊÉÖÂÜµ‰∏ãÔºåÊâçÂèØ‰ª•Ëá™Êóã„ÄÇ==</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230103174726515.png" alt="image-20230103174726515" style="zoom: 25%;" />
<p>ËøõÂÖ•Ëá™ÊóãÁöÑ<code>goroutine</code>‰ºöÂÖàÂéª‰∫âÊä¢<code>mutex</code>ÁöÑÂî§ÈÜíÊ†áËØÜ‰ΩçÔºåËÆæÁΩÆ<code>mutexWoken</code>Ê†áËØÜ‰ΩçÁöÑ<strong>ÁõÆÁöÑ</strong>ÊòØÂú®Ê≠£Â∏∏Ê®°Âºè‰∏ãÔºåÂëäÁü•ÊåÅÊúâÈîÅÁöÑ<code>goroutine</code>Âú®<code>Unlock</code>ÁöÑÊó∂ÂÄô‰∏çÁî®ÂÜçÂî§ÈÜíÂÖ∂‰ªñ<code>goroutine</code>‰∫ÜÔºåÂ∑≤ÁªèÊúâ<code>goroutine</code>Âú®ËøôÈáåÁ≠âÂæÖÔºå‰ª•ÂÖçÂî§ÈÜíÂ§™Â§öÁöÑÁ≠âÂæÖ<code>goroutine</code>„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230103175319004.png" alt="image-20230103175319004" style="zoom: 33%;" />
<p><code>Mutex</code>‰∏≠ÁöÑËá™ÊóãÔºåÂ∫ïÂ±ÇÊòØÈÄöËøá<code>procyield</code>Âæ™ÁéØÊâßË°å<code>30</code>Ê¨°<code>PAUSE</code>Ôºå<strong>Ëá™ÊóãÊ¨°Êï∞‰∏äÈôê‰∏∫<code>4</code></strong>ÔºåËÄå‰∏îÊØèËá™Êóã‰∏ÄÊ¨°ÈÉΩË¶ÅÈáçÊñ∞Âà§Êñ≠ÊòØÂê¶ÂèØ‰ª•ÁªßÁª≠Ëá™Êóã„ÄÇÂ¶ÇÊûúÈîÅË¢´ÈáäÊîæ‰∫ÜÔºåÊàñËÄÖÈîÅËøõÂÖ•‰∫ÜÈ••È•øÊ®°ÂºèÔºå‰∫¶ÊàñËÄÖÂ∑≤ÁªèËá™Êóã‰∫Ü<code>4</code>Ê¨°ÔºåÈÉΩ‰ºö<strong>ÁªìÊùüËá™Êóã</strong>„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230103175301300.png" alt="image-20230103175301300" style="zoom:25%;" />
<p><strong>ÁªìÊùüËá™Êóã</strong>ÊàñËÄÖ<strong>Ê†πÊú¨‰∏çÁî®Ëá™Êóã</strong>ÁöÑ<code>goroutine</code>Â∞±ËØ•Â∞ùËØïÂéüÂ≠êÊìç‰Ωú‰øÆÊîπ<code>mutex</code>ÁöÑÁä∂ÊÄÅ‰∫Ü„ÄÇÊääÊ≠§Êó∂<code>mutex.state</code>‰øùÂ≠òÂà∞<code>old</code>‰∏≠ÔºåÊääË¶Å‰øÆÊîπ‰∏∫ÁöÑÊñ∞<code>state</code>ËÆ∞‰∏∫<code>new</code>Ôºö</p>
<ul>
<li>
<p>Â¶ÇÊûú<code>old</code>Â§Ñ‰∫éÈ••È•øÊ®°ÂºèÊàñÂä†ÈîÅÁä∂ÊÄÅÔºå<code>goroutine</code>Â∞±ÂæóÂéªÊéíÈòüÔºåÊâÄ‰ª•Ëøô‰∫õÊÉÖÂÜµ‰∏ãÊéíÈòüËßÑÊ®°Ë¶ÅÂä†<code>1</code>„ÄÇ</p>
</li>
<li>
<p>Â¶ÇÊûúÊòØÊ≠£Â∏∏Ê®°ÂºèÔºåÂ∞±Ë¶ÅÂ∞ùËØïËÆæÁΩÆ<code>lock</code>‰ΩçÔºåÊâÄ‰ª•<code>new</code>‰∏≠Ëøô‰∏Ä‰ΩçË¶ÅÁΩÆ‰∏∫<code>1</code>Ôºõ</p>
</li>
<li>
<p>Â¶ÇÊûúÂΩìÂâç<code>goroutine</code>Á≠âÂæÖÁöÑÊó∂Èó¥Â∑≤ÁªèË∂ÖËøá<code>1ms</code>ÔºåËÄå‰∏îÈîÅËøòÊ≤°Ë¢´ÈáäÊîæÔºåÂ∞±Ë¶ÅÂ∞Ü<code>mutex</code>ÁöÑÁä∂ÊÄÅÂàáÊç¢‰∏∫È••È•øÊ®°Âºè„ÄÇ</p>
</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230103180037499.png" alt="image-20230103180037499" style="zoom: 50%;" />
<p>ÊääÊéíÈòüËßÑÊ®°ÂíåÂá†‰∏™Ê†áËØÜ‰ΩçÈÉΩËÆæÁΩÆÂ•ΩÂêéÔºåÂú®ÊâßË°åÂéüÂ≠êÊìç‰Ωú‰øÆÊîπ<code>state</code>ÂâçÔºåËã•ÊòØÂΩìÂâç<code>goroutine</code><strong>ÊåÅÊúâÂî§ÈÜíÊ†áËØÜ</strong>ÁöÑËØùÔºåËøòÈúÄË¶ÅÂ∞ÜÂî§ÈÜíÊ†áËØÜ‰Ωç<strong>ÈáçÁΩÆ</strong>ÔºåÂõ†‰∏∫ÔºåÊé•‰∏ãÊù•Êó†ËÆ∫ÊòØÂéªÊä¢ÈîÅËøòÊòØÂçïÁ∫ØÂéªÊéíÈòüÔºö</p>
<ul>
<li>Â¶ÇÊûú<strong>ÂéüÂ≠êÊìç‰ΩúÊàêÂäü</strong>‰∫ÜÔºåË¶Å‰πàÊàêÂäüÊä¢Âà∞‰∫ÜÈîÅÔºåË¶Å‰πàÊòØÊàêÂäüËøõÂà∞‰∫ÜÁ≠âÂæÖÈòüÂàóÔºåÂΩìÂâç<code>goroutine</code>ÈÉΩ‰∏çÂÜçÊòØË¢´Âî§ÈÜíÁöÑ<code>goroutine</code>‰∫ÜÔºåÊâÄ‰ª•Ë¶ÅÈáäÊîæÂî§ÈÜíÊ†áËØÜ„ÄÇ</li>
<li>ËÄåÂ¶ÇÊûú<strong>ÂéüÂ≠êÊìç‰ΩúÂ§±Ë¥•</strong>Ôºå‰πüÂ∞±ÊÑèÂë≥ÁùÄÂÖ∂‰ªñ<code>goroutine</code>Âú®Êàë‰ª¨‰øùÂ≠ò<code>mutex.state</code>Âà∞<code>old</code>ÂêéÂèà‰øÆÊîπ‰∫Ü<code>state</code>ÁöÑÂÄºÔºåÂΩìÂâç<code>goroutine</code>Â∞±Ë¶ÅÂõûËøáÂ§¥ÂéªÁªßÁª≠‰ªéËá™ÊóãÊ£ÄÊü•ËøôÈáåÂºÄÂßãÂÜçÊ¨°Â∞ùËØïÔºåÊâÄ‰ª•‰πüÈúÄË¶ÅÈáäÊîæËá™Â∑±‰πãÂâçÊä¢Âà∞ÁöÑÂî§ÈÜíÊ†áËØÜ‰ΩçÔºå‰ªéÂ§¥ÂÜçÊù•„ÄÇ</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230103181323794.png" alt="image-20230103181323794" style="zoom:33%;" />
<h5 id="lockÊìç‰ΩúÁöÑslow-path">LockÊìç‰ΩúÁöÑ<code>Slow path</code></h5>
<p>ÁªßÁª≠Â±ïÂºÄ<strong>ÂéüÂ≠êÊìç‰ΩúÊàêÂäü</strong>ÁöÑÂàÜÊîØÔºö</p>
<ul>
<li>Â¶ÇÊûúÊòØ<strong>Êä¢ÈîÅÊìç‰ΩúÊàêÂäü</strong>‰∫ÜÔºåÈÇ£‰πàÂä†ÈîÅÁöÑ<code>Slow path</code>Â∞±ÂèØ‰ª•ÂÆ£ÂëäÁªìÊùü‰∫ÜÔºõ</li>
<li>Â¶ÇÊûúÊòØ<strong>ÊéíÈòüËßÑÊ®°ËÆæÁΩÆÊàêÂäü</strong>‰∫ÜÔºåËøòË¶ÅÂÜ≥ÂÆöÊòØÊéíÂú®Á≠âÂæÖÈòüÂàóÂ§¥ÈÉ®ËøòÊòØÂ∞æÈÉ®„ÄÇÂ¶ÇÊûúÂΩìÂâç<code>goroutine</code>Â∑≤ÁªèÊéíËøáÈòü‰∫ÜÔºåÊòØÂú®<code>Unlock</code>Êó∂‰ªéÁ≠âÂæÖÈòüÂàó‰∏≠Âî§ÈÜíÁöÑÔºåÈÇ£Â∞±Ë¶ÅÊéíÂà∞Á≠âÂæÖÈòüÂàóÂ§¥ÈÉ®ÔºõÂ¶ÇÊûúÊòØÁ¨¨‰∏ÄÊ¨°ÊéíÈòüÔºåÂ∞±ÂæóÊéíÂà∞Á≠âÂæÖÈòüÂàóÂ∞æÈÉ®ÔºåÂπ∂‰∏î‰ªéÁ¨¨‰∏ÄÊ¨°ÊéíÈòüÂºÄÂßã<strong>ËÆ∞ÂΩïÂΩìÂâç<code>goroutine</code>ÁöÑÁ≠âÂæÖÊó∂Èó¥</strong>„ÄÇ<strong>Êé•‰∏ãÊù•</strong>Â∞±‰ºöËÆ©Âá∫ÔºåËøõÂà∞Á≠âÂæÖÈòüÂàóÈáåÔºåÈòüÂàóÈáåÁöÑ<code>goroutine</code>Ë¢´Âî§ÈÜíÊó∂ÔºåË¶Å‰ªé<strong>‰∏äÊ¨°ËÆ©Âá∫ÁöÑÂú∞Êñπ</strong>ÂºÄÂßãÁªßÁª≠ÊâßË°å„ÄÇ<strong>Êé•‰∏ãÊù•</strong>‰ºöÂà§Êñ≠ÔºåÂ¶ÇÊûú<code>mutex</code>Â§ÑÂú®Ê≠£Â∏∏Ê®°ÂºèÔºåÈÇ£Â∞±Êé•ÁùÄ‰ªéËá™ÊóãÂºÄÂßãÊä¢ÈîÅÔºåÂ¶ÇÊûúÂî§ÈÜíÂêé<code>mutex</code>Â§ÑÂú®È••È•øÊ®°ÂºèÔºåÈÇ£Â∞±Ê≤°ÊúâÂÖ∂‰ªñ<code>goroutine</code>‰ºöÂíåËá™Â∑±Êä¢‰∫ÜÔºåÈîÅÂ∑≤ÁªèËΩÆÂà∞Ëá™Â∑±ËøôÈáåÔºåÂè™ÈúÄË¶ÅÊää<code>mutex.state</code>‰∏≠<code>lock</code>Ê†áËØÜ‰ΩçËÆæÁΩÆ‰∏∫Âä†ÈîÅÔºåÊääÁ≠âÂæÖÈòüÂàóËßÑÊ®°ÂáèÂéª1ÔºåÂÜçÁúãÁúãÊòØ‰∏çÊòØË¶ÅÂàáÊç¢Âà∞Ê≠£Â∏∏Ê®°ÂºèÔºå‰πüÂ∞±ÊòØËá™Â∑±ÁöÑÁ≠âÂæÖÊó∂Èó¥ÊòØ‰∏çÊòØÂ∞è‰∫é<code>1ms</code>ÔºåÊàñËÄÖÁ≠âÂæÖÈòüÂàóÂ∑≤ÁªèÁ©∫‰∫ÜÔºåÊúÄÂêéËÆæÁΩÆÂ•Ω<code>mutex.state</code>Â∞±‰∏ÄÂàáok‰∫Ü„ÄÇ</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230103182744173.png" alt="image-20230103182744173" style="zoom:50%;" />
<h5 id="unlockÊìç‰ΩúÁöÑslow-path">UnlockÊìç‰ΩúÁöÑSlow path</h5>
<p>ËøõÂà∞<code>Unlock</code>ÁöÑ<code>Slow path</code>ËØ¥ÊòéÈô§Âéª<code>lock</code>Ê†áËØÜ‰Ωç‰ª•Â§ñÔºåÂâ©‰∏ãÁöÑ‰Ωç‰∏çÂÖ®‰∏∫<code>0</code>„ÄÇ</p>
<ul>
<li>
<p>Â¶ÇÊûúÂ§ÑÂú®Ê≠£Â∏∏Ê®°ÂºèÔºåËã•Á≠âÂæÖÈòüÂàó‰∏∫Á©∫ÔºåÊàñËÄÖÂ∑≤ÁªèÊúâ<code>goroutine</code>Ë¢´Âî§ÈÜíÊàñËé∑Âæó‰∫ÜÈîÅÔºåÊàñËÄÖÈîÅËøõÂÖ•‰∫ÜÈ••È•øÊ®°ÂºèÔºåÈÇ£Â∞±‰∏çÈúÄË¶ÅÂî§ÈÜíÊüê‰∏™<code>goroutine</code>ÔºåÁõ¥Êé•ËøîÂõûÂç≥ÂèØ„ÄÇ<strong>Âê¶Âàô</strong>Â∞±Ë¶ÅÂ∞ùËØïÊä¢Âç†<code>mutexWoken</code>Ê†áËØÜ‰ΩçÔºåËé∑ÂèñÂî§ÈÜí‰∏Ä‰∏™<code>goroutine</code>ÁöÑÊùÉÂà©„ÄÇÊä¢Âç†ÊàêÂäüÂêéÔºåÂ∞±‰ºöÈÄöËøá<code>runtime_Semrelease</code>ÂáΩÊï∞Âî§ÈÜí‰∏Ä‰∏™<code>goroutine</code>ÔºõÂ¶ÇÊûúÊä¢Âç†‰∏çÊàêÂäüÂ∞±ËøõË°åÂæ™ÁéØÂ∞ùËØïÔºåÁõ¥Âà∞Á≠âÂæÖÈòüÂàó‰∏∫Á©∫ÔºåÊàñËÄÖÂ∑≤ÁªèÊúâ‰∏Ä‰∏™<code>goroutine</code>Ë¢´Âî§ÈÜíÊàñËé∑Âæó‰∫ÜÈîÅÔºåÊàñËÄÖÈîÅËøõÂÖ•‰∫ÜÈ••È•øÊ®°ÂºèÔºåÂàôÈÄÄÂá∫Âæ™ÁéØ„ÄÇ</p>
</li>
<li>
<p>ËÄåÂú®È••È•øÊ®°Âºè‰∏ãÔºåÂêéÊù•ÁöÑ<code>goroutine</code>‰∏ç‰ºö‰∫âÊä¢ÈîÅÔºåËÄåÊòØÁõ¥Êé•ÊéíÈòüÔºåÈîÅÁöÑÊâÄÊúâÊùÉÊòØÁõ¥Êé•‰ªéÊâßË°å<code>Unlock</code>ÁöÑ<code>goroutine</code>‰º†ÈÄíÁªôÁ≠âÂæÖÈòüÂàó‰∏≠È¶ñ‰∏™Á≠âÂæÖËÄÖÁöÑÔºåÊâÄ‰ª•‰∏çÁî®Êä¢Âç†<code>mutexWoken</code>Ê†áËØÜ‰Ωç„ÄÇÁ¨¨‰∏Ä‰∏™Á≠âÂæÖËÄÖÂî§ÈÜíÂêéÔºå‰ºöÁªßÊâøÂΩìÂâç<code>goroutine</code>ÁöÑÊó∂Èó¥ÁâáÁ´ãÂàªÂºÄÂßãËøêË°åÔºå‰πüÂ∞±ÊòØÁªßÁª≠<code>lockSlow</code>ËøôÈáå<code>goroutine</code>Ë¢´Âî§ÈÜí‰ª•ÂêéÁöÑÈÄªËæë„ÄÇ</p>
</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230103203721215.png" alt="image-20230103203721215" style="zoom: 50%;" />
<h3 id="213-‰ø°Âè∑Èáè">2.1.3 ‰ø°Âè∑Èáè</h3>
<p>‰∏äËäÇ‰∏ªË¶ÅËÆ≤Ëß£ sync.Mutex ÁöÑÁ¨¨‰∏Ä‰∏™Â≠óÊÆµ <code>state</code>ÔºåÊú¨ËäÇ‰∏ªË¶ÅËÆ≤Ëß£ sync.Mutex ÁöÑÁ¨¨‰∫å‰∏™Â≠óÊÆµ <code>sema</code>„ÄÇ</p>
<blockquote>
<h4 id="ÈóÆÈ¢òÂçèÁ®ãÁ≠âÂæÖ‰∏Ä‰∏™ÈîÅÊó∂Ë¶ÅÂ¶Ç‰Ωï‰ºëÁú†Á≠âÂæÖÂíåÂî§ÈÜíÂë¢">**ÈóÆÈ¢òÔºö**ÂçèÁ®ãÁ≠âÂæÖ‰∏Ä‰∏™ÈîÅÊó∂ÔºåË¶ÅÂ¶Ç‰Ωï‰ºëÁú†„ÄÅÁ≠âÂæÖÂíåÂî§ÈÜíÂë¢Ôºü</h4>
</blockquote>
<p>**Á≠îÔºö**ËøôË¶ÅÈù†<code>runtime.semaphore</code>Êù•ÂÆûÁé∞ÔºåËøôÊòØÂèØ‰æõÂçèÁ®ã‰ΩøÁî®ÁöÑ‰ø°Âè∑Èáè„ÄÇ<code>runtime</code>ÂÜÖÈÉ®‰ºöÈÄöËøá‰∏Ä‰∏™Â§ßÂ∞è‰∏∫<code>251</code>ÁöÑ<code>sematable</code>Êù•ÁÆ°ÁêÜÊâÄÊúâ<code>semaphore</code>ÔºåÊÄé‰πàÈÄöËøáËøô‰∏™Â§ßÂ∞èÂõ∫ÂÆöÁöÑ<code>table</code>Êù•ÁÆ°ÁêÜÊâßË°åÈò∂ÊÆµÊï∞Èáè‰∏çÂÆöÁöÑ<code>semaphore</code>Âë¢Ôºü<strong>Â§ßËá¥ÊÄùË∑ØÂ¶Ç‰∏ãÔºö</strong></p>
<p>Ëøô‰∏™<code>sematable</code>Â≠òÂÇ®ÁöÑÊòØ<code>251</code>ËØæÂπ≥Ë°°Ê†ëÁöÑÊ†πÔºåÂπ≥Ë°°Ê†ë‰∏≠ÊØè‰∏™ËäÇÁÇπÈÉΩÊòØ‰∏Ä‰∏™<code>sudog</code>Á±ªÂûãÁöÑÂØπË±°ÔºåË¶Å‰ΩøÁî®‰∏Ä‰∏™‰ø°Âè∑ÈáèÊó∂ÔºåÈúÄË¶ÅÊèê‰æõ‰∏Ä‰∏™ËÆ∞ÂΩï‰ø°Âè∑ÈáèÊï∞ÂÄºÁöÑÂèòÈáèÔºåÊ†πÊçÆÂÆÉÁöÑÂú∞ÂùÄËøõË°åËÆ°ÁÆóÔºåÊò†Â∞ÑÂà∞<code>sematable</code>‰∏≠ÁöÑ‰∏ÄÈ¢óÂπ≥Ë°°Ê†ë‰∏äÔºåÊâæÂà∞ÂØπÂ∫îÁöÑËäÇÁÇπÂ∞±ÊâæÂà∞‰∫ÜËØ•‰ø°Âè∑ÈáèÁöÑÁ≠âÂæÖÈòüÂàó„ÄÇ</p>
<p>‰æãÂ¶ÇÔºåÊàë‰ª¨Â∏∏Áî®ÁöÑ<code>sync.Mutex</code>‰∏≠ÔºåÊúâ‰∏Ä‰∏™<code>sema</code>Â≠óÊÆµÔºåÁî®‰∫éËÆ∞ÂΩï‰ø°Âè∑ÈáèÁöÑÊï∞ÂÄºÔºåÂ¶ÇÊûúÊúâÂçèÁ®ãÊÉ≥Ë¶ÅÁ≠âÂæÖËøô‰∏™<code>Mutex</code>ÔºåÂ∞±‰ºöÊ†πÊçÆ<code>sema</code>Â≠óÊÆµÁöÑÂú∞ÂùÄËÆ°ÁÆóÊò†Â∞ÑÂà∞<code>sematable</code>‰∏≠ÁöÑÊüêÊ£µÂπ≥Ë°°Ê†ë‰∏äÔºåÊâæÂà∞ÂØπÂ∫îÁöÑËäÇÁÇπÔºå‰πüÂ∞±ÊâæÂà∞‰∫ÜËøô‰∏™<code>Mutex</code>ÁöÑÁ≠âÂæÖÈòüÂàó‰∫Ü„ÄÇÊâÄ‰ª•Ôºå<code>syne.Mutex</code>ÊòØÈÄöËøá‰ø°Âè∑ÈáèÊù•ÂÆûÁé∞ÊéíÈòüÁöÑ„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230104201053349.png" alt="image-20230104201053349" style="zoom:33%;" />
<p>ËÄå<code>channel</code>ÈúÄË¶ÅÊúâ<strong>ËØª(ÂèëÈÄÅ)Á≠âÂæÖÈòüÂàó</strong>‰ª•Âèä<strong>ÂÜô(Êé•Êî∂)Á≠âÂæÖÈòüÂàó</strong>ÔºåËøòË¶ÅÊîØÊåÅÁºìÂÜ≤Âå∫ÂäüËÉΩÔºåÊâÄ‰ª•Âπ∂Ê≤°ÊúâÁõ¥Êé•‰ΩøÁî®‰ø°Âè∑ÈáèÊù•ÂÆûÁé∞ÊéíÈòüÔºåËÄåÊòØËá™Â∑±ÂÆûÁé∞‰∫Ü‰∏ÄÂ•óÊéíÈòüÈÄªËæë„ÄÇ</p>
<p>‰∏çËøáÔºåÊó†ËÆ∫ÊòØ‰ø°Âè∑ÈáèËøòÊòØ<code>channel</code>ÔºåÂ∫ïÂ±ÇÂÆûÁé∞ÈÉΩÁ¶ª‰∏çÂºÄ<code>runtime.mutex</code>ÔºåÂõ†‰∏∫ÂÆÉ‰ª¨ÈÉΩÈúÄË¶Å‰øùÈöúÂú®Èù¢‰∏¥Â§öÁ∫øÁ®ãÂπ∂ÂèëÊó∂Ôºå‰∏ç‰ºöÂá∫Áé∞ÂêåÊ≠•ÈóÆÈ¢ò„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230104201320363.png" alt="image-20230104201320363" style="zoom: 33%;" />
<h3 id="214-Êä¢Âç†ÂºèË∞ÉÂ∫¶">2.1.4 Êä¢Âç†ÂºèË∞ÉÂ∫¶</h3>
<h4 id="2141-go-113">2.1.4.1 Go 1.13</h4>
<p>Go 1.13 ÁöÑÊä¢Âç†ÊñπÂºèÊòØ‰æùËµñ‰∫é<strong>Ê†àÂ¢ûÈïøÊ£ÄÊµã‰ª£Á†Å</strong>ÁöÑÔºåÂπ∂‰∏çÁÆó‰∏•Ê†ºÊÑè‰πâ‰∏äÁöÑÊä¢Âç†ÂºèË∞ÉÂ∫¶„ÄÇ</p>
<p>È¶ñÂÖàÁúã‰∏ÄÊÆµ‰ª£Á†ÅÔºö</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230105151904406.png" alt="image-20230105151904406" style="zoom:25%;" />
<p>ÊåâÁêÜÊù•ËØ¥ÔºåËøôÊÆµ‰ª£Á†ÅËøêË°åÂêéÂ∫îËØ•‰ºö‰∏çÊñ≠ËæìÂá∫ÈÄíÂ¢ûÁöÑÊï∞Â≠óÔºå‰ΩÜÊòØÂú® Go 1.14 ‰πãÂâçÔºåËøêË°åËøôÊÆµ‰ª£Á†Å‰ºöÂèëÁîüÈòªÂ°û„ÄÇ</p>
<p>ËøêË°åÁéØÂ¢ÉÊòØÂèåÊ†∏CPUÔºåÊéíÊü•‰πãÂêéÂèëÁé∞ÊòØÂú®<strong>ÊâßË°å<code>STW</code>Êó∂ÂèëÁîüÁöÑÈòªÂ°û</strong>„ÄÇ</p>
<p><code>GC</code> ÂºÄÂßãÂâçÈúÄË¶Å<code>STW</code>Êù•ËøõË°åÂºÄÂêØÂÜôÂ±èÈöúÁ≠âÂáÜÂ§áÂ∑•‰ΩúÔºåÊâÄ‰ª•<code>STW</code>Â∞±ÊòØË¶ÅÊä¢Âç†ÊâÄÊúâÁöÑ<code>P</code>ÔºåËÆ©<code>GC</code>Âæó‰ª•Ê≠£Â∏∏Â∑•‰Ωú„ÄÇËÄåÁ§∫‰æãÁ®ãÂ∫è‰∏≠ÁöÑ<code>main goroutine</code>Ê≤°ËÉΩË¢´Êä¢Âç†ÔºåÂÆÉ‰∏ÄÁõ¥Âú®ÊâßË°åÔºåËÄå<code>STW</code>‰∏ÄÁõ¥Âú®Á≠âÂæÖÂÆÉËÆ©Âá∫ÔºåËøôÊ†∑Â∞±Èô∑ÂÖ•‰∫ÜÂÉµÂ±Ä„ÄÇ</p>
<blockquote>
<h4 id="ÈóÆÈ¢ò‰∏∫‰ªÄ‰πà‰ºöÈô∑ÂÖ•ËøôÊ†∑ÁöÑÂ±ÄÈù¢">**ÈóÆÈ¢òÔºö**‰∏∫‰ªÄ‰πà‰ºöÈô∑ÂÖ•ËøôÊ†∑ÁöÑÂ±ÄÈù¢Ôºü</h4>
</blockquote>
<p><strong>Á≠îÔºö<strong>È¶ñÂÖàÔºåÊ¢≥ÁêÜ‰∏ã<code>STW</code>ÁöÑ‰∏ªË¶ÅÈÄªËæë„ÄÇ<code>GC</code>ÈúÄË¶ÅÊä¢Âç†ÊâÄÊúâÁöÑ<code>P</code>Ôºå‰ΩÜËøô‰∏çÊòØËØ¥Êä¢Âç†Â∞±okÁöÑÔºåÊâÄ‰ª•ÂÆÉ‰ºö</strong>ËÆ∞ÂΩï‰∏ãËá™Â∑±Ë¶ÅÁ≠âÂæÖÂ§öÂ∞ë‰∏™<code>P</code>ËÆ©Âá∫</strong>ÔºåÂΩìËøô‰∏™ÂÄºÂáè‰∏∫<code>0</code>ÔºåÁõÆÁöÑÂ∞±ËææÂà∞‰∫Ü„ÄÇÂØπ‰∫éÂΩìÂâç<code>P</code>„ÄÅ‰ª•ÂèäÈô∑ÂÖ•Á≥ªÁªüË∞ÉÁî®ÁöÑ<code>P</code>(<code>_Psyscall</code>)„ÄÅËøòÊúâÁ©∫Èó≤Áä∂ÊÄÅÁöÑ<code>P</code>ÔºåÁõ¥Êé•Â∞ÜÂÖ∂ËÆæÁΩÆ‰∏∫<code>_Pgcstop</code>Âç≥ÂèØ„ÄÇÂØπ‰∫éËøòÊúâ<code>G</code>Âú®ËøêË°åÁöÑ<code>P</code>ÔºåÂàô‰ºöÂ∞ÜÂØπÂ∫îÁöÑ<code>g.stackguard0</code>ËÆæÁΩÆ‰∏∫‰∏Ä‰∏™ÁâπÊÆäÊ†áËØÜ(<code>runtime.stackPreempt</code>)ÔºåÂëäËØâÂÆÉ<code>GC</code>Ê≠£Âú®Á≠âÂæÖÂÆÉËÆ©Âá∫„ÄÇÊ≠§Â§ñÔºåËøò‰ºöËÆæÁΩÆ‰∏Ä‰∏™<code>gcwaiting</code>Ê†áËØÜ(<code>sched.gcwaiting=1</code>)ÔºåÊé•‰∏ãÊù•Â∞±ÈÄöËøáËøô‰∏§‰∏™Ê†áËØÜÁ¨¶ÁöÑÈÖçÂêàÔºåÊù•ÂÆûÁé∞ËøêË°å‰∏≠ÁöÑ<code>P</code>ÁöÑÊä¢Âç†„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230105155228882.png" alt="image-20230105155228882" style="zoom:33%;" />
<p><strong>ËøôÊòØÊÄé‰πàÂÆûÁé∞ÁöÑÂë¢Ôºü</strong></p>
<p><code>goroutine</code>ÂàõÂª∫‰πãÂàùÔºåÊ†àÁöÑÂ§ßÂ∞èÊó∂Âõ∫ÂÆöÁöÑÔºå‰∏∫‰∫ÜÈò≤Ê≠¢Âá∫Áé∞Ê†àÊ∫¢Âá∫ÁöÑÊÉÖÂÜµÔºåÁºñËØëÂô®‰ºöÂú®ÊúâÊòéÊòæÊ†àÊ∂àËÄóÁöÑÂáΩÊï∞Â§¥ÈÉ®ÊèíÂÖ•‰∏Ä‰∫õÊ£ÄÊµã‰ª£Á†Å„ÄÇÈÄöËøá<code>g.stackguard0</code>Êù•Âà§Êñ≠ÊòØÂê¶ÈúÄË¶ÅËøõË°åÊ†àÂ¢ûÈïøÔºå‰ΩÜÂ¶ÇÊûú<code>g.stackguard0</code>Ë¢´ËÆæÁΩÆ‰∏∫ÁâπÊÆäÊ†áËØÜ<code>runtime.stackPreempt</code>Ôºå‰æø‰∏ç‰ºöÊâßË°åÊ†àÂ¢ûÈïøÔºåËÄåÊòØÂéªÊâßË°å‰∏ÄÊ¨°Ë∞ÉÂ∫¶(<code>schedule()</code>)ÔºåÂú®<code>schedule()</code>Ë∞ÉÂ∫¶ÊâßË°åÊó∂Ôºå‰ºöÊ£ÄÊµã<code>gcwaiting</code>Ê†áËØÜÔºåËã•ÂèëÁé∞<code>GC</code>Âú®Á≠âÂæÖÊâßË°åÔºå‰æø‰ºöËÆ©Âá∫ÂΩìÂâç<code>P</code>ÔºåÂ∞ÜÂÖ∂ÁΩÆ‰∏∫<code>_Pgcstop</code>Áä∂ÊÄÅ„ÄÇ</p>
<p>ËøôÊ†∑ÁúãÊù•ÔºåÁ§∫‰æã<code>main goroutine</code>‰πãÊâÄ‰ª•Ê≤°ËÉΩËÆ©Âá∫Ôºå<strong>ÊòØÂõ†‰∏∫Á©∫ÁöÑ<code>for</code>Âæ™ÁéØÂπ∂Ê≤°ÊúâË∞ÉÁî®ÂáΩÊï∞</strong>Ôºå‰πüÂ∞±Ê≤°ÊúâÊú∫‰ºöÊâßË°åÊ†àÂ¢ûÈïøÊ£ÄÊµã‰ª£Á†ÅÔºåÊâÄ‰ª•ÂÆÉÂπ∂‰∏çÁü•ÈÅì<code>GC</code>Âú®Á≠âÂæÖÂÆÉËÆ©Âá∫„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230105160033853.png" alt="image-20230105160033853" style="zoom:33%;" />
<h4 id="2142-go-114-‰πãÂêé">2.1.4.2 Go 1.14 ‰πãÂêé</h4>
<p><strong>‰æùËµñÊ†àÂ¢ûÈïøÊ£ÄÊµã‰ª£Á†ÅÁöÑÊä¢Âç†ÊñπÂºèÔºåÈÅáÂà∞Ê≤°ÊúâÂáΩÊï∞Ë∞ÉÁî®ÁöÑÊÉÖÂÜµÂ∞±‰ºöÂá∫Áé∞ÈóÆÈ¢ò„ÄÇ</strong></p>
<p>Âú® Go 1.14 Âèä‰πãÂêéÔºåËøô‰∏ÄÈóÆÈ¢òÂæóÂà∞‰∫ÜËß£ÂÜ≥„ÄÇÂú®<code>Linux</code>Á≥ªÁªü‰∏äÔºåËøôÁßçÁúüÊ≠£ÁöÑÊä¢Âç†ÂºèË∞ÉÂ∫¶ÊòØ<strong>Âü∫‰∫é‰ø°Âè∑</strong>Êù•ÂÆûÁé∞ÁöÑÔºåÊâÄ‰ª•‰πüÁß∞‰∏∫<strong>ÂºÇÊ≠•Êä¢Âç†</strong>„ÄÇ</p>
<p>ÂáΩÊï∞<code>preemptone</code>Áî®Êù•Êä¢Âç†‰∏Ä‰∏™<code>P</code>ÔºåÂÆö‰ΩçÂà∞ËØ•ÂáΩÊï∞ÔºåÂØπÊØî 1.13 Âíå 1.14 ÁöÑÂÆûÁé∞Êúâ‰Ωï‰∏çÂêå„ÄÇ</p>
<h5 id="‰ø°Âè∑ÂèëÈÄÅ">‰ø°Âè∑ÂèëÈÄÅ</h5>
<p>1.13 ‰∏≠Ôºå<code>preemptone</code>ÂáΩÊï∞‰∏ªË¶ÅË¥üË¥£ËÆæÁΩÆ<code>g.preempt=true</code>ÔºåÂπ∂Â∞Ü<code>g.stackguard0</code>ËÆæÁΩÆ‰∏∫ÁâπÊÆäÊ†áËØÜ(<code>stackPreempt</code>)„ÄÇ</p>
<p>ËÄåÂú® 1.14 ‰∏≠ÔºåÂ¢ûÂä†‰∫ÜÊúÄÂêéËøô‰∏™<code>if</code>ËØ≠Âè•ÂùóÔºö</p>
<ul>
<li>Á¨¨‰∏Ä‰∏™Âà§Êñ≠Áî®‰∫éÁ°ÆËÆ§ÂΩìÂâçÁ°¨‰ª∂ÁéØÂ¢ÉÊòØÂê¶ÊîØÊåÅËøôÁßçÂºÇÊ≠•Êä¢Âç†ÔºåËøô‰∏™Â∏∏ÈáèÂÄº(<code>preemptMSupported</code>)ÊòØÂú®ÁºñËØëÊúüÈó¥Â∞±Á°ÆÂÆöÁöÑÔºõ</li>
<li>Á¨¨‰∫å‰∏™Âà§Êñ≠(<code>debug.asyncpreemptoff</code>)Áî®‰∫éÊ£ÄÊµãÁî®Êà∑ÊòØÂê¶ÂÖÅËÆ∏ÂºÄÂêØÂºÇÊ≠•Êä¢Âç†ÔºåÈªòËÆ§ÊÉÖÂÜµ‰∏ãÊòØÂÖÅËÆ∏ÁöÑÔºå‰ΩÜÊòØÁî®Êà∑ÂèØ‰ª•ÈÄöËøá<code>GODEBUG</code>ÁéØÂ¢ÉÂèòÈáèÊù•Á¶ÅÁî®ÂºÇÊ≠•Êä¢Âç†„ÄÇ</li>
<li>Â¶ÇÊûúËøô‰∏§Êù°È™åËØÅÈÉΩÈÄöËøá‰∫ÜÔºåÂ∞±Â∞Ü<code>p.preempt</code>Â≠óÊÆµÁΩÆ‰∏∫<code>true</code>ÔºåÂÆûÈôÖÁöÑÊä¢Âç†Êìç‰Ωú‰ºö‰∫§Áî±<code>preemptM</code>ÂáΩÊï∞Êù•ÂÆåÊàê„ÄÇ</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230105170716733.png" alt="image-20230105170716733" style="zoom:33%;" />
<p>ÂÆö‰ΩçÂà∞<code>preemptM</code>ÂáΩÊï∞ÔºåÂÆÉÁöÑ‰∏ªË¶ÅÈÄªËæëÊòØÈÄöËøá<code>runtime.signalM</code>ÂáΩÊï∞ÔºåÂêëÊåáÂÆö<code>M</code>ÂèëÈÄÅ<code>sigPreempt</code>‰ø°Âè∑Ôºå<strong>ÊÄé‰πàÂèëÈÄÅÁöÑÂë¢Ôºü</strong></p>
<p><code>signalM</code>ÂáΩÊï∞‰ºöÈÄöËøáË∞ÉÁî®Êìç‰ΩúÁ≥ªÁªü‰∏≠‰ø°Âè∑Áõ∏ÂÖ≥ÁöÑÁ≥ªÁªüË∞ÉÁî®ÔºåÂ∞ÜÊåáÂÆö‰ø°Âè∑ÂèëÈÄÅÁªôÁõÆÊ†áÁ∫øÁ®ã„ÄÇ‰ø°Âè∑ÂèëÂá∫Âéª‰∫ÜÔºåÂºÇÊ≠•Êä¢Âç†ÁöÑ<strong>Ââç‰∏ÄÂçäÂ∑•‰Ωú</strong>Â∞±ÁÆóÊòØÂÆåÊàê‰∫Ü„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230105171254392.png" alt="image-20230105171254392" style="zoom: 33%;" />
<h5 id="‰ø°Âè∑Â§ÑÁêÜ">‰ø°Âè∑Â§ÑÁêÜ</h5>
<p>Âêé‰∏ÄÂçäÂ∑•‰ΩúÂ∞±Ë¶ÅÁî±Êé•Êî∂Âà∞‰ø°Âè∑ÁöÑÂ∑•‰ΩúÁ∫øÁ®ãÊù•ÂÆåÊàê‰∫Ü„ÄÇ</p>
<p>Á∫øÁ®ãÊé•Êî∂Âà∞‰ø°Âè∑ÂêéÔºå‰ºöË∞ÉÁî®ÂØπÂ∫îÁöÑ‰ø°Âè∑<code>handler</code>Êù•Â§ÑÁêÜÔºåGo ËØ≠Ë®Ä‰∏≠ÁöÑ‰ø°Âè∑‰∫§Áî±<code>runtime.sighandler</code>Êù•Â§ÑÁêÜÔºå<code>sighandler</code>Âú®Á°ÆÂÆö‰ø°Âè∑‰∏∫<code>sigPreempt</code>‰ª•ÂêéÔºå‰ºöË∞ÉÁî®<code>doSigPreempt</code>ÂáΩÊï∞„ÄÇ<strong>ÂÆÉ‰ºöÈ¶ñÂÖàÂà§Êñ≠<code>runtime</code>ÊòØÂê¶Ë¶ÅÂØπÊåáÂÆöÁöÑ<code>G</code>ËøõË°åÂºÇÊ≠•Êä¢Âç†</strong>ÔºåÈÄöËøá‰ªÄ‰πàÊù•Âà§Êñ≠Âë¢Ôºü</p>
<p>È¶ñÂÖàÔºåÊåáÂÆöÁöÑ<code>G</code>‰∏éÂÖ∂ÂØπÂ∫î<code>P</code>ÁöÑ<code>preempt</code>Â≠óÊÆµÈÉΩË¶Å‰∏∫<code>true</code>ÔºåËÄå‰∏îÊåáÂÆöÁöÑ<code>G</code>ËøòË¶ÅÂ§ÑÂú®<code>_Grunning</code>Áä∂ÊÄÅÔºåËøòË¶Å<strong>Á°ÆËÆ§Âú®ÂΩìÂâç‰ΩçÁΩÆÊâìÊñ≠<code>G</code>Âπ∂ÊâßË°åÊä¢Âç†ÊòØÂÆâÂÖ®ÁöÑ</strong>ÔºåÈÇ£‰πàÊÄé‰πàÁ°Æ‰øùÂÆâÂÖ®ÊÄßÂë¢Ôºü</p>
<ul>
<li>ÊåáÂÆöÁöÑ<code>G</code>ÂèØ‰ª•ÊåÇËµ∑Âπ∂ÂÆâÂÖ®ÁöÑÊâ´ÊèèÂÆÉÁöÑÊ†àÂíåÂØÑÂ≠òÂô®ÔºåÂπ∂‰∏îÂΩìÂâçË¢´ÊâìÊñ≠ÁöÑ‰ΩçÁΩÆÂπ∂Ê≤°ÊúâÊâìÊñ≠ÂÜôÂ±èÈöúÔºõ</li>
<li>ÊåáÂÆöÁöÑ<code>G</code>ËøòÊúâË∂≥Â§üÁöÑÊ†àÁ©∫Èó¥Êù•Ê≥®ÂÖ•‰∏Ä‰∏™ÂºÇÊ≠•Êä¢Âç†ÂáΩÊï∞Ë∞ÉÁî®(<code>asyncPreempt</code>)Ôºõ</li>
<li>ËøôÈáåÂèØ‰ª•ÂÆâÂÖ®ÁöÑÂíå<code>runtime</code>ËøõË°å‰∫§‰∫íÔºå‰∏ªË¶ÅÂ∞±ÊòØÁ°ÆÂÆöÂΩìÂâçÂπ∂Ê≤°ÊúâÊåÅÊúâ<code>runtime</code>Áõ∏ÂÖ≥ÁöÑÈîÅÔºåÁªßËÄå‰∏ç‰ºöÂú®ÂêéÁª≠Â∞ùËØïËé∑ÂæóÈîÅÊó∂ÂèëÁîüÊ≠ªÈîÅ„ÄÇ</li>
</ul>
<p><strong>Á°ÆËÆ§‰∫ÜË¶ÅÊä¢Âç†Ëøô‰∏™<code>G</code>ÔºåÂπ∂‰∏îÊ≠§Êó∂Êä¢Âç†ÊòØÂÆâÂÖ®ÁöÑ</strong>‰ª•ÂêéÔºåÂ∞±ÂèØ‰ª•ÊîæÂøÉÁöÑÈÄöËøá<code>pushCall</code>Âêë<code>G</code>ÁöÑÊâßË°å‰∏ä‰∏ãÊñá‰∏≠Ê≥®ÂÖ•ÂºÇÊ≠•Êä¢Âç†ÂáΩÊï∞Ë∞ÉÁî®‰∫ÜÔºåË¢´Ê≥®ÂÖ•ÁöÑÂºÇÊ≠•Êä¢Âç†ÂáΩÊï∞(<code>asyncPreempt</code>)ÊòØ‰∏Ä‰∏™Ê±áÁºñÂáΩÊï∞ÔºåÂÆÉ‰ºöÂÖàÊääÂêÑ‰∏™ÂØÑÂ≠òÂô®ÁöÑÂÄº‰øùÂ≠òÂú®Ê†à‰∏äÔºå‰πüÂ∞±ÊòØÂÖà‰øùÂ≠òÁé∞Âú∫Âà∞Ê†à‰∏äÔºåÁÑ∂ÂêéË∞ÉÁî®<code>runtime.asyncPreempt2</code>ÂáΩÊï∞ÔºåËøô‰∏™ÂáΩÊï∞ÊúÄÁªà‰ºöÂéªÊâßË°å<code>schedule()</code>ÔºåÂà∞ËøôÈáåÔºåÂºÇÊ≠•Êä¢Âç†Â∞±ÂÆåÊàê‰∫Ü„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230105172607879.png" alt="image-20230105172607879" style="zoom: 33%;" />
<p>ÂÜçÂéªÊâßË°å‰∏äËæπÁöÑÁ§∫‰æãÁ®ãÂ∫èÔºåÂèëÁé∞ÂèØ‰ª•Ê≠£Â∏∏ËøêË°å„ÄÇ‰πüÂ∞±ÊòØËØ¥ÔºåÂç≥‰ΩøÁ©∫ÁöÑ<code>forÂæ™ÁéØ</code>Ê≤°ÊúâË¢´ÊèíÂÖ•Ê†àÂ¢ûÈïøÊ£ÄÊµã‰ª£Á†ÅÔºåÂú® 1.14 ‰∏≠ÔºåÈÄöËøáÊ≥®ÂÖ•ÂºÇÊ≠•ÂõûË∞ÉÂáΩÊï∞ÁöÑÊñπÂºèÔºåÂêåÊ†∑ËÉΩÂÆûÁé∞Êä¢Âç†ÂºèË∞ÉÂ∫¶„ÄÇ</p>
<h3 id="215-channel">2.1.5 Channel</h3>
<h4 id="2151-Êï∞ÊçÆÁªìÊûÑ">2.1.5.1 Êï∞ÊçÆÁªìÊûÑ</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">hchan</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">qcount</span>   <span class="kt">uint</span>
</span></span><span class="line"><span class="cl">	<span class="nx">dataqsiz</span> <span class="kt">uint</span>
</span></span><span class="line"><span class="cl">	<span class="nx">buf</span>      <span class="nx">unsafe</span><span class="p">.</span><span class="nx">Pointer</span>
</span></span><span class="line"><span class="cl">	<span class="nx">elemsize</span> <span class="kt">uint16</span>
</span></span><span class="line"><span class="cl">	<span class="nx">closed</span>   <span class="kt">uint32</span>
</span></span><span class="line"><span class="cl">	<span class="nx">elemtype</span> <span class="o">*</span><span class="nx">_type</span>
</span></span><span class="line"><span class="cl">	<span class="nx">sendx</span>    <span class="kt">uint</span>
</span></span><span class="line"><span class="cl">	<span class="nx">recvx</span>    <span class="kt">uint</span>
</span></span><span class="line"><span class="cl">	<span class="nx">recvq</span>    <span class="nx">waitq</span>
</span></span><span class="line"><span class="cl">	<span class="nx">sendq</span>    <span class="nx">waitq</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">lock</span> <span class="nx">mutex</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<h4 id="ÈóÆchannelÂ∫ïÂ±ÇÊï∞ÊçÆÁªìÊûÑÊòØÊÄé‰πàËÆæËÆ°ÁöÑ">ÈóÆÔºö<code>channel</code>Â∫ïÂ±ÇÊï∞ÊçÆÁªìÊûÑÊòØÊÄé‰πàËÆæËÆ°ÁöÑÔºü</h4>
</blockquote>
<p>ÈÄöËøá<code>make</code>ÂàõÂª∫‰∏Ä‰∏™ÁºìÂÜ≤Âå∫Â§ßÂ∞è‰∏∫<code>5</code>ÔºåÂÖÉÁ¥†Á±ªÂûã‰∏∫<code>int</code>ÁöÑ<code>channel</code>Ôºå<code>ch</code>ÊòØÂ≠òÂú®‰∫éÂáΩÊï∞Ê†àÂ∏ß‰∏äÁöÑ‰∏Ä‰∏™ÊåáÈíàÔºåÊåáÂêëÂ†Ü‰∏äÁöÑ<code>hchan</code>Êï∞ÊçÆÁªìÊûÑ„ÄÇ</p>
<ul>
<li>Âõ†‰∏∫<code>channel</code>ÊîØÊåÅÂçèÁ®ãÈó¥Âπ∂ÂèëËÆøÈóÆÔºåÊâÄ‰ª•Ë¶ÅÊúâ‰∏ÄÊääÈîÅ<code>lock</code>Êù•‰øùÊä§Êï¥‰∏™Êï∞ÊçÆÁªìÊûÑ„ÄÇ</li>
<li>ÂØπ‰∫éÊúâÁºìÂÜ≤Êù•ËÆ≤ÔºåÈúÄË¶ÅÁü•ÈÅìÁºìÂÜ≤Âå∫Âú®Âì™ÔºåÂ∑≤ÁªèÂ≠òÂÇ®‰∫ÜÂ§öÂ∞ë‰∏™ÂÖÉÁ¥†ÔºåÊúÄÂ§öÂ≠òÂÇ®Â§öÂ∞ë‰∏™ÂÖÉÁ¥†ÔºåÊØè‰∏™ÂÖÉÁ¥†Âç†Â§öÂ§ßÁ©∫Èó¥ÔºåÊâÄ‰ª•ÂÆûÈôÖ‰∏äÔºåÁºìÂÜ≤Âå∫Â∞±ÊòØ‰∏™Êï∞ÁªÑ<code>buf</code>„ÄÅ<code>elemsize</code>„ÄÇ</li>
<li>Âõ†‰∏∫ Go ËøêË°å‰∏≠ÔºåÂÜÖÂ≠òÂ§çÂà∂„ÄÅÂûÉÂúæÂõûÊî∂Á≠âÊú∫Âà∂‰æùËµñÊï∞ÊçÆÁöÑÁ±ªÂûã‰ø°ÊÅØÔºåÊâÄ‰ª•<code>hchan</code>ËøòË¶ÅÊúâ‰∏Ä‰∏™ÊåáÈíàÔºåÊåáÂêëÂÖÉÁ¥†Á±ªÂûãÁöÑÁ±ªÂûãÂÖÉÊï∞ÊçÆ<code>elemtype</code>„ÄÇ</li>
<li>Ê≠§Â§ñÔºå<code>channel</code>ÊîØÊåÅ‰∫§ÊõøÁöÑËØª(Êé•Êî∂)ÂÜô(ÂèëÈÄÅ)ÔºåÈúÄË¶ÅÂàÜÂà´ËÆ∞ÂΩïËØª„ÄÅÂÜô‰∏ãÊ†áÁöÑ‰ΩçÁΩÆ<code>recvx</code>„ÄÅ<code>sendx</code>„ÄÇ</li>
<li>ÂΩìËØªÂíåÂÜô‰∏çËÉΩÁ´ãÂç≥ÂÆåÊàêÊó∂ÔºåÈúÄË¶ÅËÉΩÂ§üËÆ©ÂΩìÂâçÂçèÁ®ãÂú®<code>channel</code>‰∏äÁ≠âÂæÖÔºåÂæÖÂà∞Êù°‰ª∂Êª°Ë∂≥Êó∂ÔºåË¶ÅËÉΩÂ§üÁ´ãÂç≥Âî§ÈÜíÁ≠âÂæÖÁöÑÂçèÁ®ãÔºåÊâÄ‰ª•Ë¶ÅÊúâ‰∏§‰∏™Á≠âÂæÖÈòüÂàóÔºåÂàÜÂà´ÈíàÂØπËØª(Êé•Êî∂)ÂíåÂÜô(ÂèëÈÄÅ)<code>recvq</code>„ÄÅ<code>sendq</code>„ÄÇ</li>
<li>Ê≠§Â§ñÔºå<code>channel</code>ËÉΩÂ§ü<code>close</code>ÔºåÊâÄ‰ª•ËøòË¶ÅËÆ∞ÂΩïÂÆÉÁöÑÂÖ≥Èó≠Áä∂ÊÄÅ<code>closed</code>„ÄÇ</li>
</ul>
<p>Áªº‰∏äÊâÄËø∞Ôºå<code>channel</code>Â∫ïÂ±ÇÂ∞±ÈïøËøô‰∏™Ê†∑Â≠êÔºö</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230109162653598.png" alt="image-20230109162653598" style="zoom:50%;" />
<p>ÂàùÂßãÁä∂ÊÄÅ‰∏ãÔºå<code>ch</code>ÁöÑÁºìÂÜ≤Âå∫‰∏∫Á©∫ÔºåËØª„ÄÅÂÜô‰∏ãÊ†áÈÉΩÊåáÂêë‰∏ãÊ†á<code>0</code>ÁöÑ‰ΩçÁΩÆÔºåÁ≠âÂæÖÈòüÂàó‰πüÈÉΩ‰∏∫Á©∫„ÄÇÁÑ∂ÂêéÔºå‰∏Ä‰∏™ÂçèÁ®ã<code>g1</code>Âêë<code>ch</code>ÂèëÈÄÅÊï∞ÊçÆ[1,5]ÔºåÊ≠§Êó∂ÁºìÂÜ≤Âå∫Â∑≤Êª°ÔºåËã•ËøòË¶ÅÁªßÁª≠ÂèëÈÄÅÊï∞Â≠ó6Ôºå<code>g1</code>Â∞±‰ºöËøõÂà∞<code>ch</code>ÁöÑÂèëÈÄÅÁ≠âÂæÖÈòüÂàó‰∏≠„ÄÇËøôÊòØ‰∏Ä‰∏™<code>sudog</code>Á±ªÂûãÁöÑÈìæË°®ÔºåÈáåÈù¢‰ºöËÆ∞ÂΩïÂì™‰∏™ÂçèÁ®ãÂú®Á≠âÂæÖÔºåÁ≠âÂæÖÂì™‰∏™<code>channel</code>ÔºåÁ≠âÂæÖÂèëÈÄÅÁöÑÊï∞ÊçÆÂú®Âì™ÂÑøÁ≠â‰ø°ÊÅØ„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230109165507150.png" alt="image-20230109165507150" style="zoom:33%;" />
<p>Êé•‰∏ãÊù•ÂçèÁ®ã<code>g2</code>‰ªé<code>ch</code>Êé•Êî∂‰∏Ä‰∏™ÂÖÉÁ¥†Ôºå<code>recvx</code>ÊåáÂêë‰∏ã‰∏Ä‰∏™‰ΩçÁΩÆÔºåÁ¨¨0‰∏™‰ΩçÁΩÆÂ∞±Á©∫Âá∫Êù•‰∫ÜÔºåÊâÄ‰ª•‰ºöÂî§ÈÜí<code>sendq</code>‰∏≠ÁöÑ<code>g1</code>ÔºåÂ∞ÜËøôÈáåÁöÑÊï∞ÊçÆÂèëÈÄÅÁªô<code>ch</code>ÔºåÁÑ∂ÂêéÁºìÂÜ≤Âå∫ÂÜçÊ¨°Êª°‰∫ÜÔºå<code>sendq</code>ÈòüÂàó‰∏∫Á©∫„ÄÇ</p>
<p>Ëøô‰∏™ËøáÁ®ã‰∏≠Ôºå<code>sendx</code>Âíå<code>recvx</code>ÈÉΩ‰ºö‰ªé<code>0</code>Âà∞<code>4</code>ÂÜçÂà∞<code>0</code>ÔºåÂæ™ÁéØÁßªÂä®ÔºåÊâÄ‰ª•<code>channel</code>ÁöÑÁºìÂÜ≤Âå∫‰πüË¢´Áß∞‰∏∫<strong>ÁéØÂΩ¢ÁºìÂÜ≤Âå∫</strong>„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230109170332532.png" alt="image-20230109170332532" style="zoom:33%;" />
<h4 id="2152-ÂèëÈÄÅÊï∞ÊçÆ">2.1.5.2 ÂèëÈÄÅÊï∞ÊçÆ</h4>
<h5 id="ÈòªÂ°ûÂºèÂèëÈÄÅ">ÈòªÂ°ûÂºèÂèëÈÄÅ</h5>
<p>Â¶ÇÊûú‰ΩøÁî®‰ª•‰∏ãÊñπÂºèÁªô<code>channel</code>ÂèëÈÄÅÊï∞ÊçÆÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">ch</span> <span class="o">&lt;-</span> <span class="mi">10</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰∏çÈòªÂ°ûÁöÑÊÉÖÂÜµÔºö</p>
<ul>
<li>ÁºìÂÜ≤Âå∫ËøòÊúâÁ©∫Èó≤‰ΩçÁΩÆÔºõ</li>
<li>ÊúâÂçèÁ®ãÂú®Á≠âÁùÄÊé•Êî∂Êï∞ÊçÆÔºõ</li>
</ul>
<p>ÈòªÂ°ûÁöÑÊÉÖÂÜµÔºö</p>
<ul>
<li><code>ch</code>‰∏∫<code>nil</code>Ôºõ</li>
<li><code>ch</code>Ê≤°ÊúâÁºìÂÜ≤Âå∫ÔºåËÄå‰∏î‰πüÊ≤°ÊúâÂçèÁ®ãÁ≠âÁùÄÊé•Êî∂Êï∞ÊçÆÔºõ</li>
<li><code>ch</code>ÊúâÁºìÂÜ≤Âå∫Ôºå‰ΩÜÁºìÂÜ≤Âå∫Â∑≤Áî®Â∞Ω„ÄÇ</li>
</ul>
<h5 id="ÈùûÈòªÂ°ûÂºèÂèëÈÄÅ">ÈùûÈòªÂ°ûÂºèÂèëÈÄÅ</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="k">select</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">case</span> <span class="nx">ch</span> <span class="o">&lt;-</span> <span class="mi">10</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="k">default</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ëã•ÈááÁî®ËøôÁßçÂÜôÊ≥ïÔºåÂ¶ÇÊûúÊ£ÄÊµãÂà∞<code>ch</code>ÂèØ‰ª•ÂèëÈÄÅÊï∞ÊçÆÔºåÂ∞±‰ºöÊâßË°å<code>case</code>ÂàÜÊîØÔºõÂ¶ÇÊûú‰ºöÂèëÁîüÈòªÂ°ûÂ∞±ÊâßË°å<code>default</code>ÂàÜÊîØ„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230109210755580.png" alt="image-20230109210755580" style="zoom:33%;" />
<h4 id="2153-Êé•Êî∂Êï∞ÊçÆ">2.1.5.3 Êé•Êî∂Êï∞ÊçÆ</h4>
<h5 id="ÈòªÂ°ûÂºèÊé•Êî∂">ÈòªÂ°ûÂºèÊé•Êî∂</h5>
<p>‰ª•‰∏ãÊòØÊé•Êî∂Êï∞ÊçÆÁöÑ‰∏âÁßçÂÜôÊ≥ïÔºåÈÉΩÂÖÅËÆ∏ÂèëÁîüÈòªÂ°ûÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="o">&lt;-</span><span class="nx">ch</span>			<span class="c1">// 1. ‰∏¢ÂºÉÁªìÊûú
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">v</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">ch</span>		<span class="c1">// 2. Â∞ÜÁªìÊûúËµãÂÄºÁªôv
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">v</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">ch</span>	<span class="c1">// 3. comma okÈ£éÊ†ºÁöÑÂÜôÊ≥ïÔºåok‰∏∫falseË°®Á§∫chÂ∑≤ÂÖ≥Èó≠ÔºåÊ≠§Êó∂vÊòØchannelÂÖÉÁ¥†Á±ªÂûãÁöÑÈõ∂ÂÄº
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>‰∏çÈòªÂ°ûÁöÑÊÉÖÂÜµÔºö</p>
<ul>
<li>Âú®ÁºìÂÜ≤Âå∫‰∏≠ÊúâÊï∞ÊçÆÔºõ</li>
<li>ÊúâÂçèÁ®ãÁ≠âÁùÄÂèëÈÄÅÊï∞ÊçÆÔºõ</li>
</ul>
<p>ÈòªÂ°ûÁöÑÊÉÖÂÜµÔºö</p>
<ul>
<li><code>ch</code>‰∏∫<code>nil</code>Ôºõ</li>
<li><code>ch</code>Êó†ÁºìÂÜ≤ËÄå‰∏îÊ≤°ÊúâÂçèÁ®ãÁ≠âÁùÄÂèëÈÄÅÊï∞ÊçÆÔºõ</li>
<li><code>ch</code>ÊúâÁºìÂÜ≤‰ΩÜÁºìÂÜ≤Âå∫Êó†Êï∞ÊçÆÔºõ</li>
</ul>
<h5 id="ÈùûÈòªÂ°ûÂºèÊé•Êî∂">ÈùûÈòªÂ°ûÂºèÊé•Êî∂</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="k">select</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">case</span> <span class="o">&lt;-</span><span class="nx">ch</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="k">default</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ëã•ÈááÁî®ÈùûÈòªÂ°ûÂºèÊé•Êî∂ÊñπÂºèÔºåÂ¶ÇÊûúÊ£ÄÊµãÂà∞<code>ch</code>ÁöÑ<code>recv</code>Êìç‰Ωú‰∏ç‰ºöÈòªÂ°ûÊó∂ÔºåÂ∞±‰ºöÊâßË°å<code>case</code>ÂàÜÊîØÔºõÂ¶ÇÊûú‰ºöÈòªÂ°ûÂ∞±‰ºöÊâßË°å<code>default</code>ÂàÜÊîØ„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230109210714175.png" alt="image-20230109210714175" style="zoom:50%;" />
<hr>
<h4 id="2154-Â§öË∑Øselect">2.1.5.4 Â§öË∑Øselect</h4>
<p>‰∏äÈù¢ÁöÑ<code>select</code>Âè™ÊòØÈíàÂØπÂçï‰∏™<code>channel</code>ÁöÑÊìç‰Ωú„ÄÇ<strong>Â§öË∑Ø<code>select</code><strong>ÊòØÊåáÂ≠òÂú®</strong>‰∏§‰∏™ÊàñÊõ¥Â§ö</strong>ÁöÑ<code>case</code>ÂàÜÊîØÔºåÊØè‰∏™ÂàÜÊîØÂèØ‰ª•ÊòØ‰∏Ä‰∏™<code>channel</code>ÁöÑ<code>send</code>Êàñ<code>recv</code>Êìç‰Ωú„ÄÇ</p>
<p>‰æãÂ¶Ç‰∏Ä‰∏™ÂçèÁ®ãÈÄöËøáÂ§öË∑Ø<code>select</code>Á≠âÂæÖ<code>ch1</code>Âíå<code>ch2</code>ÔºåËøôÈáå<code>default</code>ÂàÜÊîØÊòØÂèØÈÄâÁöÑÔºåÊöÇ‰∏îÊääËøô‰∏™ÂçèÁ®ãËÆ∞‰∏∫<code>g1</code>„ÄÇ</p>
<p>Â§öË∑Ø<code>select</code>‰ºöË¢´ÁºñËØëÂô®ËΩ¨Êç¢‰∏∫ÂØπ<code>runtime.selectgo</code>ÂáΩÊï∞Ë∞ÉÁî®ÔºåÈ¶ñÂÖàÁúã<strong>ÂèÇÊï∞</strong>Ôºö</p>
<ul>
<li>Á¨¨‰∏Ä‰∏™ÂèÇÊï∞<code>cas0</code>ÊåáÂêë‰∏Ä‰∏™Êï∞ÁªÑÔºåÊï∞ÁªÑÈáåË£ÖÁöÑÊòØ<code>select</code>‰∏≠ÊâÄÊúâÁöÑ<code>case</code>ÂàÜÊîØÔºåÈ°∫Â∫èÊòØ<code>send</code>Âú®Ââç<code>recv</code>Âú®ÂêéÔºõ</li>
<li>Á¨¨‰∫å‰∏™ÂèÇÊï∞<code>order0</code>ÊåáÂêë‰∏Ä‰∏™<code>uint16</code>Á±ªÂûãÁöÑÊï∞ÁªÑÔºåÊï∞ÁªÑÂ§ßÂ∞èÁ≠â‰∫é<code>case</code>ÂàÜÊîØÁöÑ2ÂÄçÔºåÂÆûÈôÖ‰∏äË¢´Áî®‰Ωú‰∏§‰∏™Êï∞ÁªÑÔºöÁ¨¨‰∏Ä‰∏™Êï∞ÁªÑÁî®Êù•ÂØπÊâÄÊúâ<code>channel</code>ÁöÑËΩÆËØ¢ËøõË°å‰π±Â∫èÔºåÁ¨¨‰∫å‰∏™Êï∞ÁªÑÁî®Êù•ÂØπÊâÄÊúâÁöÑ<code>channel</code>ÁöÑÂä†ÈîÅÊìç‰ΩúËøõË°åÊéíÂ∫è„ÄÇ<strong>ËΩÆËØ¢ÈúÄË¶Å‰π±Â∫èÊâçËÉΩ‰øùÈöúÂÖ¨Âπ≥ÊÄßÔºåËÄåÊåâÁÖßÂõ∫ÂÆöÁÆóÊ≥ïÁ°ÆÂÆöÂä†ÈîÅÈ°∫Â∫èÊâçËÉΩÈÅøÂÖçÊ≠ªÈîÅ</strong>Ôºõ</li>
<li>Á¨¨‰∏â‰∏™ÂèÇÊï∞<code>pc0</code>Âíå<code>race</code>Ê£ÄÊµãÁõ∏ÂÖ≥Ôºõ</li>
<li><code>nsends</code>Âíå<code>nrecvs</code>ÂàÜÂà´Ë°®Á§∫ÊâÄÊúâ<code>case</code>‰∏≠ÔºåÊâßË°å<code>send</code>Âíå<code>recv</code>Êìç‰ΩúÁöÑÂàÜÊîØÂàÜÂà´ÊúâÂ§öÂ∞ë‰∏™„ÄÇ</li>
<li><code>block</code>Ë°®Á§∫Â§öË∑Ø<code>select</code>ÊòØÂê¶Ë¶ÅÈòªÂ°ûÁ≠âÂæÖ„ÄÇÂØπÂ∫îÂà∞‰ª£Á†Å‰∏≠ÔºåÂ∞±ÊòØÊúâ<code>default</code>ÂàÜÊîØÁöÑ‰∏ç‰ºöË¢´ÈòªÂ°ûÔºåÊ≤°ÊúâÁöÑ‰ºöÈòªÂ°û„ÄÇ</li>
</ul>
<p>ÂÜçÁúã<strong>ËøîÂõûÂÄº</strong>Ôºö</p>
<ul>
<li>Á¨¨‰∏Ä‰∏™ËøîÂõûÂÄº<code>int</code>Á±ªÂûãÔºå‰ª£Ë°®ÊúÄÁªàÂì™‰∏™<code>case</code>ÂàÜÊîØË¢´ÊâßË°å‰∫ÜÔºåÂØπÂ∫îÂà∞<code>cas0</code>ÊåáÂêëÁöÑÊï∞ÁªÑ‰∏ãÊ†á„ÄÇ‰ΩÜÊòØÂ¶ÇÊûúËøõÂÖ•Âà∞<code>default</code>ÂàÜÊîØÔºåÂ∞±‰ºöÂØπÂ∫î<code>-1</code>„ÄÇ</li>
<li>Á¨¨‰∫å‰∏™ËøîÂõûÂÄº<code>bool</code>Á±ªÂûãÔºåÁî®‰∫éÂú®ÊâßË°å<code>recv</code>Êìç‰ΩúÁöÑ<code>case</code>ÂàÜÊîØÊó∂ÔºåË°®ÊòéÊòØÂÆûÈôÖÊé•Êî∂Âà∞‰∫Ü‰∏Ä‰∏™ÂÄºÔºåËøòÊòØÂõ†<code>channel</code>ÂÖ≥Èó≠ËÄåÂæóÂà∞‰∫ÜÈõ∂ÂÄº„ÄÇ</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230109213648426.png" alt="image-20230109213648426" style="zoom:33%;" />
<ul>
<li>
<p>Â§öË∑Ø<code>select</code>ÈúÄË¶ÅËøõË°å<strong>ËΩÆËØ¢</strong>Êù•Á°ÆÂÆöÂì™‰∏™<code>case</code>ÂàÜÊîØÂèØÊìç‰Ωú‰∫ÜÔºå‰ΩÜÊòØËΩÆËØ¢ÂâçÈúÄË¶ÅÂÖàÂä†ÈîÅÔºåÊâÄ‰ª•<code>selectgo</code>ÂáΩÊï∞ÊâßË°åÊó∂Ôºå‰ºöÂÖàÊåâÁÖßÊúâÂ∫èÁöÑ<strong>Âä†ÈîÅ</strong>È°∫Â∫èÔºåÂØπÊâÄÊúâÁöÑ<code>channel</code>Âä†ÈîÅÔºõ</p>
</li>
<li>
<p>ÁÑ∂ÂêéÊåâÁÖß<strong>‰π±Â∫èÁöÑËΩÆËØ¢</strong>È°∫Â∫èÊ£ÄÊü•ÊâÄÊúâ<code>channel</code>ÁöÑÁ≠âÂæÖÈòüÂàóÂíåÁºìÂÜ≤Âå∫Ôºõ</p>
</li>
<li>
<p>ÂÅáÂ¶Ç<strong>Ê£ÄÊü•</strong>Âà∞<code>ch1</code>Êó∂ÔºåÂèëÁé∞ÊúâÊï∞ÊçÆÂèØËØªÔºåÈÇ£Â∞±<strong>Áõ¥Êé•Êã∑Ë¥ùÊï∞ÊçÆÔºåËøõÂÖ•ÂØπÂ∫îÂàÜÊîØ</strong>Ôºõ</p>
</li>
<li>
<p>ÂÅáÂ¶ÇÊâÄÊúâÁöÑ<code>channel</code>ÈÉΩ‰∏çÂèØÊìç‰ΩúÔºåÂ∞±<strong>ÊääÂΩìÂâçÂçèÁ®ãÊ∑ªÂä†Âà∞ÊâÄÊúâ<code>channel</code>ÁöÑ<code>sendq</code>Êàñ<code>recvq</code>‰∏≠</strong>ÔºåÂØπÂ∫îËøô‰∏™‰æãÂ≠êÔºå<code>g1</code>‰ºöË¢´Ê∑ªÂä†Âà∞<code>ch1</code>ÁöÑ<code>recvq</code>Âèä<code>ch2</code>ÁöÑ<code>sendq</code>‰∏≠Ôºå‰πãÂêé<code>g1</code>‰ºöË¢´<strong>ÊåÇËµ∑</strong>ÔºåÂπ∂<strong>Ëß£ÈîÅ</strong>ÊâÄÊúâÁöÑ<code>channel</code>Ôºõ</p>
</li>
<li>
<p>ÂÅáÂ¶ÇÊé•‰∏ãÊù•<code>ch1</code>ÊúâÊï∞ÊçÆÂèØËØª‰∫ÜÔºå<code>g1</code>Â∞±‰ºöË¢´<strong>Âî§ÈÜí</strong>ÔºåÂÆåÊàêÂØπÂ∫îÁöÑÂàÜÊîØÊìç‰ΩúÂêéÔºå‰ºöÂÜçÊ¨°ÊåâÁÖßÂä†ÈîÅÈ°∫Â∫èÂØπÊâÄÊúâ<code>channel</code><strong>Âä†ÈîÅ</strong>ÔºåÁÑ∂Âêé‰ªéÊâÄÊúâÁöÑ<code>sendq</code>Êàñ<code>recvq</code>‰∏≠Â∞ÜËá™Â∑±<strong>ÁßªÈô§</strong>Ôºõ</p>
</li>
<li>
<p>ÊúÄÂêéÂÖ®ÈÉ®<strong>Ëß£ÈîÅ</strong>ÂêéËøîÂõû„ÄÇ</p>
</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230109214411461.png" alt="image-20230109214411461" style="zoom:33%;" />
<hr>
<p>ËôΩÁÑ∂Ôºå<code>channel</code>ÁöÑËØªÂÜôÊìç‰ΩúÂÜôÊ≥ï‰ºóÂ§öÔºå‰ΩÜ‰∫ãÂÆû‰∏äÔºå<code>channel</code><strong>ÈòªÂ°ûÂºèÁöÑ<code>send</code>Êìç‰Ωú</strong>‰ºöË¢´ÁºñËØëÂô®ËΩ¨Êç¢‰∏∫<strong>ÂØπ<code>runtime.chansend1()</code>ÁöÑË∞ÉÁî®</strong>ÔºåËÄåÂÆÉ<strong>ÂÜÖÈÉ®Âè™ÊòØË∞ÉÁî®‰∫Ü<code>runtime.chansend()</code></strong>Ôºõ<strong>ÈùûÈòªÂ°ûÂºèÁöÑ<code>send</code>Êìç‰Ωú</strong>‰ºöË¢´ÁºñËØëÂô®ËΩ¨Êç¢‰∏∫<strong>ÂØπ<code>runtime.selectnbsend()</code>ÁöÑË∞ÉÁî®</strong>ÔºåÂÆÉ‰πü‰ªÖ‰ªÖÊòØ<strong>Ë∞ÉÁî®‰∫Ü<code>runtime.chansend()</code></strong>„ÄÇÊâÄ‰ª•Ôºå<strong><code>send</code>Êìç‰Ωú‰∏ªË¶ÅÊòØÈÄöËøá<code>runtime.chansend()</code>ÂáΩÊï∞ÂÆûÁé∞ÁöÑ„ÄÇ</strong></p>
<p>ÂêåÊ†∑ÁöÑÔºå<strong><code>channel</code>ÈòªÂ°ûÂºèÁöÑ<code>recv</code>Êìç‰Ωú</strong>‰ºöË¢´ÁºñËØëÂô®ËΩ¨Êç¢‰∏∫<strong>ÂØπ<code>runtime.chanrecv1()</code>ÁöÑË∞ÉÁî®</strong>ÔºåËÄåÂÆÉ<strong>ÂÜÖÈÉ®Âè™ÊòØË∞ÉÁî®‰∫Ü<code>runtime.chanrecv()</code></strong>Ôºõ<strong><code>comma ok</code>È£éÊ†ºÁöÑÂÜôÊ≥ï</strong>‰ºöË¢´ÁºñËØëÂô®ËΩ¨Êç¢‰∏∫<strong>ÂØπ<code>runtime.chanrecv2()</code>ÁöÑË∞ÉÁî®</strong>ÔºåÂÆÉÁöÑ<strong>ÂÜÖÈÉ®‰πüÊòØË∞ÉÁî®<code>runtime.chanrecv()</code></strong>Ôºå<strong>Âè™‰∏çËøáÊØî<code>chanrecv1()</code>Â§ö‰∫Ü‰∏Ä‰∏™ËøîÂõûÂÄº</strong>Ôºõ<strong>ÈùûÈòªÂ°ûÂºèÁöÑ<code>recv</code>Êìç‰Ωú</strong>‰ºöÊ†πÊçÆÊòØÂê¶‰∏∫<code>comma ok</code>È£éÊ†ºÔºåË¢´ÁºñËØëÂô®ËΩ¨Êç¢‰∏∫<strong>ÂØπ<code>runtime.selectnbrecv()</code>Êàñ<code>selectnbrecv2()</code>ÁöÑË∞ÉÁî®</strong>ÔºåËÄåÂÆÉ‰ª¨‰∏§‰∏™‰πü‰ªÖ‰ªÖÊòØ<strong>Ë∞ÉÁî®‰∫Ü<code>runtime.chanrecv()</code></strong>ÔºåÊâÄ‰ª•Ôºå<strong><code>recv</code>Êìç‰Ωú‰∏ªË¶ÅÊòØÈÄöËøá<code>runtime.chanrecv()</code>ÂáΩÊï∞ÂÆûÁé∞ÁöÑ„ÄÇ</strong></p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230109215407705.png" alt="image-20230109215407705" style="zoom:50%;" />
<h3 id="216-ÂçèÁ®ã">2.1.6 ÂçèÁ®ã</h3>
<h2 id="22-ÂÜÖÂ≠òÁÆ°ÁêÜ">2.2 ÂÜÖÂ≠òÁÆ°ÁêÜ</h2>
<h3 id="221-ÂÜÖÂ≠òÂàÜÈÖçÂô®">2.2.1 ÂÜÖÂ≠òÂàÜÈÖçÂô®</h3>
<p>Á®ãÂ∫è‰∏≠ÁöÑÊï∞ÊçÆÂíåÂèòÈáèÈÉΩ‰ºöË¢´ÂàÜÈÖçÂà∞Á®ãÂ∫èÊâÄÂú®ÁöÑËôöÊãüÂÜÖÂ≠ò‰∏≠ÔºåÂÜÖÂ≠òÁ©∫Èó¥ÂåÖÂê´‰∏§‰∏™ÈáçË¶ÅÂå∫ÂüüÔºö<strong>Ê†àÂå∫ÔºàStackÔºâÂíåÂ†ÜÂå∫ÔºàHeapÔºâ</strong>„ÄÇÂáΩÊï∞Ë∞ÉÁî®ÁöÑÂèÇÊï∞„ÄÅËøîÂõûÂÄº‰ª•ÂèäÂ±ÄÈÉ®ÂèòÈáèÂ§ßÈÉΩ‰ºöË¢´ÂàÜÈÖçÂà∞Ê†à‰∏äÔºåËøôÈÉ®ÂàÜÂÜÖÂ≠ò‰ºöÁî±ÁºñËØëÂô®ËøõË°åÁÆ°ÁêÜÔºõ‰∏çÂêåÁºñÁ®ãËØ≠Ë®Ä‰ΩøÁî®‰∏çÂêåÁöÑÊñπÊ≥ïÁÆ°ÁêÜÂ†ÜÂå∫ÁöÑÂÜÖÂ≠òÔºåC++ Á≠âÁºñÁ®ãËØ≠Ë®Ä‰ºöÁî±Â∑•Á®ãÂ∏à‰∏ªÂä®Áî≥ËØ∑ÂíåÈáäÊîæÂÜÖÂ≠òÔºåGo ‰ª•Âèä Java Á≠âÁºñÁ®ãËØ≠Ë®Ä‰ºöÁî±Â∑•Á®ãÂ∏àÂíåÁºñËØëÂô®ÂÖ±ÂêåÁÆ°ÁêÜÔºåÂ†Ü‰∏≠ÁöÑÂØπË±°Áî±ÂÜÖÂ≠òÂàÜÈÖçÂô®ÂàÜÈÖçÂπ∂Áî±ÂûÉÂúæÊî∂ÈõÜÂô®ÂõûÊî∂„ÄÇ</p>
<p>‰ªéËøõÁ®ãËôöÊãüÁ©∫Èó¥Âú∞ÂùÄÊù•ÁúãÔºö</p>
<ul>
<li>Á®ãÂ∫èË¶ÅÊâßË°åÁöÑÊåá‰ª§Âú®<strong>‰ª£Á†ÅÊÆµ</strong>Ôºõ</li>
<li>ÂÖ®Â±ÄÂèòÈáè„ÄÅÈùôÊÄÅÊï∞ÊçÆÁ≠âÈÉΩ‰ºöÂàÜÈÖçÂú®<strong>Êï∞ÊçÆÊÆµ</strong>Ôºõ</li>
<li>ÂáΩÊï∞ÁöÑÂ±ÄÈÉ®ÂèòÈáè„ÄÅÂèÇÊï∞ÂíåËøîÂõûÂÄºÈÉΩ‰ºöÂàÜÈÖçÂú®<strong>ÂáΩÊï∞Ê†àÂ∏ß</strong>Ôºõ</li>
</ul>
<h4 id="2211-ËÆæËÆ°ÂéüÁêÜ">2.2.1.1 ËÆæËÆ°ÂéüÁêÜ</h4>
<p>ÂÜÖÂ≠òÁÆ°ÁêÜ‰∏ÄËà¨ÂåÖÂê´‰∏â‰∏™‰∏çÂêåÁöÑÁªÑ‰ª∂ÔºåÂàÜÂà´ÊòØ<strong>Áî®Êà∑Á®ãÂ∫èÔºàMutatorÔºâ„ÄÅÂàÜÈÖçÂô®ÔºàAllocatorÔºâÂíåÊî∂ÈõÜÂô®ÔºàCollectorÔºâ</strong>ÔºåÂΩìÁî®Êà∑Á®ãÂ∫èÁî≥ËØ∑ÂÜÖÂ≠òÊó∂ÔºåÂÆÉ‰ºöÈÄöËøá<strong>ÂÜÖÂ≠òÂàÜÈÖçÂô®Áî≥ËØ∑Êñ∞ÂÜÖÂ≠ò</strong>ÔºåËÄåÂàÜÈÖçÂô®‰ºöË¥üË¥£‰ªéÂ†Ü‰∏≠ÂàùÂßãÂåñÁõ∏Â∫îÁöÑÂÜÖÂ≠òÂå∫Âüü„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221223151605383.png" alt="image-20221223151605383" style="zoom: 50%;" />
<h3 id="222-gc">2.2.2 GC</h3>
<p>‰ªéËøõÁ®ãËôöÊãüÁ©∫Èó¥Âú∞ÂùÄÊù•ÁúãÔºö</p>
<ul>
<li>Á®ãÂ∫èË¶ÅÊâßË°åÁöÑÊåá‰ª§Âú®<strong>‰ª£Á†ÅÊÆµ</strong>Ôºõ</li>
<li>Â∑≤ÂàùÂßãÂåñÁöÑÂÖ®Â±ÄÂèòÈáè„ÄÅÈùôÊÄÅÂ∏∏ÈáèÁ≠âÈÉΩ‰ºöÂàÜÈÖçÂú®**==Êï∞ÊçÆÊÆµ==**Ôºõ</li>
<li>Êú™ÂàùÂßãÂåñÁöÑÂÖ®Â±ÄÂèòÈáè„ÄÅÈùôÊÄÅÂ∏∏ÈáèÁ≠âÈÉΩ‰ºöÂàÜÈÖçÂú®**==BSSÊÆµ==**Ôºõ</li>
<li>ÂáΩÊï∞ÁöÑÂ±ÄÈÉ®ÂèòÈáè„ÄÅÂèÇÊï∞ÂíåËøîÂõûÂÄºÈÉΩ‰ºöÂàÜÈÖçÂú®**==ÂáΩÊï∞Ê†àÂ∏ß==**Ôºõ</li>
</ul>
<p><strong>==PointÔºö==</strong></p>
<p>Áî±‰∫éÂáΩÊï∞Ë∞ÉÁî®Ê†à‰ºöÂú®ÂáΩÊï∞ËøîÂõûÂêéÈîÄÊØÅÔºåÂõ†Ê≠§ÔºåÂ¶ÇÊûú<strong>‰∏çËÉΩÂú®ÁºñËØëÈò∂ÊÆµÁ°ÆÂÆöÊï∞ÊçÆÂØπË±°ÁöÑÂ§ßÂ∞è</strong>ÔºåÊàñËÄÖÂØπË±°<strong>ÁîüÂëΩÂë®Êúü‰ºöË∂ÖËøáÂΩìÂâçÊâÄÂú®ÂáΩÊï∞</strong>ÔºåÈÇ£‰πàÂ∞±<strong>‰∏çÈÄÇÂêàÂàÜÈÖçÂú®Ê†à‰∏ä</strong>ÔºåËÄåÂ∫îËØ•<strong>ÂàÜÈÖçÂà∞Â†Ü‰∏ä</strong>„ÄÇ</p>
<blockquote>
<h4 id="ÈóÆÈ¢ò‰∏∫‰ªÄ‰πàÈúÄË¶ÅÂûÉÂúæÂõûÊî∂"><strong>ÈóÆÈ¢òÔºö‰∏∫‰ªÄ‰πàÈúÄË¶ÅÂûÉÂúæÂõûÊî∂Ôºü</strong></h4>
</blockquote>
<p><strong>‰∏ªË¶ÅÊòØ‰∏∫‰∫ÜÈáäÊîæ==Â†ÜÂÜÖÂ≠ò==</strong>„ÄÇÈöèÁùÄÁ®ãÂ∫èËøêË°åÔºåÊúâ‰∫õÊï∞ÊçÆ‰∏ç‰ºöÂÜçË¢´Áî®Âà∞‰∫ÜÔºåÁõ¥Êé•ÂàÜÈÖçÂú®<strong>Ê†à‰∏äÁöÑÊï∞ÊçÆ</strong>Ôºå<strong>‰ºöÈöèÁùÄÂáΩÊï∞Ë∞ÉÁî®Ê†àÁöÑÈîÄÊØÅÈáäÊîæËá™Ë∫´Âç†Áî®ÁöÑÂÜÖÂ≠ò</strong>Ôºõ‰ΩÜÊòØÂàÜÈÖçÂú®<strong>Â†Ü‰∏äÁöÑÊï∞ÊçÆ</strong>ÔºåÂÆÉ‰ª¨Âç†Áî®ÁöÑÂÜÖÂ≠òÈúÄË¶ÅÁ®ãÂ∫è<strong>‰∏ªÂä®ÈáäÊîæ</strong>ÊâçÂèØ‰ª•ÈáçÊñ∞‰ΩøÁî®ÔºåÂê¶ÂàôÂ∞±‰ºöÊàê‰∏∫<strong>ÂûÉÂúæ</strong>ÔºåËÄåË∂äÁßØË∂äÂ§öÁöÑÂûÉÂúæ‰ºö‰∏çÊñ≠ÁöÑÊ∂àËÄóÁ≥ªÁªüÂÜÖÂ≠ò„ÄÇ</p>
<hr>
<p>ÂûÉÂúæÂõûÊî∂ÊúâÂá†ÁßçÂ∏∏ËßÅÊñπÂºèÔºö</p>
<ul>
<li><strong>ÊâãÂä®ÂûÉÂúæÂõûÊî∂ÔºöC„ÄÅC++„ÄÅRust„ÄÇ<strong>‰∏ÄÊó¶ÈáäÊîæÊó©‰∫ÜÔºåÂêéÁª≠ÂØπËØ•Êï∞ÊçÆÁöÑËÆøÈóÆ‰æø‰ºöÂá∫ÈîôÔºåËøôÂ∞±ÊòØÊâÄË∞ì</strong>&ldquo;ÊÇ¨ÊåÇÊåáÈíà&rdquo;<strong>ÈóÆÈ¢òÔºõËÄåÂ¶ÇÊûúÂøò‰∫ÜÈáäÊîæÔºåÂÆÉÂèà‰ºö‰∏ÄÁõ¥Âç†Áî®ÂÜÖÂ≠òÔºåÂá∫Áé∞</strong>&ldquo;ÂÜÖÂ≠òÊ≥ÑÈú≤&rdquo;</strong>Ôºõ</li>
<li><strong>Ëá™Âä®ÂûÉÂúæÂõûÊî∂ÔºöPython„ÄÅRuby„ÄÅJava„ÄÅGo</strong>„ÄÇÁî±ËøêË°åÊó∂ËØÜÂà´‰∏çÂÜçÊúâÁî®ÁöÑÊï∞ÊçÆÂπ∂ÈáäÊîæ‰ªñ‰ª¨ÊâÄÂç†ÁöÑÂÜÖÂ≠òÔºåÂÜÖÂ≠ò‰ΩïÊó∂Ë¢´ÈáäÊîæÔºåË¢´ÈáäÊîæÁöÑÂÜÖÂ≠òÂ¶Ç‰ΩïÂ§ÑÁêÜÔºåÈÉΩ‰∏çÈúÄË¶ÅÊàë‰ª¨ÂÖ≥ÂøÉ„ÄÇ
<ul>
<li>Ë∑üË∏™ÂºèÂûÉÂúæÂõûÊî∂</li>
<li>ÂºïÁî®ËÆ°Êï∞ÂºèÂûÉÂúæÂõûÊî∂</li>
</ul>
</li>
</ul>
<h4 id="2221-ËÆæËÆ°ÂéüÁêÜ">2.2.2.1 ËÆæËÆ°ÂéüÁêÜ</h4>
<blockquote>
<h4 id="ÈóÆÈ¢òËá™Âä®ÂûÉÂúæÂõûÊî∂ÊÄé‰πàÂå∫ÂàÜÂì™‰∫õÊï∞ÊçÆÊòØÂûÉÂúæÂë¢"><strong>ÈóÆÈ¢òÔºöËá™Âä®ÂûÉÂúæÂõûÊî∂ÊÄé‰πàÂå∫ÂàÜÂì™‰∫õÊï∞ÊçÆÊòØÂûÉÂúæÂë¢Ôºü</strong></h4>
</blockquote>
<p>ÂèØ‰ª•Á°ÆÂÆöÔºåÁ®ãÂ∫è‰∏≠Áî®ÂæóÂà∞ÁöÑÊï∞ÊçÆÔºå‰∏ÄÂÆöÊòØ‰ªé==<strong>Ê†à„ÄÅÊï∞ÊçÆÊÆµ</strong>==Ëøô‰∫õÊ†πËäÇÁÇπËøΩË∏™ÂæóÂà∞ÁöÑÊï∞ÊçÆ„ÄÇ‰πüÂ∞±ÊòØËØ¥Ôºå<strong>‰ªéËøô‰∫õÊ†πËäÇÁÇπËøΩË∏™‰∏çÂà∞ÁöÑÊï∞ÊçÆ</strong>‰∏ÄÂÆöÊòØÊ≤°Áî®ÁöÑÊï∞ÊçÆÔºå‰∏ÄÂÆöÊòØ<strong>ÂûÉÂúæ</strong>„ÄÇÂõ†Ê≠§ÔºåÁõÆÂâç‰∏ªÊµÅÁöÑËá™Âä®ÂûÉÂúæÂõûÊî∂ÁÆóÊ≥ïÈÉΩÊòØ‰ΩøÁî®**&ldquo;ÂèØËææÊÄß&rdquo;<strong>Ëøë‰ººÁ≠â‰ª∑</strong>&ldquo;Â≠òÊ¥ªÊÄß&rdquo;**ÁöÑ„ÄÇ</p>
<h5 id="Ê†áËÆ∞-Ê∏ÖÊâ´ÁÆóÊ≥ï">Ê†áËÆ∞-Ê∏ÖÊâ´ÁÆóÊ≥ï</h5>
<p>Ê†áËÆ∞Ê∏ÖÈô§ÔºàMark-SweepÔºâÁÆóÊ≥ïÊòØÊúÄÂ∏∏ËßÅÁöÑÂûÉÂúæÊî∂ÈõÜÁÆóÊ≥ïÔºåÊ†áËÆ∞Ê∏ÖÈô§Êî∂ÈõÜÂô®ÊòØ<strong>Ë∑üË∏™ÂºèÂûÉÂúæÊî∂ÈõÜÂô®</strong>ÔºåÂÖ∂ÊâßË°åËøáÁ®ãÂèØ‰ª•ÂàÜÊàê**Ê†áËÆ∞ÔºàMarkÔºâ<strong>Âíå</strong>Ê∏ÖÈô§ÔºàSweepÔºâ**‰∏§‰∏™Èò∂ÊÆµÔºö</p>
<ol>
<li><strong>Ê†áËÆ∞Èò∂ÊÆµ</strong> ‚Äî ‰ªéÊ†πÂØπË±°Âá∫ÂèëÊü•ÊâæÂπ∂Ê†áËÆ∞Â†Ü‰∏≠ÊâÄÊúâÂ≠òÊ¥ªÁöÑÂØπË±°Ôºõ</li>
<li><strong>Ê∏ÖÈô§Èò∂ÊÆµ</strong> ‚Äî ÈÅçÂéÜÂ†Ü‰∏≠ÁöÑÂÖ®ÈÉ®ÂØπË±°ÔºåÂõûÊî∂Êú™Ë¢´Ê†áËÆ∞ÁöÑÂûÉÂúæÂØπË±°Âπ∂Â∞ÜÂõûÊî∂ÁöÑÂÜÖÂ≠òÂä†ÂÖ•Á©∫Èó≤ÈìæË°®„ÄÇ</li>
</ol>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221222170145205.png" alt="image-20221222170145205" style="zoom:33%;" />
<h6 id="‰∏âËâ≤ÊäΩË±°">‰∏âËâ≤ÊäΩË±°</h6>
<p><strong>‰∏âËâ≤ÊäΩË±°</strong>ÂèØ‰ª•Ê∏ÖÊô∞ÁöÑÂ±ïÁé∞ËøΩË∏™ÂºèÂõûÊî∂‰∏≠<strong>ÂØπË±°Áä∂ÊÄÅ</strong>ÁöÑ<strong>ÂèòÂåñËøáÁ®ã</strong>„ÄÇ</p>
<ul>
<li>ÂûÉÂúæÂõûÊî∂<strong>ÂºÄÂßãÊó∂</strong>ÔºåÊâÄÊúâÊï∞ÊçÆÂùá‰∏∫<strong>ÁôΩËâ≤</strong>Ôºõ</li>
<li>ÁÑ∂ÂêéÊääÁõ¥Êé•ËøΩË∏™Âà∞ÁöÑrootËäÇÁÇπÈÉΩÊ†áËÆ∞‰∏∫<strong>ÁÅ∞Ëâ≤</strong>ÔºöÁÅ∞Ëâ≤‰ª£Ë°®Âü∫‰∫éÂΩìÂâçËäÇÁÇπÂ±ïÂºÄÁöÑËøΩË∏™ËøòÊú™ÂÆåÊàêÔºõ</li>
<li>ÂΩìÂü∫‰∫éÊüê‰∏™ËäÇÁÇπÁöÑËøΩË∏™‰ªªÂä°ÂÆåÊàêÂêéÔºå‰æø‰ºöÊääËØ•ËäÇÁÇπÊ†áËÆ∞‰∏∫<strong>ÈªëËâ≤</strong>ÔºöË°®Á§∫ÂÆÉÊòØÂ≠òÊ¥ªÊï∞ÊçÆÔºåËÄå‰∏îÊó†ÈúÄÂü∫‰∫éÂÆÉÂÜçÊ¨°ËøõË°åËøΩË∏™‰∫Ü„ÄÇ</li>
<li>Âü∫‰∫é<strong>ÈªëËâ≤</strong>ËäÇÁÇπÊâæÂà∞ÁöÑÊâÄÊúâËäÇÁÇπÈÉΩË¢´Ê†áËÆ∞‰∏∫<strong>ÁÅ∞Ëâ≤</strong>ÔºåË°®Á§∫ËøòË¶ÅÂü∫‰∫éÂÆÉ‰ª¨Ëøõ‰∏ÄÊ≠•ÂºÄÂßãËøΩË∏™„ÄÇ</li>
<li>ÂΩìÊ≤°Êúâ<strong>ÁÅ∞Ëâ≤</strong>ËäÇÁÇπÊó∂ÔºåÂ∞±ÊÑèÂë≥ÁùÄÊ†áËÆ∞Â∑•‰ΩúÂèØ‰ª•ÁªìÊùü‰∫Ü„ÄÇÊ≠§Êó∂ÔºåÊúâÁî®Êï∞ÊçÆÈÉΩ‰∏∫<strong>ÈªëËâ≤</strong>ÔºåÂûÉÂúæÈÉΩ‰∏∫<strong>ÁôΩËâ≤</strong>„ÄÇÊé•‰∏ãÊù•ÂõûÊî∂Ëøô‰∫õ<strong>ÁôΩËâ≤</strong>Êï∞ÊçÆÂç≥ÂèØ„ÄÇ</li>
</ul>
<p><strong>Ê†áËÆ∞-Ê∏ÖÊâ´ÁÆóÊ≥ïÁöÑÁº∫ÁÇπÔºö</strong></p>
<p>Ê†áËÆ∞-Ê∏ÖÊâ´ÁÆóÊ≥ïÂÆπÊòìÈÄ†ÊàêÂæàÂ§öÂ∞èÂÜÖÂ≠òÔºåËøô‰∏ÄÈóÆÈ¢òÂèØ‰ª•Ôºö</p>
<ul>
<li>
<p>Âü∫‰∫é**BiBOP(Big Bag of Pages)**ÁöÑÊÄùÊÉ≥Ôºå<strong>ÊääÂÜÖÂ≠òÂùóÂàíÂàÜ‰∏∫Â§öÁßçÂ§ßÂ∞èËßÑÊ†º</strong>ÔºåÂØπÁõ∏ÂêåËßÑÊ†ºÁöÑÂÜÖÂ≠òÂùóËøõË°åÁªü‰∏ÄÁÆ°ÁêÜ„ÄÇ</p>
</li>
<li>
<p>ËøòÂèØ‰ª•ÈÄöËøá<strong>Á¥ßÂáë</strong>ÁöÑÊñπÊ≥ïÂáèÂ∞ëÁ¢éÁâáÂåñÂÜÖÂ≠òÔºå‰ΩÜÊòØ‰ºöÂ∏¶Êù•Â§öÊ¨°ÁßªÂä®ÁöÑÂºÄÈîÄ„ÄÇ</p>
</li>
</ul>
<h5 id="Â§çÂà∂ÂõûÊî∂ÁÆóÊ≥ï">Â§çÂà∂ÂõûÊî∂ÁÆóÊ≥ï</h5>
<p>ËøòÊúâ‰∏ÄÁßç<strong>Â§çÂà∂ÂºèÂõûÊî∂</strong>ÁÆóÊ≥ïÔºå‰ªñ‰ºöÊääÂ†ÜÂàíÂàÜ‰∏∫‰∏§‰∏™Áõ∏Á≠âÁöÑÁ©∫Èó¥FromÂíåToÔºåÁ®ãÂ∫èÊâßË°åÊó∂‰ΩøÁî®FromÁ©∫Èó¥ÔºåÂûÉÂúæÂõûÊî∂Êó∂‰ºöÊâ´ÊèèFromÁ©∫Èó¥ÔºåÊääËÉΩËøΩË∏™Âà∞ÁöÑÊï∞ÊçÆÂ§çÂà∂Âà∞ToÁ©∫Èó¥ÔºåÂΩìÊâÄÊúâËÉΩËøΩË∏™Âà∞ÁöÑÊï∞ÊçÆÈÉΩÂ§çÂà∂Âà∞ToÁ©∫Èó¥ÂêéÔºåÊääFromÂíåToÁ©∫Èó¥ËßíËâ≤ÂØπÊç¢ÔºåÂéüÊù•ÁöÑToÂèò‰∏∫FromÔºåÂéüÊù•ÁöÑFromÂèØ‰ª•ÂÖ®ÈÉ®ÂõûÊî∂Áî®‰ΩúÊñ∞ÁöÑTo„ÄÇËøôÁßçÂ§çÂà∂Âºè‰∏ç‰ºö‰∫ßÁîüÁ¢éÁâáÂåñÈóÆÈ¢òÔºå‰ΩÜÊòØ<strong>‰ºöÊµ™Ë¥π‰∏ÄÂçäÁöÑÂ†ÜÂÜÖÂ≠ò</strong>„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221222171821098.png" alt="image-20221222171821098" style="zoom:33%;" />
<p>‰∏∫‰∫ÜÊèêÈ´òÂ†ÜÂÜÖÂ≠òÂà©Áî®ÁéáÔºåÈÄöÂ∏∏‰ºöÂíåÂÖ∂‰ªñÂûÉÂúæÂõûÊî∂ÁÆóÊ≥ïÊê≠ÈÖç‰ΩøÁî®Ôºå<strong>Âè™Âú®‰∏ÄÈÉ®ÂàÜÂ†ÜÂÜÖÂ≠ò‰∏≠‰ΩøÁî®Â§çÂà∂ÂºèÂõûÊî∂</strong>„ÄÇÊØîÂ¶Ç<strong>ÂàÜ‰ª£ÂõûÊî∂</strong>„ÄÇ</p>
<h6 id="ÂàÜ‰ª£ÂõûÊî∂">ÂàÜ‰ª£ÂõûÊî∂</h6>
<p><strong>ÂàÜ‰ª£ÂõûÊî∂</strong>‰∏ªË¶ÅÂü∫‰∫é<strong>Âº±ÂàÜ‰ª£ÂÅáËØ¥</strong>ÔºöÂ§ßÈÉ®ÂàÜÂØπË±°ÈÉΩ‰ºöÂú®Âπ¥ËΩªÊó∂Ê≠ª‰∫°„ÄÇ</p>
<ul>
<li>Êñ∞Áîü‰ª£ÂØπË±°ÔºöÊñ∞ÂàõÂª∫ÁöÑÂØπË±°Ôºõ</li>
<li>ËÄÅÂπ¥‰ª£ÂØπË±°ÔºöÁªèÂèó‰ΩèÁâπÂÆöÊ¨°Êï∞GCËÄå‰æùÁÑ∂Â≠òÊ¥ªÁöÑÂØπË±°Ôºõ</li>
</ul>
<p>Âü∫‰∫éÂº±ÂàÜ‰ª£ÂÅáËØ¥ÔºåÂ§ßÈÉ®ÂàÜÂØπË±°‰ºöÂú®ÊúÄÂàùÁªèÂéÜÁöÑGC‰∏≠Ê≠ª‰∫°Ôºå‰πüÂ∞±ÊòØËØ¥<strong>Êñ∞Áîü‰ª£ÂØπË±°Êàê‰∏∫ÂûÉÂúæÁöÑÊ¶ÇÁéáÈ´ò‰∫éËÄÅÂπ¥‰ª£ÂØπË±°</strong>„ÄÇÂõ†Ê≠§ÔºåÂèØ‰ª•Â∞ÜÊï∞ÊçÆÂàíÂàÜ‰∏∫Êñ∞Áîü‰ª£ÂíåËÄÅÂπ¥‰ª£Ôºå<strong>Èôç‰ΩéËÄÅÂπ¥‰ª£ÊâßË°åÂûÉÂúæÂõûÊî∂ÁöÑÈ¢ëÁéá</strong>Ôºå‰∏çÁî®ÊØèÊ¨°ÈÉΩÂ§ÑÁêÜÊâÄÊúâÊï∞ÊçÆÔºåÂ∞ÜÊòéÊòæÊèêÈ´òÂûÉÂúæÂõûÊî∂ÊâßË°åÁöÑÊïàÁéá„ÄÇËÄå‰∏îÔºåÊñ∞Áîü‰ª£ÂíåËÄÅÂπ¥‰ª£ËøòÂèØ‰ª•ÂàÜÂà´ÈááÁî®‰∏çÂêåÁöÑÂõûÊî∂Á≠ñÁï•ÔºåËøõ‰∏ÄÊ≠•ÊèêÂçáÂõûÊî∂ÊïàÁõäÂπ∂ÂáèÂ∞ëÂºÄÈîÄ„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221222173347821.png" alt="image-20221222173347821" style="zoom: 33%;" />
<hr>
<p>‰ª•‰∏äÂùá‰∏∫<strong>Ë∑üË∏™ÂºèÂûÉÂúæÂõûÊî∂</strong>ÔºåËÄåÂºïÁî®ËÆ°Êï∞ÂºèÂûÉÂúæÂõûÊî∂ÊúâÂæàÂ§ßÁöÑ‰∏çÂêå„ÄÇ</p>
<h5 id="ÂºïÁî®ËÆ°Êï∞Âºè">ÂºïÁî®ËÆ°Êï∞Âºè</h5>
<p>**ÂºïÁî®ËÆ°Êï∞ÊåáÁöÑÊòØ‰∏Ä‰∏™Êï∞ÊçÆÂØπË±°Ë¢´ÂºïÁî®ÁöÑÊ¨°Êï∞„ÄÇ**Á®ãÂ∫èÊâßË°åËøáÁ®ã‰∏≠Ôºå‰ºöÊõ¥Êñ∞Êï∞ÊçÆÂØπË±°ÁöÑÂºïÁî®ËÆ°Êï∞ÔºåÂΩìÂØπË±°ÁöÑÂºïÁî®ËÆ°Êï∞‰∏∫0Êó∂ÔºåÂ∞±Ë°®Á§∫Ëøô‰∏™ÂØπË±°‰∏çÂÜçË¢´‰ΩøÁî®ÔºåÂèØ‰ª•ÂõûÊî∂ÂÆÉÊâÄÂç†Áî®ÁöÑÂÜÖÂ≠ò„ÄÇÂõ†Ê≠§ÔºåÂú®ÂºïÁî®ËÆ°Êï∞Ê≥ï‰∏≠ÂûÉÂúæËØÜÂà´ÁöÑ‰ªªÂä°Â∑≤ÁªèË¢´ÂàÜÊëäÂà∞ÊØèÊ¨°ÂØπÊï∞ÊçÆÂØπË±°ÁöÑÊìç‰Ωú‰∏≠„ÄÇËôΩÁÑ∂ÂºïÁî®ËÆ°Êï∞Ê≥ïÂèØ‰ª•ÂèäÊó∂ÂõûÊî∂Êó†Áî®ÂÜÖÂ≠òÔºå‰ΩÜÊòØÈ´òÈ¢ëÁéáÁöÑÊõ¥Êñ∞ÂºïÁî®ËÆ°Êï∞‰πü‰ºöÈÄ†Êàê‰∏çÂ∞èÁöÑÂºÄÈîÄÔºåËÄå‰∏îÂ¶ÇÊûúÂèëÁîüÂæ™ÁéØÂºïÁî®ÊÉÖÂÜµÔºåÈÇ£‰πàÂ∞ÜÊó†Ê≥ïÂõûÊî∂„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221222173942715.png" alt="image-20221222173942715" style="zoom: 25%;" />
<hr>
<p>‰ª•‰∏äËÆ®ËÆ∫ÂùáÊòØÂú®ÊöÇÂÅúÁî®Êà∑Á®ãÂ∫èÔºåÂè™‰∏ìÊ≥®‰∫éÂûÉÂúæÂõûÊî∂ÁöÑÂâçÊèê‰∏ãËøõË°åÁöÑÔºå‰πüÂç≥ÊâÄË∞ì**==STW==(Stop The World)**„ÄÇ‰ΩÜÂÆûÈôÖ‰∏äÁî®Êà∑Á®ãÂ∫èÊó†Ê≥ïÊé•ÂèóÈïøÊó∂Èó¥ÁöÑÊöÇÂÅú„ÄÇ</p>
<h5 id="Â¢ûÈáèÂºèÂûÉÂúæÂõûÊî∂">Â¢ûÈáèÂºèÂûÉÂúæÂõûÊî∂</h5>
<p>**Â¢ûÈáèÂºèÂûÉÂúæÂõûÊî∂Ôºö**Â∞ÜÈïøÊó∂Èó¥ÁöÑÂûÉÂúæÂõûÊî∂ÔºåÂàÜÊàêËã•Âπ≤Â∞èÊÆµÔºåÂíåÁî®Êà∑Á®ãÂ∫è‰∫§ÊõøÊâßË°åÔºåÂç≥Áº©Áü≠ÊØèÊ¨°ÊöÇÂÅúÁöÑÊó∂Èó¥Ôºå‰ΩÜÂ¢ûÂä†ÊöÇÂÅúÁöÑÊ¨°Êï∞„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221222174536321.png" alt="image-20221222174536321" style="zoom:33%;" />
<p>**Ëøô‰ºöÂ∏¶Êù•Êñ∞ÁöÑÈóÆÈ¢òÔºö**‰øù‰∏çÈΩêÂûÉÂúæÂõûÊî∂Á®ãÂ∫èÂâçËÑöÂàöÊ†áËÆ∞‰∏Ä‰∏™ÈªëËâ≤ÂØπË±°ÔºåÁî®Êà∑Á®ãÂ∫èÂêéËÑöÂ∞±‰øÆÊîπ‰∫ÜÂÆÉ(Â∞ÜÂÆÉÊåáÂêëÁôΩËâ≤ÂØπË±°ÔºåÊ≠§Êó∂ÂéüÈªëËâ≤ÂØπË±°Â∫îÂèò‰∏∫ÁÅ∞Ëâ≤Ôºå‰ΩÜÂπ∂Ê≤°Êúâ)ÔºåÂûÉÂúæÂõûÊî∂Á®ãÂ∫èÊúâÂèØËÉΩËØØÂà§Â∞ÜÁôΩËâ≤ÂØπË±°(Â∫î‰∏∫ÁÅ∞Ëâ≤ÂØπË±°)ÂõûÊî∂„ÄÇÂéüÂõ†Â¶Ç‰∏ãÔºö</p>
<p>Âú®‰∏âËâ≤ÊäΩË±°‰∏≠ÔºåÈªëËâ≤ÂØπË±°Â§ÑÁêÜÂÆåÊØïÔºå‰∏ç‰ºöË¢´ÂÜçÊ¨°Êâ´ÊèèÔºåËÄåÁÅ∞Ëâ≤ÂØπË±°Ëøò‰ºöË¢´ÂõûÊî∂Âô®ÁªßÁª≠Â§ÑÁêÜÔºåÊâÄ‰ª•<strong>Ëã•Âá∫Áé∞ÈªëËâ≤ÂØπË±°Âà∞ÁôΩËâ≤ÂØπË±°ÁöÑÂºïÁî®</strong>Ôºå<strong>ÂêåÊó∂Ê≤°Êúâ‰ªª‰ΩïÁÅ∞Ëâ≤ÂØπË±°ÂèØ‰ª•ÊäµËææËøô‰∏™ÁôΩËâ≤ÂØπË±°</strong>ÔºåÂÆÉÂ∞±‰ºöË¢´Âà§‰∏∫<strong>ÂûÉÂúæ</strong>Ôºå‰ΩÜÂÆûÈôÖ‰∏äÂÆÉ‰ªçÊòØÂ≠òÊ¥ªÊï∞ÊçÆ„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221222180626713.png" alt="image-20221222180626713" style="zoom:33%;" />
<h5 id="Âº∫‰∏âËâ≤‰∏çÂèòÂºè‰∏éÂº±‰∏âËâ≤‰∏çÂèòÂºè">Âº∫‰∏âËâ≤‰∏çÂèòÂºè‰∏éÂº±‰∏âËâ≤‰∏çÂèòÂºè</h5>
<p>Â¶ÇÊûúËÉΩÂ§üÂÅöÂà∞<strong>‰∏çÂá∫Áé∞ÈªëËâ≤ÂØπË±°Âà∞ÁôΩËâ≤ÂØπË±°ÁöÑÂºïÁî®</strong>ÔºåÂ∞±ÂøÖÁÑ∂‰∏ç‰ºöÂá∫Áé∞ËøôÊ†∑ÁöÑÈîôËØØ‰∫Ü„ÄÇËøôË¢´Áß∞‰∏∫**&ldquo;Âº∫‰∏âËâ≤‰∏çÂèòÂºè&rdquo;**„ÄÇ</p>
<p>Ëã•ÊääÊù°‰ª∂ÊîæÂÆΩ‰∏ÄÁÇπÔºå<strong>ÂÖÅËÆ∏Âá∫Áé∞ÈªëËâ≤ÂØπË±°Âà∞ÁôΩËâ≤ÂØπË±°ÁöÑÂºïÁî®</strong>Ôºå‰ΩÜÊòØÂèØ‰ª•<strong>‰øùËØÅÈÄöËøáÁÅ∞Ëâ≤ÂØπË±°ÂèØ‰ª•ÊäµËææËØ•ÁôΩËâ≤ÂØπË±°</strong>ÔºåËøôÊ†∑‰πüÂèØ‰ª•ÈÅøÂÖçËøô‰∏™ÈîôËØØÔºåËøôË¢´Áß∞‰∏∫**&ldquo;Âº±‰∏âËâ≤‰∏çÂèòÂºè&rdquo;**„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221222180954270.png" alt="image-20221222180954270" style="zoom:33%;" />
<h5 id="ËØªÂÜôÂ±èÈöú">ËØªÂÜôÂ±èÈöú</h5>
<p>ÂÆûÁé∞**&ldquo;Âº∫/Âº±‰∏âËâ≤‰∏çÂèòÂºè&rdquo;<strong>ÈÄöÂ∏∏ÁöÑÂÅöÊ≥ïÊòØÂª∫Á´ã</strong>&ldquo;ËØª/ÂÜôÂ±èÈöú&rdquo;**„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221222212313757.png" alt="image-20221222212313757" style="zoom:33%;" />
<ul>
<li>
<p>**ÂÜôÂ±èÈöúÔºö**‰ºöÂú®ÂÜôÊìç‰Ωú‰∏≠ÊèíÂÖ•Êåá‰ª§ÔºåÁõÆÁöÑÊòØÊääÊï∞ÊçÆÂØπË±°ÁöÑ‰øÆÊîπÈÄöÁü•Âà∞ÂûÉÂúæÂõûÊî∂Âô®ÔºåÊâÄ‰ª•ÂÜôÂ±èÈöúÈÄöÂ∏∏Ë¶ÅÊúâ‰∏Ä‰∏™ËÆ∞ÂΩïÈõÜÔºåËÄåËÆ∞ÂΩïÈõÜÊòØÈááÁî®È°∫Â∫èÂ≠òÂÇ®ËøòÊòØÂìàÂ∏åË°®„ÄÅËÆ∞ÂΩïÁ≤æÁ°ÆÂà∞Ë¢´‰øÆÊîπÁöÑÂØπË±°ËøòÊòØÂè™ËÆ∞ÂΩïÂÖ∂ÊâÄÂú®È°µÁ≠âÈóÆÈ¢òÔºåÂ∞±ÊòØÂÜôÂ±èÈöúÂÖ∑‰ΩìÂÆûÁé∞Ë¶ÅËÄÉËôëÁöÑ‰∫Ü„ÄÇ</p>
</li>
<li>
<p><strong>&ldquo;Âº∫‰∏âËâ≤‰∏çÂèòÂºè&rdquo;<strong>ÊèêÈÜíÊàë‰ª¨ÂÖ≥Ê≥®ÁôΩËâ≤ÊåáÈíàÊåáÂêëÈªëËâ≤ÂØπË±°ÁöÑÂÜôÂÖ•Êìç‰ΩúÔºåÊó†ËÆ∫Â¶Ç‰ΩïÈÉΩ</strong>‰∏çÂÖÅËÆ∏Âá∫Áé∞ÈªëËâ≤ÂØπË±°Âà∞ÁôΩËâ≤ÂØπË±°ÁöÑÂºïÁî®</strong>„ÄÇÂèØ‰ª•ÊääÁôΩËâ≤ÊåáÈíàÂèò‰∏∫ÁÅ∞Ëâ≤Ôºå‰πüÂèØ‰ª•ÊääÈªëËâ≤ÂØπË±°Âèò‰∏∫ÁÅ∞Ëâ≤„ÄÇËøô‰∫õÈÉΩÂ±û‰∫é**==&ldquo;ÊèíÂÖ•&quot;ÂÜôÂ±èÈöú==**„ÄÇ</p>
</li>
<li>
<p><strong>&ldquo;Âº±‰∏âËâ≤‰∏çÂèòÂºè&rdquo;<strong>ÂàôÊèêÈÜíÊàë‰ª¨ÂÖ≥Ê≥®ÂØπÈÇ£‰∫õ</strong>Âà∞ÁôΩËâ≤ÂØπË±°Ë∑ØÂæÑ</strong>ÁöÑÁ†¥ÂùèË°å‰∏∫„ÄÇ‰æãÂ¶ÇË¶ÅÂà†Èô§ÁÅ∞Ëâ≤ÂØπË±°Âà∞ÁôΩËâ≤ÂØπË±°ÁöÑÂºïÁî®Êó∂ÔºåÂèØ‰ª•ÊääÁôΩËâ≤ÂØπË±°Âèò‰∏∫ÁÅ∞Ëâ≤„ÄÇËøôÁßçÂÜôÂ±èÈöúÂ±û‰∫é**==&ldquo;Âà†Èô§&quot;ÂÜôÂ±èÈöú==**„ÄÇ</p>
</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221222211852448.png" alt="image-20221222211852448" style="zoom: 33%;" />
<ul>
<li>**ËØªÂ±èÈöúÔºö**Á°Æ‰øùÁî®Êà∑Á®ãÂ∫è‰∏ç‰ºöËÆøÈóÆÂà∞Â∑≤ÁªèÂ≠òÂú®ÂâØÊú¨ÁöÑÈôàÊóßÂØπË±°„ÄÇÔºà‰∏ªË¶ÅÈíàÂØπÂ§çÂà∂ÂºèÂõûÊî∂Ôºâ</li>
</ul>
<h5 id="Â§öÊ†∏">Â§öÊ†∏</h5>
<ul>
<li>**Âπ∂Ë°åÂûÉÂúæÂõûÊî∂Ôºö**Â§öÁ∫øÁ®ãÂπ∂Ë°åÊâßË°åÂûÉÂúæÂõûÊî∂Á®ãÂ∫è„ÄÇ</li>
<li><strong>Âπ∂ÂèëÂûÉÂúæÂõûÊî∂ÔºöÁî®Êà∑Á®ãÂ∫è‰∏éÂûÉÂúæÂõûÊî∂Á®ãÂ∫èÂπ∂ÂèëÊâßË°å</strong>ÔºåËøôÊúâÂèØËÉΩÂØºËá¥ÈîôËØØ(Êúâ‰∫õÁ∫øÁ®ãÂºÄÂêØ‰∫ÜÂÜôÂ±èÈöúÔºåÊúâ‰∫õËøòÊ≤°ÂºÄÂêØÔºåÊâÄ‰ª•ÈÄöÂ∏∏ÈááÁî®‰∏ãËæπÈÇ£Áßç)</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221222212720071.png" alt="image-20221222212720071" style="zoom:33%;" />
<ul>
<li>‰∏ª‰ΩìÂπ∂ÂèëÂºèÂûÉÂúæÂõûÊî∂ÔºöÂú®Êüê‰∫õÈò∂ÊÆµÈááÂèñSTW(Á°Æ‰øùÂ§ß‰ºôÂÑøÈÉΩÂºÄÂêØ‰∫ÜÂÜôÂ±èÈöú)ÔºåÂú®ÂÖ∂‰ªñÈò∂ÊÆµÊîØÊåÅÂπ∂Âèë„ÄÇ</li>
<li>‰∏ª‰ΩìÂπ∂ÂèëÂ¢ûÈáèÂºèÂûÉÂúæÂõûÊî∂ÔºöÂú®&quot;‰∏ª‰ΩìÂπ∂ÂèëÂºèÂûÉÂúæÂõûÊî∂&quot;Âü∫Á°Ä‰∏äÊîØÊåÅÂ¢ûÈáèÂºèÂõûÊî∂Ôºå</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221222213057154.png" alt="image-20221222213057154" style="zoom:33%;" />
<h4 id="2222-go">2.2.2.2 Go</h4>
<p><code>Go</code>ËØ≠Ë®ÄÁöÑÂûÉÂúæÂõûÊî∂ÈááÁî®<strong>Ê†áËÆ∞-Ê∏ÖÊâ´ÁÆóÊ≥ï</strong>ÔºåÊîØÊåÅ**==‰∏ª‰ΩìÂπ∂ÂèëÂ¢ûÈáèÂºèÂõûÊî∂==<strong>Ôºå‰ΩøÁî®</strong>ÊèíÂÖ•‰∏éÂà†Èô§<strong>‰∏§ÁßçÂÜôÂ±èÈöúÁªìÂêàÁöÑ</strong>Ê∑∑ÂêàÂÜôÂ±èÈöú**„ÄÇ</p>
<ul>
<li>
<p><code>Go</code>ËØ≠Ë®ÄÁöÑ<code>GC</code>Âú®ÂáÜÂ§áÈò∂ÊÆµ(<code>Mark Setup</code>)‰ºö‰∏∫ÊØè‰∏™<code>p</code>ÂàõÂª∫‰∏Ä‰∏™<code>mark worker</code>ÂçèÁ®ãÔºåÊääÂØπÂ∫îÁöÑ<code>g</code>ÊåáÈíàÂ≠òÂÇ®Âà∞<code>p</code>‰∏≠ÔºåËøô‰∫õÂêéÂè∞<code>mark worker</code>ÂàõÂª∫ÂêéÂæàÂø´ËøõÂÖ•‰ºëÁú†ÔºåÁ≠âÂà∞<strong>Ê†áËÆ∞Èò∂ÊÆµ</strong>ÂæóÂà∞Ë∞ÉÂ∫¶ÊâßË°å„ÄÇ</p>
</li>
<li>
<p>Êé•‰∏ãÊù•<strong>Á¨¨‰∏ÄÊ¨°<code>STW</code></strong>Ôºå<code>GC</code>ËøõÂÖ•<code>_GCMark</code>Èò∂ÊÆµ„ÄÇÂÖ®Â±ÄÂèòÈáè<code>gcphase</code>ËÆ∞ÂΩï<code>GC</code>Èò∂ÊÆµÊ†áËØÜÔºåÂÖ®Â±ÄÂèòÈáè<code>writeBarrier</code>ËÆ∞ÂΩïÊòØÂê¶ÂºÄÂêØÂÜôÂ±èÈöúÔºåÂÖ®Â±ÄÂèòÈáè<code>gcBlackenEnabled</code>Áî®‰∫éÊ†áËØÜÊòØÂê¶ÂÖÅËÆ∏ËøõË°å<code>GC</code>Ê†áËÆ∞Â∑•‰Ωú(Ê≠§Â§ÑÁΩÆ‰∏∫<code>1</code>ÔºåÊ†áËØÜÂÖÅËÆ∏)„ÄÇ</p>
</li>
<li>
<p>Âú®<code>STW</code>ÁöÑÊÉÖÂÜµ‰∏ã<strong>ÂºÄÂêØÂÜôÂ±èÈöú</strong>„ÄÇÁ≠âÊâÄÊúâÂáÜÂ§áÂ∑•‰ΩúÂÅöÂ•Ω‰ª•ÂêéÔºå<strong><code>start the world</code></strong>ÔºåÊâÄÊúâ<code>p</code>ÈÉΩ‰ºöÁü•ÈÅìÂÜôÂ±èÈöúÂ∑≤ÂºÄÂêØÔºåÁÑ∂ÂêéËøô‰∫õÂêéÂè∞<code>mark worker</code>ÂèØ‰ª•ÂæóÂà∞Ë∞ÉÂ∫¶ÊâßË°åÔºåÂ±ïÂºÄÊ†áËÆ∞Â∑•‰Ωú„ÄÇ</p>
</li>
<li>
<p>ÂΩìÊ≤°ÊúâÊ†áËÆ∞‰ªªÂä°Êó∂Ôºå<strong>Á¨¨‰∫åÊ¨°<code>STW</code></strong>Ôºå<code>GC</code>ËøõÂÖ•<code>_GCMarkTermination</code>Èò∂ÊÆµÔºåÁ°ÆËÆ§Ê†áËÆ∞Â∑•‰ΩúÁ°ÆÂÆûÂ∑≤ÁªèÂÆåÊàêÔºåÁÑ∂ÂêéÂÅúÊ≠¢Ê†áËÆ∞Â∑•‰ΩúÔºåÂ∞Ü<code>gcBlackenEnabled</code>ÁΩÆ‰∏∫<code>0</code>„ÄÇ</p>
</li>
<li>
<p>Êé•‰∏ãÊù•ÔºåËøõÂÖ•<code>_GCOff</code>Èò∂ÊÆµÔºåÂÖ≥Èó≠ÂÜôÂ±èÈöú„ÄÇ**<code>start the world</code>ÔºåËøõÂÖ•Ê∏ÖÊâ´Èò∂ÊÆµ„ÄÇ**ËøõÂÖ•<code>_GCOff</code>Èò∂ÊÆµÂâçÔºåÊñ∞ÂàÜÈÖçÁöÑÂØπË±°‰ºöÁõ¥Êé•Ê†áËÆ∞‰∏∫ÈªëËâ≤ÔºåËøõÂÖ•<code>_GCOff</code>Èò∂ÊÆµÂêéÔºåÂÜçÊñ∞ÂàÜÈÖçÁöÑÂØπË±°Â∞±ÊòØÁôΩËâ≤ÁöÑ‰∫Ü„ÄÇ</p>
</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221229151143665.png" alt="image-20221229151143665" style="zoom:33%;" />
<p>ÊâßË°åÊ∏ÖÊâ´Â∑•‰ΩúÁöÑÂçèÁ®ãÁî±<code>runtime.main</code>Âú®<code>gcenable</code>‰∏≠ÂàõÂª∫ÔºåÂØπÂ∫î<code>g</code>ÊåáÈíàÂ≠òÂÇ®Âú®ÂÖ®Â±ÄÂèòÈáè<code>sweep</code>‰∏≠ÔºåÂà∞Ê∏ÖÊâ´Èò∂ÊÆµÔºåËøô‰∏™ÂêéÂè∞ÁöÑ**<code>sweeper</code><strong>‰ºöË¢´Âä†ÂÖ•Âà∞<code>runq</code>‰∏≠ÔºåÂÆÉÂæóÂà∞Ë∞ÉÂ∫¶ÊâßË°åÊó∂‰ºö</strong>ÊâßË°åÊ∏ÖÊâ´‰ªªÂä°**ÔºåÂõ†‰∏∫Ê∏ÖÊâ´Â∑•‰Ωú‰πüÊòØÂ¢ûÈáèËøõË°åÁöÑÔºåÊâÄ‰ª•ÊØè‰∏ÄËΩÆ<code>GC</code>ÂºÄÂßãÂâçÔºåËøòË¶ÅÂÖàÁ°Æ‰øùÂÆåÊàê‰∏ä‰∏ÄËΩÆ<code>GC</code>Êú™ÂÆåÊàêÁöÑÊ∏ÖÊâ´Â∑•‰Ωú„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221229152005509.png" alt="image-20221229152005509" style="zoom: 33%;" />
<p>ËøôÊ†∑ÁúãÊù•‰ºº‰πéÂè™ÈúÄË¶Å‰∏§ËΩÆ<code>STW</code>Ôºå<strong>Ê†áËÆ∞</strong>‰∏é<strong>Ê∏ÖÊâ´</strong>Â∑•‰ΩúÂπ∂ÂèëÂ¢ûÈáèÊâßË°åÁöÑ<code>GC</code>ËÄåÂ∑≤„ÄÇ</p>
<blockquote>
<h4 id="ÈóÆÈ¢ò"><strong>ÈóÆÈ¢òÔºö</strong></h4>
</blockquote>
<ol>
<li>**ÂÖ≥‰∫é<code>GC</code>Ê†áËÆ∞Â∑•‰ΩúÔºö**‰æùÁÖßÊ†áËÆ∞-Ê∏ÖÊâ´ÁÆóÊ≥ïÔºå<strong>Ê†áËÆ∞Â∑•‰ΩúË¶Å‰ªéÊâ´Êèè<code>bss</code>ÊÆµ„ÄÅÊï∞ÊçÆÊÆµ„ÄÅ‰ª•ÂèäÂçèÁ®ãÊ†à‰∏äÁöÑËøô‰∫õ<code>root</code>ÁªìÁÇπÂºÄÂßã</strong>Ôºå<strong>ËøΩË∏™Âà∞Â†Ü‰∏äÁöÑËäÇÁÇπ</strong>ÔºåÈÇ£ÊÄé‰πàÁ°ÆÂÆöËøô‰∫õÊï∞ÊçÆÂØπË±°ÊòØÂê¶ÊòØ<code>GC</code>ÊÑüÂÖ¥Ë∂£ÁöÑÊåáÈíàÂë¢Ôºü</li>
</ol>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221229152754952.png" alt="image-20221229152754952" style="zoom:25%;" />
<p>GoËØ≠Ë®ÄÂú®ÁºñËØëÈò∂ÊÆµ‰ºöÁîüÊàê<code>bss</code>ÊÆµ„ÄÅÊï∞ÊçÆÊÆµÁ≠âÂØπÂ∫îÁöÑ<strong>ÂÖÉÊï∞ÊçÆ</strong>ÔºåÂ≠òÂÇ®Âú®ÂèØÊâßË°åÊñá‰ª∂‰∏≠ÔºåÈÄöËøáÂêÑÊ®°ÂùóÂØπÂ∫îÁöÑ<code>moduledata</code>ÂèØ‰ª•Ëé∑Âæó<code>gcdatamask</code>„ÄÅ<code>gcbssmask</code>Á≠â‰ø°ÊÅØÔºåÂÆÉ‰ª¨‰ºöË¢´<strong>Áî®‰∫éÂà§Êñ≠ÁâπÂÆö<code>root</code>ËäÇÁÇπÊòØÂê¶‰∏∫ÊåáÈíà</strong>„ÄÇ</p>
<p>ÂçèÁ®ãÊ†à‰πüÊúâÂØπÂ∫îÁöÑÂÖÉÊï∞ÊçÆÔºåÂ≠òÂÇ®Âú®<code>stackmap</code>‰∏≠ÔºåÊâ´ÊèèÂçèÁ®ãÊ†àÊó∂ÔºåÈÄöËøáÂØπÂ∫îÂÖÉÊï∞ÊçÆÔºåÂèØ‰ª•Áü•ÈÅìÊ†à‰∏äÁöÑÂ±ÄÈÉ®ÂèòÈáè„ÄÅÂèÇÊï∞„ÄÅËøîÂõûÂÄºÁ≠âÂØπË±°‰∏≠ÈÇ£‰∫õÊòØÂ≠òÊ¥ªÁöÑÊåáÈíà„ÄÇ<strong>Á°ÆÂÆö‰∫Ü<code>root</code>ËäÇÁÇπÊòØÂê¶ÊòØÊåáÈíàÔºåËøòË¶ÅËøõ‰∏ÄÊ≠•Âà§Êñ≠Ëøô‰∫õÊåáÈíàÊòØÂê¶ÊåáÂêëÂ†ÜÂÜÖÂ≠ò</strong>ÔºåÂ¶ÇÊûú<strong>ÊåáÂêëÂ†ÜÂÜÖÂ≠ò</strong>Â∞±ÂæóÊää‰ªñ‰ª¨Âä†ÂÖ•Âà∞<code>GC</code>Â∑•‰ΩúÈòüÂàó‰∏≠ËøõË°åËøõ‰∏ÄÊ≠•Êâ´Êèè„ÄÇ</p>
<p>Â†Ü‰∏äËøô‰∫õÊï∞ÊçÆÂØπË±°Ëá™ÁÑ∂‰πüÊúâÂØπÂ∫îÁöÑ<strong>ÂÖÉÊï∞ÊçÆ</strong>„ÄÇ<code>mheap</code>‰∏≠ÊØè‰∏™<code>arena</code>ÂØπÂ∫î‰∏Ä‰∏™<code>HeapArena</code>ÔºåËÆ∞ÂΩï<code>arena</code>ÁöÑÂÖÉÊï∞ÊçÆ‰ø°ÊÅØ„ÄÇ<strong>ÂÖ∂‰∏≠Êúâ‰∏Ä‰∏™<code>bitmap</code>Ôºå</strong><code>bitmap</code>‰∏≠‰∏Ä‰∏™<code>byte</code>ÂèØ‰ª•Ê†áËÆ∞<code>arena</code>‰∏≠ËøûÁª≠Âõõ‰∏™ÊåáÈíàÂ§ßÂ∞èÁöÑÂÜÖÂ≠òÔºåÊØè‰∏™<code>word</code>ÂØπÂ∫îÁöÑ‰∏§‰∏™<code>bit</code>‰∏≠Ôºå‰Ωé‰Ωç<code>bit</code>Áî®‰∫éÊ†áËÆ∞ÊòØÂê¶‰∏∫ÊåáÈíà(0‰∏∫ÈùûÊåáÈíàÔºå1‰∏∫ÊåáÈíà)ÔºåÈ´ò‰Ωç<code>bit</code>Áî®‰∫éÊ†áËÆ∞ÊòØÂê¶Ë¶ÅÁªßÁª≠Êâ´Êèè(1‰ª£Ë°®ÔºöÊâ´ÊèèÂÆåÂΩìÂâç<code>word</code>ÔºåÂπ∂‰∏çËÉΩÂÆåÊàêÂΩìÂâçÊï∞ÊçÆÂØπË±°ÁöÑÊâ´Êèè)Ôºå<code>bitmap</code>ÁöÑ‰ø°ÊÅØÂú®ÂàÜÈÖçÂÜÖÂ≠òÊó∂ËÆæÁΩÆÔºå‰ºöÁî®Âà∞ÂØπÂ∫îÁ±ªÂûãÂÖÉÊï∞ÊçÆ‰∏≠ÁöÑ<code>gcdata</code>‰ø°ÊÅØ„ÄÇ<code>HeapArena</code>‰∏≠ËøòÊúâ‰∏Ä‰∏™<code>spans</code>Â≠óÊÆµÔºåÂÆÉÊòØ‰∏Ä‰∏™<code>*mspan</code>Á±ªÂûãÁöÑÊï∞ÁªÑÔºåÁî®‰∫éËÆ∞ÂΩïÂΩìÂâç<code>arena</code>‰∏≠ÊØè‰∏ÄÈ°µÂØπÂ∫îÂà∞Âì™‰∏™<code>span</code>„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221229160021183.png" alt="image-20221229160021183" style="zoom:33%;" />
<p>Âü∫‰∫é<code>HeapArena</code>ËÆ∞ÂΩïÁöÑ<strong>ÂÖÉÊï∞ÊçÆ‰ø°ÊÅØ</strong>ÔºåÊàë‰ª¨Âè™Ë¶ÅÁü•ÈÅì‰∏Ä‰∏™ÂØπË±°ÁöÑÂú∞ÂùÄÔºåÂ∞±ÂèØ‰ª•Ê†πÊçÆ<code>bitmap</code>‰ø°ÊÅØÔºåÊâ´ÊèèÂÆÉÂÜÖÈÉ®ÊòØÂê¶Âê´ÊúâÊåáÈíàÔºõ‰πüÂèØ‰ª•Ê†πÊçÆÂØπË±°Âú∞ÂùÄÔºåËÆ°ÁÆóÂá∫ÂÆÉÂú®Âì™‰∏ÄÈ°µÔºåÁÑ∂ÂêéÈÄöËøá<code>spans</code>‰ø°ÊÅØÊü•Âà∞ËØ•ÂØπË±°Â≠òÂú®Âì™‰∏Ä‰∏™<code>span</code>‰∏≠ÔºåËÄåÊØè‰∏™<code>span</code>ÈÉΩÊúâ‰∏§‰∏™‰ΩçÂõæÊ†áËÆ∞ÔºåËÆ∞ÂΩïÂú®<code>mspan</code>‰∏≠Ôºö<code>allocBits</code>‰∏≠ÊØè‰∏Ä‰ΩçÁî®‰∫éÊ†áËÆ∞‰∏Ä‰∏™ÂØπË±°Â≠òÂÇ®ÂçïÂÖÉÊòØÂê¶Â∑≤ÂàÜÈÖç„ÄÇ<code>gcmarkBits</code>‰∏≠ÊØè‰∏Ä‰ΩçÁî®‰∫éÊ†áËÆ∞‰∏Ä‰∏™ÂØπË±°ÊòØÂê¶Â≠òÊ¥ª„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221229155909739.png" alt="image-20221229155909739" style="zoom: 33%;" />
<p>Êúâ‰∫ÜËøô‰∫õÂÖÉÊï∞ÊçÆÂíå‰ΩçÂõæÊ†áËÆ∞ÔºåÂ∞±ËÉΩÁü•ÈÅìÂì™‰∫õÊï∞ÊçÆÂØπË±°Â∫îËØ•Ë¢´Ê†áËÆ∞‰∏∫ÁÅ∞Ëâ≤Ôºå‰πüÂ∞±ÊòØÊääÂÖ∂ÂØπÂ∫îÁöÑ<code>gcmarkBits</code>Ê†áËÆ∞‰∏∫<code>1</code>ÔºåÂπ∂Âä†ÂÖ•Âà∞<strong>Â∑•‰ΩúÈòüÂàó</strong>‰∏≠„ÄÇ</p>
<ol start="2">
<li><strong>ÂÖ≥‰∫éÂ∑•‰ΩúÈòüÂàóÔºöÂÖ®Â±ÄÂèòÈáè<code>work</code><strong>‰∏≠Â≠òÂÇ®ÁùÄÂÖ®Â±ÄÂ∑•‰ΩúÈòüÂàóÁºìÂ≠òÔºåÂêåÊó∂ÔºåÊØè‰∏™<code>p</code>ÈÉΩÊúâ‰∏Ä‰∏™</strong>Êú¨Âú∞Â∑•‰ΩúÈòüÂàó</strong>(<code>p.gcw</code>)„ÄÇÊú¨Âú∞Â∑•‰ΩúÈòüÂàó‰∏≠Êúâ‰∏§‰∏™<code>workbuf</code>ÔºåÊ∑ªÂä†‰ªªÂä°Êó∂ÊÄªÊòØÂæÄ<code>wbuf1</code>Ê∑ªÂä†Ôºå<code>wbuf1</code>Êª°‰∫ÜÂ∞±‰∫§Êç¢‰∏§‰∏™<code>workbuf</code>Ôºå‰∫§Êç¢ÂêéÂ¶ÇÊûú‰æùÁÑ∂ÊòØÊª°ÁöÑÔºåÂ∞±ÊääÂΩìÂâç<code>wbuf1</code>ÁöÑÂ∑•‰Ωú<code>flush</code>Âà∞ÂÖ®Â±ÄÁºìÂ≠ò‰∏≠Âéª„ÄÇÂêéÂè∞<code>mark worker</code>ÊâßË°åÊ†áËÆ∞Â∑•‰Ωú<strong>Ê∂àËÄóÂ∑•‰ΩúÈòüÂàó</strong>Êó∂Ôºå‰ºöÂ§ÑÁêÜÊú¨Âú∞Â∑•‰ΩúÈòüÂàóÂíåÂÖ®Â±ÄÁºìÂ≠ò‰∏≠Â∑•‰ΩúÈáèÂùáË°°ÁöÑÈóÆÈ¢òÔºåÂ¶ÇÊûúÂÖ®Â±ÄÂ∑•‰ΩúÁºìÂ≠ò‰∏∫Á©∫ÔºåÂ∞±ÊääÂΩìÂâç<code>p</code>ÁöÑÂ∑•‰ΩúÂàÜ‰∏Ä‰∫õÂà∞ÂÖ®Â±ÄÂ∑•‰ΩúÁºìÂ≠ò‰∏≠Ôºå<strong>ÂÖ∑‰ΩìÂÅöÊ≥ïÊòØ</strong>ÔºöÂ¶ÇÊûú<code>wbuf2</code>‰∏ç‰∏∫Á©∫ÔºåÂ∞±ÊääÂÆÉÊï¥‰∏™<code>flush</code>Âà∞ÂÖ®Â±ÄÁºìÂ≠ò‰∏≠ÔºõÂ¶ÇÊûú‰∏∫Á©∫ÔºåËÄå<code>wbuf1</code>‰∏≠ÂÖÉÁ¥†‰∏™Êï∞Â§ß‰∫é<code>4</code>ÔºåÂ∞±Êää<code>wbuf1</code>‰∏≠‰∏ÄÂçäÁöÑÂ∑•‰ΩúÊîæÂà∞ÂÖ®Â±ÄÁºìÂ≠ò‰∏≠„ÄÇËÄåÂ¶ÇÊûúËé∑ÂèñÊ†áËÆ∞‰ªªÂä°Êó∂ÂèëÁé∞ÔºåÊú¨Âú∞Â∑•‰ΩúÈòüÂàó‰∏∫Á©∫Ôºå‰πü‰ºö‰ªéÂÖ®Â±ÄÂ∑•‰ΩúÁºìÂ≠ò‰∏≠Ëé∑Âèñ‰ªªÂä°ÊîæÂà∞Êú¨Âú∞ÈòüÂàó‰∏≠„ÄÇ</li>
</ol>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221229163955508.png" alt="image-20221229163955508" style="zoom:33%;" />
<p>Ëá≥‰∫éÂÜôÂ±èÈöúÔºåÊØè‰∏™<code>p</code>ÈÉΩÊúâ‰∏Ä‰∏™ÂÜôÂ±èÈöúÁºìÂÜ≤Âå∫ÔºåÊâÄ‰ª•ÂÜôÂ±èÈöúËß¶ÂèëÊó∂ÔºåÂπ∂‰∏ç‰ºöÁõ¥Êé•Êìç‰ΩúÂ∑•‰ΩúÈòüÂàóÔºåËÄåÊòØ<strong>ÊääÁõ∏ÂÖ≥ÊåáÈíàÂÜôÂÖ•ÂΩìÂâç<code>p</code>ÁöÑÂÜôÂ±èÈöúÁºìÂÜ≤Âå∫</strong>‰∏≠Ôºå<strong>ÂΩìÂÜôÂ±èÈöúÁºìÂÜ≤Âå∫Â∑≤Êª°Êàñ<code>mark worker</code>ÈÄöËøáÂ∑•‰ΩúÈòüÂàóËé∑Âèñ‰∏çÂà∞‰ªªÂä°Êó∂</strong>Ôºå‰ºöÊääÂÜôÂ±èÈöúÁºìÂÜ≤ÂÜÖÂÆπ<code>flush</code>Âà∞Â∑•‰ΩúÁºìÂ≠ò‰∏≠„ÄÇÈÄöËøáÂå∫ÂàÜÊú¨Âú∞Â∑•‰ΩúÈòüÂàó‰∏éÂÖ®Â±ÄÂ∑•‰ΩúÁºìÂ≠òÔºåÂπ∂<strong>‰∏∫ÊØè‰∏™<code>p</code>ËÆæÁΩÆÂÜôÂ±èÈöúÁºìÂÜ≤Âå∫ÔºåÁºìËß£‰∫ÜÊâßË°åÂπ∂ÂèëÊ†áËÆ∞Â∑•‰ΩúÊó∂Êìç‰ΩúÂ∑•‰ΩúÈòüÂàóÁöÑÁ´û‰∫âÈóÆÈ¢ò„ÄÇ</strong></p>
<p>ËôΩÁÑ∂<code>GC</code>ÂàùÂßãÂåñÊó∂‰∏∫ÊØè‰∏™<code>p</code>ÈÉΩÂàõÂª∫‰∫Ü‰∏Ä‰∏™<code>mark worker</code>Ôºå‰ΩÜÊòØ<strong>Ë∞ÉÂ∫¶Êó∂ÂèØ‰ª•ÂêØÂä®Â§öÂ∞ë‰∏™‰πüÊòØ‰∏™ÈóÆÈ¢ò</strong>„ÄÇ</p>
<ol start="3">
<li>
<p><strong>ÂÖ≥‰∫é<code>GC</code>ÂØπ<code>CPU</code>ÁöÑ‰ΩøÁî®ÁéáÔºö</strong><code>GC</code>ÈªòËÆ§ÁöÑ<code>CPU</code>ÁõÆÊ†á‰ΩøÁî®Áéá‰∏∫<code>25%</code>ÔºåÂú®<code>GC</code>ÊâßË°åÁöÑÂàùÂßãÂåñÈò∂ÊÆµÔºå‰ºöÊ†πÊçÆÂΩìÂâç<code>gomaxprocs</code>Êï∞ÂÄº‰πò‰ª•<code>CPU</code>ÁõÆÊ†á‰ΩøÁî®ÁéáÔºåÊù•ËÆ°ÁÆóÈúÄË¶ÅÂêØÂä®ÁöÑ<code>mark worker</code>Êï∞ÈáèÔºå‰∏∫‰∫ÜÂ∫îÂØπËÆ°ÁÆóÁªìÊûú‰∏ç‰∏∫Êï¥Êï∞ÁöÑÊÉÖÂÜµÔºå‰ºöÂØπËØ•ÁªìÊûúËøõË°åÂä†<code>0.5</code>ÁöÑ<code>rounding</code>Ôºå‰ΩÜÊòØËøôÊ†∑ÁöÑ<code>rounding</code>‰ºöÂíåÂéüÁõÆÊ†á‰∫ßÁîüËØØÂ∑ÆÔºåËØØÂ∑ÆË∂ÖËøá<code>0.3</code>Â∞±ÊØîËæÉÊòæËëó‰∫Ü„ÄÇ‰æãÂ¶Ç<code>gomaxprocs=6</code>ÁöÑÊÉÖÂÜµÔºåÊ≠§Êó∂ÔºåÂ¶ÇÊûúË∞ÉÂ∫¶Êó∂ÂÖÅËÆ∏ÂêØÁî®‰∏§‰∏™<code>mark worker</code>Â∞±Êúâ‰∫õÂ§ö‰∫Ü„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221229172058110.png" alt="image-20221229172058110" style="zoom:33%;" />
<p><strong>‰∏∫Ê≠§</strong>Ôºå<code>GC</code>Âú®<code>mark worker</code>‰∏≠ÂºïÂÖ•‰∫Ü‰∏çÂêåÁöÑÂ∑•‰ΩúÊ®°ÂºèÔºåËÆ∞ÂΩïÂú®<code>p</code>‰∏≠Ôºå‰Ωú‰∏∫ÂØπÂ∫î<code>p</code>ÁöÑ<code>mark worker</code>ÁöÑÂ∑•‰ΩúÊ®°ÂºèÔºö</p>
<ul>
<li><code>Dedicated</code>Ê®°ÂºèÁöÑ<code>worker</code>‰ºöÊâßË°åÊ†áËÆ∞‰ªªÂä°Áõ¥Âà∞Ë¢´Êä¢Âç†Ôºõ</li>
<li><code>Fractional</code>Ê®°ÂºèÁöÑ<code>worker</code>Èô§‰∫ÜË¢´Êä¢Âç†Â§ñÔºåËøòÂèØ‰ª•Âú®ËææÂà∞<code>fractional</code>ÈÉ®ÂàÜÁöÑÁõÆÊ†áÊó∂‰∏ªÂä®ËÆ©Âá∫„ÄÇ‰æãÂ¶ÇÔºåÂ¶ÇÊûú<code>gomaxprocs=4</code>ÔºåÂ∞±Âè™ÈúÄË¶ÅÂêØÂä®‰∏Ä‰∏™<code>Dedicated</code>Ê®°ÂºèÁöÑ<code>worker</code>Âç≥ÂèØÔºõÂ¶ÇÊûú<code>gomaxprocs=6</code>ÔºåÈô§‰∫Ü‰∏Ä‰∏™<code>Dedicated</code>Ê®°ÂºèÁöÑ<code>worker</code>Â§ñÔºåËøòÂÖÅËÆ∏ÂÜçÂêØÁî®‰∏Ä‰∏™<code>Fractional</code>Ê®°ÂºèÁöÑ<code>worker</code>Ôºå<code>Fractional</code>ÈÉ®ÂàÜÁöÑÁõÆÊ†á‰∏∫<code>0.5</code>ÔºåËøô‰ºöÁî±ÊâÄÊúâ<code>p</code>ÂÖ±ÂêåË¥üË¥£ÔºåÊâÄ‰ª•ËøôÈáåÂØπÊØè‰∏™<code>p</code>ËÄåË®ÄÔºå<code>fractionalUtilizationGoal=1/12</code>„ÄÇ</li>
</ul>
</li>
</ol>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221229172521378.png" alt="image-20221229172521378" style="zoom:33%;" />
<p>**ÂÖ®Â±ÄÂèòÈáè<code>gcController</code>**‰∏≠‰ºöËÆ∞ÂΩïÂèØ‰ª•ÂêØÂä®Â§öÂ∞ë‰∏™<code>Dedicated</code>Ê®°ÂºèÁöÑ<code>worker</code>ÔºåËøò‰ºöËÆ∞ÂΩï<code>fractionalUtilizationGoal</code>ÔºåË∞ÉÂ∫¶Âô®ÊâßË°å<code>findRunnableGcWorker</code>Ôºå<strong>ÊÉ≥Ë¶ÅÊÅ¢Â§çÂêéÂè∞<code>mark worker</code>Êó∂</strong>ÔºåÈúÄË¶ÅËÆæÁΩÆ<code>worker</code>ËøêË°åÁöÑÊ®°ÂºèÔºö</p>
<ul>
<li>Â¶ÇÊûú<code>Dedicated</code>Ê®°ÂºèÁöÑ<code>worker</code>Êï∞ÁõÆËøòÊ≤°ÊúâËææÂà∞‰∏äÈôêÔºåÂ∞±ËÆæÁΩÆ‰∏∫<code>Dedicated</code>Ê®°ÂºèÔºõ</li>
<li>Â¶ÇÊûú<code>Dedicated</code>Ê®°ÂºèÁöÑ<code>worker</code>Êï∞ÈáèËææÂà∞‰∏äÈôêÂêéÔºåÂ∞±Ë¶ÅÁúãÊòØÂê¶ÈúÄË¶Å<code>Fractional</code>Ê®°ÂºèÁöÑ<code>worker</code>ËæÖÂä©Â∑•‰ΩúÔºåÈúÄË¶ÅÁöÑËØùÂ∞±ËÆæÁΩÆ‰∏∫<code>Fractional</code>Ê®°ÂºèÔºå<code>p</code>‰ºöËÆ∞ÂΩïËá™Â∑±Á¥ØËÆ°ÊâßË°å<code>Fractional worker</code>ÁöÑÊó∂Èó¥‰∏éÂΩìÂâç<code>worker</code>ÂºÄÂßãÂ∑•‰ΩúÁöÑÊó∂Èó¥ÔºåËÄå<code>gcController</code>‰ºöËÆ∞ÂΩïÊú¨ËΩÆ<code>GC</code>Ê†áËÆ∞Â∑•‰ΩúÂºÄÂßãÁöÑÊó∂Èó¥ÔºåÂΩìÂâç<code>p</code>ÊâßË°å<code>Fractional</code>Ê®°ÂºèÁöÑÊ†áËÆ∞<code>worker</code>Êó∂ÔºåÊØèÂÆåÊàê‰∏ÄÂÆöÈáèÁöÑÂ∑•‰ΩúÔºåÂ∞±‰ºöÊ£ÄÊü•ÂΩìÂâç<code>p</code>Á¥ØËÆ°Âú®<code>Fractional</code>Ê®°Âºè‰∏ãÁöÑÂ∑•‰ΩúÊó∂Èó¥‰∏éÊú¨ËΩÆ<code>GC</code>Ê†áËÆ∞Â∑•‰ΩúÂ∑≤ÊâßË°åÁöÑÊó∂Èó¥ÁöÑÊØîÁéáÔºåÊòØÂê¶ËææÂà∞‰∫Ü<code>fractionalUtilizationGoal</code>ÔºöÂ¶ÇÊûúËææÂà∞‰∫ÜÔºåÂΩìÂâç<code>worker</code>Â∞±ÂèØ‰ª•ËÆ©Âá∫‰∫Ü„ÄÇ</li>
</ul>
<p>ÈÄöËøáËøôÊ†∑ÁöÑÊñπÂºèÔºåÂèØ‰ª•ÊúâÊïàÁöÑÊéßÂà∂<code>GC</code>ÁöÑ<code>CPU</code>‰ΩøÁî®Áéá„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221229173321726.png" alt="image-20221229173321726" style="zoom:33%;" />
<ol start="4">
<li><strong>ÂÖ≥‰∫é<code>GC</code>ÊâßË°åËøáÁ®ã‰∏≠ÁöÑÂÜÖÂ≠òÂàÜÈÖçÂéãÂäõÔºö<strong>‰∏∫‰∫ÜÈÅøÂÖçÂÜÖÂ≠òÂàÜÈÖçÂéãÂäõËøáÂ§ßÔºåGoËØ≠Ë®ÄÂÆûÁé∞‰∫Ü</strong><code>GC Assist</code>Êú∫Âà∂(ËæÖÂä©GC)</strong>„ÄÇ</li>
</ol>
<p>Â¶ÇÊûúÂçèÁ®ãË¶ÅÂàÜÈÖçÂÜÖÂ≠òÔºåËÄå**<code>GC</code>Ê†áËÆ∞**Â∑•‰ΩúÂ∞öÊú™ÂÆåÊàêÔºåÂÆÉÂ∞±Ë¶ÅË¥üË¥£‰∏ÄÈÉ®ÂàÜÊ†áËÆ∞Â∑•‰ΩúÔºå<strong>Ë¶ÅÁî≥ËØ∑ÁöÑÂÜÖÂ≠òË∂äÂ§ßÔºåÂØπÂ∫îË¶ÅË¥üÊãÖÁöÑÊ†áËÆ∞‰ªªÂä°Â∞±Ë∂äÂ§ö(Ë¥üÂÄ∫Ë∂äÂ§ö)</strong>ÔºåËøôÊòØ‰∏ÄÁßçÂÄüË¥∑ÂÅøËøòÊú∫Âà∂Ôºö</p>
<ul>
<li>ÂΩìÂâç<code>g</code>‰∏≠<code>gcAssistBytes</code>Ëã•Â∞è‰∫é0ÔºåÂàôÂΩìÂâç<code>g</code>Èù¢‰∏¥Ë¥üÂÄ∫Ôºõ</li>
<li>Â§ß‰∫é0ÔºåÂàôË°®Á§∫ÊúâÁªì‰Ωô„ÄÇ</li>
</ul>
<p><strong>ÊúâË¥üÂÄ∫ÁöÑ<code>g</code><strong>Âú®Áî≥ËØ∑ÂÜÖÂ≠òÂâçÔºåÈúÄË¶ÅËæÖÂä©<code>GC</code>ÂÆåÊàê‰∏Ä‰∫õÊ†áËÆ∞Â∑•‰ΩúÊù•ÂÅøËøòÂÄ∫Âä°Ôºå‰∏çËøáÔºåÂêéÂè∞<code>mark worker</code>ÊØèÂÆåÊàê‰∏ÄÂÆöÈáèÁöÑÊ†áËÆ∞‰ªªÂä°ÔºåÂ∞±‰ºöÂú®ÂÖ®Â±Ä<code>gcController</code>Â≠ò‰∏ÄÁ¨î‰ø°Áî®ÔºåÊúâÂÄ∫Âä°ÈúÄË¶ÅÂÅøËøòÁöÑ<code>g</code>ÂèØ‰ª•‰ªé<code>gcController</code>ËøôÈáå<code>steal</code>Â∞ΩÈáèÂ§öÁöÑ‰ø°Áî®ÔºåÊù•ÊäµÊ∂àËá™Â∑±ÊâÄÊ¨†ÁöÑÂÄ∫Âä°Ôºå‰∏çÁÆ°ÊòØÁúüÊ≠£ÊâßË°åÊ†áËÆ∞Êâ´Êèè‰ªªÂä°ÔºåËøòÊòØ‰ªé<code>gcController</code>ËøôÈáå</strong><code>steal</code>‰ø°Áî®</strong>ÔºåÂ¶ÇÊûúËøô‰∏ÄÊ¨°ÂÅøËøò‰∫ÜÂΩìÂâçÂÄ∫Âä°ÂêéËøòÊúâÁªì‰ΩôÔºåÂ∞±ÂèØ‰ª•Áî®‰∫éÊäµÊ∂à‰∏ãÊ¨°ÂÜÖÂ≠òÂàÜÈÖçÁöÑÂÄ∫Âä°‰∫Ü„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221229174239972.png" alt="image-20221229174239972" style="zoom:33%;" />
<p><code>GC</code>Ê†áËÆ∞Èò∂ÊÆµÊØèÊ¨°ÂÜÖÂ≠òÂàÜÈÖçÔºåÈÉΩ‰ºöÊ£ÄÊü•ÊòØÂê¶ÈúÄË¶Å**<code>ËæÖÂä©Ê†áËÆ∞</code><strong>ÔºõËÄåÂà∞‰∫Ü<code>GC</code>Ê∏ÖÊâ´Èò∂ÊÆµÔºåÂÜÖÂ≠òÂàÜÈÖçÂ∞±ÂèØËÉΩ‰ºöËß¶Âèë</strong><code>ËæÖÂä©Ê∏ÖÊâ´</code>**„ÄÇ</p>
<p>‰æãÂ¶ÇÔºåÁõ¥Êé•‰ªé<code>mheap</code>ÂàÜÈÖçÂ§ßÂØπË±°Êó∂Ôºå‰∏∫‰∫ÜÁª¥ÊåÅÂ†ÜÂÜÖÂ≠òÂàÜÈÖçÈáè‰∏éÊ∏ÖÊâ´È°µÈù¢Êï∞ÈáèÁöÑÁ∫øÊÄßÂÖ≥Á≥ªÔºåÂèØËÉΩÈúÄË¶ÅÊâßË°å‰∏ÄÂÆöÈáèÁöÑÊ∏ÖÊâ´Â∑•‰Ωú„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221229174515178.png" alt="image-20221229174515178" style="zoom:33%;" />
<p>ÂÜç‰æãÂ¶ÇÔºå‰ªéÊú¨Âú∞ÁºìÂ≠ò‰∏≠Áõ¥Êé•ÂàÜÈÖç‰∏Ä‰∏™<code>span</code>Êó∂ÔºåËã•ÈÅáÂà∞Â∞öÊú™Ê∏ÖÊâ´ÁöÑÂèØÁî®<code>span</code>Ôºå‰πüÈúÄË¶ÅÂÖàÊ∏ÖÊâ´Ëøô‰∏™<code>span</code>ÂÜçÂàÜÈÖç‰ΩøÁî®„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221229174635779.png" alt="image-20221229174635779" style="zoom:33%;" />
<p><strong><code>ËæÖÂä©Ê†áËÆ∞</code>Âíå<code>ËæÖÂä©Ê∏ÖÊâ´</code>ÂèØ‰ª•ÈÅøÂÖçÂá∫Áé∞Âπ∂ÂèëÂûÉÂúæÂõûÊî∂‰∏≠ÔºåÂõ†ËøáÂ§ßÁöÑÂÜÖÂ≠òÂàÜÈÖçÂéãÂäõÂØºËá¥<code>GC</code>Êù•‰∏çÂèäÂõûÊî∂ÁöÑÊÉÖÂÜµ„ÄÇ</strong></p>
<ol start="5">
<li><strong>ÂÖ≥‰∫éÊ∑∑ÂêàÂÜôÂ±èÈöúÔºö</strong></li>
</ol>
<p>È¶ñÂÖàÁúã‰∏ãGoËØ≠Ë®ÄÂÜôÂ±èÈöúÁöÑ‰º™‰ª£Á†ÅÔºå<code>slot</code>ÁöÑÂéüÊåáÈíàÊòØ<code>old</code>ÔºåÂ¶ÇÊûúË¶ÅÊää<code>ptr</code>ÂÜôÂÖ•<code>slot</code>ÔºåÈÇ£‰πàÂØπÂéüÊåáÈíàÂèØËææË∑ØÂæÑÁöÑÂà†Èô§‰ºöËß¶Âèë<strong>Âà†Èô§ÂÜôÂ±èÈöú</strong>ÔºåÊñ∞ÊåáÈíàÂà∞<code>slot</code>ÂèØËææË∑ØÂæÑÁöÑÂ¢ûÂä†‰ºöËß¶Âèë<strong>ÊèíÂÖ•ÂÜôÂ±èÈöú</strong>ÔºåGoËØ≠Ë®ÄÊï¥Âêà‰∫Ü<strong>ÊèíÂÖ•‰∏éÂà†Èô§ÂÜôÂ±èÈöú</strong>ÔºåÁß∞‰πã‰∏∫<strong>Ê∑∑ÂêàÂÜôÂ±èÈöú</strong>„ÄÇ</p>
<blockquote>
<h4 id="ÈóÆÈ¢ò‰∏∫‰ªÄ‰πàË¶ÅÂä†ÂÖ•Âà†Èô§ÂÜôÂ±èÈöú"><strong>ÈóÆÈ¢òÔºö‰∏∫‰ªÄ‰πàË¶ÅÂä†ÂÖ•Âà†Èô§ÂÜôÂ±èÈöúÔºü</strong></h4>
</blockquote>
<p><strong>Âú®ÂºïÂÖ•Ê∑∑ÂêàÂÜôÂ±èÈöúÂâçÔºåÂè™ÊúâÊèíÂÖ•ÂÜôÂ±èÈöú</strong>Ôºå‰ΩÜÊòØËøôÈúÄË¶ÅÂØπÊâÄÊúâÂ†Ü„ÄÅÊ†àÁöÑÂÜôÊìç‰ΩúÈÉΩÂºÄÂêØÂÜôÂ±èÈöúÔºå‰ª£‰ª∑Â§™Â§ß„ÄÇ‰∏∫‰∫ÜÊîπÂñÑËøô‰∏™ÈóÆÈ¢òÔºåÊîπ‰∏∫ÂøΩÁï•ÂçèÁ®ãÊ†à‰∏äÁöÑÂÜôÂ±èÈöúÔºåÂè™Âú®Ê†áËÆ∞ÁªìÊùüÈò∂ÊÆµÔºåÈáçÊñ∞Êâ´ÊèèÈÇ£‰∫õË¢´ÊøÄÊ¥ªÁöÑÊ†àÂ∏ßÔºå‰ΩÜÊòØGoËØ≠Ë®ÄÈÄöÂ∏∏‰ºöÊúâÂ§ßÈáèÊ¥ªË∑ÉÁöÑÂçèÁ®ãÔºåËøôÂ∞±ÂØºËá¥Á¨¨‰∫åÊ¨°<code>STW</code>Êó∂ÔºåÈáçÊñ∞Êâ´ÊèèÂçèÁ®ãÊ†àÁöÑÊó∂Èó¥ËøáÈïø„ÄÇ<strong>Â¶ÇÊûúÂú®ÂøΩÁï•ÂÜôÂ±èÈöúÁöÑÂâçÊèê‰∏ãÔºåËÉΩÂ§ü‰øùÈöúÂÜôÂÖ•Ê†à‰∏äÁöÑÊï∞ÊçÆÂØπË±°‰∏ç‰ºöË¢´<code>hiding</code></strong>ÔºåÂ∞±‰∏çÁî®Âú®Á¨¨‰∫åÊ¨°<code>STW</code>Êó∂ÈáçÊñ∞Êâ´ÊèèËøô‰∫õÊ†àÂ∏ß‰∫Ü„ÄÇ<strong>ËÄåÂà†Èô§ÂÜôÂ±èÈöúÊÅ∞Â•ΩÂèØ‰ª•Ëß£ÂÜ≥ËøôÁÇπ</strong>„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221229175748570.png" alt="image-20221229175748570" style="zoom:33%;" />
<p>‰æãÂ¶ÇÔºåÂΩìÂâç<code>g</code>ÁöÑÊ†àÂ∏ß‰∏≠<code>A</code>Â∑≤ÁªèÂÆåÊàêÊâ´ÊèèÔºåÁÑ∂Âêé<code>g</code>ÊâßË°åÔºåÊää<code>old</code>ÂÜôÂÖ•Ê†à‰∏äÁöÑÊú¨Âú∞ÂèòÈáè<code>A</code>ÔºåÊ†à‰∏äÂπ∂Ê≤°ÊúâÊèíÂÖ•ÂÜôÂ±èÈöúÔºå<code>old</code>Âπ∂‰∏ç‰ºöË¢´Ê†áËÆ∞Ôºå‰πãÂêéÊääÊñ∞ÊåáÈíà<code>ptr</code>ÂÜôÂÖ•<code>slot</code>ÔºåÂ¶ÇÊûúÊ≤°ÊúâÂºïÂÖ•Âà†Èô§ÂÜôÂ±èÈöúÔºåÊ≠§Êó∂ÊäµËææ<code>old</code>ÁöÑÂîØ‰∏ÄË∑ØÂæÑË¢´ÊâìÊñ≠Ôºå<code>old</code>Â∞±‰∏çËÉΩË¢´<code>GC</code>ÂèëÁé∞ÔºåÊâÄ‰ª•ÈúÄË¶ÅÂú®Âà†Èô§<code>old</code>ÁöÑÂèØËææË∑ØÂæÑÊó∂Ôºå<strong>ÈÄöËøáÂà†Èô§ÂÜôÂ±èÈöúÊääÂÆÉÊ†áËÆ∞‰∏∫ÁÅ∞Ëâ≤</strong>„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221229180135141.png" alt="image-20221229180135141" style="zoom: 33%;" />
<p>Â¶ÇÊûú<code>slot</code>Â∑≤ÁªèÊ†áËÆ∞‰∏∫ÈªëËâ≤ÔºåÊ†à‰∏äÁöÑ<code>C</code>ËøòÊú™Ë¢´Êâ´ÊèèÔºåÊé•‰∏ãÊù•<code>g</code>ÊâßË°åÔºåÊää<code>ptr</code>ÂÜôÂÖ•<code>slot</code>ÔºåËÄåÂΩìÂâç<code>g</code>ÂàáÊñ≠<code>C</code>Âà∞Ëææ<code>ptr</code>ÁöÑÂèØËææË∑ØÂæÑÊó∂ÔºåÂπ∂Ê≤°ÊúâÂà†Èô§ÂÜôÂ±èÈöúÔºå‰∏ç‰ºöÊ†áËÆ∞<code>ptr</code>Ôºå‰∏∫‰∫ÜÈÅøÂÖçÂ∞ÜÁôΩËâ≤ÂØπË±°ÂÜôÂÖ•Â†Ü‰∏äÁöÑÈªëËâ≤ÂØπË±°ÔºåÂ∞±Ë¶ÅÈù†<strong>ÊèíÂÖ•ÂÜôÂ±èÈöúÔºåÂú®ÂÜôÂÖ•<code>slot</code>Êó∂Ê†áËÆ∞Êñ∞ÊåáÈíà</strong>„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221229180424615.png" alt="image-20221229180424615" style="zoom:33%;" />
<p>Ëá≥‰∫éÂà§Êñ≠ÂΩìÂâçÊ†àÊòØÂê¶‰∏∫ÁÅ∞Ëâ≤ÔºåÊòØÂõ†‰∏∫Â¶ÇÊûúÂΩìÂâçÂ∑≤ÁªèÊòØÂÆåÊàêÊâ´ÊèèÁöÑÈªëËâ≤Ê†àÔºåÈÇ£‰πàÂÆÉÊåáÂêëÁöÑÂØπË±°‰∏ÄÂÆöÂ∑≤ÁªèË¢´Ê†áËÆ∞‰∫ÜÔºåÊèíÂÖ•ÂÜôÂ±èÈöúÂ∞±Ê≤°ÂøÖË¶ÅÂÜçÊ†áËÆ∞‰∏ÄÊ¨°‰∫Ü„ÄÇÊâÄ‰ª•Ôºå<strong>‰ΩøÁî®Ê∑∑ÂêàÂÜôÂ±èÈöúÁöÑÊÑè‰πâÂú®‰∫éÔºö<strong>Êó¢ÂèØ‰ª•ÂøΩÁï•ÂΩìÂâçÊ†àÂ∏ßÁöÑÂÜôÂ±èÈöúÔºå‰πü‰∏çÁî®Âú®Á¨¨‰∫åÊ¨°<code>STW</code>Êó∂ÔºåÈáçÊñ∞Êâ´ÊèèÊâÄÊúâÊ¥ªË∑É<code>g</code>ÁöÑÊ†àÂ∏ß„ÄÇÂè™Êúâ</strong>Ê†àÊòØÁÅ∞Ëâ≤</strong>ÁöÑÊó∂ÂÄôÔºåÊâçÈúÄË¶Å<strong>ÊèíÂÖ•ÂÜôÂ±èÈöú</strong>„ÄÇ</p>
<p>**==Êç¢Âè•ËØùËØ¥==ÔºåÂÅáÂ¶ÇÊ≤°ÊúâÂà†Èô§ÂÜôÂ±èÈöúÔºåÊØèÊ¨°Êìç‰ΩúÊ†à‰∏äÁöÑÊåáÈíàÈÉΩË¶ÅÁªèËøáÊèíÂÖ•ÂÜôÂ±èÈöúÔºåËøôÂ∞ÜÊûÅÂ§ßÈôêÂà∂ÊÄßËÉΩ„ÄÇ**‰ΩÜÂÆûÈôÖ‰∏äÂèØ‰ª•ÂàÜÊûê‰∏Ä‰∏ãÔºåÂΩì‰∏∫Ê†à‰∏äÁöÑÊåáÈíàËµãÂÄºÊó∂Ôºå‰∏ÄÂÖ±Â∞±ÂõõÁßçÊù•Ê∫êÔºöÂÖ®Êñ∞ÂàÜÈÖç„ÄÅÊ†à‰∏äÁöÑÊåáÈíà„ÄÅÂ†Ü‰∏äÁöÑÊåáÈíà„ÄÅÂÖ®Â±ÄÊï∞ÊçÆÊÆµÁöÑÊåáÈíà„ÄÇ</p>
<ul>
<li>ÂÖ®Êñ∞ÂàÜÈÖçÁöÑÂØπË±°Âú®Ê†áËÆ∞Èò∂ÊÆµ‰ºöËá™Âä®Ë¢´Ê†áËÆ∞‰∏∫<strong>ÈªëËâ≤</strong>ÔºåÂõ†Ê≠§‰∏çÈúÄË¶ÅÈ¢ùÂ§ñÂ§ÑÁêÜÔºõ</li>
<li>Ê†à‰∏äÊåáÈíàÈó¥ÁöÑËµãÂÄº‰πü‰∏çÂøÖÁî®ÂÜôÂ±èÈöúÔºåÂõ†‰∏∫‰∏ç‰ºöÈöêËóèÂÖ∂‰ªñÊåáÈíàÔºõ</li>
<li>Â†ÜÂíåÂÖ®Â±ÄÊï∞ÊçÆÊÆµÔºåÂ¶ÇÊûú‰ªÖ‰ªÖÊòØ‰ªéÂÆÉ‰ª¨ÈÇ£ÈáåÊääÊåáÈíàÂ§çÂà∂Âà∞Ê†à‰∏äÔºåÈÇ£‰πü‰∏ç‰ºöÊúâÂï•ÈóÆÈ¢òÔºå<strong>ÈóÆÈ¢òÂá∫Âú®</strong>ÔºåËã•Â§çÂà∂Âà∞Ê†à‰∏ä‰πãÂêéÔºåÂ†ÜÊàñÂÖ®Â±ÄÊï∞ÊçÆÊÆµ‰∏≠ÁöÑÊóßÊåáÈíàË¢´Âà†Êéâ‰∫ÜÔºå‰∏îÂÆÉÊåáÂêëÁöÑÂØπË±°Ê≤°ÊúâÂÖ∂‰ªñÊåáÈíà‰πüÊåáÂêëÂÆÉÔºåÈÇ£ÂÆÉÊåáÂêëÁöÑÂØπË±°Â∞±‰ºöË¢´&quot;ÈöêËóè&quot;‰∫Ü„ÄÇ<strong>ÊâÄ‰ª•ÔºåÈóÆÈ¢òÂè™Âá∫Âú®Âà†Èô§Êìç‰Ωú‰∏ä„ÄÇ</strong></li>
</ul>
<p>Âõ†Ê≠§Ôºå<strong>ÂΩìÂ†ÜÊàñÂÖ®Â±ÄÊï∞ÊçÆÊÆµÂà†Èô§ÂØπË±°Êó∂ÔºåÈúÄË¶ÅÂ∫îÁî®Âà†Èô§ÂÜôÂ±èÈöú</strong>ÔºåÁÅ∞ÂåñÂà†Èô§ÊåáÈíàÊåáÂêëÁöÑÂØπË±°„ÄÇ</p>
<p>==<strong>ËøôÊ†∑ÔºåÂ∞±‰∏çÈúÄË¶ÅÂØπÊ†à‰ΩøÁî®ÂÜôÂ±èÈöú‰∫Ü„ÄÇ</strong>==</p>
<ol start="6">
<li><strong>ÂÖ≥‰∫é<code>GC</code>Ëß¶ÂèëÊñπÂºèÔºö</strong></li>
</ol>
<ul>
<li><strong>ÊâãÂä®Ëß¶Âèë</strong>„ÄÇÂÖ•Âè£Âú®<code>runtime.GC()</code>ÂáΩÊï∞‰∏≠„ÄÇ</li>
<li><strong>ÂàÜÈÖçÂÜÖÂ≠ò</strong>„ÄÇÂàÜÈÖçÂÜÖÂ≠òÊó∂ÔºåÊúâ‰∫õÊÉÖÂÜµÈúÄË¶ÅÊ£ÄÊü•ÊòØÂê¶ÈúÄË¶ÅËß¶Âèë<code>GC</code>ÔºåÊØèÊ¨°<code>GC</code>ÈÉΩ‰ºöÂú®Ê†áËÆ∞ÁªìÊùüÂêéËÆæÁΩÆ‰∏ã‰∏ÄÊ¨°Ëß¶Âèë<code>GC</code>ÁöÑÂ†ÜÂÜÖÂ≠òÂàÜÈÖçÈáèÔºåÂàÜÈÖçÂ§ßÂØπË±°Êàñ‰ªé<code>mcentral</code>Ëé∑ÂèñÁ©∫Èó≤ÂÜÖÂ≠òÊó∂Ôºå‰ºö<strong>Âà§Êñ≠ÊòØÂê¶ËææÂà∞‰∫ÜËøôÈáåËÆæÁΩÆÁöÑ<code>gc_trigger</code>‰ª•ÂÜ≥ÂÆöÊòØÂê¶Ë¶ÅËß¶Âèë<code>GC</code></strong>„ÄÇ</li>
<li><strong><code>sysmon</code></strong>„ÄÇ<strong>ÁõëÊéßÁ∫øÁ®ãÁöÑ‰∏ÄÈ°π‰ªªÂä°Â∞±ÊòØÂº∫Âà∂ÊâßË°å<code>GC</code></strong>ÔºåÂú®<code>runtime</code>ÂåÖÂàùÂßãÂåñÊó∂Ôºå‰ºö‰ª•<code>forcegchelper</code>‰∏∫ÊâßË°åÂÖ•Âè£ÂºÄÂêØ‰∏Ä‰∏™ÂçèÁ®ãÔºåÂè™‰∏çËøáÂÆÉË¢´‰ªéÂàõÂª∫Âêé‰ºöÂæàÂø´ËøõÂÖ•‰ºëÁú†Ôºå<strong>ÁõëÊéßÁ∫øÁ®ãÂú®Ê£ÄÊµãÂà∞Ë∑ùÁ¶ª‰∏äÊ¨°<code>GC</code>Â∑≤ÁªèË∂ÖËøá‰∫ÜÊåáÂÆöÊó∂Èó¥</strong>Ôºå<strong>Â∞±‰ºöÊää<code>forcegchelper</code>ÂçèÁ®ãÊ∑ªÂä†Âà∞ÂÖ®Â±Ä<code>runq</code>‰∏≠ÔºåÁ≠âÂÆÉÂæóÂà∞Ë∞ÉÂ∫¶ÊâßË°åÊó∂Â∞±‰ºöÂºÄÂêØÊñ∞‰∏ÄËΩÆÁöÑ<code>GC</code></strong>„ÄÇ</li>
</ul>
<h3 id="223-Â†ÜÂÜÖÂ≠òÂàÜÈÖç">2.2.3 Â†ÜÂÜÖÂ≠òÂàÜÈÖç</h3>
<p>GoËØ≠Ë®ÄÁöÑ<code>runtime</code>Â∞ÜÂ†ÜÂú∞ÂùÄÁ©∫Èó¥ÂàíÂàÜÊàê‰∏Ä‰∏™‰∏Ä‰∏™ÁöÑ<code>arena</code>Ôºå<code>arena</code>Âå∫ÂüüÁöÑËµ∑ÂßãÂú∞ÂùÄË¢´ÂÆö‰πâ‰∏∫Â∏∏Èáè<code>arenaBaseOffset</code>ÔºåÂú®<code>amd64</code>Êû∂ÊûÑ‰∏ãÁöÑ<code>Linux</code>ÁéØÂ¢É‰∏ãÔºåÊØè‰∏™<code>arena</code>ÁöÑÂ§ßÂ∞èÊòØ<code>64MB</code>ÔºåËµ∑ÂßãÂú∞ÂùÄ‰πüÂØπÈΩêÂà∞<code>64MB</code>„ÄÇÊØè‰∏™<code>arena</code>ÂåÖÂê´<code>8192</code>‰∏™<code>page</code>ÔºåÊâÄ‰ª•ÊØè‰∏™<code>page</code>Â§ßÂ∞è‰∏∫<code>8KB</code>„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221223153110980.png" alt="image-   20221223153110980" style="zoom:33%;" />
<p>**ÈóÆÈ¢òÔºö**Âõ†‰∏∫Á®ãÂ∫èËøêË°åËµ∑Êù•ÊâÄÈúÄÂàÜÈÖçÁöÑÂÜÖÂ≠òÂùóÊúâÂ§ßÊúâÂ∞èÔºåËÄåÂàÜÊï£ÁöÑ„ÄÅÂ§ßÂ∞è‰∏ç‰∏ÄÁöÑÁ¢éÁâáÂåñÂÜÖÂ≠ò‰∏ÄÊñπÈù¢ÂèØËÉΩÈôç‰ΩéÂÜÖÂ≠òÂà©Áî®ÁéáÔºåÂè¶‰∏ÄÊñπÈù¢ÂèØËÉΩ‰ºöÊèêÈ´òË¶ÅÊâæÂà∞Â§ßÂ∞èÂêàÈÄÇÁöÑÂÜÖÂ≠òÂùóÁöÑ‰ª£‰ª∑„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221223153254645.png" alt="image-20221223153254645" style="zoom:33%;" />
<p><strong>Ëß£ÂÜ≥Ôºö<strong>‰∏∫Èôç‰ΩéÁ¢éÁâáÂåñÂÜÖÂ≠òÁªôÁ®ãÂ∫èÊÄßËÉΩÈÄ†ÊàêÁöÑ‰∏çËâØÂΩ±ÂìçÔºåGoËØ≠Ë®ÄÁöÑÂ†ÜÂàÜÈÖçÈááÁî®‰∫Ü‰∏é</strong><code>tcmalloc</code>ÂÜÖÂ≠òÂàÜÈÖçÂô®</strong>Á±ª‰ººÁöÑÁÆóÊ≥ï„ÄÇ**ÁÆÄÂçïÊù•ËÆ≤Â∞±ÊòØÔºö**ÊåâÁÖß‰∏ÄÁªÑÈ¢ÑÁΩÆÁöÑÂ§ßÂ∞èËßÑÊ†ºÊääÂÜÖÂ≠òÈ°µÂàíÂàÜÊàêÂùóÔºåÁÑ∂ÂêéÊää‰∏çÂêåËßÑÊ†ºÁöÑÂÜÖÂ≠òÂùóÊîæÂÖ•ÂØπÂ∫îÁöÑÁ©∫Èó≤ÈìæË°®‰∏≠„ÄÇÁ®ãÂ∫èÁî≥ËØ∑ÂÜÖÂ≠òÊó∂ÔºåÂàÜÈÖçÂô®‰ºöÂÖàÊ†πÊçÆË¶ÅÁî≥ËØ∑ÁöÑÂÜÖÂ≠òÂ§ßÂ∞èÔºåÊâæÂà∞ÊúÄÂåπÈÖçÁöÑËßÑÊ†ºÔºåÁÑ∂Âêé‰ªéÂØπÂ∫îÁ©∫Èó≤ÈìæË°®‰∏≠ÂàÜÈÖç‰∏Ä‰∏™ÂÜÖÂ≠òÂùó„ÄÇ</p>
<p>Go 1.16 <code>runtime</code>ÂåÖÁªôÂá∫‰∫Ü67ÁßçÈ¢ÑÁΩÆÁöÑÂ§ßÂ∞èËßÑÊ†ºÔºåÊúÄÂ∞è<code>8B</code>ÔºåÊúÄÂ§ß<code>32KB</code>„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221223154122579.png" alt="image-20221223154122579" style="zoom:33%;" />
<p>ÊâÄ‰ª•ÔºåÂú®ÂàíÂàÜÁöÑÊï¥Êï¥ÈΩêÈΩêÁöÑ<code>arena</code>ÈáåÔºåÂèà‰ºöÊåâÈúÄÂàíÂàÜÂá∫‰∏çÂêåÁöÑ<code>span</code>ÔºåÊØè‰∏™<code>span</code>ÂåÖÂê´‰∏ÄÁªÑËøûÁª≠ÁöÑ<code>page</code>ÔºåÂπ∂‰∏îÊåâÁÖßÁâπÂÆöËßÑÊ†ºÂàíÂàÜÊàêÁ≠âÂ§ßÁöÑÂÜÖÂ≠òÂùó„ÄÇ<strong>Â§ßÂ∞èÂÖ≥Á≥ªÊòØÔºö<code>arena</code> -&gt; <code>span</code> -&gt; <code>page</code> -&gt; <code>ÂÜÖÂ≠òÂùó</code></strong>„ÄÇËøô‰∫õÂ∞±ÁªÑÊàê‰∫ÜÂ†ÜÂÜÖÂ≠ò„ÄÇ</p>
<h4 id="2231-Êï∞ÊçÆÁªìÊûÑ">2.2.3.1 Êï∞ÊçÆÁªìÊûÑ</h4>
<p>Âú®Â†ÜÂÜÖÂ≠ò‰πãÂ§ñÔºåÊúâ‰∏ÄÂ§ßÁ•®Áî®‰∫éÁÆ°ÁêÜÂ†ÜÂÜÖÂ≠òÁöÑ<strong>Êï∞ÊçÆÁªìÊûÑ</strong>„ÄÇ</p>
<ul>
<li><code>mheap</code>Áî®‰∫éÁÆ°ÁêÜÊï¥‰∏™Â†ÜÂÜÖÂ≠òÔºõ</li>
<li>‰∏Ä‰∏™<code>arena</code>ÂØπÂ∫î‰∏Ä‰∏™<code>heapArena</code>ÁªìÊûÑÔºõ</li>
<li>‰∏Ä‰∏™<code>span</code>ÂØπÂ∫î‰∏Ä‰∏™<code>mspan</code>ÁªìÊûÑÔºõ</li>
<li><code>mheap</code>‰∏≠ÔºåÊúâ‰∏Ä‰∏™ÂÖ®Â±ÄÁöÑ<code>mspan</code>ÁÆ°ÁêÜ‰∏≠ÂøÉÔºåÂÆÉÊòØ‰∏Ä‰∏™ÈïøÂ∫¶‰∏∫<code>136</code>ÁöÑÊï∞ÁªÑÔºåÊï∞ÁªÑÂÖÉÁ¥†ÊòØ‰∏Ä‰∏™**<code>mcentral</code>ÁªìÊûÑ**+‰∏Ä‰∏™<code>padding</code>„ÄÇ</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221223160941435.png" alt="image-20221223160941435" style="zoom:50%;" />
<p><strong>ÈóÆÈ¢òÔºö</strong><code>mcentral</code>ÊÄé‰πàÁÆ°ÁêÜ<code>span</code>Âë¢Ôºü</p>
<p>**Ëß£Á≠îÔºö**ÂÆûÈôÖ‰∏äÔºå‰∏Ä‰∏™<code>mcentral</code>ÂØπÂ∫î‰∏ÄÁßç<code>mspan</code>ËßÑÊ†ºÁ±ªÂûãÔºåËÆ∞ÂΩïÂú®<code>spanclass</code>‰∏≠Ôºå<code>spanclass</code>È´ò‰∏É‰ΩçÊ†áËÆ∞ÂÜÖÂ≠òÂùóÂ§ßÂ∞èËßÑÊ†ºÁºñÂè∑Ôºå<code>runtime</code>Êèê‰æõÁöÑÈ¢ÑÁΩÆËßÑÊ†ºÂØπÂ∫îÁºñÂè∑<code>1</code>Âà∞<code>67</code>ÔºåÁºñÂè∑<code>0</code>ÁïôÂá∫Êù•Áî®‰ΩúÊ†áËÆ∞Â§ß‰∫é<code>32KB</code>ÁöÑÂ§ßÂùóÂÜÖÂ≠òÔºå‰πüÂç≥‰∏ÄÂÖ±<code>68</code>Áßç„ÄÇÁÑ∂ÂêéÊØèÁßçËßÑÊ†º‰ºöÊåâÁÖßÊòØÂê¶‰∏çÈúÄË¶Å<code>GC</code>Êâ´ÊèèÔºåËøõ‰∏ÄÊ≠•Âå∫ÂàÜÂºÄÔºåÁî®ÊúÄ‰Ωé‰ΩçËøõË°åÊ†áËØÜ„ÄÇÂåÖÂê´ÊåáÈíàÁöÑÈúÄË¶Å<code>GC</code>Êâ´ÊèèÔºåÂΩí‰∏∫<code>scannable</code>Ëøô‰∏ÄÁ±ªÔºå‰∏çÂê´ÊåáÈíàÁöÑÂΩí‰∏∫<code>noscan</code>Ëøô‰∏ÄÁ±ª„ÄÇÊâÄ‰ª•ÂÖ±ÂàÜ‰∏∫136Áßç„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221223160954624.png" alt="image-20221223160954624" style="zoom: 33%;" />
<p>ÊØèÁßç<code>spanclass</code>ÁöÑ<code>mcentral</code>‰∏≠Ôºå‰ºöËøõ‰∏ÄÊ≠•Â∞ÜÂ∑≤Áî®Â∞Ω‰∏éÊú™Áî®Â∞ΩÁöÑ<code>mspan</code>ÂàÜÂà´ÁÆ°ÁêÜÔºåÊØè‰∏ÄÁßçÂèà‰ºöÊîæÂà∞‰∏§‰∏™Âπ∂ÂèëÂÆâÂÖ®ÁöÑ<code>set</code>‰∏≠Ôºö‰∏Ä‰∏™ÊòØÂ∑≤Ê∏ÖÊâ´ÁöÑÔºå‰∏Ä‰∏™ÊòØÊú™Ê∏ÖÊâ´ÁöÑ„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221223161158130.png" alt="image-20221223161158130" style="zoom:33%;" />
<p>ÂÖ®Â±Ä<code>mspan</code>ÁÆ°ÁêÜ‰∏≠ÂøÉ<code>mcentral</code>Êñπ‰æøÂèñÁî®ÂêÑÁßçÁ±ªÂûãÁöÑ<code>mspan</code>Ôºå‰ΩÜÊòØ‰∏∫‰∫Ü‰øùÈöúÂ§ö‰∏™<code>p</code>‰πãÈó¥Âπ∂ÂèëÂÆâÂÖ®ÔºåÂÖç‰∏ç‰∫ÜÈ¢ëÁπÅÁöÑÂä†ÈîÅ„ÄÅËß£ÈîÅÔºå<strong>‰∏∫Èôç‰ΩéÂ§ö‰∏™<code>p</code>‰πãÈó¥ÁöÑÁ´û‰∫âÊÄß</strong>ÔºåGoËØ≠Ë®ÄÁöÑÊØè‰∏™<code>p</code>ÈÉΩÊúâ‰∏Ä‰∏™<strong>Êú¨Âú∞Â∞èÂØπË±°ÁºìÂ≠ò<code>p.mcache</code></strong>Ôºå‰ªéËøôÈáåÂèñÁî®Â∞±‰∏çÁî®ÂÜçÂä†ÈîÅ‰∫Ü„ÄÇ<code>mcache</code>Êúâ‰∏Ä‰∏™ÈïøÂ∫¶‰∏∫<code>136</code>ÁöÑ<code>*mspan</code>Á±ªÂûãÁöÑÊï∞ÁªÑÔºåËøòÊúâ‰∏ìÈó®Áî®‰∫éÂàÜÈÖçÂ∞è‰∫é<code>16</code>Â≠óËäÇÁöÑ<code>noscan</code>Á±ªÂûãÁöÑ<code>tinyÂÜÖÂ≠ò</code>ÔºåÂΩìÂâç<code>p</code>ÈúÄË¶ÅÁî®Âà∞ÁâπÂÆöËßÑÊ†ºÁ±ªÂûãÁöÑ<code>mspan</code>Êó∂ÔºåÂÖàÂéªÊú¨Âú∞ÁºìÂ≠òËøôÈáåÊâæÂØπÂ∫îÁöÑ<code>mspan</code>ÔºåÂ¶ÇÊûúÊ≤°ÊúâÊàñËÄÖÁî®ÂÆå‰∫ÜÔºåÂ∞±Âéª<code>mcentral</code>Ëé∑Âèñ‰∏Ä‰∏™ÊîæÂà∞Êú¨Âú∞ÔºåÊääÂ∑≤Áî®Â∞ΩÁöÑÂΩíËøòÂà∞<code>mcentral</code>ÁöÑ<code>full set</code>‰∏≠Ôºå</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221223161653430.png" alt="image-20221223161653430" style="zoom:33%;" />
<p>Êé•‰∏ãÊù•Áúã<code>heapArena</code>ÔºåËøôÈáåÂ≠òÂÇ®ÁùÄ<code>arena</code>ÁöÑÂÖÉÊï∞ÊçÆÔºåÈáåÈù¢Êúâ‰∏ÄÁæ§‰ΩçÂõæÊ†áËÆ∞„ÄÇ</p>
<ul>
<li>ÂÖ∂‰∏≠Ôºå<code>bitmap</code>‰ΩçÂõæÔºåÁî®<strong>‰∏Ä‰Ωç</strong>Ê†áËÆ∞Ëøô‰∏™<code>arena</code>‰∏≠‰∏Ä‰∏™ÊåáÈíàÂ§ßÂ∞èÁöÑÂÜÖÂ≠òÂçïÂÖÉÂà∞Â∫ïÊòØÊåáÈíàËøòÊòØÊ†áÈáèÔºåÂÜçÁî®‰∏Ä‰ΩçÊù•Ê†áËÆ∞ËøôÂùóÂÜÖÂ≠òÂçïÂÖÉÁöÑÂêéÁª≠ÂçïÂÖÉÊòØÂê¶ÂåÖÂê´ÊåáÈíàÔºåËÄå‰∏î‰∏∫‰∫Ü‰æø‰∫éÊìç‰ΩúÔºå<code>bitmap</code>‰∏≠Áî®<strong>‰∏ÄÂ≠óËäÇ</strong>Ê†áËÆ∞<code>arena</code>‰∏≠4‰∏™ÊåáÈíàÂ§ßÂ∞èÁöÑÂÜÖÂ≠òÁ©∫Èó¥Ôºå‰Ωé4‰ΩçÁî®‰∫éÁî®‰∫éÊ†áËÆ∞ÊåáÈíà/Ê†áÈáèÔºåÈ´ò4‰ΩçÁî®‰∫éÊ†áËÆ∞Êâ´Êèè/ÁªàÊ≠¢„ÄÇ‰æãÂ¶ÇÊ≠§Â§Ñ<code>slice</code>Ôºå<code>bitmap</code>Á¨¨‰∏ÄÂ≠óËäÇÁöÑ<code>0-3</code>‰ΩçÂàÜÂà´Ê†áËÆ∞‰∏â‰∏™ÂØπÂ∫îÂ≠óÊÆµÊòØÊåáÈíàËøòÊòØÊ†áÈáèÔºåÁ¨¨<code>4-6</code>‰ΩçÂàÜÂà´Ê†áËÆ∞‰∏â‰∏™ÂØπÂ∫îÂ≠óÊÆµÊòØÂê¶ÈúÄË¶ÅÁªßÁª≠Êâ´Êèè„ÄÇ</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221223172629595.png" alt="image-20221223172629595" style="zoom: 33%;" />
<ul>
<li><code>pageInUse</code>ÊòØ‰∏™<code>uint8</code>Á±ªÂûãÁöÑÊï∞ÁªÑÔºåÈïøÂ∫¶‰∏∫<code>1024</code>ÔºåÊâÄ‰ª•‰∏ÄÂÖ±<code>8192</code>‰Ωç„ÄÇËøô‰∏™‰ΩçÂõæÂè™Ê†áËÆ∞**Â§Ñ‰∫é‰ΩøÁî®Áä∂ÊÄÅ(mSpanInUse)**ÁöÑ<code>span</code>ÁöÑÁ¨¨‰∏Ä‰∏™<code>page</code>„ÄÇ‰æãÂ¶ÇÔºå<code>arena</code>‰∏≠Á¨¨‰∏Ä‰∏™‰ΩøÁî®Áä∂ÊÄÅÁöÑ<code>span</code>ÂåÖÊã¨‰∏§‰∏™<code>page</code>ÔºåÂØπÂ∫î<code>pageInUse</code>‰∏≠Á¨¨<code>0</code>‰ΩçÊ†á‰∏∫<code>1</code>ÔºåÁ¨¨‰∫å‰∏™<code>span</code>‰πüÂú®‰ΩøÁî®‰∏≠ÔºåÂÆÉÂåÖÊã¨‰∏â‰∏™<code>page</code>Ôºå‰ΩÜÂè™ÊúâÁ¨¨‰∏Ä‰∏™<code>page</code>ÂØπÂ∫îÁöÑÁ¨¨<code>2</code>‰Ωç‰ºöË¢´Ê†áËÆ∞‰∏∫<code>1</code>„ÄÇ</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221223173130960.png" alt="image-20221223173130960" style="zoom:33%;" />
<ul>
<li><code>pageMarks</code>ÁöÑÁî®Ê≥ïÂíå<code>pageInUse</code>‰∏ÄÊ†∑ÔºåÂè™Ê†áËÆ∞ÊØè‰∏™<code>span</code>ÁöÑÁ¨¨‰∏Ä‰∏™<code>page</code>ÔºåÂú®<code>GC</code>Ê†áËÆ∞Èò∂ÊÆµ‰ºö‰øÆÊîπËøô‰∏™‰ΩçÂõæÔºåÊ†áËÆ∞Âì™‰∫õ<code>span</code>‰∏≠Â≠òÂú®Ë¢´Ê†áËÆ∞ÁöÑÂØπË±°ÔºåÂú®<code>GC</code>Ê∏ÖÊâ´Èò∂ÊÆµ‰ºöÊ†πÊçÆËøô‰∏™‰ΩçÂõæÔºåÊù•ÈáäÊîæ‰∏çÂê´Ê†áËÆ∞ÂØπË±°ÁöÑ<code>span</code>Ôºå</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221223173403051.png" alt="image-20221223173403051" style="zoom:33%;" />
<ul>
<li><code>spans</code>ÊòØ‰∏™<code>*mspan</code>Á±ªÂûãÁöÑÊï∞ÁªÑÔºåÂ§ßÂ∞è‰∏∫<code>8192</code>ÔºåÊ≠£Â•ΩÂØπÂ∫î<code>arena</code>‰∏≠ÁöÑ<code>8192</code>‰∏™<code>page</code>ÔºåÊâÄ‰ª•Áî®‰∫éÂÆö‰Ωç‰∏Ä‰∏™<code>page</code>ÂØπÂ∫îÁöÑ<code>mspan</code>Âú®Âì™ÂÑø„ÄÇ<code>mspan</code>ÁÆ°ÁêÜÁùÄ<code>span</code>‰∏≠‰∏ÄÁªÑËøûÁª≠ÁöÑ<code>page</code>ÔºåÂêå<code>mcentral</code>‰∏ÄÊ†∑ÔºåÂ∞ÜÂàíÂàÜÁöÑÂÜÖÂ≠òÂùóËßÑÊ†ºÁ±ªÂûãËÆ∞ÂΩïÂú®<code>spanclass</code>‰∏≠„ÄÇ
<ul>
<li><code>nelem</code>ËÆ∞ÂΩïÁùÄÂΩìÂâç<code>span</code>ÂÖ±ÂàíÂàÜÊàêÂ§öÂ∞ë‰∏™ÂÜÖÂ≠òÂùóÔºå<code>freeIndex</code>ËÆ∞ÂΩïÁùÄ‰∏ã‰∏™Á©∫Èó≤ÂÜÖÂ≠òÂùóÁöÑÁ¥¢Âºï„ÄÇ</li>
</ul>
</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221223173926642.png" alt="image-20221223173926642" style="zoom:33%;" />
<ul>
<li>
<p>‰∏é<code>heapArena</code>‰∏çÂêåÔºå<code>mspan</code>ËøôÈáåÁöÑ‰ΩçÂõæÊ†áËÆ∞ÔºåÈù¢ÂêëÁöÑÊòØÂàíÂàÜÂ•ΩÁöÑÂÜÖÂ≠òÂùóÂçïÂÖÉ„ÄÇ</p>
<ul>
<li>
<p><code>allocBits</code>‰ΩçÂõæÁî®Êù•Ê†áËÆ∞Âì™‰∫õÂÜÖÂ≠òÂùóÂ∑≤ÁªèË¢´ÂàÜÈÖç‰∫Ü„ÄÇ</p>
</li>
<li>
<p><code>gcmarkBits</code>ÊòØÂΩìÂâç<code>span</code>ÁöÑÊ†áËÆ∞‰ΩçÂõæÔºåÂú®<code>GC</code>Ê†áËÆ∞Èò∂ÊÆµ‰ºöÂØπËøô‰∏™‰ΩçÂõæËøõË°åÊ†áËÆ∞Ôºå‰∏Ä‰∏™‰∫åËøõÂà∂‰ΩçÂØπÂ∫î<code>span</code>‰∏≠ÁöÑ‰∏Ä‰∏™ÂÜÖÂ≠òÂùóÔºåÂà∞<code>GC</code>Ê∏ÖÊâ´Èò∂ÊÆµ‰ºöÈáäÊîæÊéâÊóßÁöÑ<code>allocBits</code>ÔºåÁÑ∂ÂêéÊääÊ†áËÆ∞Â•ΩÁöÑ<code>gcmarkBits</code>Áî®‰ΩúÊñ∞ÁöÑ<code>allocBits</code>ÔºåËøôÊ†∑Êú™Ë¢´<code>GC</code>Ê†áËÆ∞ÁöÑÂÜÖÂ≠òÂùóÂ∞±ËÉΩÂõûÊî∂Âà©Áî®‰∫Ü„ÄÇÂΩìÁÑ∂ÔºåËøò‰ºöÈáçÊñ∞ÂàÜÈÖç‰∏ÄÊÆµÊ∏ÖÈõ∂ÁöÑÂÜÖÂ≠òÁªô<code>gcmarkBits</code>‰ΩçÂõæ„ÄÇ</p>
</li>
</ul>
</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221223174343329.png" alt="image-20221223174343329" style="zoom:33%;" />
<h4 id="2232-ÂàÜÈÖçÁ≠ñÁï•">2.2.3.2 ÂàÜÈÖçÁ≠ñÁï•</h4>
<p><code>mallocgc</code>ÊòØË¥üË¥£Â†ÜÂàÜÈÖçÁöÑÂÖ≥ÈîÆÂáΩÊï∞Ôºå<code>runtime</code>‰∏≠ÁöÑ<code>new</code>Á≥ªÂàóÂíå<code>make</code>Á≥ªÂàóÂáΩÊï∞ÈÉΩ‰æùËµñÂÆÉ„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221225164824873.png" alt="image-20221225164824873" style="zoom:33%;" />
<p>ÂÆÉÁöÑ‰∏ªË¶ÅÈÄªËæëÂèØ‰ª•ÂàÜ‰∏∫Âõõ‰∏™ÈÉ®ÂàÜÔºö</p>
<ul>
<li><strong>Á¨¨‰∏ÄÈÉ®ÂàÜÔºöËæÖÂä©GC„ÄÇ<strong>Â¶ÇÊûúÁ®ãÂ∫è</strong>Áî≥ËØ∑Â†ÜÂÜÖÂ≠òÊó∂</strong>ÔºåÊ≠£Â§Ñ‰∫é<strong>GCÊ†áËÆ∞Èò∂ÊÆµ</strong>ÔºåÂΩì‰∏ãÂ∑≤ÂàÜÈÖçÁöÑÂ†ÜÂÜÖÂ≠òËøòÊ≤°Ê†áËÆ∞ÂÆåÔºå‰Ω†ËøôËæπÂèàË¶ÅÂàÜÈÖçÊñ∞ÁöÑÂÜÖÂ≠òÔºå‰∏á‰∏ÄÂÜÖÂ≠òÁî≥ËØ∑ÁöÑÈÄüÂ∫¶Ë∂ÖËøá‰∫ÜGCÊ†áËÆ∞ÁöÑÈÄüÂ∫¶ÔºåÂ∞±ÂèØËÉΩ‰ºöÂá∫Áé∞ÂÜÖÂ≠ò‰∏çÂ§üÁöÑÊÉÖÂÜµ„ÄÇÊâÄ‰ª•ÔºåÁî≥ËØ∑‰∏ÄÂ≠óËäÇÂÜÖÂ≠òÈúÄË¶ÅÂÅöÂ§öÂ∞ëÊâ´ÊèèÂ∑•‰ΩúÔºüÊàñËÄÖËØ¥ÔºåÂÆåÊàê‰∏ÄÂ≠óËäÇÊâ´ÊèèÂ∑•‰ΩúÂêéÂèØ‰ª•ÂàÜÈÖçÂ§öÂ§ßÁöÑÂÜÖÂ≠òÁ©∫Èó¥ÔºüËøôÈÉΩÊòØÊ†πÊçÆGCÊâ´ÊèèÁöÑËøõÂ∫¶Êõ¥Êñ∞ËÆ°ÁÆóÁöÑ„ÄÇ</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221225170457086.png" alt="image-20221225170457086" style="zoom:33%;" />
<p>ÊØèÊ¨°<strong>ÊâßË°åËæÖÂä©GCÔºåÊúÄÂ∞ëË¶ÅÊâ´Êèè<code>64KB</code>„ÄÇ<strong>ËøôÊòØÂõ†‰∏∫ÂçèÁ®ãÊØèÊ¨°ÊâßË°åËæÖÂä©GCÔºåÂ§öÂá∫Êù•ÁöÑÈÉ®ÂàÜ‰ºö‰Ωú‰∏∫‰ø°Áî®Â≠òÂÇ®Âà∞ÂΩìÂâç<code>g</code>‰∏≠ÔºåÂ∞±ÂÉè‰ø°Áî®Âç°ÁöÑÈ¢ùÂ∫¶‰∏ÄÊ†∑ÔºåÂêéÁª≠ÂÜçÊâßË°å<code>mallocgc()</code>Êó∂Ôºå<strong>Âè™Ë¶Å‰ø°Áî®È¢ùÂ∫¶Áî®‰∏çÂÆå</strong>ÔºåÂ∞±</strong>‰∏çÁî®ÊâßË°åËæÖÂä©GC</strong>‰∫Ü„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221225170844061.png" alt="image-20221225170844061" style="zoom:33%;" />
<p>Ê≠§Â§ñÔºåËøòÊúâ‰∏ÄÁßçÊñπÊ≥ïÂèØ‰ª•ÈÄÉÈÅøËæÖÂä©GCÔºö<strong>Á™ÉÂèñ‰ø°Áî®</strong>„ÄÇÂêéÂè∞ÁöÑ<code>GC mark worker</code>ÊâßË°åÊâ´Êèè‰ªªÂä°Êó∂Ôºå‰ºöÂú®<strong>ÂÖ®Â±Ä<code>gcController</code><strong>ËøôÈáå</strong>(bgScanCredit)ÁßØÁ¥Ø‰ø°Áî®</strong>ÔºåÂ¶ÇÊûúËÉΩÂ§üÁ™ÉÂèñË∂≥Â§üÂ§öÁöÑ‰ø°Áî®ÂÄºÊù•ÊäµÊ∂àÂΩìÂâçÂçèÁ®ãËÉåË¥üÁöÑÂÄ∫Âä°(<strong>ËØ¥ÊòéÊ≠§Êó∂Á©∫Èó≤ÂÜÖÂ≠òË∂≥Â§üÂ§ß</strong>)ÔºåÈÇ£Â∞±‰∏çÁî®ÊâßË°åËæÖÂä©GC‰∫Ü„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221225171110124.png" alt="image-20221225171110124" style="zoom:33%;" />
<ul>
<li>
<p>**Á¨¨‰∫åÈÉ®ÂàÜÔºöÁ©∫Èó¥ÂàÜÈÖç„ÄÇ**ËøôÈáåÈúÄË¶ÅÊ†πÊçÆË¶ÅÂàÜÈÖçÁöÑÁ©∫Èó¥Â§ßÂ∞èÔºå‰ª•ÂèäÊòØÂê¶‰∏∫<code>noscan</code>ÂûãÁ©∫Èó¥Êù•ÈÄâÊã©‰∏çÂêåÁöÑÂàÜÈÖçÁ≠ñÁï•„ÄÇ</p>
<ul>
<li>Â¶ÇÊûúÊòØ<code>noscan</code>Á±ªÂûã‰∏î<code>Â§ßÂ∞è&lt;maxTinySize</code>Ôºå‰ºö‰ΩøÁî®<code>tiny allocator</code>Ôºõ</li>
<li><code>Â§ßÂ∞è&gt;maxSmallSize</code>ÁöÑÂÜÖÂ≠òÂàÜÈÖçÔºåÂåÖÊã¨<code>noscan</code>Âíå<code>scanable</code>Á±ªÂûãÔºåÈÉΩ‰ºöÈááÁî®Â§ßÂùóÂÜÖÂ≠òÂàÜÈÖçÂô®Ôºõ</li>
<li><code>maxSmallSzie&gt;=Â§ßÂ∞è&gt;=maxTinySize</code>ÁöÑ<code>noscan</code>Á±ªÂûã„ÄÅ‰ª•Âèä<code>maxSmallSize&gt;=Â§ßÂ∞è</code>ÁöÑ<code>scanable</code>Á±ªÂûãÔºå‰ºö‰ΩøÁî®Áõ¥Êé•ÂåπÈÖçÈ¢ÑÁΩÆÂ§ßÂ∞èËßÑÊ†ºÊù•ÂàÜÈÖç„ÄÇ</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221225174042977.png" alt="image-20221225174042977" style="zoom:33%;" />
</li>
</ul>
<ol>
<li>
<p><code>Â§ßÂ∞è&gt;32KB</code>ÁöÑÂ§ßÂùóÂÜÖÂ≠òÈ¢ùÂ§ñÂ§ÑÁêÜÔºåËøôÊòØÂõ†‰∏∫È¢ÑÁΩÆÁöÑÂÜÖÂ≠òËßÑÊ†ºÊúÄÂ§ßÊâç<code>32KB</code>ÔºåÊâÄ‰ª•<strong>‰ºöÁõ¥Êé•Ê†πÊçÆÊâÄÈúÄÈ°µÈù¢Êï∞ÔºåÂàÜÈÖç‰∏Ä‰∏™Êñ∞ÁöÑ<code>span</code></strong>„ÄÇ</p>
</li>
<li>
<p>ËÄåÂØπ‰∫é<code>&lt;16B</code>ÁöÑÂÜÖÂ≠òÂàÜÈÖçÔºå‰πü‰∏çÁõ¥Êé•ÂåπÈÖçÈ¢ÑÁΩÆÂÜÖÂ≠òËßÑÊ†ºÔºå‰∏ªË¶ÅÊòØ‰∏∫‰∫ÜÂáèÂ∞ëÊµ™Ë¥πÔºöÂ¶ÇÊûúÈúÄË¶ÅËøûÁª≠ÂàÜÈÖç<code>16</code>Ê¨°<code>1B</code>ÁöÑÂÜÖÂ≠òÔºåÊØèÊ¨°ÂàÜÈÖçÊó∂ÂåπÈÖçÈ¢ÑÁΩÆÁöÑÂÜÖÂ≠òËßÑÊ†º‰∏∫<code>8B</code>(ËøôÊòØÊúÄÂ∞èÁöÑ‰∫Ü)ÔºåÈÇ£‰πàÊØèÊ¨°Â∞±‰ºöÊµ™Ë¥π<code>7B</code>„ÄÇËÄå**<code>tiny allocator</code>ËÉΩÂ§üÂ∞ÜÂá†‰∏™Â∞èÂùóÁöÑÂÜÖÂ≠òÂàÜÈÖçËØ∑Ê±ÇÂêàÂπ∂**ÔºåÊâÄ‰ª•‰æãÂ≠ê‰∏≠<code>16</code>Ê¨°<code>1B</code>ÁöÑÂÜÖÂ≠òÂàÜÈÖçËØ∑Ê±ÇÂèØ‰ª•ÂêàÂπ∂Âà∞‰∏Ä‰∏™<code>16B</code>ÁöÑÂÜÖÂ≠òÂùó‰∏≠„ÄÇËØ∏Â¶ÇÊ≠§Á±ªÔºåÂèØ‰ª•ÊèêÈ´òÂÜÖÂ≠ò‰ΩøÁî®Áéá„ÄÇ</p>
</li>
</ol>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221225174917460.png" alt="image-20221225174917460" style="zoom:33%;" />
<p>**<code>tiny allcoator</code>ÂàÜÈÖçÂÜÖÂ≠òÁöÑÂ§ßËá¥ËøáÁ®ãÔºö**ÊØè‰∏™<code>p</code>ÁöÑ<code>mcache</code>Êúâ‰∏ìÈó®Áî®‰∫é<code>tiny allocator</code>ÁöÑÂÜÖÂ≠ò(<code>mcache.tiny</code>)„ÄÇËøôÊòØ‰∏Ä‰∏™<code>16B</code>ÁöÑÂÜÖÂ≠òÂçïÂÖÉÔºå<code>mcache.tinyoffset</code>ËÆ∞ÂΩïËøôÊÆµÂÜÖÂ≠òÂ∑≤ÁªèÁî®Âà∞Âì™Èáå‰∫ÜÔºåÂ¶ÇÊûú<code>tiny allocator</code>ËøòÂ§üÂàÜÈÖç<code>size</code>Â§ßÂ∞èÁöÑÂÜÖÂ≠òÔºåÂ∞±Âú®<code>tiny</code>ÂÜÖÂ≠òÂùó‰∏≠Áõ¥Êé•ÂàÜÈÖç„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221225181609105.png" alt="image-20221225181609105" style="zoom:33%;" />
<p>(Êé•‰∏ä)Â¶ÇÊûúÂâ©‰ΩôÁöÑÁ©∫Èó¥‰∏çÂ§ü‰∫ÜÔºåÂ∞±‰ªéÂΩìÂâç<code>p</code>ÁöÑ<code>mcache</code>‰∏≠ÔºåÊâæÂà∞ÂØπÂ∫îÁöÑ<code>mspan</code>ÔºåÈáçÊñ∞Êãø‰∏Ä‰∏™<code>16B</code>Â§ßÂ∞èÁöÑÂÜÖÂ≠òÂùóÊù•Áî®„ÄÇÂ¶ÇÊûúÊú¨Âú∞ÁºìÂ≠ò‰∏≠Áõ∏Â∫îËßÑÊ†ºÁöÑ<code>mspan</code>‰πüÊ≤°ÊúâÁ©∫Èó¥‰∫ÜÔºåÂ∞±‰ºö‰ªé<code>mcentral</code>‰∏≠Êãø‰∏Ä‰∏™Êñ∞ÁöÑ<code>mspan</code>ËøáÊù•ÔºåÂàÜÈÖçÂÆå‰ª•ÂêéÔºåÂ¶ÇÊûúÊñ∞ÊãøÊù•ÁöÑÂÜÖÂ≠òÂùóÁöÑÂâ©‰ΩôÁ©∫Èó¥ÊØîÊóßÂÜÖÂ≠òÁöÑÂâ©‰ΩôÁ©∫Èó¥ËøòË¶ÅÂ§ßÔºåÈÇ£Â∞±Áî®Êñ∞ÁöÑÂÜÖÂ≠òÂùóÊääÊóßÁöÑ<code>tiny</code>ÊõøÊç¢Êéâ(ÊóßÁöÑËøòÂú®mcacheÔºåÂè™‰∏çËøá‰∏çÂºïÁî®‰∫Ü)„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221225181807160.png" alt="image-20221225181807160" style="zoom:33%;" />
<ol start="3">
<li>ÂØπ‰∫éÊúÄÂêé‰∏ÄÁßçÔºåÁõ¥Êé•ÈÄöËøáÊú¨Âú∞<code>mcache</code>‰∏éÂÖ®Â±Ä<code>mcentral</code>ÈÖçÂêàÂ∑•‰ΩúÔºåÊâæÂà∞ÂåπÈÖçËßÑÊ†ºÁöÑ<code>mspan</code>Âç≥ÂèØ„ÄÇ</li>
</ol>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221225182136720.png" alt="image-20221225182136720" style="zoom:33%;" />
<p>Á©∫Èó¥ÂàÜÈÖçÂ•Ω‰∫ÜËøòÊ≤°ÂÆåÔºåËøòË¶Å<strong>ËÆ∞ÂΩï‰∏ãÂì™‰∫õÂÜÖÂ≠òÂ∑≤Ë¢´ÂàÜÈÖçÔºåÂì™‰∫õÊï∞ÊçÆÈúÄË¶ÅGCÊâ´Êèè</strong>ÔºåÊâçËÉΩÁªßÁª≠ÂÜÖÂ≠òÁÆ°ÁêÜÂ∑•‰Ωú„ÄÇÊâÄ‰ª•Êé•‰∏ãÊù•ÈúÄË¶ÅËøõË°å‰∏ÄÁ≥ªÂàó<strong>‰ΩçÂõæÊ†áËÆ∞</strong>„ÄÇ</p>
<h4 id="2233-‰ΩçÂõæÊ†áËÆ∞">2.2.3.3 ‰ΩçÂõæÊ†áËÆ∞</h4>
<blockquote>
<h4 id="ÈóÆÈ¢òÈÄöËøá‰∏Ä‰∏™Â†ÜÂÜÖÂ≠òÂú∞ÂùÄÂ¶Ç‰ΩïÊâæÂà∞ÂØπÂ∫îÁöÑheaparenaÂíåmspan">**ÈóÆÈ¢òÔºö**ÈÄöËøá‰∏Ä‰∏™Â†ÜÂÜÖÂ≠òÂú∞ÂùÄÔºåÂ¶Ç‰ΩïÊâæÂà∞ÂØπÂ∫îÁöÑ<code>heapArena</code>Âíå<code>mspan</code>Ôºü</h4>
</blockquote>
<ul>
<li>
<p>Â∑≤Áü•Ôºö‰∏Ä‰∏™Â†ÜÂÜÖÂ≠òÂú∞ÂùÄ<code>p</code>Ôºå<code>arena</code>Âå∫ÂüüËµ∑ÂßãÂú∞ÂùÄÂ¶ÇÂõæ(arenaBaseOffset)ÔºåÊØè‰∏™<code>arena</code>Â§ßÂ∞è‰∏∫<code>heapArenaBytes</code>„ÄÇ</p>
</li>
<li>
<p>Ê±ÇÔºö<code>p</code>Âú®Á¨¨Âá†‰∏™<code>arena</code>‰∏≠Ôºü</p>
</li>
<li>
<p><strong>Á≠îÔºö</strong><code>arenaÁºñÂè∑</code> = <code>(p-arenaBaseOffset)</code>/<code>heapArenaBytes</code></p>
</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221227153807927.png" alt="image-20221227153807927" style="zoom: 33%;" />
<ul>
<li>Â∑≤Áü•Ôºöamd64Êû∂ÊûÑÁöÑLinuxÁéØÂ¢É‰∏ãÔºå‰∏Ä‰∏™<code>arena</code>Â§ßÂ∞èÂíåÂØπÈΩêËæπÁïåÈÉΩÊòØ<code>64M</code>(26‰Ωç)ÔºåËÄåËôöÊãüÂú∞ÂùÄÁ©∫Èó¥‰∏≠ÁöÑÁ∫øÊÄßÂú∞ÂùÄÊúâ<code>48</code>‰ΩçÔºåÈÇ£<code>48</code>‰ΩçÁöÑÁ∫øÊÄßÂú∞ÂùÄÂèØ‰ª•ÂØªÂùÄÁöÑËôöÊãüÁ©∫Èó¥Â∞±ÊòØ<code>2^48</code>Ëøô‰πàÂ§ß„ÄÇ</li>
<li>Ê±ÇÔºöËøô‰πàÂ§ßÁöÑÁ©∫Èó¥ÂèØ‰ª•ÂàíÂàÜÊàêÂ§öÂ∞ë‰∏™<code>arena</code>Ôºü</li>
<li><strong>Á≠îÔºö</strong><code>2^48</code>/<code>64M</code>=<code>4M</code></li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221227154547110.png" alt="image-20221227154547110" style="zoom:33%;" />
<p>GoÂºÄÂèëËÄÖÊää<code>heapArena</code>ÁöÑÂú∞ÂùÄÂ≠òÂà∞‰∫Ü‰∏Ä‰∏™‰∫åÁª¥Êï∞ÁªÑ‰∏≠ÔºåÂØªÂùÄ<code>heapArena</code>Êó∂Ôºå‰πü‰∏çËÉΩÁõ¥Êé•‰ΩøÁî®<code>arena</code>ÁöÑÁºñÂè∑ÔºåËÄåÊòØÊ†πÊçÆ<code>arena</code>ÁºñÂè∑ËÆ°ÁÆóÂá∫‰∏Ä‰∏™<code>arenaIdx</code>ÔºåÂÆÉÊú¨Ë¥®‰∏äÊòØ‰∏Ä‰∏™<code>uint</code>ÔºåÂè™‰∏çËøáÂàÜ‰∏§ÈÉ®ÂàÜÔºåÂàÜÂà´‰Ωú‰∏∫‰∏§‰∏™Áª¥Â∫¶ÁöÑÁ¥¢Âºï„ÄÇ</p>
<ul>
<li>Âú®amd64‰ΩçÁöÑWindowsÁéØÂ¢É‰∏ãÔºå<code>arenas</code>Êï∞ÁªÑÁ¨¨‰∏ÄÁª¥Êúâ<code>64</code>‰∏™ÂÖÉÁ¥†ÔºåÊâÄ‰ª•<code>arenaIdx</code>Á¨¨‰∏ÄÁª¥Â∫¶Á¥¢ÂºïÂç†<code>6</code>‰ΩçÔºåÁ¨¨‰∫åÁª¥Êï∞ÁªÑÈïøÂ∫¶‰∏∫<code>1M</code>ÔºåÊâÄ‰ª•<code>arenaIdx</code>‰∏≠‰Ωé<code>20</code>‰ΩçÁî®‰ΩúÁ¨¨‰∫åÁª¥ÁöÑÁ¥¢Âºï„ÄÇ</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221227155429504.png" alt="image-20221227155429504" style="zoom: 50%;" />
<ul>
<li>‰ΩÜÂú®amd64‰ΩçÁöÑLinuxÁéØÂ¢É‰∏ãÔºåËøô‰∏™<code>arenas</code>Êï∞ÁªÑÁ¨¨‰∏ÄÁª¥Âè™Êúâ‰∏Ä‰∏™ÂÖÉÁ¥†ÔºåÁ¨¨‰∫åÁª¥Êúâ<code>4M</code>‰∏™ÂÖÉÁ¥†Ôºå<code>arenaIdx</code>ÁöÑ‰Ωé<code>22</code>‰ΩçÈÉΩÁî®ÂÅöÁ¨¨‰∫åÁª¥ÁöÑÁ¥¢ÂºïÔºåÊú¨Ë¥®‰∏äÂíåÁõ¥Êé•‰ΩøÁî®<code>arena</code>ÁºñÂè∑ÊòØ‰∏ÄÊ†∑ÁöÑ„ÄÇ</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221227155506501.png" alt="image-20221227155506501" style="zoom: 33%;" />
<p><strong>Âà∞ËøôÈáåÔºåÊÄªÁÆóËÉΩÊ†πÊçÆÂÜÖÂ≠òÂú∞ÂùÄÔºåÊâæÂà∞ÂØπÂ∫îÁöÑ<code>heapArena</code>‰∫ÜÔºåÊé•‰∏ãÊù•Â∞±Êù•Êâæ<code>mspan</code>„ÄÇ</strong></p>
<ul>
<li>Â∑≤Áü•Ôºö<code>arena</code>‰∏≠ÊØè‰∏™<code>page</code>Â§ßÂ∞è‰∏∫<code>pageSize</code>ÔºåÊØè‰∏™<code>arena</code>‰∏≠Êúâ<code>pagesPerArena</code>‰∏™<code>page</code>„ÄÇ</li>
<li>Ê±ÇÔºö<code>p</code>Âú®Ëøô‰∏™<code>arena</code>‰∏≠Á¨¨Âá†‰∏™<code>page</code>Ôºü</li>
<li><strong>Á≠îÔºö</strong><code>page</code>ÁºñÂè∑ = <code>(p/pageSize)</code> % <code>pagePerArena</code></li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221227160003822.png" alt="image-20221227160003822" style="zoom: 50%;" />
<p>Á°ÆÂÆö‰∫Ü<code>page</code>ÁöÑÁ¥¢ÂºïÔºåÂ∞±ËÉΩÂú®<code>heapArena.spans</code>Êï∞ÁªÑ‰∏≠ÔºåÊâæÂà∞ÂØπÂ∫îÁöÑ<code>mspan</code>ÁöÑÂú∞ÂùÄ‰∫Ü„ÄÇ‰∏çËøáÊ†áËÆ∞ÂÆå‰∫Ü‰πüËøò‰∏çËÉΩÁªìÊùüÔºåËøòË¶ÅÊúâ<strong>Êî∂Â∞æÂ∑•‰Ωú</strong>„ÄÇ</p>
<h4 id="2234-Êî∂Â∞æÂ∑•‰Ωú">2.2.3.4 Êî∂Â∞æÂ∑•‰Ωú</h4>
<p>Â¶ÇÊûúÂΩìÂâçÂ§ÑÂú®<code>GC</code>Ê†áËÆ∞Èò∂ÊÆµÔºåÂ∞±ÈúÄË¶ÅÂØπÊñ∞ÂàÜÈÖçÁöÑÂØπË±°ËøõË°å<code>GC</code>Ê†áËÆ∞ÔºåËÄå‰∏îÔºåÂ¶ÇÊûúÊ≠§Ê¨°ÂÜÖÂ≠òÂàÜÈÖçËææÂà∞‰∫Ü<code>GC</code>ÁöÑËß¶ÂèëÊù°‰ª∂ÔºåËøò‰ºöËß¶ÂèëÊñ∞‰∏ÄËΩÆÁöÑ<code>GC</code>„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221227160500434.png" alt="image-20221227160500434" style="zoom:33%;" />
<h3 id="224-Ê†àÂÜÖÂ≠òÂàÜÈÖç">2.2.4 Ê†àÂÜÖÂ≠òÂàÜÈÖç</h3>
<h4 id="2241-Ê†àÂÜÖÂ≠òÂàÜÈÖçËøáÁ®ã">2.2.4.1 Ê†àÂÜÖÂ≠òÂàÜÈÖçËøáÁ®ã</h4>
<p>Â†ÜÂÜÖÂ≠òÂàÜÈÖç‰∏≠ÁöÑ<code>arena</code>‰∏≠ÁöÑ<code>span</code>Èô§‰∫ÜÁî®‰ΩúÂ†ÜÂÜÖÂ≠òÂàÜÈÖçÂ§ñÔºå‰πüÁî®‰∫éÊ†àÂÜÖÂ≠òÂàÜÈÖçÔºåÂè™ÊòØÁî®ÈÄî‰∏çÂêåÁöÑ<code>span</code>ÂØπÂ∫îÁöÑ<code>mspan</code>Áä∂ÊÄÅ‰∏çÂêåÔºåÁî®‰ΩúÂ†ÜÂÜÖÂ≠òÁöÑ<code>mspan</code>ÊòØ<code>mSpanInUse</code>Áä∂ÊÄÅÔºåÁî®‰ΩúÊ†àÂÜÖÂ≠òÁöÑÊòØ<code>mSpanManual</code>Áä∂ÊÄÅ„ÄÇ</p>
<p>‰∏∫ÊèêÈ´òÊ†àÂÜÖÂ≠òÂàÜÈÖçÊïàÁéáÔºåË∞ÉÂ∫¶Âô®ÂàùÂßãÂåñÊó∂Ôºå‰ºöÂàùÂßãÂåñ<strong>‰∏§‰∏™</strong>Áî®‰∫éÊ†àÂÜÖÂ≠òÂàÜÈÖçÁöÑÂÖ®Â±ÄÂØπË±°Ôºö</p>
<ul>
<li><strong><code>stackpool</code><strong>Èù¢Âêë</strong><code>32KB</code>‰ª•‰∏ã</strong>ÁöÑÊ†àÂàÜÈÖçÔºåÊ†àÂ§ßÂ∞èÂøÖÈ°ªÊòØ<code>2</code>ÁöÑÂπÇÔºåÊúÄÂ∞è‰∏∫<code>2KB</code>Ôºõ</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221227163813640.png" alt="image-20221227163813640" style="zoom:50%;" />
<ul>
<li>**Â§ß‰∫éÁ≠â‰∫é<code>32KB</code><strong>ÁöÑÊ†àÔºåÁî±</strong><code>stackLarge</code>**Êù•ÂàÜÈÖçËøô‰πüÊòØ‰∏™<code>mspan</code>ÈìæË°®ÁöÑÊï∞ÁªÑÔºåÈïøÂ∫¶‰∏∫25Ôºå<code>mspan</code>ËßÑÊ†º‰ªé<code>8KB</code>ÂºÄÂßãÔºå‰πãÂêéÊØè‰∏™ÈìæË°®ÁöÑ<code>mspan</code>ËßÑÊ†ºÈÉΩÊòØÂâç‰∏Ä‰∏™ÁöÑ<code>2</code>ÂÄçÔºå<code>8KB</code>Âíå<code>16KB</code>Ëøô‰∏§‰∏™ÈìæË°®ÂÆûÈôÖ‰∏ä‰∏ÄÁõ¥ÊòØÁ©∫ÁöÑÔºåÁïôÁùÄ‰ªñ‰ª¨ÊòØÊñπ‰æø‰ΩøÁî®<code>mspan</code>ÂåÖÂê´È°µÈù¢Êï∞ÁöÑ(‰ª•2‰∏∫Â∫ï)ÂØπÊï∞‰Ωú‰∏∫Êï∞ÁªÑ‰∏ãÊ†á„ÄÇ</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221227163745608.png" alt="image-20221227163745608" style="zoom:50%;" />
<p>ÂàùÂßãÂåñÂêéÔºåËøô‰∫õÈìæË°®ÈÉΩËøòÊòØÁ©∫ÁöÑÔºåÊé•‰∏ãÊù•ÂÆÉ‰ª¨‰ºö‰Ωú‰∏∫<strong>ÂÖ®Â±ÄÊ†àÁºìÂ≠ò</strong>Êù•‰ΩøÁî®„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221227165230972.png" alt="image-20221227165230972" style="zoom:50%;" />
<p>ÂêåÂ†ÜÂÜÖÂ≠òÂàÜÈÖç‰∏ÄÊ†∑ÔºåÊØè‰∏™<code>p</code>‰πüÊúâÁî®‰∫éÊ†àÂàÜÈÖçÁöÑÊú¨Âú∞ÁºìÂ≠òÔºåËøôÁõ∏ÂΩì‰∫éÊòØ<code>stackpool</code>ÁöÑÊú¨Âú∞ÁºìÂ≠ò„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221227165336958.png" alt="image-20221227165336958" style="zoom: 50%;" />
<p>Ë¶ÅÂàÜÈÖçÊ†àÂÜÖÂ≠òÊó∂Ôºö</p>
<ul>
<li><strong>Â∞è‰∫é<code>32KB</code>ÁöÑÊ†àÁ©∫Èó¥</strong>Ôºå‰ºö‰ºòÂÖà‰ΩøÁî®ÂΩìÂâç<code>p</code>ÁöÑÊú¨Âú∞ÁºìÂ≠ò„ÄÇ<strong>Â¶ÇÊûú</strong>Êú¨Âú∞ÁºìÂ≠ò‰∏≠ÂØπÂ∫îËßÑÊ†ºÁöÑÂÜÖÂ≠òÂùóÈìæË°®‰∏∫Á©∫ÔºåÂ∞±‰ªé<code>stackpool</code>ÂàÜÈÖç<code>16KB</code>ÁöÑÂÜÖÂ≠òÊîæÂà∞Êú¨Âú∞ÁºìÂ≠ò(<code>stackcache</code>)‰∏≠ÔºåÁÑ∂ÂêéÁªßÁª≠‰ªéÊú¨Âú∞ÁºìÂ≠òÂàÜÈÖçÔºõ<strong>Â¶ÇÊûú</strong><code>stackpool</code>‰∏≠ÂØπÂ∫îÁöÑÈìæË°®‰πü‰∏∫Á©∫ÔºåÂ∞±‰ªéÂ†ÜÂÜÖÂ≠ò‰∏≠Áõ¥Êé•ÂàÜÈÖç‰∏Ä‰∏™<code>32KB</code>ÁöÑ<code>span</code>ÔºåÂàíÂàÜÊàêÂØπÂ∫îÁöÑÂÜÖÂ≠òÂùóÂ§ßÂ∞èÊîæÂà∞<code>stackpool</code>‰∏≠Ôºõ<strong>‰∏çËøáÊúâ‰∫õÊÉÖÂÜµ‰∏ã</strong>ÔºåÊòØÊó†Ê≥ï‰ΩøÁî®Êú¨Âú∞ÁºìÂ≠òÁöÑÔºåÂú®‰∏çËÉΩ‰ΩøÁî®Êú¨Âú∞ÁºìÂ≠òÁöÑÊÉÖÂÜµ‰∏ãÔºåÂ∞±Áõ¥Êé•‰ªé<code>stackpool</code>ÂàÜÈÖçÔºõ</li>
</ul>
<ol>
<li>Êú¨Âú∞Êó†ÂèØÁî®ÁºìÂ≠òÔºå‰ªé<code>stackpool</code>ÂàÜÈÖçÔºö</li>
</ol>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221227165751844.png" alt="image-20221227165751844" style="zoom:33%;" />
<ol start="2">
<li><code>stackpool</code>‰πü‰∏∫Á©∫Ôºö</li>
</ol>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221227170032933.png" alt="image-20221227170032933" style="zoom:33%;" />
<ol start="3">
<li>Êó†Ê≥ï‰ΩøÁî®Êú¨Âú∞ÁºìÂ≠òÔºö</li>
</ol>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221227170251317.png" alt="image-20221227170251317" style="zoom:25%;" />
<ul>
<li><strong>Â§ß‰∫éÁ≠â‰∫é<code>32KB</code>ÁöÑÊ†àÁ©∫Èó¥</strong>ÔºåÂ∞±ËÆ°ÁÆóÈúÄË¶ÅÁöÑ<code>page</code>Êï∞ÁõÆÔºåÂπ∂‰ª•<code>2</code>‰∏∫Â∫ïÊ±ÇÂØπÊï∞(<code>log2npage</code>)ÔºåÂ∞ÜÂæóÂà∞ÁöÑÁªìÊûú‰Ωú‰∏∫<code>stackLarge</code>Êï∞ÁªÑÁöÑ‰∏ãÊ†áÔºåÊâæÂà∞ÂØπÂ∫îÁöÑÁ©∫Èó≤<code>span</code>ÈìæË°®„ÄÇ<strong>Ëã•</strong>ÈìæË°®‰∏ç‰∏∫Á©∫ÔºåÂ∞±Êãø‰∏Ä‰∏™ËøáÊù•Áî®Ôºõ<strong>Ëã•</strong>ÈìæË°®‰∏∫Á©∫ÔºåÂ∞±Áõ¥Êé•‰ªéÂ†ÜÂÜÖÂ≠òÂàÜÈÖç‰∏Ä‰∏™Êã•ÊúâËøô‰πàÂ§ö‰∏™È°µÈù¢ÁöÑ<code>span</code>ÔºåÂπ∂ÊääÂÆÉÊï¥‰∏™Áî®‰∫éÂàÜÈÖçÊ†àÂÜÖÂ≠òÔºå</li>
</ul>
<ol>
<li>ÈìæË°®‰∏ç‰∏∫Á©∫Ôºö</li>
</ol>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221227170450338.png" alt="image-20221227170450338" style="zoom:33%;" />
<ol start="2">
<li>ÈìæË°®‰∏∫Á©∫Ôºö</li>
</ol>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221227170820284.png" alt="image-20221227170820284" style="zoom:33%;" />
<hr>
<h4 id="2242-Ê†àÂ¢ûÈïø">2.2.4.2 Ê†àÂ¢ûÈïø</h4>
<p>Ê†àÂÜÖÂ≠òÂàùÂßãÂàÜÈÖçÂèëÁîüÂú®<code>goroutine</code>ÂàõÂª∫Êó∂ÔºåÁî±‰∫é<strong>ÂàùÂßãÊ†àÂ§ßÂ∞èÈÉΩÊòØ<code>2KB</code></strong>ÔºåÂú®ÂÆûÈôÖ‰∏öÂä°‰∏≠ÂèØËÉΩ‰ºö‰∏çÂ§üÁî®ÔºåÊâÄ‰ª•ÈúÄË¶ÅÂÆûÁé∞‰∏ÄÁßç<strong>Âú®ËøêË°åÈò∂ÊÆµÂä®ÊÄÅÂ¢ûÈïøÊ†àÁöÑÊú∫Âà∂</strong>„ÄÇ</p>
<p><code>goroutine</code>ÁöÑÊ†àÂ¢ûÈïøÔºåÊòØÈÄöËøáÁºñËØëÂô®Âíå<code>runtime</code>Âêà‰ΩúÂÆûÁé∞ÁöÑ„ÄÇÁºñËØëÂô®‰ºöÂú®ÂáΩÊï∞ÁöÑÂ§¥ÈÉ®ÂÆâÊèíÊ£ÄÊµã‰ª£Á†ÅÔºåÊ£ÄÊü•ÂΩìÂâçÂâ©‰ΩôÁöÑÊ†àÁ©∫Èó¥ÊòØÂê¶Â§üÁî®„ÄÇËã•‰∏çÂ§üÁî®ÔºåÂ∞±Ë∞ÉÁî®<code>runtime</code>‰∏≠ÁöÑÁõ∏ÂÖ≥ÂáΩÊï∞Êù•<strong>Â¢ûÈïøÊ†àÁ©∫Èó¥(<code>runtime.morestack_noctxt</code>)</strong>ÔºåÊ†àÁ©∫Èó¥ÊòØ<strong>ÊàêÂÄç</strong>Â¢ûÈïøÁöÑÔºåÈúÄË¶ÅÂ¢ûÈïøÊó∂ÔºåÂ∞±ÂÖàÊääÂΩìÂâçÁöÑÊ†àÁ©∫Èó¥Â§ßÂ∞è<code>x2</code>ÔºåÂπ∂ÊääÂçèÁ®ãÁä∂ÊÄÅÁΩÆ‰∏∫<code>_Gcopystack</code>ÔºåÊé•‰∏ãÊù•Ë∞ÉÁî®<code>copystack</code>ÂáΩÊï∞ÂàÜÈÖçÊñ∞ÁöÑÊ†àÁ©∫Èó¥Âπ∂Êã∑Ë¥ùÊóßÊ†à‰∏äÁöÑÊï∞ÊçÆÔºåÈáäÊîæÊóßÊ†àÁöÑÁ©∫Èó¥ÔºåÊúÄÂêéÊÅ¢Â§çÂçèÁ®ãËøêË°å<code>_Grunning</code>„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221228155220366.png" alt="image-20221228155220366" style="zoom:33%;" />
<h4 id="2243-Ê†àÊî∂Áº©">2.2.4.3 Ê†àÊî∂Áº©</h4>
<p>Ê†àÊî∂Áº©ÂèØ‰ª•ÂáèÂ∞ë<strong>ËøêË°å‰∏≠ÁöÑÂçèÁ®ã</strong>ÂØπÊ†àÁ©∫Èó¥ÁöÑÊµ™Ë¥π„ÄÇ</p>
<ul>
<li>
<p>Ê†àÊî∂Áº©‰∏ç‰ºöÁº©Âà∞ÊØî<code>2KB</code>ËøòÂ∞è„ÄÇ</p>
</li>
<li>
<p><strong>ÂîØ‰∏Ä</strong>ÂèØ‰ª•Ëß¶ÂèëÊ†àÊî∂Áº©ÁöÑÂú∞ÊñπÂ∞±ÊòØ**<code>GC</code>**„ÄÇ</p>
</li>
</ul>
<p><code>GC</code>ÈÄöËøá<code>scanstack</code>ÂáΩÊï∞ÂØªÊâæÊ†áËÆ∞<code>root</code>ËäÇÁÇπÊó∂ÔºåÂ¶ÇÊûúÂèëÁé∞ÂèØ‰ª•ÂÆâÂÖ®ÁöÑÊî∂Áº©Ê†àÔºåÂ∞±‰ºöÊâßË°åÊ†àÊî∂Áº©Ôºõ‰∏çËÉΩÈ©¨‰∏äÊâßË°åÊó∂ÔºåÂ∞±ËÆæÁΩÆÊ†àÊî∂Áº©Ê†áËØÜ(<code>g.preemptShrink=true</code>)ÔºåÁ≠âÂà∞ÂçèÁ®ãÊ£ÄÊµãÂà∞Êä¢Âç†Ê†áËØÜ(<code>stackPreempt</code>)ÔºåÂú®ËÆ©Âá∫<code>CPU</code>Ââç‰ºöÊ£ÄÊü•Ëøô‰∏™Ê†àÊî∂Áº©Ê†áËØÜÔºå‰∏∫<code>true</code>Êó∂Â∞±‰ºöÂÖàËøõË°åÊ†àÊî∂Áº©ÔºåÂÜçËÆ©Âá∫<code>CPU</code>„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221228155813634.png" alt="image-20221228155813634" style="zoom: 50%;" />
<h4 id="2244-Ê†àÈáäÊîæ">2.2.4.4 Ê†àÈáäÊîæ</h4>
<p>‰ΩÜÊòØ<strong>ÁªìÊùüËøêË°åÁöÑÂçèÁ®ã</strong>ÁöÑÊ†àÁ©∫Èó¥ËØ•ÊÄé‰πàÂõûÊî∂Âà©Áî®Ôºü</p>
<p>Â∏∏ËßÑ<code>gorontine</code>ÁªìÊùüÊó∂Ôºå‰ºöË¢´ÊîæÂà∞Ë∞ÉÂ∫¶Âô®ÂØπË±°ÁöÑÁ©∫Èó≤<code>g</code>ÈòüÂàó(<code>sched.gFree</code>)‰∏≠ÔºåËøôÈáåÁöÑÁ©∫Èó≤ÂçèÁ®ãÂàÜ‰∏§ÁßçÔºö</p>
<ul>
<li>‰∏ÄÁßçÊúâÂçèÁ®ãÊ†à(<code>sched.gFree.stack</code>)Ôºõ</li>
<li>‰∏ÄÁßçÊ≤°ÊúâÂçèÁ®ãÊ†à(<code>sched.gFree.noStack</code>)„ÄÇ</li>
</ul>
<p>ÂàõÂª∫ÂçèÁ®ãÊó∂Ôºå‰ºöÂÖàÁúãÁúãËøôÈáåÊúâÊ≤°ÊúâÁ©∫Èó≤ÂçèÁ®ãÂèØ‰ª•Áî®Ôºå<strong>‰ºòÂÖà‰ΩøÁî®ÊúâÊ†àÁöÑÂçèÁ®ã</strong>ÔºåÂÖ∂Ê¨°‰ΩøÁî®Êó†Ê†àÁöÑÂçèÁ®ã„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221228160542263.png" alt="image-20221228160542263" style="zoom:50%;" />
<p>‰∏çËøáÔºåÂ∏∏ËßÑ<code>goroutine</code>ËøêË°åÁªìÊùüÊó∂ÔºåÈÉΩÊúâÂçèÁ®ãÊ†àÔºåÂ∫îËØ•ËøõÂà∞Âì™‰∏™ÈòüÂàóÂë¢Ôºü</p>
<ul>
<li>Â¶ÇÊûúÂçèÁ®ãÊ†àÊ≤°ÊúâÂ¢ûÈïøËøá(ËøòÊòØ<code>2KB</code>)ÔºåÂ∞±ÊääËøô‰∏™ÂçèÁ®ãÊîæÂà∞<strong>ÊúâÊ†àÁöÑÁ©∫Èó≤<code>g</code>ÈòüÂàó</strong>‰∏≠„ÄÇËÄåËøô‰∫õÁ©∫Èó≤ÂçèÁ®ãÁöÑÊ†àÔºå‰πü‰ºöÂú®<code>GC</code>ÊâßË°å<code>markroot</code>Êó∂Ë¢´ÈáäÊîæÔºåÂà∞Êó∂ÂÄôÊúâÊ†àÁöÑÁ©∫Èó≤<code>g</code>‰πü‰ºöÂä†ÂÖ•Âà∞Êó†Ê†àÁöÑÁ©∫Èó≤<code>g</code>ÈòüÂàó‰∏≠„ÄÇ</li>
<li>Â¶ÇÊûúÂçèÁ®ãÊ†àÊúâÂ¢ûÈïøËøáÔºåÂ∞±ÊääÂçèÁ®ãÊ†àÈáäÊîæÊéâÔºåÂÜçÊääÂçèÁ®ãÊ†àÊîæÂÖ•<strong>Êó†Ê†àÁöÑÁ©∫Èó≤<code>g</code>ÈòüÂàó‰∏≠</strong>„ÄÇ</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221228161114623.png" alt="image-20221228161114623" style="zoom:50%;" />
<p>**ÈóÆÈ¢òÔºö**ÈÇ£‰πàÊ†àÈáäÊîæÂà∞Âì™Èáå‰∫ÜÂë¢ÔºüÊòØÊîæÂõûÂà∞ÂΩìÂâç<code>p</code>ÁöÑÊú¨Âú∞ÁºìÂ≠òÔºüËøòÊòØÊîæÂõûÂà∞ÂÖ®Â±ÄÊ†àÁºìÂ≠òÔºüÊäëÊàñÊòØÁõ¥Êé•ËøòÁªôÂ†ÜÂÜÖÂ≠òÔºü</p>
<p>**Á≠îÔºö**ÂÖ∂ÂÆûÈÉΩÊúâÂèØËÉΩÔºåË¶ÅËßÜÊÉÖÂÜµËÄåÂÆö„ÄÇ</p>
<ul>
<li><strong>Â∞è‰∫é<code>32KB</code>ÁöÑÊ†àÔºö<strong>Âú®ÈáäÊîæÊó∂‰ºöÂÖàÊîæÂõûÊú¨Âú∞ÁºìÂ≠ò‰∏≠ÔºåÂ¶ÇÊûúÊú¨Âú∞ÁºìÂ≠ò</strong>ÂØπÂ∫îÈìæË°®</strong>‰∏≠Ê†àÁ©∫Èó¥ÊÄªÂíåÂ§ß‰∫é<code>32KB</code>ÔºåÂ∞±Êää‰∏ÄÈÉ®ÂàÜÊîæÂõû<code>stackpool</code>‰∏≠Ôºå<strong>Êú¨Âú∞Ëøô‰∏™ÈìæË°®Âè™‰øùÁïô<code>16KB</code></strong>ÔºõÂ¶ÇÊûúÊú¨Âú∞ÁºìÂ≠ò‰∏çÂèØÁî®Ôºå‰πü‰ºöÁõ¥Êé•ÊîæÂõû<code>stackpool</code>‰∏≠„ÄÇËÄå‰∏îÔºåÂ¶ÇÊûúÂèëÁé∞Ëøô‰∏™<code>mspan</code>‰∏≠ÔºåÊâÄÊúâÂÜÖÂ≠òÂùóÈÉΩË¢´ÈáäÊîæ‰∫ÜÂ∞±‰ºöÊääÂÆÉÂΩíËøòÁªôÂ†ÜÂÜÖÂ≠ò„ÄÇ</li>
<li>**Â§ß‰∫éÁ≠â‰∫é<code>32KB</code>ÁöÑÊ†àÔºö**Â¶ÇÊûúÂΩìÂâçÂ§Ñ‰∫é<code>GC</code>Ê∏ÖÁêÜÈò∂ÊÆµ(<code>gcphase == _GCoff</code>)ÔºåÂ∞±Áõ¥Êé•ÈáäÊîæÂà∞Â†ÜÂÜÖÂ≠òÔºõÂê¶ÂàôÂÖàÊääÂÆÉÊîæÂõûÂà∞<code>stackLarge</code>„ÄÇ</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221228162025052.png" alt="image-20221228162025052" style="zoom:50%;" />
<h1 id="‰∏âÈù¢ËØïÈ¢ò">‰∏â„ÄÅÈù¢ËØïÈ¢ò</h1>
<h2 id="31-goroutineË∞ÉÂ∫¶">3.1 <code>GoroutineË∞ÉÂ∫¶</code></h2>
<h4 id="È¢òÁõÆ1">È¢òÁõÆÔºö1</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">runtime</span><span class="p">.</span><span class="nf">GOMAXPROCS</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
</span></span><span class="line"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">go</span> <span class="kd">func</span><span class="p">(</span><span class="nx">n</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">println</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nx">wg</span><span class="p">.</span><span class="nf">Done</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="p">}(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">go</span> <span class="kd">func</span><span class="p">(</span><span class="nx">n</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">println</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nx">wg</span><span class="p">.</span><span class="nf">Done</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="p">}(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">go</span> <span class="kd">func</span><span class="p">(</span><span class="nx">n</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">println</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nx">wg</span><span class="p">.</span><span class="nf">Done</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="p">}(</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span class="nf">Wait</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>È¶ñÂÖàÔºåÁ¨¨2Ë°å<code>runtime.GOMAXPROCS(1)</code>Êää<code>GMP</code>Ê®°Âûã‰∏≠**<code>P</code>ÁöÑÊï∞ÈáèÈôêÂà∂‰∏∫<code>1</code>**ÔºåËøô‰πüÂ∞±ÈôêÂà∂‰∫Ü‰ªª‰∏ÄÊó∂ÂàªÂè™ÂÖÅËÆ∏‰∏Ä‰∏™<code>M</code>ÊâßË°å<code>Go</code>‰ª£Á†Å„ÄÇÂú®Ëøô‰∏™ÂâçÊèê‰∏ãÔºåÂÜçÊù•ÂàÜÊûêËøôÂá†‰∏™<code>goroutine</code>ÁöÑÊâßË°åÈ°∫Â∫è„ÄÇ</p>
<p>ÈÄöËøáÂÖ≥ÈîÆÂ≠ó<code>go</code>Êù•ÂàõÂª∫Êñ∞ÁöÑ<code>goroutine</code>ÔºåÂÆûÈôÖ‰∏ä‰ºöË¢´ÁºñËØëÂô®ËΩ¨Âåñ‰∏∫ÂØπ<code>runtime.newproc</code>ÁöÑË∞ÉÁî®„ÄÇ<strong>ËØ•ÂáΩÊï∞ÁöÑ‰∏ªË¶ÅÈÄªËæë</strong>Â∞±ÊòØÂÖàÂàáÊç¢Ëá≥Á≥ªÁªüÊ†àÔºåÁÑ∂ÂêéË∞ÉÁî®<code>newproc1</code>ÂáΩÊï∞ÔºåÂàÜÈÖçÂπ∂ÂàùÂßãÂåñ‰∏Ä‰∏™Êñ∞ÁöÑ<code>g</code>ÔºåÂÜçÈÄöËøá<code>runqput</code>ÊääÊñ∞ÁöÑ<code>g</code>Ê∑ªÂä†Âà∞**ÂΩìÂâç<code>P</code>ÁöÑÊú¨Âú∞<code>runq</code>**‰∏≠„ÄÇ</p>
<p>Âê¨Ëµ∑Êù•ÔºåÊúÄÂêéÁöÑËæìÂá∫Â∫îËØ•ÊòØ<code>1 2 3</code>„ÄÇ<strong>‰ΩÜÂÆûÈôÖ‰∏äÊúÄÂêéÁöÑËæìÂá∫ÊòØ<code>3 1 2</code>„ÄÇ</strong></p>
<p>ÂÆûÈôÖ‰∏äÔºå<strong><code>P</code>‰∏ç‰ªÖÊúâÊú¨Âú∞<code>runq</code>ÔºåËøòÊúâ‰∏Ä‰∏™<code>runnext</code>Â≠óÊÆµ</strong>ÔºåÁî®Êù•‰øùÂ≠ò‰∏ãÊ¨°Ë¶ÅËøêË°åÁöÑ<code>g</code>Ôºå<code>newproc1</code>‰∏≠Ë∞ÉÁî®<code>runqput</code>Êó∂‰ºöÁî®Âà∞Ëøô‰∏™<code>runnext</code>„ÄÇËøáÁ®ãÂ¶Ç‰∏ãÔºåÊàë‰ª¨Â∞ÜËæìÂá∫ÁöÑÊï∞ÂÄº‰Ωú‰∏∫ÂØπÂ∫î<code>goroutine</code>ÁöÑ‰ª£Âè∑ÔºåÔºö</p>
<ul>
<li>È¶ñÂÖàÔºå<code>1</code>Âè∑<code>goroutine</code>Ë¢´ËÆ∞Âú®<code>runnext</code>‰∏≠Ôºå<code>2</code>Âè∑<code>goroutine</code>Êää<code>1</code>Âè∑<code>goroutine</code>Êå§Ëµ∞Ôºå<code>1</code>Âè∑<code>goroutine</code>ËøõÂÖ•Âà∞Êú¨Âú∞<code>runq</code>Ôºõ</li>
<li>Êé•‰∏ãÊù•Ôºå<code>3</code>Âè∑<code>goroutine</code>Âèà‰ºöÊää<code>2</code>Âè∑<code>goroutine</code>Êå§Ëµ∞Ôºå<code>2</code>Âè∑<code>goroutine</code>‰ºöËøõÂÖ•Êú¨Âú∞<code>runq</code>ÈòüÂàóÂ∞æÈÉ®Ôºõ</li>
<li>Ë∞ÉÂ∫¶<code>goroutine</code>ÊâßË°åÊó∂ÔºåÈÄöËøá<code>runqget</code>Ëé∑ÂèñÂæÖÊâßË°åÁöÑ<code>g</code>„ÄÇËÄå<code>runqget</code>‰πü‰ºöÂØπ<code>runnext</code>ÁâπÊÆäÂ§ÑÁêÜÔºå**‰ºòÂÖàË∞ÉÂ∫¶<code>runnext</code>**ËøôÈáåËÆ∞ÂΩïÁöÑ<code>g</code>ÔºåÂÜçÊåâÈ°∫Â∫èË∞ÉÂ∫¶Êú¨Âú∞<code>runq</code>‰∏≠ËÆ∞ÂΩïÁöÑ<code>g</code>Ôºõ</li>
<li>Âõ†Ê≠§Ôºå<code>3</code>Âè∑<code>goroutine</code>‰ºòÂÖàÊâßË°åÔºåÁÑ∂ÂêéÊòØÊú¨Âú∞<code>runq</code>ÈòüÂàóÔºå‰πüÂ∞±ÊòØ<code>3 1 2</code>„ÄÇ</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230118225323923.png" alt="image-20230118225323923" style="zoom:33%;" />
<p>**Êú¨È¢òÂè™Êúâ 3 ‰∏™<code>goroutine</code>ÔºåÈÇ£Â¶ÇÊûúÊòØ 4„ÄÅ5„ÄÅ6„ÄÅ‚Ä¶ ‰∏™Âë¢Ôºü**ÂèàÊòØ‰ªÄ‰πàÊÉÖÂÜµÔºüËØ∑Áúã‰∏ãÈ¢òÔºÅ</p>
<h4 id="È¢òÁõÆ2">È¢òÁõÆÔºö2</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">runtime</span><span class="p">.</span><span class="nf">GOMAXPROCS</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
</span></span><span class="line"><span class="cl">    <span class="nx">N</span> <span class="o">:=</span> <span class="mi">4</span>	    <span class="c1">// ÂèØ‰ª•‰∏çÊñ≠Â¢ûÂ§ß NÔºå‰∏¥ÁïåÁÇπÂú® 257
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="nx">N</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>	
</span></span><span class="line"><span class="cl">		<span class="nx">wg</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">go</span> <span class="kd">func</span><span class="p">(</span><span class="nx">n</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nb">println</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="nx">wg</span><span class="p">.</span><span class="nf">Done</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">		<span class="p">}(</span><span class="nx">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span class="nf">Wait</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂÖ∂‰∏≠Ôºå<code>4</code>‰∏™<code>goroutine</code>ÁöÑËæìÂá∫ÊòØ<code>4 1 2 3</code>Ôºå<code>5</code>‰∏™<code>goroutine</code>ÁöÑËæìÂá∫ÊòØ<code>5 1 2 3 4</code>ÔºåÁõ¥Âà∞<code>257</code>‰∏™<code>goroutine</code>ÁöÑËæìÂá∫ÊòØ<code>257 1 2 ... 256</code>ÔºåÂèØ‰ª•<strong>ÁúãÂá∫<code>N &lt;= 257</code>Êó∂ÔºåÈÉΩÊòØËøô‰∏™ËßÑÂæã</strong>„ÄÇ</p>
<p><strong>‰ΩÜÊòØ<code>N &gt; 257</code>Êó∂ÂèàÊòØ‰ªÄ‰πàÊÉÖÂÜµÂë¢Ôºü<strong>‰∏çË¶ÅÂøòËÆ∞</strong>ÂÖ®Â±Ä<code>runq</code></strong>ÔºÅÔºÅÔºÅ</p>
<p>ÂÖàËß£Èáä‰∏Ä‰∏ã<code>N &lt;= 257</code>ÊòØ‰∏∫Âï•Ôºü<code>P</code>ÁöÑ<code>runnext</code>ÂèØ‰ª•ËÆ∞ÂΩï<code>1</code>‰∏™<code>g</code>ÔºåÊú¨Âú∞<code>runq</code>ÂèØ‰ª•ËÆ∞ÂΩï<code>256</code>‰∏™<code>g</code>Ôºå‰∏ÄÂÖ±Â∞±ÊòØ<code>257</code>‰∏™„ÄÇÊâÄ‰ª•Ëã•<code>N = 257</code>ÔºåÂ∞±‰ºöÂá∫Áé∞Â¶Ç‰∏ãÊÉÖÂÜµÔºö</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230118230721962.png" alt="image-20230118230721962" style="zoom:33%;" />
<p>Êé•‰∏ãÊù•Ëã•ÂèàÂà∞Ëææ<code>258</code>Âè∑<code>g</code>Ôºå‰ºöÊää<code>257</code>Âè∑<code>g</code>Êå§Ëµ∞Ôºå‰ΩÜÊú¨Âú∞<code>runq</code>Â∑≤Êª°ÔºåÊâÄ‰ª•**<code>257</code>Âè∑<code>g</code>‰ºöÂíåÊú¨Âú∞<code>runq</code>‰∏≠ÁöÑÂâç‰∏ÄÂçä<code>g</code>**‰∏ÄËµ∑ËøõÂà∞ÂÖ®Â±Ä<code>runq</code>‰∏≠(‰πãÊâÄ‰ª•ÂèñÂâç‰∏ÄÂçäÊòØ‰∏∫‰∫ÜÈò≤Ê≠¢È••È•øÔºå‰πãÊâÄ‰ª•ÈöèÊú∫ÊîæÂà∞ÂÖ®Â±Ä<code>runq</code>ÊòØ‰∏∫‰∫ÜÈÅøÂÖçÂ§öÊ†∏<code>cpu</code>‰øÆÊîπÂêå‰∏Ä‰∏™ÁºìÂ≠ò)„ÄÇ</p>
<p><strong>ÊåâÁÖßÂπ≥Êó∂ÊèèËø∞ÁöÑË∞ÉÂ∫¶ÈÄªËæë</strong>ÔºöÂÖà‰ªéÊú¨Âú∞<code>runq</code>Ëé∑ÂèñÂæÖÊâßË°åÁöÑ<code>g</code>ÔºåÊ≤°ÊúâÁöÑËØùÂÜç‰ªéÂÖ®Â±Ä<code>runq</code>Ëé∑ÂèñÔºåËøòÊ≤°ÊúâÁöÑËØùÂ∞±ÂéªÂà´ÁöÑ<code>p</code>ÈÇ£Èáå<code>steal</code>‰∏ÄÈÉ®ÂàÜ„ÄÇÊâÄ‰ª•Ôºö</p>
<ul>
<li>ËøôÈáåÊúÄÂÖàÊâßË°åÁöÑÊòØ<code>runnext</code>‰∏≠ÁöÑ<code>258</code>Âè∑<code>goroutine</code>Ôºõ</li>
<li>Êé•‰∏ãÊù•ÊòØÊú¨Âú∞<code>runq</code>‰∏≠ÁöÑ<code>129</code>Âè∑-<code>256</code>Âè∑Ôºõ</li>
<li>ÊúÄÂêéÂÖ®Â±ÄÈòüÂàó‰∏≠ÁöÑ<code>g</code>Êâç‰ºöË¢´ÊãøÂõûÊú¨Âú∞<code>runq</code>„ÄÇ</li>
</ul>
<p>==<strong>‰ΩÜÂÆûÈôÖ‰∏äÂπ∂ÈùûÂ¶ÇÊ≠§</strong>==„ÄÇÂÆûÈôÖËøêË°åÂèëÁé∞ÔºåÂú®<code>129</code>Âè∑-<code>256</code>Âè∑‰πãÈó¥Ôºå‰ºöÂèëÁé∞<code>1</code>Âè∑Âíå<code>2</code>Âè∑‰πüÁ©øÊèíÂú®ËøôÊÆµÂå∫Èó¥ÂÜÖË¢´ÊâßË°å‰∫Ü„ÄÇËøô‰∏™ÈóÆÈ¢ò‰∏é<code>runq</code>ÁöÑÊéíÈòüÈÄªËæëÊó†ÂÖ≥ÔºåÂ±û‰∫éË∞ÉÂ∫¶ÈÄªËæëÁöÑËåÉÁï¥„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230119000143891.png" alt="image-20230119000143891" style="zoom:33%;" />
<p>Âú®‰ªãÁªç<code>runtime.schedule</code>Êó∂Ôºå‰ªãÁªçËøá<strong>ÊØèÈöî<code>61</code>‰∏™<code>schedtick</code>Â∞±‰ºö‰ºòÂÖà‰ªéÂÖ®Â±Ä<code>runq</code>‰∏≠Ëé∑Âèñ<code>goroutine</code></strong>ÔºåËøôÊ†∑ÊòØ‰∏∫‰∫ÜÈÅøÂÖçÂú®ÊØè‰∏™<code>p</code>ÁöÑÊú¨Âú∞<code>runq</code>ÈÉΩÁπÅÂøôÁöÑÊó∂ÂÄôÔºåÂÖ®Â±Ä<code>runq</code>‰∏≠ÁöÑ<code>goroutine</code>ËøüËøüÂæó‰∏çÂà∞Ë∞ÉÂ∫¶ÁöÑÊÉÖÂÜµ„ÄÇ</p>
<h4 id="ÈóÆÁ≠îÈ¢òÈõÜÂêà">ÈóÆÁ≠îÈ¢òÈõÜÂêà</h4>
<blockquote>
<h4 id="ÈóÆgpmÊ®°Âûã‰∏≠pÂºïÂÖ•ÁöÑÂéüÂõ†"><strong>ÈóÆÔºöGPMÊ®°Âûã‰∏≠ÔºåPÂºïÂÖ•ÁöÑÂéüÂõ†Ôºü</strong></h4>
</blockquote>
<p><strong>Á≠îÔºö</strong></p>
<ul>
<li>‰∏ÄÂºÄÂßãÊâÄÊúâÁöÑ<code>g</code>ÈÉΩÂú®‰∏Ä‰∏™ÂÖ®Â±Ä<code>runq</code>‰∏≠ÔºåÁî®‰∏Ä‰∏™ÂÖ®Â±ÄÁöÑ<code>mutex</code>‰øùÊä§ÂÖ®Â±Ä<code>runq</code>ÔºåÂ§ö‰∏™<code>m</code>‰ªéÂÖ®Â±Ä<code>runq</code>‰∏≠Ëé∑Âèñ<code>g</code>Êó∂ÈúÄË¶ÅÈ¢ëÁπÅÁöÑÂä†Ëß£ÈîÅÂèäÁ≠âÂæÖÔºõ</li>
<li><code>g</code>ÁöÑÊØèÊ¨°ÊâßË°å‰ºöË¢´ÈöèÊú∫ÁöÑÂàÜÂà∞‰∏çÂêåÁöÑ<code>m</code>ÔºåÈÄ†ÊàêÂú®‰∏çÂêå<code>m</code>ÁöÑÈ¢ëÁπÅÂàáÊç¢ÔºåÁ†¥ÂùèÁ®ãÂ∫èÁöÑÂ±ÄÈÉ®ÊÄßÔºõ(ËøôÁÇπÊúâÁÇπÊÄ™ÔºåÊúâÂæÖÁ°ÆÂÆö)</li>
<li>ÊØè‰∏™<code>m</code>ÈÉΩ‰ºöÂÖ≥ËÅî‰∏Ä‰∏™ÂÜÖÂ≠òÂàÜÈÖçÁºìÂ≠òÔºåÈÄ†ÊàêÂ§ßÈáèÁöÑÂÜÖÂ≠òÂºÄÈîÄÔºå‰ΩÜÂÆûÈôÖ‰∏äÂè™ÊúâÊâßË°å<code>g</code>ÁöÑ<code>m</code>ÊâçÈúÄË¶ÅÔºåÈÇ£‰∫õÈòªÂ°ûÂú®Ë∞ÉÂ∫¶ÁöÑ<code>m</code>Ê†πÊú¨‰∏çÈúÄË¶ÅÔºõ</li>
<li>ÂºïÂÖ•<code>p</code>ÂêéÔºå<code>m</code>Â∞±ÂèØ‰ª•Áõ¥Êé•‰ªé<code>p</code>Â§ÑËé∑ÂèñÂæÖÊâßË°åÁöÑ<code>g</code>Ôºå‰∏çÁî®ÊØèÊ¨°ÈÉΩÂíå‰ºóÂ§ö<code>m</code>‰ªé‰∏Ä‰∏™ÂÖ®Â±ÄÈòüÂàó‰∏≠‰∫âÊä¢‰ªªÂä°ÔºåÊèêÈ´ò‰∫ÜÂπ∂ÂèëÊÄßËÉΩ„ÄÇ</li>
</ul>
<blockquote>
<h4 id="ÈóÆÂ§ö‰∏™Á∫øÁ®ãÂèØ‰ª•Â±û‰∫éÂêå‰∏Ä‰∏™ËøõÁ®ãÂπ∂ÂÖ±‰∫´ÂÜÖÂ≠òÁ©∫Èó¥"><strong>ÈóÆÔºöÂ§ö‰∏™Á∫øÁ®ãÂèØ‰ª•Â±û‰∫éÂêå‰∏Ä‰∏™ËøõÁ®ãÂπ∂ÂÖ±‰∫´ÂÜÖÂ≠òÁ©∫Èó¥„ÄÇ</strong></h4>
<p>Âõ†‰∏∫Â§öÁ∫øÁ®ã‰∏çÈúÄË¶ÅÂàõÂª∫Êñ∞ÁöÑËôöÊãüÂÜÖÂ≠òÁ©∫Èó¥ÔºåÊâÄ‰ª•ÂÆÉ‰ª¨‰πü‰∏çÈúÄË¶ÅÂÜÖÂ≠òÁÆ°ÁêÜÂçïÂÖÉÂ§ÑÁêÜ‰∏ä‰∏ãÊñáÁöÑÂàáÊç¢ÔºåÁ∫øÁ®ã‰πãÈó¥ÁöÑÈÄö‰ø°‰πüÊ≠£ÊòØÂü∫‰∫éÂÖ±‰∫´ÁöÑÂÜÖÂ≠òËøõË°åÁöÑÔºå‰∏éÈáçÈáèÁ∫ßÁöÑËøõÁ®ãÁõ∏ÊØîÔºåÁ∫øÁ®ãÊòæÂæóÊØîËæÉËΩªÈáè„ÄÇËøô‰∏çÊòØÊå∫Â•ΩÁöÑÂòõÔºå<strong>‰∏∫Âï•ËøòË¶ÅÂºïÂÖ•<code>goroutine</code>Ôºü</strong></p>
</blockquote>
<p><strong>Á≠îÔºö</strong></p>
<ul>
<li>ËôΩÁÑ∂Á∫øÁ®ãÊØîËæÉËΩªÈáèÔºå‰ΩÜÊòØÂú®Ë∞ÉÂ∫¶Êó∂‰πüÊúâÊØîËæÉÂ§ßÁöÑÈ¢ùÂ§ñÂºÄÈîÄÔºõ</li>
<li>ÊØè‰∏™Á∫øÁ®ãÈÉΩÈúÄË¶Å‰∏Ä‰∏™<strong>Áî®Êà∑Ê†à</strong>Âíå<strong>ÂÜÖÊ†∏Ê†à</strong>ÔºåÂΩìÈúÄË¶Å‰ΩøÁî®Á≥ªÁªüËµÑÊ∫êÁöÑÊó∂ÂÄôÔºå‰ºöÈÄöËøáÁ≥ªÁªüË∞ÉÁî®ËøõÂÖ•ÂÜÖÊ†∏ÊÄÅ„ÄÇ(‰∏∫‰ªÄ‰πàË¶ÅÂàÜÂºÄÔºü‰∏∫‰∫ÜÈò≤Ê≠¢Áî®Êà∑ÊÄÅ‰ª£Á†ÅËÆøÈóÆÂÜÖÊ†∏Êï∞ÊçÆ)„ÄÇÂΩìÁ≥ªÁªüÁöÑÁ∫øÁ®ãËææÂà∞‰∏ÄÂÆöËßÑÊ®°ÔºåÂÜÖÊ†∏Ê†àÂíåÁî®Êà∑Ê†à‰ºöÂç†Áî®Â§ßÈáèÂÜÖÂ≠òÔºõÂπ∂‰∏îÔºåÊìç‰ΩúÁ≥ªÁªüÂü∫‰∫éÊó∂Èó¥ÁâáÁöÑÁ≠ñÁï•Ë∞ÉÂ∫¶ÊâÄÊúâÁ∫øÁ®ãÔºåËã•Á∫øÁ®ãËßÑÊ®°ËøáÂ§ßÔºå‰∏∫‰∫ÜÈôç‰ΩéÂª∂ËøüÔºåÁ∫øÁ®ãÊØèÊ¨°Ëé∑ÂæóÁöÑÊó∂Èó¥Áâá‰ºöË¢´ÂéãÁº©Ôºå‰ªéËÄåÂØºËá¥Á∫øÁ®ãÂàáÊç¢È¢ëÁéáÂèòÂ§ß„ÄÇÁ∫øÁ®ãÁöÑÈ¢ëÁπÅÂàáÊç¢‰πü‰ºöÂç†Áî®Â§ßÈáèCPUËµÑÊ∫ê„ÄÇËÄåÈ´òÂπ∂ÂèëÁöÑÂú∫ÊôØÈúÄÊ±ÇÂ∞±ÊòØË¶Å<strong>È¢ëÁπÅÂàáÊç¢</strong>„ÄÇ</li>
<li>ÂºïÂÖ•ÂçèÁ®ãÔºåÂèØ‰ª•<strong>ËäÇÁúÅÂÜÖÂ≠òÁ©∫Èó¥</strong>ÔºåÈôç‰Ωé<strong>Ë∞ÉÂ∫¶‰ª£‰ª∑</strong>„ÄÇ<strong>ÂçèÁ®ãÁöÑË∞ÉÂ∫¶‰∏çÈúÄË¶ÅÊìç‰ΩúÁ≥ªÁªüÂèÇ‰∏éÔºåÂè™ÈúÄË¶ÅÁî®Êà∑ÊÄÅÁ®ãÂ∫èË∞ÉÂ∫¶„ÄÇ</strong></li>
<li>ÊØè‰∏™Á∫øÁ®ãÈÉΩ‰ºöÂç†Áî® 1M ‰ª•‰∏äÁöÑÂÜÖÂ≠òÁ©∫Èó¥ÔºåÂú®ÂàáÊç¢Á∫øÁ®ãÊó∂‰∏çÊ≠¢‰ºöÊ∂àËÄóËæÉÂ§öÁöÑÂÜÖÂ≠òÔºåÊÅ¢Â§çÂØÑÂ≠òÂô®‰∏≠ÁöÑÂÜÖÂÆπËøòÈúÄË¶ÅÂêëÊìç‰ΩúÁ≥ªÁªüÁî≥ËØ∑ÊàñËÄÖÈîÄÊØÅËµÑÊ∫êÔºåÊØè‰∏ÄÊ¨°Á∫øÁ®ã‰∏ä‰∏ãÊñáÁöÑÂàáÊç¢ÈÉΩÈúÄË¶ÅÊ∂àËÄó ~1us Â∑¶Âè≥ÁöÑÊó∂Èó¥Ôºå‰ΩÜÊòØ Go Ë∞ÉÂ∫¶Âô®ÂØπ Goroutine ÁöÑ‰∏ä‰∏ãÊñáÂàáÊç¢Á∫¶‰∏∫ ~0.2usÔºåÂáèÂ∞ë‰∫Ü 80% ÁöÑÈ¢ùÂ§ñÂºÄÈîÄ„ÄÇ</li>
</ul>
<blockquote>
<h4 id="ÈóÆË∞ÅË¥üË¥£Ëß¶ÂèëtimerÊ≥®ÂÜåÁöÑÂõûË∞ÉÂáΩÊï∞">**ÈóÆÔºö**Ë∞ÅË¥üË¥£Ëß¶Âèë<code>timer</code>Ê≥®ÂÜåÁöÑÂõûË∞ÉÂáΩÊï∞Ôºü</h4>
</blockquote>
<p><strong>Á≠îÔºö</strong><code>timer</code>ÁöÑËß¶ÂèëÂàÜ‰∏∫<strong>Ë∞ÉÂ∫¶Ëß¶Âèë</strong>Âíå<strong>ÁõëÊéßÁ∫øÁ®ãËß¶Âèë</strong>Ôºå‰∏§ËÄÖ‰∏ªË¶ÅÊòØÈÄöËøáË∞ÉÁî®ÂáΩÊï∞<code>checkTimers()</code>Êù•ÂÆûÁé∞„ÄÇ</p>
<p>ÂÖ∂ÂÆûÊØè‰∏™<code>p</code>ÈÉΩÊúâ‰∏Ä‰∏™<strong>ÊúÄÂ∞èÂ†Ü<code>p.timers</code></strong>ÔºåÁî®‰∫éÁÆ°ÁêÜËá™Â∑±ÁöÑ<code>timer</code>Ôºå<strong>Â†ÜÈ°∂ÁöÑ<code>timer</code>Â∞±ÊòØÊé•‰∏ãÊù•Ë¶ÅËß¶ÂèëÁöÑÈÇ£‰∏Ä‰∏™</strong>(ËÄÅÁâàÊú¨Ëøô‰∏™Â†ÜÊòØÂÖ®Â±ÄÁöÑÔºåÂ∞±ÂæàÊÖ¢ÔºÅ)„ÄÇËÄå<strong>Â∑•‰ΩúÁ∫øÁ®ãÊØèÊ¨°Ë∞ÉÂ∫¶Êó∂(ÊâßË°å<code>schedule()</code>Êó∂)ÔºåÈÉΩ‰ºöË∞ÉÁî®<code>checkTimers()</code>ÂáΩÊï∞</strong>ÔºåÊ£ÄÊü•Âπ∂ÊâßË°åÈÇ£‰∫õÂ∑≤ÁªèÂà∞Êó∂Èó¥ÁöÑ<code>timer</code>„ÄÇ<strong>‰∏çËøáËøô‰∏çÂ§üÁ®≥Â¶•</strong>Ôºå‰∏á‰∏ÄÊâÄÊúâÁöÑ<code>m</code>ÈÉΩÂú®ÂøôÔºåÈÇ£‰πàÂ∞±‰∏çËÉΩÂèäÊó∂Ëß¶ÂèëË∞ÉÂ∫¶‰∫ÜÔºåÂèØËÉΩ‰ºöÂØºËá¥<code>timer</code>ÊâßË°åÊó∂Èó¥ÂèëÁîüËæÉÂ§ßÂÅèÂ∑Æ„ÄÇÊâÄ‰ª•Ëøò‰ºöÈÄöËøá<strong>ÁõëÊéßÁ∫øÁ®ã</strong>Êù•Â¢ûÂä†‰∏ÄÂ±Ç‰øùÈöú„ÄÇ</p>
<p><strong>ÁõëÊéßÁ∫øÁ®ã</strong>ÊòØÁî±<code>main goroutine</code>ÂàõÂª∫ÁöÑÔºå‰∏é<code>GPM</code>‰∏≠ÁöÑÂ∑•‰ΩúÁ∫øÁ®ã‰∏çÂêåÔºåÂπ∂‰∏çÈúÄË¶Å‰æùËµñ<code>p</code>Ôºå‰πü‰∏çÁî±<code>GPM</code>Ë∞ÉÂ∫¶„ÄÇÁõëÊéßÁ∫øÁ®ãÊúâÂ§ö‰∏™‰ªªÂä°ÔºåÂÖ∂‰∏≠‰∏ÄÈ°π‰æøÊòØ<strong>‰øùÈöú<code>timer</code>ÁöÑÊ≠£Â∏∏ÊâßË°å</strong>„ÄÇÁõëÊéßÁ∫øÁ®ãÊ£ÄÊµãÂà∞Êé•‰∏ãÊù•Êúâ<code>timer</code>Ë¶ÅÊâßË°åÊó∂(ÈÅçÂéÜÊâÄÊúâÁöÑ<code>p</code>ÔºåÊâæÂá∫‰∏ãÊ¨°ÊúÄÂÖàÊâßË°å(Êó∂Èó¥ÂÄºÊúÄÂ∞è)ÁöÑÊó∂Èó¥ÂíåÂÖ∂ÊâÄÂú®ÁöÑ<code>p</code>)ÔºåËã•Ê≠§Êó∂Êó†Á©∫Èó≤<code>m</code>Ôºå‰æø‰ºöÂàõÂª∫Êñ∞ÁöÑÂ∑•‰ΩúÁ∫øÁ®ã‰ª•‰øùÈöú<code>timer</code>ÂèØ‰ª•È°∫Âà©ÊâßË°å„ÄÇ</p>
<blockquote>
<h4 id="ÈóÆÂ¶Ç‰ΩïÊä¢Âç†ÂÖ∑‰ΩìËØ¥ËØ¥"><strong>ÈóÆÔºö<strong>Â¶Ç‰Ωï</strong>Êä¢Âç†</strong>ÔºüÂÖ∑‰ΩìËØ¥ËØ¥Ôºü</h4>
</blockquote>
<p><strong>Á≠îÔºö<strong>ÁõëÊéßÁ∫øÁ®ãË¶ÅÊú¨ÁùÄ</strong>ÂÖ¨Âπ≥Ë∞ÉÂ∫¶</strong>ÁöÑÂéüÂàôÔºåÂØπËøêË°åÊó∂Èó¥ËøáÈïøÁöÑ<code>p</code>ÂÆûË°å**&ldquo;Êä¢Âç†&rdquo;**Êìç‰Ωú„ÄÇÂ∞±ÊòØÂëäËØâÈÇ£‰∫õËøêË°åÊó∂Èó¥Ë∂ÖËøáÁâπÂÆöÈòàÂÄº(10ms)ÁöÑ<code>g</code>ÔºåËØ•ËÆ©Âá∫‰∫ÜÔºÅ</p>
<p>Go 1.14‰πãÂâç‰æùËµñ‰∫éÊ†àÂ¢ûÈïø„ÄÇ**Â±ïÂºÄÔºö**ÂΩì<code>runtime</code>Â∏åÊúõÊüê‰∏™ÂçèÁ®ãËÆ©Âá∫CPUÊó∂ÔºåÂ∞±‰ºöÊää‰ªñÁöÑ<code>stackguard</code>ËµãÂÄº‰∏∫<code>stackPreempt</code>ÔºåËøôÊòØ‰∏Ä‰∏™ÈùûÂ∏∏Â§ßÁöÑÂÄºÔºåÁúüÊ≠£ÁöÑÊ†àÊåáÈíà‰∏ç‰ºöÊåáÂêëËøô‰∏™‰ΩçÁΩÆÔºåÂõ†Ê≠§Áî®‰ΩúÁâπÊÆäÊ†áËØÜ„ÄÇËøõËÄå‰ºöË∑≥ËΩ¨Âà∞<code>morestack</code>Â§ÑÔºåËÄå<code>morestack</code>‰ºöË∞ÉÁî®<code>runtime.newstack()</code>ÂáΩÊï∞ÔºåË¥üË¥£Ê†àÂ¢ûÈïøÂ∑•‰Ωú„ÄÇ‰∏çËøá‰ªñÂú®ËøõË°åÊ†àÂ¢ûÈïøÂ∑•‰ΩúÂâç‰ºöÂÖàÂà§Êñ≠<code>stackguard0</code>ÊòØÂê¶Á≠â‰∫é<code>stackPreempt</code>ÔºåÁ≠â‰∫éÁöÑËØùÂ∞±‰∏çËøõË°åÊ†àÂ¢ûÈïø‰∫ÜÔºå<strong>ËÄåÊòØÊâßË°å‰∏ÄÊ¨°ÂçèÁ®ãË∞ÉÂ∫¶</strong>„ÄÇËøôÁßçÊñπÂºèÁöÑÁº∫ÁÇπÊòØËøáÂ∫¶‰æùËµñÊ†àÂ¢ûÈïø‰ª£Á†ÅÔºåÂ¶ÇÊûúÊù•‰∏™Á©∫ÁöÑ<code>for{}</code>Âæ™ÁéØÔºåÂõ†‰∏∫‰∏éÊ†àÂ¢ûÈïøÊó†ÂÖ≥ÔºåÁ®ãÂ∫èÂ∞±‰ºöÂç°Ê≠ªÂú®Ëøô‰∏™Âú∞Êñπ„ÄÇ</p>
<p>ÂÖ∂ÂÆûÔºå‰∏∫‰∫ÜÂÖÖÂàÜÂà©Áî®CPUÔºåÁõëÊéßÁ∫øÁ®ãËøò‰ºöÊä¢Âç†Â§ÑÂú®<strong>Á≥ªÁªüË∞ÉÁî®‰∏≠ÁöÑ<code>p</code></strong>ÔºåÂõ†‰∏∫‰∏Ä‰∏™ÂçèÁ®ãË¶ÅÊâßË°åÁ≥ªÁªüË∞ÉÁî®ÔºåÂ∞±Ë¶ÅÂàáÊç¢Âà∞<code>g0</code>Ê†àÔºåÂú®Á≥ªÁªüË∞ÉÁî®Ê≤°ÊâßË°åÂÆå‰πãÂâçÔºåËøô‰∏™<code>m</code>Âíå<code>g</code>ÂÖ∂ÂÆûÁªëÂÆö‰∫ÜÔºå‰∏çËÉΩË¢´ÂàÜÂºÄÔºå‰πüÂ∞±Áî®‰∏çÂà∞<code>p</code>ÔºåÊâÄ‰ª•Âú®Èô∑ÂÖ•Á≥ªÁªüË∞ÉÁî®ÂâçÔºåÂΩìÂâç<code>m</code>‰ºöËÆ©Âá∫<code>p</code>ÔºåËß£Èô§<code>m.p</code>‰∏éÂΩìÂâç<code>p</code>ÁöÑÂº∫ÂÖ≥ËÅîÔºåÂè™Âú®<code>m.oldp</code>‰∏≠ËÆ∞ÂΩïËøô‰∏™<code>p</code>„ÄÇ<code>p</code>ÁöÑÊï∞ÁõÆÊØïÁ´üÊúâÈôêÔºåÂ¶ÇÊûúÊúâÂÖ∂‰ªñÂçèÁ®ãÊ≠£Âú®Á≠âÂæÖÊâßË°åÔºåÈÇ£Â∞±‰ºöÊää‰ªñÂÖ≥ËÅîÂà∞ÂÖ∂‰ªñ<code>m</code>„ÄÇ</p>
<p>‰∏çËøáÂ¶ÇÊûúÂΩìÂâç<code>m</code>‰ªéÁ≥ªÁªüË∞ÉÁî®‰∏≠ÊÅ¢Â§çÔºå‰ºöÂÖàÊ£ÄÊµã‰πãÂâçÁöÑ<code>p</code>ÊòØÂê¶Ë¢´Âç†Áî®ÔºåÊ≤°ÊúâÁöÑËØùÂ∞±ÁªßÁª≠‰ΩøÁî®ÔºåÂê¶ÂàôÂÜçÂéªÁî≥ËØ∑‰∏Ä‰∏™ÔºåÊ≤°Áî≥ËØ∑Âà∞ÁöÑËØùÔºåÂ∞±ÊääÂΩìÂâç<code>g</code>ÊîæÂÖ•ÂÖ®Â±Ä<code>runq</code>‰∏≠ÔºåÁÑ∂ÂêéÂΩìÂâçÁ∫øÁ®ãÂ∞±Áù°Áú†‰∫Ü„ÄÇ</p>
<blockquote>
<h4 id="ÈóÆÈÇ£Êä¢Âç†Êó∂ÊÄé‰πàÁü•ÈÅìÊüê‰∏™gËøêË°åÊó∂Èó¥ËøáÈïø‰∫ÜÂë¢">**ÈóÆÔºö**ÈÇ£Êä¢Âç†Êó∂ÔºåÊÄé‰πàÁü•ÈÅìÊüê‰∏™<code>g</code>ËøêË°åÊó∂Èó¥ËøáÈïø‰∫ÜÂë¢Ôºü</h4>
</blockquote>
<p><strong>Á≠îÔºö</strong><code>p</code>ÈáåÈù¢Êúâ‰∏Ä‰∏™<code>schedtick</code>Â≠óÊÆµÔºåÊØèÂΩìË∞ÉÂ∫¶ÊâßË°å‰∏Ä‰∏™Êñ∞ÁöÑ<code>g</code>ÔºåÂπ∂‰∏î‰∏çÁªßÊâø‰∏ä‰∏™<code>g</code>ÁöÑÊó∂Èó¥ÁâáÊó∂ÔºåÂ∞±‰ºöÊää<code>p.schedtick++</code>ÔºåËÄå<code>sysmontick.schedwhen</code>ËÆ∞ÂΩï‰∏ä‰∏ÄÊ¨°Ë∞ÉÂ∫¶ÁöÑÊó∂Èó¥„ÄÇÁõëÊéßÁ∫øÁ®ãÂ¶ÇÊûúÁõëÊµãÂà∞<code>sysmontick.schedtick</code>‰∏é<code>p.schedtick</code>‰∏çÁõ∏Á≠âÔºåËØ¥ÊòéËøô‰∏™<code>p</code>ÂèëÁîü‰∫ÜÊñ∞ÁöÑË∞ÉÂ∫¶ÔºåÂ∞±‰ºöÂêåÊ≠•<code>sysmontick.schedtick</code>ÁöÑÂÄºÔºåÂπ∂Êõ¥Êñ∞Ë∞ÉÂ∫¶Êó∂Èó¥<code>sysmontick.schedwhen</code>Ôºõ‰ΩÜËã•‰∫åËÄÖÁõ∏Á≠âÔºåËØ¥ÊòéÊ≤°ÂèëÁîüÊñ∞ÁöÑË∞ÉÂ∫¶ÔºåÊàñËÄÖÂç≥‰ΩøÂèëÁîü‰∫ÜÊñ∞ÁöÑË∞ÉÂ∫¶Ôºå‰πüÊ≤øÁî®‰∫Ü‰πãÂâçÁöÑÊó∂Èó¥ÁâáÔºåÊâÄ‰ª•ÂèØ‰ª•ÈÄöËøáÂΩìÂâçÊó∂Èó¥‰∏é<code>sysmontick.schedwhen</code>ÁöÑÂ∑ÆÂÄºÊù•Âà§Êñ≠ÂΩìÂâç<code>p</code>‰∏äÁöÑ<code>g</code>ÊòØÂê¶ËøêË°åÊó∂Èó¥ËøáÈïø„ÄÇ</p>
<blockquote>
<h4 id="ÈóÆÂ¶Ç‰ΩïË∞ÉÂ∫¶Â±ïÂºÄËØ¥ËØ¥"><strong>ÈóÆÔºö<strong>Â¶Ç‰Ωï</strong>Ë∞ÉÂ∫¶</strong>ÔºüÂ±ïÂºÄËØ¥ËØ¥Ôºü</h4>
</blockquote>
<p><strong>Á≠îÔºöÂ∑≤ÁªèÊä¢Âç†‰∫Ü<code>p</code>ÔºåÂæóË∞ÉÂ∫¶‰∏™ÁöÑ<code>g</code>ËøáÊù•ÊâßË°åÂêßÔºü<strong>ËøôÂ∞±Áî®Âà∞‰∫Ü</strong><code>schedule()</code></strong>„ÄÇ</p>
<ul>
<li>È¶ñÂÖàÔºåË¶ÅÁ°ÆÂÆöÂΩìÂâç<code>m</code>ÊòØÂê¶ÂíåÂΩìÂâç<code>g</code>ÁªëÂÆö‰∫Ü„ÄÇÂ¶ÇÊûúÁªëÂÆö‰∫ÜÔºåÈÇ£ÂΩìÂâç<code>m</code>Â∞±‰∏çËÉΩÊâßË°åÂÖ∂‰ªñ<code>g</code>Ôºå‰ºöÈòªÂ°ûÂΩìÂâç<code>m</code>ÔºåÁ≠âÂà∞ÂΩìÂâç<code>g</code>ÂÜçÊ¨°ÂæóÂà∞Ë∞ÉÂ∫¶ÊâßË°åÊó∂ÔºåÂ∞±‰ºöÊää<code>m</code>Âî§ÈÜíÔºõÂ¶ÇÊûúÊ≤°ÊúâÁªëÂÆöÔºåÂ∞±ÂÖàÁúãÁúã<code>GC</code>ÊòØ‰∏çÊòØÂú®Á≠âÂæÖÊâßË°å„ÄÇÂ¶ÇÊûú<code>GC</code>Ê≠£Á≠âÂæÖÊâßË°åÔºåÂ∞±ÂéªÊâßË°å<code>GC</code>ÔºåÂõûÊù•ÂÜçÁªßÁª≠ÊâßË°åË∞ÉÂ∫¶Á®ãÂ∫èÔºõ</li>
<li>Êé•‰∏ãÊù•Ôºå‰ºöÊâßË°å<code>checkTimer()</code>Ê£ÄÊü•ÊúâÊ≤°ÊúâË¶ÅÊâßË°åÁöÑ<code>timer</code>ÔºõÁÑ∂Âêé‰ºöÂÖàÂéªÊú¨Âú∞<code>runq</code>‰∏≠Êü•ÊâæÔºåÊ≤°ÊúâÁöÑËØùÂ∞±Ë∞ÉÁî®<code>findrunnable()</code>ÔºåËøô‰∏™ÂáΩÊï∞Áõ¥Âà∞Ëé∑ÂèñÂà∞ÂæÖÊâßË°åÁöÑ<code>g</code>Êâç‰ºöËøîÂõûÔºõ</li>
<li>Âú®<code>findrunnable()</code>Â§ÑÔºå‰πü‰ºöÂà§Êñ≠ÊòØÂê¶Ë¶ÅÊâßË°å<code>GC</code>ÔºåÁÑ∂ÂêéÂÖàÂ∞ùËØï‰ªéÊú¨Âú∞<code>runq</code>‰∏≠Ëé∑Âèñ -&gt; Ê≤°ÊúâÁöÑËØùÂ∞±‰ªéÂÖ®Â±Ä<code>runq</code>‰∏≠Ëé∑Âèñ‰∏ÄÈÉ®ÂàÜ -&gt; Â¶ÇÊûúËøòÊ≤°ÊúâÔºåÂ∞±ÂÖàÂ∞ùËØïÊâßË°å<code>netpoll</code>ÔºåÊÅ¢Â§çÈÇ£‰∫õ<code>I/O‰∫ã‰ª∂</code>Â∑≤ÁªèÂ∞±Áª™ÁöÑ<code>g</code>ÔºåÂÆÉ‰ª¨‰ºöË¢´ÊîæÂõûÂÖ®Â±Ä<code>runq</code>‰∏≠ -&gt; ÁÑ∂ÂêéÊâç‰ºöÂ∞ùËØï‰ªéÂÖ∂‰ªñ<code>p</code>ÈÇ£Èáå<code>steal</code>‰∏Ä‰∫õ‰ªªÂä°„ÄÇ</li>
<li><strong>ÂΩìË∞ÉÂ∫¶Á®ãÂ∫èÁªà‰∫éËé∑Âæó‰∏Ä‰∏™ÂæÖÊâßË°åÁöÑ<code>g</code>Âêé</strong>ÔºåËøòÈúÄË¶ÅÊ£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÁªëÂÆöÊüê‰∏™<code>m</code>ÔºåÂ¶ÇÊûúÂ∑≤ÁªèÁªëÂÆö‰∫ÜÊüê‰∏™<code>m</code>ÔºåËøòÂæóÊääËøô‰∏™<code>g</code>ÈÄÅÂõûÂéªÔºåËÄåÂΩìÂâç<code>m</code>‰∏çÂæó‰∏çÂÜçÊ¨°ËøõË°å<code>schedule()</code>Ë∞ÉÂ∫¶ÔºõÂ¶ÇÊûúÊ≤°ÊúâÁªëÂÆöÁöÑ<code>m</code>ÔºåÂ∞±Ë∞ÉÁî®<code>execute()</code>Âú®ÂΩìÂâç<code>m</code>‰∏äÊâßË°åËøô‰∏™<code>g</code>„ÄÇ</li>
<li><code>execute()</code>‰ºöÂª∫Á´ãÂΩìÂâç<code>m</code>‰∏é<code>g</code>ÁöÑÂÖ≥ËÅîÂÖ≥Á≥ªÔºåÂπ∂Êää<code>g</code>ÁöÑÁä∂ÊÄÅ‰ªé<code>_Grunnable</code>Êîπ‰∏∫<code>_Grunning</code>ÔºåÂ¶ÇÊûú‰∏çÁªßÊâø‰∏ä‰∏Ä‰∏™ÂçèÁ®ãÁöÑÊó∂Èó¥ÁâáÔºåÂ∞±Êää<code>p</code>ËøôÈáåÁöÑË∞ÉÂ∫¶ËÆ°Êï∞<code>p.schedtick</code>+1Ôºõ</li>
<li>ÊúÄÂêéÔºå‰ºöË∞ÉÁî®<code>gogo()</code>ÂáΩÊï∞Ôºå‰ªé<code>g.sched</code>ËøôÈáåÊÅ¢Â§çÂçèÁ®ãÊ†àÊåáÈíà„ÄÅÊåá‰ª§ÊåáÈíàÁ≠âÁªßÁª≠ÊâßË°å„ÄÇ</li>
</ul>
<blockquote>
<h4 id="ÈóÆ">ÈóÆÔºö</h4>
</blockquote>
<p>ÂΩì‰Ω†‰∏çÁü•ÈÅì‰∏Ä‰∏™ÂçèÁ®ã‰ªÄ‰πàÊó∂ÂÄôÂÅúÊ≠¢Êó∂Ôºå‰Ω†Â∞±‰∏çÂ∫îËØ•ÂéªÂàõÂª∫Ëøô‰πà‰∏™ÂçèÁ®ã„ÄÇ‰πüÂ∞±ÊòØÔºå‰∏çËÉΩÊª•Áî®Âπ∂Âèë„ÄÇ</p>
<blockquote>
<h4 id="ÈóÆgoroutine-‰ªÄ‰πàÊó∂ÂÄô‰ºöÂèëÁîüÊ≥ÑÊºèÊÄé‰πàÂèëÁé∞goroutine-Ë¢´Âç†Êª°‰∫ÜÊÄé‰πàÂäû">ÈóÆÔºöGoroutine ‰ªÄ‰πàÊó∂ÂÄô‰ºöÂèëÁîüÊ≥ÑÊºèÔºüÊÄé‰πàÂèëÁé∞ÔºüGoroutine Ë¢´Âç†Êª°‰∫ÜÊÄé‰πàÂäûÔºüüö©‚≠ê</h4>
</blockquote>
<p><strong>Goroutine Ê≥ÑÈú≤ÁöÑÂéüÂõ†Â§ßÂ§öÈõÜ‰∏≠Âú®</strong>Ôºö</p>
<ul>
<li>Goroutine ÂÜÖÊ≠£Âú®ËøõË°å channel/mutex Á≠âËØªÂÜôÊìç‰ΩúÔºå‰ΩÜÁî±‰∫éÈÄªËæëÈóÆÈ¢òÔºåÊüê‰∫õÊÉÖÂÜµ‰∏ã‰ºö<strong>Ë¢´‰∏ÄÁõ¥ÈòªÂ°û</strong>„ÄÇÊØîÂ¶ÇÔºö
<ul>
<li>‰ΩøÁî®channelÊó∂ÔºåÂè™ÊúâÂÜôÊ≤°ÊúâËØª„ÄÅÂè™ÊúâËØªÊ≤°ÊúâÂÜôÔºåÊØîÂ¶Ç‰ª•‰∏ã‰ª£Á†ÅÔºö</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// 1. Âè™ÂÜô‰∏çËØª
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;goroutines: %d\n&#34;</span><span class="p">,</span> <span class="nx">runtime</span><span class="p">.</span><span class="nf">NumGoroutine</span><span class="p">())</span> <span class="c1">// 1Ôºåmain  goroutine
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nf">queryAll</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;goroutines: %d\n&#34;</span><span class="p">,</span> <span class="nx">runtime</span><span class="p">.</span><span class="nf">NumGoroutine</span><span class="p">())</span> <span class="c1">// ÊØèÊ¨° + 3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">queryAll</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ch</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">int</span><span class="p">)</span> <span class="c1">// Êó†ÁºìÂÜ≤channel
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span> <span class="nx">ch</span> <span class="o">&lt;-</span> <span class="mi">1</span> <span class="p">}()</span> <span class="c1">// Âè™ÊúâÂÜôÔºåÊ≤°ÊúâËØªÔºåÈÄ†ÊàêgoroutineÈòªÂ°ûÔºå‰πüÂ∞±ÊòØgoroutineÊ≥ÑÈú≤
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 2. Âè™ËØª‰∏çÂÜô
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;goroutines: &#34;</span><span class="p">,</span> <span class="nx">runtime</span><span class="p">.</span><span class="nf">NumGoroutine</span><span class="p">())</span>	<span class="c1">// 2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">ch</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">int</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="o">&lt;-</span><span class="nx">ch</span>	<span class="c1">// Âè™ËØª‰∏çÂÜôÔºå‰πü‰ºöÈòªÂ°ûÔºåÈÄ†ÊàêÊ≥ÑÈú≤
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">time</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Goroutine ÂÜÖÁöÑ‰∏öÂä°ÈÄªËæë<strong>ËøõÂÖ•Ê≠ªÂæ™ÁéØ</strong>ÔºåËµÑÊ∫ê‰∏ÄÁõ¥Êó†Ê≥ïÈáäÊîæ
<ul>
<li>ÊØîÂ¶ÇËØ¥ÔºåÁî®ÈîÅÔºö</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">total</span> <span class="o">:=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">time</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;total: &#34;</span><span class="p">,</span> <span class="nx">total</span><span class="p">)</span>                       <span class="c1">// 0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;goroutines: &#34;</span><span class="p">,</span> <span class="nx">runtime</span><span class="p">.</span><span class="nf">NumGoroutine</span><span class="p">())</span> <span class="c1">// 11
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">mutex</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span>
</span></span><span class="line"><span class="cl">	<span class="nx">mutex</span><span class="p">.</span><span class="nf">Lock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">mutex</span><span class="p">.</span><span class="nf">Lock</span><span class="p">()</span> <span class="c1">// ÈòªÂ°ûÂú®Ê≠§Â§Ñ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">total</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">		<span class="p">}()</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Goroutine ÂÜÖÁöÑ‰∏öÂä°ÈÄªËæë<strong>ËøõÂÖ•ÈïøÊó∂Èó¥Á≠âÂæÖ</strong>ÔºåÊúâ‰∏çÊñ≠Êñ∞Â¢ûÁöÑ Goroutine ËøõÂÖ•Á≠âÂæÖ„ÄÇ</li>
</ul>
<p>Â¶Ç‰ΩïÈÅøÂÖçÔºü</p>
<ul>
<li>ÂàõÂª∫Â∏¶ÊúâÁºìÂÜ≤Âå∫ÁöÑ channelÔºåËøôÊ†∑Â∞±ÂèØ‰ª•ÈÅøÂÖçÊ≤°ÊúâÊé•Êî∂Á´ØÂØºËá¥ÁöÑÈòªÂ°ûÔºõ</li>
<li>‰ΩøÁî® select Â∞ùËØïÂèëÈÄÅÔºõ</li>
</ul>
<hr>
<p>‰ª•‰∏äÊòØÔºågoroutineÊ≥ÑÈú≤ÁöÑÊÉÖÂÜµÔºåÂ¶Ç‰ΩïËøõË°åÊéíÊü•Ôºü</p>
<ul>
<li>ÈÄöËøá <code>runtime.NumGoroutine</code> ÂèØ‰ª•Ëé∑Âèñ goroutine Êï∞ÈáèÔºõ</li>
<li>ÈÄöËøá <code>pprof</code>„ÄÇ</li>
</ul>
<p>ÂèØÁªßÁª≠Â≠¶‰π† <a href="https://golang2.eddycjy.com/posts/ch6/01-pprof-1/" target="_blank" rel="noopener noreffer ">pprof</a>„ÄÇ</p>
<blockquote>
<h4 id="ÈóÆÂ¶Ç‰ΩïÊéßÂà∂ÂçèÁ®ãÁöÑÂπ∂ÂèëÊï∞Èáè">ÈóÆÔºöÂ¶Ç‰ΩïÊéßÂà∂ÂçèÁ®ãÁöÑÂπ∂ÂèëÊï∞ÈáèÔºü</h4>
</blockquote>
<p>‰∏çÂêåÁöÑÂ∫îÁî®Á®ãÂ∫èÔºåÊ∂àËÄóÁöÑËµÑÊ∫êÊòØ‰∏ç‰∏ÄÊ†∑ÁöÑ„ÄÇÊØîËæÉÊé®ËçêÁöÑÊñπÂºèÁöÑÊòØÔºöÂ∫îÁî®Á®ãÂ∫èÊù•‰∏ªÂä®ÈôêÂà∂Âπ∂ÂèëÁöÑÂçèÁ®ãÊï∞Èáè„ÄÇ</p>
<ol>
<li><strong>Âà©Áî® channel ÁöÑÁºìÂÜ≤Âå∫Êù•ÂÆûÁé∞</strong></li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// main_chan.go
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ch</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kd">struct</span><span class="p">{},</span> <span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">ch</span> <span class="o">&lt;-</span> <span class="kd">struct</span><span class="p">{}{}</span>
</span></span><span class="line"><span class="cl">		<span class="nx">wg</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">go</span> <span class="kd">func</span><span class="p">(</span><span class="nx">i</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">defer</span> <span class="nx">wg</span><span class="p">.</span><span class="nf">Done</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">			<span class="nx">log</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="nx">time</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="o">&lt;-</span><span class="nx">ch</span>
</span></span><span class="line"><span class="cl">		<span class="p">}(</span><span class="nx">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span class="nf">Wait</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÊúÄÂ§öÊúâ 3 ‰∏™ goroutine„ÄÇ</p>
<ol start="2">
<li><strong>Âà©Áî®Á¨¨‰∏âÊñπÂåÖÔºåÊûÑÈÄ†ÂçèÁ®ãÊ±†</strong></li>
</ol>
<ul>
<li><a href="https://github.com/Jeffail/tunny" target="_blank" rel="noopener noreffer ">Jeffail/tunny</a></li>
<li><a href="https://github.com/panjf2000/ants" target="_blank" rel="noopener noreffer ">panjf2000/ants</a></li>
</ul>
<p>‰ª• <code>tunny</code> ‰∏æ‰æãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;log&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;time&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/Jeffail/tunny&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Á¨¨‰∏Ä‰∏™ÂèÇÊï∞ÊòØÂçèÁ®ãÊ±†ÁöÑÂ§ßÂ∞è(poolSize)ÔºåÁ¨¨‰∫å‰∏™ÂèÇÊï∞ÊòØÂçèÁ®ãËøêË°åÁöÑÂáΩÊï∞(worker)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">pool</span> <span class="o">:=</span> <span class="nx">tunny</span><span class="p">.</span><span class="nf">NewFunc</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">i</span> <span class="kd">interface</span><span class="p">{})</span> <span class="kd">interface</span><span class="p">{}</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">log</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nx">time</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="nx">pool</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span> <span class="c1">// ÂÖ≥Èó≠ÂçèÁ®ãÊ±†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">go</span> <span class="nx">pool</span><span class="p">.</span><span class="nf">Process</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="c1">// Â∞ÜÂèÇÊï∞ i ‰º†ÈÄíÁªôÂçèÁ®ãÊ±†ÂÆö‰πâÂ•ΩÁöÑ worker Â§ÑÁêÜ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">time</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li><strong>Ë∞ÉÊï¥ËµÑÊ∫êÁöÑ‰∏äÈôê</strong></li>
</ol>
<ul>
<li>ulimit</li>
</ul>
<p><code>ulimit -a</code> ÂèØ‰ª•ÁúãÂà∞Á≥ªÁªüÂΩìÂâçÁöÑËÆæÁΩÆÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-zsh" data-lang="zsh"><span class="line"><span class="cl">‚ùØ <span class="nb">ulimit</span> -a
</span></span><span class="line"><span class="cl">-t: cpu <span class="nb">time</span> <span class="o">(</span>seconds<span class="o">)</span>              unlimited
</span></span><span class="line"><span class="cl">-f: file size <span class="o">(</span>blocks<span class="o">)</span>              unlimited
</span></span><span class="line"><span class="cl">-d: data seg size <span class="o">(</span>kbytes<span class="o">)</span>          unlimited
</span></span><span class="line"><span class="cl">-s: stack size <span class="o">(</span>kbytes<span class="o">)</span>             <span class="m">2032</span>
</span></span><span class="line"><span class="cl">-c: core file size <span class="o">(</span>blocks<span class="o">)</span>         unlimited
</span></span><span class="line"><span class="cl">-n: file descriptors                <span class="m">3200</span>
</span></span><span class="line"><span class="cl">-v: address space <span class="o">(</span>kbytes<span class="o">)</span>          unlimited
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂèØÈÄöËøá‰∏äËø∞ÂèÇÊï∞ÔºåËÆæÁΩÆÁ≥ªÁªüËµÑÊ∫êÈôêÂà∂ÔºåÊéßÂà∂ÂçèÁ®ãÊï∞ÁõÆ„ÄÇ</p>
<h2 id="32-ÁªÑÂêàÂºèÁªßÊâø">3.2 ÁªÑÂêàÂºèÁªßÊâø</h2>
<blockquote>
<h4 id="ÈóÆÂ¶Ç‰∏ã‰ª£Á†ÅËæìÂá∫‰ªÄ‰πà">ÈóÆÔºöÂ¶Ç‰∏ã‰ª£Á†ÅËæìÂá∫‰ªÄ‰πàÔºü</h4>
</blockquote>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230501224820368.png" alt="image-20230501224820368" style="zoom:40%;" />
<blockquote>
<h4 id="ÈóÆÁªÑÂêàÂºèÁªßÊâø‰∏≠ÁºñËØëÂô®ÁîüÊàêÂåÖË£ÖÊñπÊ≥ïÁöÑËßÑÂàô">ÈóÆÔºöÁªÑÂêàÂºèÁªßÊâø‰∏≠ÔºåÁºñËØëÂô®ÁîüÊàêÂåÖË£ÖÊñπÊ≥ïÁöÑËßÑÂàôÔºü</h4>
</blockquote>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230501225344225.png" alt="image-20230501225344225" style="zoom: 40%;" />
<h2 id="33-Èó≠ÂåÖ">3.3 Èó≠ÂåÖ</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nf">x</span><span class="p">()()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">x</span><span class="p">()</span> <span class="p">(</span><span class="nx">y</span> <span class="kd">func</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">y</span> <span class="p">=</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">println</span><span class="p">(</span><span class="s">&#34;y&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">println</span><span class="p">(</span><span class="s">&#34;z&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nf">y</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰ºöËæìÂá∫‰ªÄ‰πàÂë¢Ôºü</p>
<p>‰ºö‰∏çÊñ≠ÁöÑËæìÂá∫<code>z</code>„ÄÇ</p>
<p>ÂÖàÁúã<code>main</code>ÂáΩÊï∞ÁöÑÊ†àÂ∏ßÔºö</p>
<p><code>x</code>ÂáΩÊï∞Âè™ÊúâËøîÂõûÂÄºÊ≤°ÊúâÂèÇÊï∞ÔºåËÄå<code>x</code>ÁöÑËøîÂõûÂÄºÊòØ‰∏Ä‰∏™ÂáΩÊï∞„ÄÇ<strong>ÂáΩÊï∞‰Ωú‰∏∫ÂèÇÊï∞„ÄÅËøîÂõûÂÄºÊàñËÄÖË¢´ËµãÂÄºÁªôÂèòÈáèÊó∂ÔºåÂ∞±Ë¢´Áß∞‰∏∫<code>Function Value</code>„ÄÇ<strong>ÊâÄ‰ª•ËøôÈáåÁöÑ<code>y</code>ÊòØ‰∏Ä‰∏™<code>Function Value</code>„ÄÇ</strong><code>Function Value</code>Êú¨Ë¥®‰∏äÊòØ‰∏Ä‰∏™ÊåáÈíàÔºåÊåáÂêë‰∏Ä‰∏™<code>runtime.funcval</code>ÁªìÊûÑ‰ΩìÔºåËøô‰∏™ÁªìÊûÑ‰ΩìÂ≠òÂÇ®‰∫ÜÂØπÂ∫îÂáΩÊï∞ÁöÑÊåá‰ª§ÂÖ•Âè£Âú∞ÂùÄ„ÄÇ</strong><code>x</code>ËøîÂõû‰∏Ä‰∏™ÂåøÂêçÂáΩÊï∞ÔºåËÄåËøô‰∏™ÂáΩÊï∞‰∏≠ÊçïËé∑‰∫Ü<code>y</code>ÔºåÊâÄ‰ª•Ëøô‰∏™ËøîÂõûÂÄºÊòØ‰∏Ä‰∏™<strong>Èó≠ÂåÖÂØπË±°</strong>„ÄÇ<strong>Èó≠ÂåÖÂØπË±°Â∞±ÊòØ‰∏Ä‰∏™ÊúâÊçïËé∑ÂàóË°®ÁöÑ<code>Function Value</code>ËÄåÂ∑≤„ÄÇ</strong></p>
<p>‰πüÂ∞±ÊòØËØ¥Âú®Ëøô‰∏™ÂáΩÊï∞ÂÖ•Âè£Âú∞ÂùÄÂêéÈù¢Ôºå‰ºöÊúâËØ•Èó≠ÂåÖÂáΩÊï∞ÊçïËé∑ÁöÑÂèòÈáèÔºå**‰∏çËøáËøôÈáåÊçïËé∑ÁöÑÁ©∂Á´üÊòØÂèòÈáèÁöÑÂÄºËøòÊòØÂÆÉÁöÑÂú∞ÂùÄÔºü**ÂÖ∂ÂÆûÔºåÂ¶ÇÊûúË¢´ÊçïËé∑ÁöÑÂèòÈáèÂú®ÂÖ∂ËµãÂàùÂÄºÂêéÊ≤°ÊúâÂú®Ë¢´‰øÆÊîπËøáÔºåÂ∞±‰ºöÊçïËé∑ÂèòÈáèÁöÑÂÄºÔºõÂèç‰πãÔºåÂ∞±ÊçïËé∑ÂèòÈáèÁöÑÂú∞ÂùÄ„ÄÇ</p>
<p>Âú®ÂáΩÊï∞<code>x</code>‰∏≠ÔºåÂÖàÁªô<code>y</code>ËµãÂàùÂÄºÔºå<code>return</code>ÂèàÂ∞ÜÊñ∞ÁöÑËøîÂõûÂÄºÂÜôÂà∞‰∫Ü<code>y</code>ÔºåÊâÄ‰ª•Èó≠ÂåÖÂØπË±°ËøôÈáåÊçïËé∑ÁöÑÊòØÂèòÈáèÁöÑÂú∞ÂùÄ„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230131174816983.png" alt="image-20230131174816983" style="zoom:50%;" />
<p>‰ΩÜÊòØÂΩì<code>y</code>ÁöÑÂú∞ÂùÄË¢´ÊçïËé∑‰∫ÜÔºåÂΩì<code>x</code>ÊâßË°åÁªìÊùüÔºå<code>main</code>ÂáΩÊï∞Ë∞ÉÁî®ËøîÂõûÁöÑ<code>y</code>Êó∂ÔºåËøôÈáåÁöÑÊ†àÂ∏ßÂ∞±‰∏çÂÜç‰∏∫Ë∞ÉÁî®<code>x</code>ÊúçÂä°‰∫ÜÔºåÊâÄ‰ª•Ë¢´ÊçïËé∑ÁöÑÂèòÈáèÈúÄË¶ÅÈÄÉÈÄ∏Âà∞Â†Ü‰∏äÔºåËøîÂõûÂÄºËøôÈáåÂ∞±Ë¶ÅÂ≠òÂÇ®<code>y</code>Âú®Â†Ü‰∏äÁöÑÂú∞ÂùÄÔºå‰ΩÜÊòØÔºåËøôÊ†∑Â∞±ÊîπÂèò‰∫ÜËøîÂõûÂÄºÁöÑÁ±ªÂûãÔºåÊâÄ‰ª•ËÆ©<code>y</code>ÈÄÉÈÄ∏Âà∞Â†Ü‰∏äÊòØË°å‰∏çÈÄöÁöÑ„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230131175045496.png" alt="image-20230131175045496" style="zoom:50%;" />
<p>ÈÇ£‰πàÔºåÁºñËØëÂô®‰ºöÊÄéÊ†∑Â§ÑÁêÜ<strong>ËøîÂõûÂÄºÁöÑÂú∞ÂùÄË¢´ÊçïËé∑ÁöÑÊÉÖÂÜµ</strong>Âë¢Ôºü</p>
<p>ÂÆûÈôÖ‰∏äÔºåÁºñËØëÂô®‰ºöÂú®Â†Ü‰∏äÂàÜÈÖç‰∏Ä‰∏™<code>y</code>ÁöÑÂâØÊú¨ÔºåËÆ∞‰∏∫<code>y'</code>ÔºåÂêåÊó∂‰∏∫<code>x</code>ÁîüÊàê‰∏Ä‰∏™Â±ÄÈÉ®ÂèòÈáèÔºåÂ≠òÂÇ®<code>y'</code>Âú®Â†Ü‰∏äÁöÑÂú∞ÂùÄÔºåËÆ∞‰∏∫<code>py'</code>ÔºåÁÑ∂ÂêéÂú®ÂáΩÊï∞<code>x</code>ÂíåËøîÂõûÁöÑÈó≠ÂåÖÂØπË±°‰∏≠ÈÉΩ‰ΩøÁî®ÂâØÊú¨<code>y'</code>ÔºåËøôÈáåÊçïËé∑ÁöÑÊòØ<code>y'</code>ÁöÑÂú∞ÂùÄÔºåÂè™Âú®<code>x</code>ËøîÂõûÂâçÂ∞Ü<code>y'</code>ÁöÑÂÄºÊã∑Ë¥ùÂà∞ËøîÂõûÂÄºÁ©∫Èó¥ÔºåËøôÊ†∑<code>y</code>Âíå<code>y'</code>ÈÉΩÊåáÂêëÂ†Ü‰∏äÁöÑÂêå‰∏Ä‰∏™Èó≠ÂåÖÂØπË±°„ÄÇËÄåÂú®Ë∞ÉÁî®<code>x</code>ÁöÑÊ†àÂ∏ßÈîÄÊØÅÂêéÔºåËøô‰∏™Èó≠ÂåÖÂØπË±°‰æùÁÑ∂ÂèØ‰ª•Ê≠£Â∏∏‰ΩøÁî®ÂÖ∂ÊçïËé∑ÁöÑÂèòÈáè„ÄÇ</p>
<p>ÂΩìËøîÂõûÂÄº<code>y</code>Ë¢´Ë∞ÉÁî®ÔºåÊâæÂà∞ËøôÈáåÁöÑÈó≠ÂåÖÂáΩÊï∞ÔºåËæìÂá∫Á¨¨‰∏Ä‰∏™Â≠óÊØç<code>z</code>ÔºåÁÑ∂ÂêéÈÄöËøáÊçïËé∑ÂàóË°®ÊâæÂà∞<code>y'</code>ÔºåË∞ÉÁî®<code>y'</code>ÊåáÂêëÁöÑÂáΩÊï∞-ËøòÊòØËøô‰∏™ÂáΩÊï∞ÔºåÂõ†Ê≠§‰ºö‰∏çÂÅúËæìÂá∫<code>z</code>„ÄÇ</p>
<h2 id="34-gc">3.4 GC</h2>
<blockquote>
<h4 id="ÈóÆËá™Âä®ÂûÉÂúæÂõûÊî∂ÊÄé‰πàÂå∫ÂàÜÂì™‰∫õÊï∞ÊçÆÊòØÂûÉÂúæÂë¢"><strong>ÈóÆÔºöËá™Âä®ÂûÉÂúæÂõûÊî∂ÊÄé‰πàÂå∫ÂàÜÂì™‰∫õÊï∞ÊçÆÊòØÂûÉÂúæÂë¢Ôºü</strong></h4>
</blockquote>
<p>ÂèØ‰ª•Á°ÆÂÆöÔºåÁ®ãÂ∫è‰∏≠Áî®ÂæóÂà∞ÁöÑÊï∞ÊçÆÔºå‰∏ÄÂÆöÊòØ‰ªéÊ†à„ÄÅÊï∞ÊçÆÊÆµËøô‰∫õÊ†πËäÇÁÇπËøΩË∏™ÂæóÂà∞ÁöÑÊï∞ÊçÆ„ÄÇ‰πüÂ∞±ÊòØËØ¥Ôºå<strong>‰ªéËøô‰∫õÊ†πËäÇÁÇπËøΩË∏™‰∏çÂà∞ÁöÑÊï∞ÊçÆ</strong>‰∏ÄÂÆöÊòØÊ≤°Áî®ÁöÑÊï∞ÊçÆÔºå‰∏ÄÂÆöÊòØ<strong>ÂûÉÂúæ</strong>„ÄÇÂõ†Ê≠§ÔºåÁõÆÂâç‰∏ªÊµÅÁöÑËá™Âä®ÂûÉÂúæÂõûÊî∂ÁÆóÊ≥ïÈÉΩÊòØ‰ΩøÁî®**&ldquo;ÂèØËææÊÄß&rdquo;<strong>Ëøë‰ººÁ≠â‰ª∑</strong>&ldquo;Â≠òÊ¥ªÊÄß&rdquo;**ÁöÑ„ÄÇ</p>
<p><strong>==Ê†áËÆ∞-Ê∏ÖÊâ´ÁÆóÊ≥ï==</strong></p>
<p>Ê†áËÆ∞Ê∏ÖÈô§ÔºàMark-SweepÔºâÁÆóÊ≥ïÊòØÊúÄÂ∏∏ËßÅÁöÑÂûÉÂúæÊî∂ÈõÜÁÆóÊ≥ïÔºåÊ†áËÆ∞Ê∏ÖÈô§Êî∂ÈõÜÂô®ÊòØ<strong>Ë∑üË∏™ÂºèÂûÉÂúæÊî∂ÈõÜÂô®</strong>ÔºåÂÖ∂ÊâßË°åËøáÁ®ãÂèØ‰ª•ÂàÜÊàê**Ê†áËÆ∞ÔºàMarkÔºâ<strong>Âíå</strong>Ê∏ÖÈô§ÔºàSweepÔºâ**‰∏§‰∏™Èò∂ÊÆµÔºö</p>
<ol>
<li><strong>Ê†áËÆ∞Èò∂ÊÆµ</strong> ‚Äî ‰ªéÊ†πÂØπË±°Âá∫ÂèëÊü•ÊâæÂπ∂Ê†áËÆ∞Â†Ü‰∏≠ÊâÄÊúâÂ≠òÊ¥ªÁöÑÂØπË±°Ôºõ</li>
<li><strong>Ê∏ÖÈô§Èò∂ÊÆµ</strong> ‚Äî ÈÅçÂéÜÂ†Ü‰∏≠ÁöÑÂÖ®ÈÉ®ÂØπË±°ÔºåÂõûÊî∂Êú™Ë¢´Ê†áËÆ∞ÁöÑÂûÉÂúæÂØπË±°Âπ∂Â∞ÜÂõûÊî∂ÁöÑÂÜÖÂ≠òÂä†ÂÖ•Á©∫Èó≤ÈìæË°®„ÄÇ</li>
</ol>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20221222170145205.png" alt="image-20221222170145205" style="zoom:33%;" />
<p><strong>==‰∏âËâ≤ÊäΩË±°==</strong></p>
<p><strong>‰∏âËâ≤ÊäΩË±°</strong>ÂèØ‰ª•Ê∏ÖÊô∞ÁöÑÂ±ïÁé∞<strong>ËøΩË∏™ÂºèÂõûÊî∂</strong>‰∏≠<strong>ÂØπË±°Áä∂ÊÄÅ</strong>ÁöÑ<strong>ÂèòÂåñËøáÁ®ã</strong>„ÄÇ</p>
<ul>
<li>ÂûÉÂúæÂõûÊî∂<strong>ÂºÄÂßãÊó∂</strong>ÔºåÊâÄÊúâÊï∞ÊçÆÂùá‰∏∫<strong>ÁôΩËâ≤</strong>Ôºõ</li>
<li>ÁÑ∂ÂêéÊääÁõ¥Êé•ËøΩË∏™Âà∞ÁöÑrootËäÇÁÇπÈÉΩÊ†áËÆ∞‰∏∫<strong>ÁÅ∞Ëâ≤</strong>ÔºöÁÅ∞Ëâ≤‰ª£Ë°®Âü∫‰∫éÂΩìÂâçËäÇÁÇπÂ±ïÂºÄÁöÑËøΩË∏™ËøòÊú™ÂÆåÊàêÔºõ</li>
<li>ÂΩìÂü∫‰∫éÊüê‰∏™ËäÇÁÇπÁöÑËøΩË∏™‰ªªÂä°ÂÆåÊàêÂêéÔºå‰æø‰ºöÊääËØ•ËäÇÁÇπÊ†áËÆ∞‰∏∫<strong>ÈªëËâ≤</strong>ÔºöË°®Á§∫ÂÆÉÊòØÂ≠òÊ¥ªÊï∞ÊçÆÔºåËÄå‰∏îÊó†ÈúÄÂü∫‰∫éÂÆÉÂÜçÊ¨°ËøõË°åËøΩË∏™‰∫Ü„ÄÇ</li>
<li>Âü∫‰∫é<strong>ÈªëËâ≤</strong>ËäÇÁÇπÊâæÂà∞ÁöÑÊâÄÊúâËäÇÁÇπÈÉΩË¢´Ê†áËÆ∞‰∏∫<strong>ÁÅ∞Ëâ≤</strong>ÔºåË°®Á§∫ËøòË¶ÅÂü∫‰∫éÂÆÉ‰ª¨Ëøõ‰∏ÄÊ≠•ÂºÄÂßãËøΩË∏™„ÄÇ</li>
<li>ÂΩìÊ≤°Êúâ<strong>ÁÅ∞Ëâ≤</strong>ËäÇÁÇπÊó∂ÔºåÂ∞±ÊÑèÂë≥ÁùÄÊ†áËÆ∞Â∑•‰ΩúÂèØ‰ª•ÁªìÊùü‰∫Ü„ÄÇÊ≠§Êó∂ÔºåÊúâÁî®Êï∞ÊçÆÈÉΩ‰∏∫<strong>ÈªëËâ≤</strong>ÔºåÂûÉÂúæÈÉΩ‰∏∫<strong>ÁôΩËâ≤</strong>„ÄÇÊé•‰∏ãÊù•ÂõûÊî∂Ëøô‰∫õ<strong>ÁôΩËâ≤</strong>Êï∞ÊçÆÂç≥ÂèØ„ÄÇ</li>
</ul>
<h2 id="35-mutex">3.5 Mutex</h2>
<blockquote>
<h4 id="ÈóÆrwmutex-ÊòØËØª‰ºòÂÖàËøòÊòØÂÜô‰ºòÂÖàËØª‰ºòÂÖàÁöÑËØùÂ¶ÇÊûú‰∏ÄÁõ¥ÊúâËØªËØ∑Ê±ÇÈÇ£‰πàÂÜôËØ∑Ê±Ç‰ºöÈ••È•øÂêó">ÈóÆÔºöRWMutex ÊòØËØª‰ºòÂÖàËøòÊòØÂÜô‰ºòÂÖàÔºüËØª‰ºòÂÖàÁöÑËØùÔºåÂ¶ÇÊûú‰∏ÄÁõ¥ÊúâËØªËØ∑Ê±ÇÔºåÈÇ£‰πàÂÜôËØ∑Ê±Ç‰ºöÈ••È•øÂêóÔºü‚≠êüö©</h4>
</blockquote>
<p><code>RWMutex</code> ÊòØ‰∏Ä‰∏™<code>ËØª/ÂÜô‰∫íÊñ•ÈîÅ</code>ÔºåÂú®Êüê‰∏ÄÊó∂ÂàªÂè™ËÉΩÁî±<code>‰ªªÊÑèÊï∞Èáè</code>ÁöÑ <code>reader</code> ÊåÅÊúâ ÊàñËÄÖ <code>‰∏Ä‰∏™ writer</code> ÊåÅÊúâ„ÄÇ‰πüÂ∞±ÊòØËØ¥ÔºåË¶Å‰πàÊîæË°å‰ªªÊÑèÊï∞ÈáèÁöÑ readerÔºåÂ§ö‰∏™ reader ÂèØ‰ª•<code>Âπ∂Ë°åËØª</code>ÔºõË¶Å‰πàÊîæË°å‰∏Ä‰∏™ writerÔºåÂ§ö‰∏™ writer ÈúÄË¶Å<code>‰∏≤Ë°åÂÜô</code>„ÄÇ</p>
<p>‰∏ÄÊó¶Ê∂âÂèäÂà∞Â§ö‰∏™ reader Âíå writer ÔºåÂ∞±ÈúÄË¶ÅËÄÉËôë‰ºòÂÖàÁ∫ßÈóÆÈ¢òÔºåÊòØ reader ‰ºòÂÖàËøòÊòØ writer ‰ºòÂÖàÔºö</p>
<ul>
<li><strong>ËØªËÄÖ‰ºòÂÖàÔºàreaders-preferenceÔºâ</strong>ÔºöËØªËÄÖ‰ºòÂÖàÊòØËØªÊìç‰Ωú‰ºòÂÖà‰∫éÂÜôÊìç‰ΩúÔºåÂç≥‰ΩøÂÜôÊìç‰ΩúÊèêÂá∫Áî≥ËØ∑ËµÑÊ∫êÔºå‰ΩÜÂè™Ë¶ÅËøòÊúâËØªËÄÖÂú®ËØªÂèñÊìç‰ΩúÔºåÂ∞±ËøòÂÖÅËÆ∏ÂÖ∂‰ªñËØªËÄÖÁªßÁª≠ËØªÂèñÊìç‰ΩúÔºåÁõ¥Âà∞ÊâÄÊúâËØªËÄÖÁªìÊùüËØªÂèñÔºåÊâçÂºÄÂßãÂÜô„ÄÇËØª‰ºòÂÖàÂèØ‰ª•Êèê‰æõÂæàÈ´òÁöÑÂπ∂ÂèëÂ§ÑÁêÜÊÄßËÉΩÔºå‰ΩÜÊòØÂú®È¢ëÁπÅËØªÂèñÁöÑÁ≥ªÁªü‰∏≠Ôºå‰ºöÈïøÊó∂Èó¥ÂÜôÈòªÂ°ûÔºå<strong>ÂØºËá¥ÂÜôÈ••È•ø</strong>„ÄÇ</li>
<li><strong>ÂÜôËÄÖ‰ºòÂÖàÔºàwriters-preferenceÔºâ</strong>ÔºöÂÜôËÄÖ‰ºòÂÖàÊòØÂÜôÊìç‰Ωú‰ºòÂÖà‰∫éËØªÊìç‰ΩúÔºåÂ¶ÇÊûúÊúâÂÜôËÄÖÊèêÂá∫Áî≥ËØ∑ËµÑÊ∫êÔºåÂú®Áî≥ËØ∑‰πãÂâçÂ∑≤ÁªèÂºÄÂßãËØªÂèñÊìç‰ΩúÁöÑÂèØ‰ª•ÁªßÁª≠ÊâßË°åËØªÂèñÔºå‰ΩÜÊòØÂ¶ÇÊûúÂÜçÊúâËØªËÄÖÁî≥ËØ∑ËØªÂèñÊìç‰ΩúÔºåÂàô‰∏çËÉΩÂ§üËØªÂèñÔºåÂè™ÊúâÂú®ÊâÄÊúâÁöÑÂÜôËÄÖÂÜôÂÆå‰πãÂêéÊâçÂèØ‰ª•ËØªÂèñ„ÄÇÂÜôËÄÖ‰ºòÂÖàËß£ÂÜ≥‰∫ÜËØªËÄÖ‰ºòÂÖàÈÄ†ÊàêÂÜôÈ••È•øÁöÑÈóÆÈ¢ò„ÄÇ‰ΩÜÊòØËã•Âú®È¢ëÁπÅÂÜôÂÖ•ÁöÑÁ≥ªÁªü‰∏≠Ôºå‰ºöÈïøÊó∂Èó¥ËØªÈòªÂ°ûÔºå<strong>ÂØºËá¥ËØªÈ••È•ø</strong>„ÄÇ</li>
</ul>
<p><code>RWMutex</code> ÁöÑÊï∞ÊçÆÁªìÊûÑÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">RWMutex</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">w</span>           <span class="nx">Mutex</span>  <span class="c1">// Áî®‰∫éÊéßÂà∂Â§ö‰∏™ÂÜôÈîÅÔºåËé∑ÂæóÂÜôÈîÅÈ¶ñÂÖàË¶ÅËé∑ÂèñËØ•ÈîÅÔºåÂ¶ÇÊûúÊúâ‰∏Ä‰∏™ÂÜôÈîÅÂú®ËøõË°åÔºåÈÇ£‰πàÂÜçÂà∞Êù•ÁöÑÂÜôÈîÅÂ∞Ü‰ºöÈòªÂ°û‰∫éÊ≠§
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">writerSem</span>   <span class="kt">uint32</span> <span class="c1">// ÂÜôÈòªÂ°ûÁ≠âÂæÖÁöÑ‰ø°Âè∑ÈáèÔºåÊúÄÂêé‰∏Ä‰∏™ËØªËÄÖÈáäÊîæÈîÅÊó∂‰ºöÈáäÊîæ‰ø°Âè∑Èáè
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">readerSem</span>   <span class="kt">uint32</span> <span class="c1">// ËØªÈòªÂ°ûÁöÑÂçèÁ®ãÁ≠âÂæÖÁöÑ‰ø°Âè∑ÈáèÔºåÊåÅÊúâÂÜôÈîÅÁöÑÂçèÁ®ãÈáäÊîæÈîÅÂêé‰ºöÈáäÊîæ‰ø°Âè∑Èáè
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">readerCount</span> <span class="kt">int32</span>  <span class="c1">// ËÆ∞ÂΩïËØªËÄÖ‰∏™Êï∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">readerWait</span>  <span class="kt">int32</span>  <span class="c1">// ËÆ∞ÂΩïÂÜôÈòªÂ°ûÊó∂ËØªËÄÖ‰∏™Êï∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>RWMutex</code> ËÆæËÆ°ÈááÁî®<strong>ÂÜô‰ºòÂÖàÊñπÊ≥ï</strong>„ÄÇ</p>
<p>ÈóÆÈ¢òË¶ÅÁÇπÔºö</p>
<ol>
<li><strong>ÂÜôÊìç‰ΩúÊòØÂ¶Ç‰ΩïÈòªÊ≠¢ÂÜôÊìç‰ΩúÁöÑÔºü</strong></li>
</ol>
<p><code>RWMutex</code>ÂåÖÂê´‰∏Ä‰∏™‰∫íÊñ•ÈîÅ(Mutex)Ôºå<strong>ÂÜôÈîÅÂÆöÂøÖÈ°ªË¶ÅÂÖàËé∑ÂèñËØ•‰∫íÊñ•ÈîÅ</strong>„ÄÇ</p>
<ol start="2">
<li><strong>ÂÜôÊìç‰ΩúÊòØÂ¶Ç‰ΩïÈòªÊ≠¢ËØªÊìç‰ΩúÁöÑÔºü</strong></li>
</ol>
<p><code>RWMutex.readerCount</code>ÊòØ‰∏™Êï¥ÂûãÂÄºÔºåÁî®‰∫éË°®Á§∫ËØªËÄÖÊï∞ÈáèÔºå‰∏çËÄÉËôëÂÜôÊìç‰ΩúÁöÑÊÉÖÂÜµ‰∏ãÔºåÊØèÊ¨°ËØªÈîÅÂÆöÂ∞ÜËØ•ÂÄº+1ÔºåÊØèÊ¨°Ëß£Èô§ËØªÈîÅÂÆöÂ∞ÜËØ•ÂÄº-1ÔºåÊâÄ‰ª•readerCountÂèñÂÄº‰∏∫[0, N]ÔºåN‰∏∫ËØªËÄÖ‰∏™Êï∞ÔºåÂÆûÈôÖ‰∏äÊúÄÂ§ßÂèØÊîØÊåÅ2^30^‰∏™Âπ∂ÂèëËØªËÄÖ„ÄÇ</p>
<p>ÂΩìÂÜôÈîÅÂÆöËøõË°åÊó∂Ôºå‰ºöÂÖàÂ∞ÜreaderCountÂáèÂéª2^30^Ôºå‰ªéËÄåreaderCountÂèòÊàê‰∫ÜË¥üÂÄºÔºåÊ≠§Êó∂ÂÜçÊúâËØªÈîÅÂÆöÂà∞Êù•Êó∂Ê£ÄÊµãÂà∞readerCount‰∏∫Ë¥üÂÄºÔºå‰æøÁü•ÈÅìÊúâÂÜôÊìç‰ΩúÂú®ËøõË°åÔºåÂè™Â•ΩÈòªÂ°ûÁ≠âÂæÖÔºåÂêåÊó∂Ëøò‰ºöÂØπreaderCount+1ÔºåËøôÊ†∑Á≠âÂæÖÁöÑËØªÊìç‰Ωú‰∏™Êï∞Âπ∂‰∏ç‰ºö‰∏¢Â§±ÔºåÂè™ÈúÄË¶ÅÂ∞ÜreaderCountÂä†‰∏ä2^30^Âç≥ÂèØËé∑Âæó„ÄÇ</p>
<p>ÊâÄ‰ª•Ôºå<strong>ÂÜôÊìç‰ΩúÂ∞ÜreaderCountÂèòÊàêË¥üÂÄºÊù•ÈòªÊ≠¢ËØªÊìç‰Ωú</strong>„ÄÇ</p>
<ol start="3">
<li><strong>ËØªÊìç‰ΩúÊòØÂ¶Ç‰ΩïÈòªÊ≠¢ÂÜôÊìç‰ΩúÁöÑÔºü</strong></li>
</ol>
<p>ÂÜôÊìç‰ΩúÂà∞Êù•Êó∂Ôºå‰ºöÊää<code>RWMutex.readerCount</code>ÂÄºÊã∑Ë¥ùÂà∞<code>RWMutex.readerWait</code>‰∏≠ÔºåÁî®‰∫éÊ†áËÆ∞ÊéíÂú®ÂÜôÊìç‰ΩúÂâçÈù¢ÁöÑËØªËÄÖ‰∏™Êï∞„ÄÇÂâçÈù¢ÁöÑËØªÊìç‰ΩúÁªìÊùüÂêéÔºåÈô§‰∫Ü‰ºöÈÄíÂáè<code>RWMutex.readerCount</code>ÔºåËøò‰ºöÈÄíÂáè<code>RWMutex.readerWait</code>ÂÄºÔºåÂΩì<code>RWMutex.readerWait</code>ÂÄºÂèò‰∏∫0Êó∂Âî§ÈÜíÂÜôÊìç‰Ωú„ÄÇ</p>
<ol start="4">
<li><strong>‰∏∫‰ªÄ‰πàÂÜôÈîÅÂÆö‰∏ç‰ºöË¢´È•øÊ≠ªÔºü</strong></li>
</ol>
<p>ÂÜôÊìç‰ΩúË¶ÅÁ≠âÂæÖËØªÊìç‰ΩúÁªìÊùüÂêéÊâçÂèØ‰ª•Ëé∑ÂæóÈîÅÔºåÂÜôÊìç‰ΩúÁ≠âÂæÖÊúüÈó¥ÂèØËÉΩËøòÊúâÊñ∞ÁöÑËØªÊìç‰ΩúÊåÅÁª≠Âà∞Êù•ÔºåÂ¶ÇÊûúÂÜôÊìç‰ΩúÁ≠âÂæÖÊâÄÊúâËØªÊìç‰ΩúÁªìÊùüÔºåÂæàÂèØËÉΩË¢´È•øÊ≠ª„ÄÇÁÑ∂ËÄåÔºåÈÄöËøá<code>RWMutex.readerWait</code>ÂèØÂÆåÁæéËß£ÂÜ≥Ëøô‰∏™ÈóÆÈ¢ò„ÄÇ</p>
<p>ÂÜôÊìç‰ΩúÂà∞Êù•Êó∂Ôºå‰ºöÊää<code>RWMutex.readerCount</code>ÂÄºÊã∑Ë¥ùÂà∞<code>RWMutex.readerWait</code>‰∏≠ÔºåÁî®‰∫éÊ†áËÆ∞ÊéíÂú®ÂÜôÊìç‰ΩúÂâçÈù¢ÁöÑËØªËÄÖ‰∏™Êï∞„ÄÇ</p>
<p>ÂâçÈù¢ÁöÑËØªÊìç‰ΩúÁªìÊùüÂêéÔºåÈô§‰∫Ü‰ºöÈÄíÂáè<code>RWMutex.readerCount</code>ÔºåËøò‰ºöÈÄíÂáè<code>RWMutex.readerWait</code>ÂÄºÔºåÂΩì<code>RWMutex.readerWait</code>ÂÄºÂèò‰∏∫0Êó∂<strong>Âî§ÈÜíÂÜôÊìç‰Ωú</strong>„ÄÇ</p>
<blockquote>
<h4 id="ÈóÆmutexÁöÑÂ∑•‰ΩúÊ®°ÂºèÊ≠£Â∏∏Ê®°ÂºèÂíåÈ••È•øÊ®°Âºè">ÈóÆÔºöMutexÁöÑÂ∑•‰ΩúÊ®°ÂºèÔºüÊ≠£Â∏∏Ê®°ÂºèÂíåÈ••È•øÊ®°ÂºèÔºü</h4>
</blockquote>
<p><code>Mutex </code>ÂÖ±Êúâ‰∏§ÁßçÂ∑•‰ΩúÊ®°ÂºèÔºöÊ≠£Â∏∏Ê®°ÂºèÂíåÈ••È•øÊ®°Âºè„ÄÇ</p>
<p><strong>Ê≠£Â∏∏Ê®°Âºè</strong>‰∏ãÔºå‰∏Ä‰∏™Â∞ùËØïÂä†ÈîÅÁöÑ<code>goroutine</code>‰ºöÂÖàËá™ÊóãÂá†Ê¨°ÔºåÂ∞ùËØïÈÄöËøáÂéüÂ≠êÊìç‰ΩúËé∑ÂæóÈîÅ„ÄÇËã•Âá†Ê¨°Ëá™Êóã‰πãÂêé‰∏çËÉΩËé∑ÂæóÈîÅÔºåÂ∞±‰ºöÈÄöËøá‰ø°Âè∑ÈáèËøõË°åÊéíÈòüÁ≠âÂæÖ„ÄÇÊâÄÊúâÁöÑÁ≠âÂæÖËÄÖ‰ºöÊåâÁÖßÂÖàÂÖ•ÂÖàÂá∫ÁöÑÈ°∫Â∫èÊéíÈòüÔºå‰ΩÜÊòØÂΩìÈîÅË¢´ÈáäÊîæÔºåË¢´Âî§ÈÜíÁöÑÁ≠âÂæÖËÄÖÂπ∂‰∏ç‰ºöÁõ¥Êé•Ëé∑ÂæóÈîÅÔºåÂÆÉÈúÄË¶ÅÂíåÂ§Ñ‰∫éËá™ÊóãÈò∂ÊÆµÂ∞öÊú™ÊéíÈòüÁöÑ<code>goroutine</code>ËøõË°åÁ´û‰∫â„ÄÇ</p>
<p>ËøôÁßçÊÉÖÂÜµÂêéÊù•ËÄÖÊõ¥Êúâ‰ºòÂäøÔºåÈ¶ñÂÖàÊòØÂõ†‰∏∫Â§Ñ‰∫éËá™ÊóãÁä∂ÊÄÅÁöÑ<code>goroutine</code>ÂèØËÉΩÊúâÂ§ö‰∏™Ôºå‰∏îÂêéÊù•ËÄÖÊ≠£Âú®CPU‰∏äËøêË°åÔºåÊòæÁÑ∂ÊØîÂàöË¢´Âî§ÈÜíÁöÑ<code>goroutine</code>Êúâ‰ºòÂäø„ÄÇÂ¶ÇÊûúË¢´Âî§ÈÜíÁöÑ<code>goroutine</code>Ê≤°ÊúâËé∑ÂæóÈîÅÔºåÂÆÉÂ∞ÜÂÜçÊ¨°ËøõÂÖ•ÊéíÈòüÈòüÂàóÔºå‰ΩÜÊòØÊòØÁõ¥Êé•Âú®ÈòüÂ§¥„ÄÇ</p>
<p>ÂΩì‰∏Ä‰∏™<code>goroutine</code>Êú¨Ê¨°Á≠âÂæÖÂä†ÈîÅÁöÑÊó∂Èó¥Ë∂ÖËøá<code>1ms</code>ÔºåÂÆÉ‰ºöÊääÂΩìÂâç<code>Mutex</code>ÂàáÊç¢Âà∞<strong>È••È•øÊ®°Âºè</strong>Ôºå<code>Mutex</code>ÁöÑÊâÄÊúâÊùÉÁõ¥Êé•ËΩ¨ËÆ©ÁªôÈòüÈ¶ñ<code>goroutine</code>ÔºåÊ≠§Êó∂ÂêéÊù•ËÄÖ‰πü‰∏çÂÜçËá™ÊóãÔºåËÄåÊòØÁõ¥Êé•ËøõÂÖ•ÈòüÂàóÂ∞æÈÉ®ÂºÄÂßãÊéíÈòü„ÄÇ</p>
<p>ÂΩìËé∑Âæó<code>Mutex</code>ÁöÑ<code>goroutine</code>ÊòØÈòüÂàó‰∏≠ÊúÄÂêé‰∏Ä‰∏™Êó∂ÔºåÊàñËÄÖÂÆÉÁöÑÁ≠âÂæÖÊó∂Èó¥Â∞è‰∫é<code>1ms</code>ÔºåÂÆÉ‰ºöÊää<code>Mutex</code>ÁöÑÁä∂ÊÄÅÊîπÂõû<strong>Ê≠£Â∏∏Ê®°Âºè</strong>„ÄÇ</p>
<p>Ê≠£Â∏∏Ê®°ÂºèÈúÄË¶ÅÂ§ßÂÆ∂‰∫âÊä¢ÈîÅÔºå‰ªéËÄåËé∑ÂæóÊõ¥È´òÁöÑÂêûÂêêÈáèÔºõËÄåÈ••È•øÊ®°ÂºèÂØπÈò≤Ê≠¢Âá∫Áé∞Â∞æÁ´ØÂª∂ËøüÁâπÂà´ÈáçË¶Å„ÄÇ</p>
<blockquote>
<h4 id="ÈóÆ‰ªÄ‰πàÊó∂ÂÄô‰ºöÂèëÁîüËá™Êóã">ÈóÆÔºö‰ªÄ‰πàÊó∂ÂÄô‰ºöÂèëÁîüËá™ÊóãÔºü</h4>
</blockquote>
<p>Âä†ÈîÅÊó∂ÔºåÂ¶ÇÊûúÂΩìÂâç <code>Locked</code> ‰Ωç‰∏∫1ÔºåÂàôËØ¥ÊòéÂΩìÂâçËØ•ÈîÅÁî±ÂÖ∂‰ªñÂçèÁ®ãÊåÅÊúâÔºåÂ∞ùËØïÂä†ÈîÅÁöÑÂçèÁ®ãÂπ∂‰∏çÊòØÈ©¨‰∏äËΩ¨ÂÖ•ÈòªÂ°ûÔºåËÄåÊòØ‰ºöÊåÅÁª≠Êé¢Êµã <code>Locked</code> ‰ΩçÊòØÂê¶Âèò‰∏∫0ÔºåËøô‰∏™ËøáÁ®ãÂ∞±ÊòØ„Äå<strong>Ëá™Êóã</strong>„Äç„ÄÇÂÆûÈôÖ‰∏äÂ∞±ÊòØÊâßË°å‰∫Ü30Ê¨°<code>PAUSE</code>„ÄÇ</p>
<ul>
<li>Â§öÊ†∏Âú∫ÊôØ„ÄÇÂõ†‰∏∫ÂçïÊ†∏Âú∫ÊôØÊòØÊ≤°ÊúâÊÑè‰πâÁöÑÔºå‰∏Ä‰∏™Âç†ÁùÄCPUËøõË°åËá™ÊóãÁ≠âÂæÖÈîÅÔºå‰∏Ä‰∏™Âç†ÁùÄÈîÅ„ÄÇËøôÊó†ÊÑè‰πâ„ÄÇ</li>
<li><code>gomaxprocs&gt;1</code>„ÄÇÂêå‰∏ä„ÄÇ</li>
<li>Ëá≥Â∞ëÊúâ‰∏Ä‰∏™ÂÖ∂‰ªñÁöÑ<code>p</code>Ê≠£Âú®<code>running</code> &amp;&amp; ÂΩìÂâç<code>p</code>ÁöÑÊú¨Âú∞<code>runq</code>ÈòüÂàó‰∏∫Á©∫„ÄÇÊØîËµ∑Ë∞ÉÂ∫¶Ëøô‰∏™<code>goroutine</code>ËøõË°åËá™ÊóãÔºå‰∏çÂ¶ÇË∞ÉÂ∫¶Âà´ÁöÑ<code>goroutine</code>„ÄÇ</li>
</ul>
<p>Ëá™Êóã‰∏äÈôê‰∏∫4ÔºåÊØèÊâßË°å‰∏ÄÊ¨°Ëá™ÊóãÈÉΩ‰ºöÈáçÊñ∞Âà§Êñ≠ÊòØÂê¶ÂèØ‰ª•ÁªßÁª≠Ëá™Êóã„ÄÇÂ¶ÇÊûúÈîÅË¢´ÈáäÊîæ‰∫ÜÔºåÊàñËÄÖÈîÅËøõÂÖ•‰∫ÜÈ••È•øÊ®°ÂºèÔºåÊàñËÄÖÂ∑≤ÁªèËá™Êóã‰∫Ü4Ê¨°ÔºåÈÉΩ‰ºöÁªìÊùüËá™Êóã„ÄÇ</p>
<blockquote>
<h4 id="ÈóÆ‰∏∫‰ªÄ‰πàËá™ÊóãÊ¨°Êï∞Êúâ‰∏äÈôê">ÈóÆÔºö‰∏∫‰ªÄ‰πàËá™ÊóãÊ¨°Êï∞Êúâ‰∏äÈôêÔºü</h4>
</blockquote>
<p>Ëá™ÊóãÊòØ‰∏∫‰∫ÜÈÅøÂÖçÈ¢ëÁπÅËé∑ÂæóÈîÅÂ§±Ë¥•ÂØºËá¥ÁöÑÂçèÁ®ãÂàáÊç¢ÔºåËøôÊ†∑ÂºÄÈîÄÂæàÂ§ß„ÄÇËã•ÈîÅÁöÑÊåÅÊúâÊó∂Èó¥ÂæàÁü≠ÔºåËá™ÊóãÂá†Ê¨°Â∞±ËÉΩËé∑ÂæóÔºåËøôÊ†∑Â∞±ËÉΩÂáèÂ∞ëÂàáÊç¢Ôºå‰ΩÜÂ¶ÇÊûúÈîÅÁöÑÊåÅÊúâÊó∂Èó¥ÂæàÈïøÔºåÈÇ£Â∞±‰ºöÊó†ÊÑè‰πâÁöÑËá™ÊóãÔºåÂèçÂÄíÊµ™Ë¥π‰∫ÜCPUËµÑÊ∫êÔºåÊâÄ‰ª•ÈÄöÂ∏∏ÈôêÂà∂Ëá™ÊóãÊ¨°Êï∞ÔºåËá™ÊóãÊ¨°Êï∞ÂÜÖÊó†Ê≥ïËé∑ÂæóÈîÅÂ∞±ËÆ©Âá∫CPUÔºå‰ª•ÂÖçÈïøÊó∂Èó¥Êó†ÊÑè‰πâÁöÑÁ≠âÂæÖ„ÄÇ</p>
<blockquote>
<h4 id="ÈóÆÂçèÁ®ãÊòØÂ¶Ç‰ΩïËøõË°åÊéíÈòüÁöÑÂë¢">ÈóÆÔºöÂçèÁ®ãÊòØÂ¶Ç‰ΩïËøõË°åÊéíÈòüÁöÑÂë¢Ôºü</h4>
</blockquote>
<p>ÈÄöËøá<code>sema</code>Â≠óÊÆµ„ÄÇ<code>runtime</code>ÂÜÖÈÉ®‰ºöÈÄöËøá‰∏Ä‰∏™Â§ßÂ∞è‰∏∫<code>251</code>ÁöÑ<code>sematable</code>Êù•ÁÆ°ÁêÜÊâÄÊúâ<code>semaphore</code>ÔºåËøô‰∏™<code>sematable</code>Â≠òÂÇ®ÁöÑÊòØ<code>251</code>ËØæÂπ≥Ë°°Ê†ëÁöÑÊ†πÔºåÂπ≥Ë°°Ê†ë‰∏≠ÊØè‰∏™ËäÇÁÇπÈÉΩÊòØ‰∏Ä‰∏™<code>sudog</code>Á±ªÂûãÁöÑÂØπË±°ÔºåË¶Å‰ΩøÁî®‰∏Ä‰∏™‰ø°Âè∑ÈáèÊó∂ÔºåÈúÄË¶ÅÊèê‰æõ‰∏Ä‰∏™ËÆ∞ÂΩï‰ø°Âè∑ÈáèÊï∞ÂÄºÁöÑÂèòÈáèÔºåÊ†πÊçÆÂÆÉÁöÑÂú∞ÂùÄËøõË°åËÆ°ÁÆóÔºåÊò†Â∞ÑÂà∞<code>sematable</code>‰∏≠ÁöÑ‰∏ÄÈ¢óÂπ≥Ë°°Ê†ë‰∏äÔºåÊâæÂà∞ÂØπÂ∫îÁöÑËäÇÁÇπÂ∞±ÊâæÂà∞‰∫Ü<strong>ËØ•‰ø°Âè∑ÈáèÁöÑÁ≠âÂæÖÈòüÂàó</strong>ÔºåËØ•‰ø°Âè∑ÈáèÁöÑÂçèÁ®ãÂ∞±Âú®Ëøô‰∏™ÈòüÂàó‰∏≠ËøõË°åÁ≠âÂæÖÂî§ÈÜí„ÄÇ</p>
<h2 id="36-ÊñπÊ≥ïÈõÜ">3.6 ÊñπÊ≥ïÈõÜ</h2>
<blockquote>
<h4 id="ÈóÆ‰∏∫‰ªÄ‰πàË¶ÅÈôêÂà∂-t-Âíå-t-‰∏çËÉΩÂ£∞ÊòéÂêåÂêçÊñπÊ≥ï">ÈóÆÔºö‰∏∫‰ªÄ‰πàË¶ÅÈôêÂà∂ <code>T</code> Âíå <code>*T</code> ‰∏çËÉΩÂ£∞ÊòéÂêåÂêçÊñπÊ≥ïÔºü</h4>
</blockquote>
<p>È¶ñÂÖàÔºå<code>T</code>Âíå<code>*T</code>ÊòØ‰∏§ÁßçÁ±ªÂûãÔºåÂàÜÂà´ÊúâÁùÄËá™Â∑±ÁöÑÁ±ªÂûãÂÖÉÊï∞ÊçÆÔºåËÄåÊ†πÊçÆËá™ÂÆö‰πâÁ±ªÂûãÁöÑÁ±ªÂûãÂÖÉÊï∞ÊçÆÔºåÂèØ‰ª•ÊâæÂà∞ËØ•Á±ªÂûãÂÖ≥ËÅîÁöÑÊñπÊ≥ïÂàóË°®„ÄÇ</p>
<p>ÂèØ‰ª•Á°ÆÂÆöÁöÑÊòØÔºå<code>T</code>ÁöÑÊñπÊ≥ïÈõÜÈáåÔºåÂÖ®ÈÉ®ÈÉΩÊòØÊúâÊòéÁ°ÆÂÆö‰πâÁöÑÊé•Êî∂ËÄÖ‰∏∫<code>T</code>Á±ªÂûãÁöÑÊñπÊ≥ïÔºõËÄå<code>*T</code>ÁöÑÊñπÊ≥ïÈõÜÈáåÔºåÈô§‰∫ÜÊúâÊòéÁ°ÆÂÆö‰πâÁöÑÊé•Êî∂ËÄÖ‰∏∫<code>*T</code>ÁöÑÊñπÊ≥ï‰ª•Â§ñÔºå**Ëøò‰ºöÊúâÁºñËØëÂô®ÁîüÊàêÁöÑ‰∏Ä‰∫õ&quot;ÂåÖË£ÖÊñπÊ≥ï&rdquo;Ôºö**Ëøô‰∫õÂåÖË£ÖÊñπÊ≥ïÊòØÂØπÊé•Êî∂ËÄÖ‰∏∫<code>T</code>Á±ªÂûãÁöÑÂêåÂêçÊñπÊ≥ïÁöÑ&quot;ÂåÖË£Ö&rdquo;„ÄÇ</p>
<p>Â¶ÇÊûúÁªô<code>T</code>Âíå<code>*T</code>ÂÆö‰πâ‰∫ÜÂêåÂêçÊñπÊ≥ïÔºåÂ∞±ÊúâÂèØËÉΩÂíåÁºñËØëÂô®ÁîüÊàêÁöÑÂåÖË£ÖÊñπÊ≥ï<strong>ÂèëÁîüÂÜ≤Á™Å</strong>ÔºåÊâÄ‰ª• Go Âπ≤ËÑÜ‰∏çÂÖÅËÆ∏‰∏∫<code>T</code>Âíå<code>*T</code>ÂÆö‰πâÂêåÂêçÊñπÊ≥ï„ÄÇ</p>
<blockquote>
<h4 id="ÈóÆ‰∏∫‰ªÄ‰πàÁºñËØëÂô®Ë¶Å‰∏∫-t-ÁîüÊàê-t-ÁöÑÂêåÂêçÊñπÊ≥ï">ÈóÆÔºö‰∏∫‰ªÄ‰πàÁºñËØëÂô®Ë¶Å‰∏∫ <code>*T</code> ÁîüÊàê <code>T</code> ÁöÑÂêåÂêçÊñπÊ≥ïÔºü</h4>
</blockquote>
<p><strong>ËøôÈáåÈ¶ñÂÖàË¶ÅÊòéÁ°Æ‰∏ÄÁÇπÔºö<strong>ÈÄöËøá<code>*T</code>Á±ªÂûãÁöÑÂèòÈáèÁõ¥Êé•Ë∞ÉÁî®<code>T</code>Á±ªÂûãÊé•Êî∂ËÄÖÁöÑÊñπÊ≥ïÂè™ÊòØ‰∏ÄÁßç</strong>ËØ≠Ê≥ïÁ≥ñ</strong>„ÄÇÁªèÈ™åËØÅÔºåËøôÁßçË∞ÉÁî®ÊñπÂºèÔºåÁºñËØëÂô®‰ºöÂú®Ë∞ÉÁî®Á´ØËøõË°å<strong>ÊåáÈíàËß£ÂºïÁî®</strong>ÔºåÂπ∂<strong>‰∏ç‰ºöÁî®Âà∞ËøôÈáåÁöÑÂåÖË£ÖÊñπÊ≥ï</strong>„ÄÇ</p>
<p>==<strong>ÂÆûÈôÖ‰∏äÔºå<strong>ÁºñËØëÂô®ÁîüÊàêÂåÖË£ÖÊñπÊ≥ï‰∏ªË¶ÅÊòØ</strong>‰∏∫‰∫ÜÊîØÊåÅÊé•Âè£</strong>„ÄÇ==</p>
<blockquote>
<h4 id="ÈóÆ‰∏∫‰ªÄ‰πàÊòØ‰∏∫‰∫ÜÊîØÊåÅÊé•Âè£">ÈóÆÔºö‰∏∫‰ªÄ‰πàÊòØ‰∏∫‰∫ÜÊîØÊåÅÊé•Âè£Ôºü</h4>
</blockquote>
<p>ÈùûÁ©∫Êé•Âè£ÂåÖÂê´‰∏§‰∏™ÊåáÈíàÔºö‰∏Ä‰∏™ÂíåÁ±ªÂûãÂÖÉÊï∞ÊçÆÁõ∏ÂÖ≥Ôºå‰∏Ä‰∏™ÂíåÊé•Âè£Ë£ÖËΩΩÁöÑÊï∞ÊçÆÁõ∏ÂÖ≥„ÄÇËôΩÁÑ∂ÊúâÊï∞ÊçÆÊåáÈíàÔºå‰ΩÜÊòØÂπ∂‰∏çËÉΩÂÉèËØ≠Ê≥ïÁ≥ñÈÇ£Ê†∑Ôºå<strong>ÂØπÊåáÈíàËøõË°åËß£ÂºïÁî®Êù•Ë∞ÉÁî®ÂÄºÊé•Êî∂ËÄÖÁöÑÊñπÊ≥ï</strong>„ÄÇËøôÊòØ‰∏∫Âï•Âë¢Ôºü</p>
<p><strong>ÂéüÂõ†Ôºö<strong>ÊñπÊ≥ïÁöÑÊé•Êî∂ËÄÖÊòØÊñπÊ≥ïË∞ÉÁî®Êó∂ÈöêÂê´ÁöÑÁ¨¨‰∏Ä‰∏™ÂèÇÊï∞ÔºåGo ‰∏≠ÁöÑÂáΩÊï∞ÂèÇÊï∞ÈÄöËøáÊ†àËøõË°å‰º†ÈÄíÔºåÂ¶ÇÊûúÂèÇÊï∞ÊòØÊåáÈíàÁ±ªÂûãÔºåÂπ≥Âè∞Á°ÆÂÆö‰∫ÜÔºåÊåáÈíàÂ§ßÂ∞è‰πüÂ∞±Á°ÆÂÆö‰∫Ü„ÄÇ‰ΩÜ</strong>Â¶ÇÊûúË¶ÅËß£ÂºïÁî®‰∏∫ÂÄºÁ±ªÂûãÔºåÂ∞±ÂøÖÈ°ªÊúâÊòéÁ°ÆÁöÑÁ±ªÂûã‰ø°ÊÅØ</strong>ÔºåÁºñËØëÂô®ÊâçËÉΩÁü•ÈÅìËøô‰∏™ÂèÇÊï∞<strong>ËØ•Âú®Ê†à‰∏äÂàÜÈÖçÂ§öÂ§ßÁöÑÂÜÖÂ≠òÁ©∫Èó¥</strong>„ÄÇ<strong>ÂØπ‰∫éÊé•Âè£Êù•ËØ¥</strong>Ôºå<strong>ÁºñËØëÈò∂ÊÆµÂπ∂‰∏çËÉΩÁ°ÆÂÆöËØ•Êé•Âè£‰ºöË£ÖËΩΩÁöÑÊï∞ÊçÆÁ±ªÂûã</strong>Ôºå‰πüÂ∞±‰∏çËÉΩËøõË°åÊåáÈíàËß£ÂºïÁî®„ÄÇÊâÄ‰ª•ÈÄâÊã©‰∏∫<code>*T</code>ÁîüÊàê‰∏ÄÂ•ó<code>T</code>ÁöÑÂåÖË£ÖÊñπÊ≥ï„ÄÇ</p>
<p>Âú®ÈìæÊé•Èò∂ÊÆµÔºå‰∏ç‰ºöÁî®Âà∞ÁöÑÊñπÊ≥ï‰ºöË¢´ÂøΩÁï•„ÄÇ</p>
<h2 id="37-Êä¢Âç†ÂºèË∞ÉÂ∫¶">3.7 Êä¢Âç†ÂºèË∞ÉÂ∫¶</h2>
<blockquote>
<h4 id="ÈóÆÂ¶Ç‰ΩïËøõË°åÊä¢Âç†ÂºèË∞ÉÂ∫¶">ÈóÆÔºöÂ¶Ç‰ΩïËøõË°åÊä¢Âç†ÂºèË∞ÉÂ∫¶Ôºü</h4>
</blockquote>
<p><strong>Go 1.14 ‰πãÂâç</strong>ÔºåÊòØÂÄüÂä©‰∫é<strong>Ê†àÂ¢ûÈïøÊ£ÄÊµã</strong>Êù•ÂÆûÁé∞Êä¢Âç†ÂºèË∞ÉÂ∫¶ÁöÑÔºåËã•<code>goroutine</code>‰∏≠Ê≤°ÊúâÂØºËá¥Ê†àÂ¢ûÈïøÁöÑ‰ª£Á†ÅÔºåÂ∞±‰∏ç‰ºöË¢´Êä¢Âç†ÔºåÊâÄ‰ª•Ëøô‰∏çÁÆóÁúüÊ≠£ÁöÑÊä¢Âç†ÂºèË∞ÉÂ∫¶„ÄÇ</p>
<p>‰ª•<code>GC</code>‰∏æ‰æãÔºå<code>STW</code>Èò∂ÊÆµÈúÄË¶ÅÊä¢Âç†ÊâÄÊúâÁöÑ<code>P</code>Ôºå‰ΩÜ‰∏çÊòØËØ¥Êä¢Âç†Â∞±ËÉΩÊä¢Âç†ÁöÑÔºå‰ºöÂÖàËÆ∞ÂΩïË¶ÅÁ≠âÂæÖÂ§öÂ∞ë‰∏™<code>P</code>ÔºåÂΩìËøô‰∏™ÂÄºÂáè‰∏∫<code>0</code>ÔºåÁõÆÁöÑÂ∞±ËææÂà∞‰∫Ü„ÄÇ</p>
<ul>
<li>ÂØπ‰∫éÂΩìÂâç<code>P</code>„ÄÅ‰ª•ÂèäÈô∑ÂÖ•Á≥ªÁªüË∞ÉÁî®ÁöÑ<code>P</code>(<code>_Psyscall</code>)„ÄÅËøòÊúâÁ©∫Èó≤Áä∂ÊÄÅÁöÑ<code>P</code>Ôºå<strong>Áõ¥Êé•Â∞ÜÂÖ∂ËÆæÁΩÆ‰∏∫<code>_Pgcstop</code>Âç≥ÂèØ</strong>Ôºõ</li>
<li>ÂØπ‰∫éËøòÊúâ<code>G</code>Âú®ËøêË°åÁöÑ<code>P</code>ÔºåÂàô‰ºöÂ∞ÜÂØπÂ∫îÁöÑ<code>g.stackguard0</code>ËÆæÁΩÆ‰∏∫‰∏Ä‰∏™ÁâπÊÆäÊ†áËØÜ(<code>runtime.stackPreempt</code>)ÔºåÂëäËØâÂÆÉ<code>GC</code>Ê≠£Âú®Á≠âÂæÖÂÆÉËÆ©Âá∫„ÄÇÊ≠§Â§ñÔºåËøò‰ºöËÆæÁΩÆ‰∏Ä‰∏™<code>gcwaiting</code>Ê†áËØÜ(ËÆæÁΩÆ<code>gcwaiting=1</code>)ÔºåÊé•‰∏ãÊù•Â∞±ÈÄöËøáËøô‰∏§‰∏™Ê†áËØÜÁ¨¶ÁöÑÈÖçÂêàÔºåÊù•ÂÆûÁé∞ËøêË°å‰∏≠ÁöÑ<code>P</code>ÁöÑÊä¢Âç†„ÄÇ</li>
</ul>
<p><code>goroutine</code>ÂàõÂª∫‰πãÂàùÔºåÊ†àÁöÑÂ§ßÂ∞èÊòØÂõ∫ÂÆöÁöÑÔºå‰∏∫‰∫ÜÈò≤Ê≠¢Âá∫Áé∞Ê†àÊ∫¢Âá∫ÁöÑÊÉÖÂÜµÔºå<strong>ÁºñËØëÂô®‰ºöÂú®ÊúâÊòéÊòæÊ†àÊ∂àËÄóÁöÑÂáΩÊï∞Â§¥ÈÉ®ÊèíÂÖ•‰∏Ä‰∫õÊ£ÄÊµã‰ª£Á†Å</strong>ÔºåÈÄöËøá<code>g.stackguard0</code>Êù•Âà§Êñ≠ÊòØÂê¶ÈúÄË¶ÅËøõË°åÊ†àÂ¢ûÈïøÔºöÂ¶ÇÊûú<code>g.stackguard0</code>Ë¢´ËÆæÁΩÆ‰∏∫ÁâπÊÆäÊ†áËØÜ<code>runtime.stackPreempt</code>Ôºå‰æø‰∏ç‰ºöÊâßË°åÊ†àÂ¢ûÈïøÔºåËÄåÊòØÂéªÊâßË°å‰∏ÄÊ¨°Ë∞ÉÂ∫¶(<code>schedule()</code>)ÔºõÂú®<code>schedule()</code>Ë∞ÉÂ∫¶ÊâßË°åÊó∂Ôºå‰ºöÊ£ÄÊµã<code>gcwaiting</code>Ê†áËØÜÔºåËã•ÂèëÁé∞<code>GC</code>Âú®Á≠âÂæÖÊâßË°åÔºå‰æø‰ºöËÆ©Âá∫ÂΩìÂâç<code>P</code>ÔºåÂ∞ÜÂÖ∂ÁΩÆ‰∏∫<code>_Pgcstop</code>Áä∂ÊÄÅ„ÄÇ</p>
<p><strong>‰æùËµñÊ†àÂ¢ûÈïøÊ£ÄÊµã‰ª£Á†ÅÁöÑÊä¢Âç†ÊñπÂºèÔºåÈÅáÂà∞Ê≤°ÊúâÂáΩÊï∞Ë∞ÉÁî®ÁöÑÊÉÖÂÜµÂ∞±‰ºöÂá∫Áé∞ÈóÆÈ¢ò„ÄÇ</strong></p>
<p><strong>Go 1.14 ‰πãÂêé</strong>Ôºå<code>preemptone</code>ÂáΩÊï∞‰ºöÂà§Êñ≠ÂΩìÂâçÁ°¨‰ª∂ÁéØÂ¢ÉÊòØÂê¶ÊîØÊåÅÂºÇÊ≠•Êä¢Âç†ÔºåËøò‰ºöÂà§Êñ≠Áî®Êà∑ÊòØÂê¶ÂÖÅËÆ∏ÂºÄÂêØÂºÇÊ≠•Êä¢Âç†ÔºåÈªòËÆ§ÊÉÖÂÜµ‰∏ãÊòØÂÖÅËÆ∏ÁöÑ„ÄÇÂ¶ÇÊûúËøô‰∏§Êù°È™åËØÅÈÉΩÈÄöËøá‰∫ÜÔºåÂ∞±Â∞Ü<code>p.preempt</code>Â≠óÊÆµÁΩÆ‰∏∫<code>true</code>ÔºåÂÆûÈôÖÁöÑÊä¢Âç†Êìç‰Ωú‰ºö‰∫§Áî±<code>preemptM</code>ÂáΩÊï∞Êù•ÂÆåÊàê„ÄÇ<code>preemptM</code>ÂáΩÊï∞‰ºöË∞ÉÁî®<code>signalM</code>ÂáΩÊï∞ÔºåÈÄöËøáË∞ÉÁî®Êìç‰ΩúÁ≥ªÁªü‰∏≠‰ø°Âè∑Áõ∏ÂÖ≥ÁöÑÁ≥ªÁªüË∞ÉÁî®Ôºå<strong>Â∞ÜÊåáÂÆö‰ø°Âè∑ÂèëÈÄÅÁªôÁõÆÊ†áÁ∫øÁ®ã</strong>„ÄÇ</p>
<p><strong>Á∫øÁ®ãÊé•Êî∂Âà∞‰ø°Âè∑Âêé</strong>Ôºå‰ºöË∞ÉÁî®ÂØπÂ∫îÁöÑ‰ø°Âè∑Â§ÑÁêÜÂáΩÊï∞<code>sighandler</code>Êù•Â§ÑÁêÜÔºå<code>sighandler</code>Âú®Á°ÆÂÆö‰ø°Âè∑‰∏∫<code>sigPreempt</code>(Êä¢Âç†‰ø°Âè∑)‰ª•ÂêéÔºå<strong>ÂÆÉ‰ºöÈ¶ñÂÖàÂà§Êñ≠<code>runtime</code>ÊòØÂê¶Ë¶ÅÂØπÊåáÂÆöÁöÑ<code>G</code>ËøõË°åÂºÇÊ≠•Êä¢Âç†</strong>ÔºåÈÄöËøá‰ªÄ‰πàÊù•Âà§Êñ≠Âë¢Ôºü</p>
<ul>
<li>
<p>ÊåáÂÆöÁöÑ<code>G</code>‰∏éÂÖ∂ÂØπÂ∫î<code>P</code>ÁöÑ<code>preempt</code>Â≠óÊÆµÈÉΩË¶Å‰∏∫<code>true</code>ÔºåËÄå‰∏îÊåáÂÆöÁöÑ<code>G</code>ËøòË¶ÅÂ§ÑÂú®<code>_Grunning</code>Áä∂ÊÄÅÔºõ</p>
</li>
<li>
<p>ËøòË¶Å<strong>Á°ÆËÆ§Âú®ÂΩìÂâç‰ΩçÁΩÆÊâìÊñ≠<code>G</code>Âπ∂ÊâßË°åÊä¢Âç†ÊòØÂÆâÂÖ®ÁöÑ</strong></p>
<ul>
<li>
<p>ÊåáÂÆöÁöÑ<code>G</code><strong>ÂèØ‰ª•ÊåÇËµ∑Âπ∂ÂÆâÂÖ®ÁöÑÊâ´ÊèèÂÆÉÁöÑÊ†àÂíåÂØÑÂ≠òÂô®</strong>ÔºåÂπ∂‰∏îÂΩìÂâçË¢´ÊâìÊñ≠ÁöÑ‰ΩçÁΩÆÂπ∂<strong>Ê≤°ÊúâÊâìÊñ≠ÂÜôÂ±èÈöú</strong>Ôºõ</p>
</li>
<li>
<p>ÊåáÂÆöÁöÑ<code>G</code>Ëøò<strong>ÊúâË∂≥Â§üÁöÑÊ†àÁ©∫Èó¥</strong>Êù•Ê≥®ÂÖ•‰∏Ä‰∏™ÂºÇÊ≠•Êä¢Âç†ÂáΩÊï∞Ë∞ÉÁî®(<code>asyncPreempt</code>)Ôºõ</p>
</li>
<li>
<p>ËøôÈáåÂèØ‰ª•ÂÆâÂÖ®ÁöÑÂíå<code>runtime</code>ËøõË°å‰∫§‰∫íÔºå‰∏ªË¶ÅÂ∞±ÊòØÁ°ÆÂÆöÂΩìÂâçÂπ∂<strong>Ê≤°ÊúâÊåÅÊúâ<code>runtime</code>Áõ∏ÂÖ≥ÁöÑÈîÅ</strong>ÔºåÁªßËÄå‰∏ç‰ºöÂú®ÂêéÁª≠Â∞ùËØïËé∑ÂæóÈîÅÊó∂ÂèëÁîüÊ≠ªÈîÅ„ÄÇ</p>
</li>
</ul>
</li>
</ul>
<p><strong>Á°ÆËÆ§‰∫ÜË¶ÅÊä¢Âç†Ëøô‰∏™<code>G</code>ÔºåÂπ∂‰∏îÊ≠§Êó∂Êä¢Âç†ÊòØÂÆâÂÖ®ÁöÑ</strong>‰ª•ÂêéÔºåÂ∞±ÂèØ‰ª•ÊîæÂøÉÁöÑÈÄöËøá<code>pushCall</code>Âêë<code>G</code>‰∏≠<strong>Ê≥®ÂÖ•ÂºÇÊ≠•Êä¢Âç†ÂáΩÊï∞Ë∞ÉÁî®</strong>‰∫ÜÔºåË¢´Ê≥®ÂÖ•ÁöÑÂºÇÊ≠•Êä¢Âç†ÂáΩÊï∞(<code>asyncPreempt</code>)ÊúÄÁªà‰ºöÂéªÊâßË°å<code>schedule()</code>ÔºåÂà∞ËøôÈáåÔºåÂºÇÊ≠•Êä¢Âç†Â∞±ÂÆåÊàê‰∫Ü„ÄÇ</p>
<h2 id="38-channel">3.8 Channel</h2>
<blockquote>
<h4 id="ÈóÆchannel-ÊòØÂê¶ÊòØÂπ∂ÂèëÂÆâÂÖ®ÁöÑ">ÈóÆÔºöchannel ÊòØÂê¶ÊòØÂπ∂ÂèëÂÆâÂÖ®ÁöÑÔºü</h4>
</blockquote>
<p>ÊòØÊª¥</p>
<blockquote>
<h4 id="ÈóÆÊÄé‰πàÈÄöËøá-channel-ÂÆûÁé∞ÂçèÁ®ãÈó¥ÁöÑÈÄö‰ø°">ÈóÆÔºöÊÄé‰πàÈÄöËøá channel ÂÆûÁé∞ÂçèÁ®ãÈó¥ÁöÑÈÄö‰ø°Ôºü</h4>
</blockquote>
<blockquote>
<h4 id="ÈóÆÂêëÂ∑≤ÂÖ≥Èó≠ÁöÑ-channel-ÂÜô-‰ºöÂèëÁîü‰ªÄ‰πà‰ªéÂ∑≤ÂÖ≥Èó≠ÁöÑ-channel-ËØª-‰ºöÂèëÁîü‰ªÄ‰πà">ÈóÆÔºöÂêëÂ∑≤ÂÖ≥Èó≠ÁöÑ channel ÂÜô ‰ºöÂèëÁîü‰ªÄ‰πàÔºü‰ªéÂ∑≤ÂÖ≥Èó≠ÁöÑ channel ËØª ‰ºöÂèëÁîü‰ªÄ‰πàÔºü‚≠ê</h4>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">testClose</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">intChan</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">int</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">intChan</span> <span class="o">&lt;-</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// 1. ÂÖ≥Èó≠‰∏Ä‰∏™channel
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nb">close</span><span class="p">(</span><span class="nx">intChan</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// 2. ÂêëÂÖ≥Èó≠ÁöÑchannel‰∏≠ÂÜôÂÖ•Êï∞ÊçÆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//intChan &lt;- 3 // ‰ºöÊä•Èîô panic: send on closed channel
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// 3. ‰ªéÂÖ≥Èó≠ÁöÑchannelËØªÂèñÊï∞ÊçÆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">num</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">intChan</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">num</span><span class="p">,</span> <span class="nx">ok</span><span class="p">)</span> <span class="c1">// 2 true
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">num</span><span class="p">,</span> <span class="nx">ok</span> <span class="p">=</span> <span class="o">&lt;-</span><span class="nx">intChan</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">num</span><span class="p">,</span> <span class="nx">ok</span><span class="p">)</span> <span class="c1">// 0 false
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<h4 id="ÈóÆÂ¶Ç‰Ωï‰ºòÈõÖÂÖ≥Èó≠‰∏Ä‰∏™-channel">ÈóÆÔºöÂ¶Ç‰Ωï‰ºòÈõÖÂÖ≥Èó≠‰∏Ä‰∏™ ChannelÔºü‚≠ê‚≠ê</h4>
</blockquote>
<p><strong>ÂÖàËØ¥ËØ¥‰∏∫Âï•ChannelÂÖ≥Èó≠Ëøô‰πàÈ∫ªÁÉ¶Ôºö</strong></p>
<ul>
<li>‰∏çËÉΩÊó†ËÑëÂÖ≥Èó≠Ôºå<strong>Â¶ÇÊûú‰∏Ä‰∏™channelÂ∑≤ÁªèÂÖ≥Èó≠</strong>Ôºå<strong>ÈáçÂ§çÂÖ≥Èó≠channel</strong>‰ºöÂØºËá¥panic</li>
<li><strong>ÂæÄ‰∏Ä‰∏™ÂÖ≥Èó≠ÁöÑchannelÂÜôÊï∞ÊçÆ</strong>Ôºå‰πü‰ºöÂØºËá¥panic</li>
</ul>
<p>**channelÁöÑÂÖ≥Èó≠ÂéüÂàôÔºö**‚≠ê</p>
<ul>
<li>‰∏çË¶ÅÂú®Ê∂àË¥πËÄÖÁ´ØÂÖ≥Èó≠channel</li>
<li>‰∏çË¶ÅÂú®ÊúâÂ§ö‰∏™Âπ∂Ë°åÁöÑÁîü‰∫ßËÄÖÊó∂ÂÖ≥Èó≠channel(Â∫îËØ•Âè™Âú®ÂîØ‰∏ÄÊàñËÄÖÊúÄÂêé‰∏Ä‰∏™Áîü‰∫ßËÄÖÂçèÁ®ã‰∏≠ÂÖ≥Èó≠channel)</li>
</ul>
<p>==<strong>‰ºòÈõÖÁöÑÂÖ≥Èó≠ÔºåÂÖ∂ÂÆûË¶ÅÂàÜÊÉÖÂÜµÁöÑÔºö</strong>==</p>
<ul>
<li><strong>Âçï‰∏™Áîü‰∫ßËÄÖÔºåÂçï‰∏™Ê∂àË¥πËÄÖ</strong></li>
</ul>
<p>‚Äã	Áõ¥Êé•ËÆ©<strong>Áîü‰∫ßËÄÖÂÖ≥Èó≠</strong>„ÄÇ</p>
<ul>
<li>
<p><strong>Âçï‰∏™Áîü‰∫ßËÄÖÔºåÂ§ö‰∏™Ê∂àË¥πËÄÖ</strong></p>
<p>ËøôÁßçÊÉÖÂÜµÂæàÁÆÄÂçïÔºåÁõ¥Êé•ËÆ©<strong>Áîü‰∫ßËÄÖÂÖ≥Èó≠</strong>Âç≥ÂèØ„ÄÇ</p>
</li>
<li>
<p><strong>Â§ö‰∏™Áîü‰∫ßËÄÖÔºåÂçï‰∏™Ê∂àË¥πËÄÖ</strong></p>
</li>
</ul>
<p>‚Äã	‰∏çËÉΩÂú®Ê∂àË¥πÁ´ØÂÖ≥Èó≠ÔºåËøôËøùËÉå‰∫ÜchannelÂÖ≥Èó≠ÂéüÂàô„ÄÇÂèØ‰ª•<strong>ËÆ©Ê∂àË¥πËÄÖÊ†áËÆ∞‰∏Ä‰∏™<code>close</code>‰ø°Âè∑</strong>ÔºåÈÄöÁü•Áîü‰∫ßËÄÖ‰∏çË¶ÅÁªßÁª≠ÂÜôÊï∞ÊçÆ„ÄÇ</p>
<ul>
<li><strong>Â§ö‰∏™Áîü‰∫ßËÄÖÔºåÂ§ö‰∏™Ê∂àË¥πËÄÖ</strong></li>
</ul>
<p>‚Äã	ÂèØ‰ª•ËÆæÁΩÆ‰∏Ä‰∏™‰∏≠Èó¥Ë∞ÉËß£ËÄÖËßíËâ≤„ÄÇ</p>
<p>È¶ñÂÖàËÆæÁΩÆ‰∏Ä‰∏™ÈÄöÈÅì<code>toStop</code>ÔºåÂΩìÁîü‰∫ßËÄÖÊàñÊ∂àË¥πËÄÖËææÂà∞Êù°‰ª∂ÔºåÂ∞±Âêë<code>toStop</code>ÂèëÈÄÅÂÖ≥Èó≠‰ø°Âè∑Ôºå‰∏≠Èó¥ËßíËâ≤Êî∂Âà∞ÂêéÂÖ≥Èó≠<code>stopCh</code>(‰ªÖÁî®‰ΩúÈÄöÁü•ÂèëÈÄÅËÄÖ‰∏çË¶ÅÂÜçÂêëÊï∞ÊçÆÈÄöÈÅì<code>dataCh</code>ÂÜôÊï∞ÊçÆ‰∫Ü)ÔºåÁîü‰∫ßËÄÖÊî∂Âà∞<code>stopCh</code>ÁöÑÂÖ≥Èó≠‰ø°Âè∑ÂêéÔºå‰∏çÂÜçÂêë<code>dataCh</code>ÂÜôÊï∞ÊçÆ„ÄÇ</p>
<p>ËØ∑Ê≥®ÊÑèÔºå‰ø°Âè∑ÈÄöÈÅì<code>toStop</code>ÁöÑÂÆπÈáèÂøÖÈ°ªËá≥Â∞ë‰∏∫1„ÄÇÂ¶ÇÊûúÂÆÉÁöÑÂÆπÈáè‰∏∫0ÔºåÂàôÂú®‰∏≠Èó¥Ë∞ÉËß£ËÄÖËøòÊú™ÂáÜÂ§áÂ•ΩÁöÑÊÉÖÂÜµ‰∏ãÂ∞±Â∑≤ÁªèÊúâÊüê‰∏™ÂçèÁ®ãÂêë<code>toStop</code>ÂèëÈÄÅ‰ø°Âè∑Êó∂ÔºåÊ≠§‰ø°Âè∑ÊúâÂèØËÉΩË¢´ÊäõÂºÉ„ÄÇ</p>
<p><strong>ÂèÇËÄÉÊñáÁ´†</strong>Ôºö</p>
<ul>
<li><a href="https://gfw.go101.org/article/channel-closing.html" target="_blank" rel="noopener noreffer ">https://gfw.go101.org/article/channel-closing.html</a></li>
</ul>
<blockquote>
<h4 id="ÈóÆchannel-ÁöÑÂèëÈÄÅÊé•Êî∂ÂÖ≥Èó≠">ÈóÆÔºöchannel ÁöÑÂèëÈÄÅ„ÄÅÊé•Êî∂„ÄÅÂÖ≥Èó≠Ôºü</h4>
</blockquote>
<p><strong>ÂèëÈÄÅ</strong>Ôºö</p>
<ul>
<li>ÂèëÈÄÅÊìç‰Ωú‰ºöÂØπ <code>hchan</code> Âä†ÈîÅÔºõ</li>
<li>ÂΩì <code>recvq</code> ‰∏≠Â≠òÂú®Á≠âÂæÖÊé•Êî∂ÁöÑ goroutine Êó∂ÔºåËã•Êúâ goroutine Ë¶ÅÂèëÈÄÅÊï∞ÊçÆÔºåÂ∞±‰ºöË∞ÉÁî® <code>memmove</code> ÂáΩÊï∞‰ªéÂèëÈÄÅ goroutine ÁöÑÊ†à‰∏≠ÔºåÁõ¥Êé•Êã∑Ë¥ùÊï∞ÊçÆÂà∞Êé•Êî∂ goroutine ÁöÑÊ†à‰∏≠Ôºå‰∏çÁªèËøá channel (Êó†ËÆ∫ channel ÊòØÂê¶ÊúâÁºìÂÜ≤Âå∫)Ôºõ</li>
<li>ÂΩì <code>recvq</code> Á≠âÂæÖÈòüÂàó‰∏∫Á©∫Êó∂Ôºå‰ºöÂà§Êñ≠ <code>hchan.buf</code> ÊòØÂê¶ÂèØÁî®„ÄÇÂ¶ÇÊûúÂèØÁî®ÔºåÂàô‰ºöÂ∞ÜÂèëÈÄÅÁöÑÊï∞ÊçÆÊã∑Ë¥ùËá≥ <code>hchan.buf</code> ‰∏≠Ôºõ</li>
<li>Â¶ÇÊûú <code>hchan.buf</code>  Â∑≤Êª°ÔºåÈÇ£‰πàÂ∞ÜÂΩìÂâçÂèëÈÄÅ goroutine ÁΩÆ‰∫é <code>sendq</code> ‰∏≠ÊéíÈòüÔºåÂπ∂Âú®ËøêË°åÊó∂‰∏≠ÊåÇËµ∑Ôºõ</li>
<li>ÂêëÂ∑≤ÁªèÂÖ≥Èó≠ÁöÑ channel ÂèëÈÄÅÊï∞ÊçÆÔºå‰ºöÂºïÂèë panicÔºõ</li>
</ul>
<p>ÂØπ‰∫éÊó†ÁºìÂÜ≤ÁöÑ channel Êù•ËØ¥ÔºåÂÆÉÂ§©ÁÑ∂Â∞±ÊòØ <code>hchan.buf</code> Â∑≤Êª°ÁöÑÊÉÖÂÜµÔºåÂõ†‰∏∫ÂÆÉÁöÑ <code>hchan.buf</code> ÁöÑÂÆπÈáè‰∏∫ 0„ÄÇ</p>
<p><strong>Êé•Êî∂</strong>Ôºö</p>
<ul>
<li>Êé•Êî∂Êìç‰Ωú‰ºöÂØπ <code>hchan</code> Âä†ÈîÅ„ÄÇ</li>
<li>ÂΩì <code>sendq</code> ‰∏≠Â≠òÂú®Á≠âÂæÖÂèëÈÄÅÁöÑ goroutine Êó∂ÔºåÊÑèÂë≥ÁùÄÊ≠§Êó∂ÁöÑ <code>hchan.buf</code> Â∑≤Êª°ÔºàÊó†ÁºìÂ≠òÁöÑÂ§©ÁÑ∂Â∑≤Êª°ÔºâÔºåÂàÜ‰∏§ÁßçÊÉÖÂÜµÔºö
<ul>
<li>Â¶ÇÊûúÊòØÊúâÁºìÂ≠òÁöÑ <code>hchan</code>ÔºåÈÇ£‰πàÂÖàÂ∞ÜÁºìÂÜ≤Âå∫ÁöÑÊï∞ÊçÆÊã∑Ë¥ùÁªôÊé•Êî∂ goroutineÔºåÂÜçÂ∞Ü <code>sendq</code> ÁöÑÈòüÂ§¥ <code>sudog</code> Âá∫ÈòüÔºåÂ∞ÜÂá∫ÈòüÁöÑ <code>sudog</code> ‰∏äÁöÑÂÖÉÁ¥†Êã∑Ë¥ùËá≥ <code>hchan</code> ÁöÑÁºìÂ≠òÂå∫„ÄÇ</li>
<li>Â¶ÇÊûúÊòØÊó†ÁºìÂ≠òÁöÑ <code>hchan</code>ÔºåÈÇ£‰πàÁõ¥Êé•Â∞ÜÂá∫ÈòüÁöÑ <code>sudog</code> ‰∏äÁöÑÂÖÉÁ¥†Êã∑Ë¥ùÁªôÊé•Êî∂ goroutine„ÄÇ‰∏§ÁßçÊÉÖÂÜµÁöÑÊúÄÂêéÈÉΩ‰ºöÂî§ÈÜíÂá∫ÈòüÁöÑ <code>sudog</code> ‰∏äÁöÑÂèëÈÄÅ goroutine„ÄÇ</li>
</ul>
</li>
<li>ÂΩì <code>sendq</code> ÂèëÈÄÅÈòüÂàó‰∏∫Á©∫Êó∂Ôºå‰ºöÂà§Êñ≠ <code>hchan.buf</code> ÊòØÂê¶ÂèØÁî®„ÄÇ
<ul>
<li>Â¶ÇÊûúÂèØÁî®ÔºåÂàô‰ºöÂ∞Ü <code>hchan.buf</code> ÁöÑÊï∞ÊçÆÊã∑Ë¥ùÁªôÊé•Êî∂ goroutine„ÄÇ</li>
<li>Â¶ÇÊûú <code>hchan.buf</code> ‰∏çÂèØÁî®ÔºåÈÇ£‰πàÂ∞ÜÂΩìÂâçÊé•Êî∂ goroutine ÁΩÆ‰∫é <code>recvq</code> ‰∏≠ÊéíÈòüÔºåÂπ∂Âú®ËøêË°åÊó∂‰∏≠ÊåÇËµ∑„ÄÇ</li>
</ul>
</li>
<li>‰∏éÂèëÈÄÅ‰∏çÂêåÁöÑÊòØÔºåÂΩì <code>channel</code> ÂÖ≥Èó≠Êó∂Ôºågoroutine ËøòËÉΩ‰ªé <code>channel</code> ‰∏≠Ëé∑ÂèñÊï∞ÊçÆ„ÄÇÂ¶ÇÊûú <code>recvq</code> Á≠âÂæÖÂàóË°®‰∏≠Êúâ goroutinesÔºåÈÇ£‰πàÂÆÉ‰ª¨ÈÉΩ‰ºöË¢´Âî§ÈÜíÊé•Êî∂Êï∞ÊçÆ„ÄÇÂ¶ÇÊûú <code>hchan.buf</code> ‰∏≠ËøòÊúâÊú™Êé•Êî∂ÁöÑÊï∞ÊçÆÔºåÈÇ£‰πà goroutine ‰ºöÊé•Êî∂ÁºìÂÜ≤Âå∫‰∏≠ÁöÑÊï∞ÊçÆÔºåÂê¶Âàô goroutine ‰ºöËé∑ÂèñÂà∞ÂÖÉÁ¥†ÁöÑÈõ∂ÂÄº„ÄÇ</li>
</ul>
<p><strong>ÂÖ≥Èó≠</strong>Ôºö</p>
<ul>
<li>Â¶ÇÊûúÂÖ≥Èó≠Â∑≤ÂÖ≥Èó≠ÁöÑ channel ‰ºöÂºïÂèë painc„ÄÇ</li>
<li>ÂÖ≥Èó≠ channel ÂêéÔºåÂ¶ÇÊûúÊúâÈòªÂ°ûÁöÑËØªÂèñÊàñÂèëÈÄÅ goroutines Â∞Ü‰ºöË¢´Âî§ÈÜíÔºö
<ul>
<li>ËØªÂèñ goroutine ‰ºöËé∑ÂèñÂà∞ hchan ÁöÑÂ∑≤Êé•Êî∂ÂÖÉÁ¥†ÔºåÂ¶ÇÊûúÊ≤°ÊúâÔºåÂàôËé∑ÂèñÂà∞ÂÖÉÁ¥†Èõ∂ÂÄºÔºõ</li>
<li><strong>ÂèëÈÄÅ goroutine ÁöÑÊâßË°åÂàô‰ºöÂºïÂèë painc</strong>„ÄÇ</li>
</ul>
</li>
</ul>
<blockquote>
<h4 id="ÈóÆchannel-ÈùûÂæóÂÖ≥Èó≠Âêó">ÈóÆÔºöchannel ÈùûÂæóÂÖ≥Èó≠ÂêóÔºü‚≠êüö©</h4>
</blockquote>
<p>‰∏çÁî®Ôºåchannel Ê≤°ÊúâË¢´‰ªª‰ΩïÂçèÁ®ãÁî®Âà∞ÂêéÊúÄÁªà‰ºöË¢´ GC ÂõûÊî∂„ÄÇ</p>
<p>‰ΩÜÔºåÈúÄË¶ÅÂàÜÂà´ËÄÉËôë‰∏§ÁßçÊÉÖÂÜµÔºö</p>
<ul>
<li><strong>channel ÁöÑ<code>ÂèëÈÄÅÊ¨°Êï∞ == Êé•Êî∂Ê¨°Êï∞</code></strong>Ôºö</li>
</ul>
<p>ÂèëÈÄÅËÄÖ goroutine ÂíåÊé•Êî∂ËÄÖ goroutine ÂàÜÂà´ÈÉΩ‰ºöÂú®ÂèëÈÄÅÊàñÊé•Êî∂ÁªìÊùüÊó∂ÁªìÊùüÂêÑËá™ÁöÑ goroutine (‰πüÂç≥ÊòØchannel‰∏≠Ê≤°ÊúâÈòªÂ°ûÁöÑgoroutine)ÔºåÊ≠§Êó∂ÔºåchannelÁî±‰∫éÊ≤°ÊúâË¢´‰ΩøÁî®ÔºåÂ∞±‰ºöË¢´ÂûÉÂúæÊî∂ÈõÜÂô®Ëá™Âä®ÂõûÊî∂„ÄÇËøôÁßçÊÉÖÂÜµ‰∏ãÔºå<strong>‰∏çÂÖ≥Èó≠ channelÔºåÊ≤°Êúâ‰ªª‰ΩïÂâØ‰ΩúÁî®</strong>„ÄÇ</p>
<ul>
<li><strong>channel ÁöÑ<code>ÂèëÈÄÅÊ¨°Êï∞ != Êé•Êî∂Ê¨°Êï∞</code></strong>Ôºö</li>
</ul>
<p>channel ÁöÑÂèëÈÄÅÊ¨°Êï∞‰∏çÁ≠â‰∫éÊé•Êî∂Ê¨°Êï∞Êó∂ÔºåÂèØËÉΩ‰ºöÂØºËá¥ÂèëÈÄÅËÄÖÊàñÊé•Êî∂ËÄÖÈòªÂ°ûÂú®channel„ÄÇÂõ†Ê≠§channelÁî±‰∫é‰∏ÄÁõ¥Ë¢´‰ΩøÁî®ÔºåÂØºËá¥Êó†Ê≥ïË¢´ÂûÉÂúæÂõûÊî∂„ÄÇÈòªÂ°ûÁöÑ goroutine ÂíåÊú™Ë¢´ÂõûÊî∂ÁöÑ channel ÈÉΩÈÄ†Êàê‰∫ÜÂÜÖÂ≠òÊ≥ÑÊºèÁöÑÈóÆÈ¢ò„ÄÇ</p>
<blockquote>
<h4 id="ÈóÆÂ¶Ç‰ΩïÂà§Êñ≠channelÂ∑≤ÂÖ≥Èó≠">ÈóÆÔºöÂ¶Ç‰ΩïÂà§Êñ≠channelÂ∑≤ÂÖ≥Èó≠Ôºüü§î‚ùì</h4>
</blockquote>
<ul>
<li>ÈÄöËøá <code>v, ok := &lt;-chan</code>ÔºåËã•Â∑≤ÂÖ≥Èó≠Ôºåok Â∞±ÊòØ falseÔºõ</li>
</ul>
<p>‰ºº‰πéÂæóÂàÜÊúâÁºìÂÜ≤ÂíåÊó†ÁºìÂÜ≤Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// 1. ÊúâÁºìÂÜ≤Êó∂ÔºåÂè™Ë¶ÅÁºìÂÜ≤Âå∫ÊúâÊï∞ÊçÆÔºåokÂ∞±ÊòØtrueÔºåÂõ†Ê≠§‰∏çËÉΩÁî®ËøôÁßçÊñπÊ≥ïÂà§Êñ≠
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ch</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">int</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ch</span> <span class="o">&lt;-</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">	<span class="nb">close</span><span class="p">(</span><span class="nx">ch</span><span class="p">)</span>				<span class="c1">// Ê≠§Â§ÑÂ∑≤ÂÖ≥Èó≠Ôºå‰ΩÜchannel‰æùÁÑ∂ÊúâÊï∞ÊçÆÊú™ËØªÂÆå
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">v1</span><span class="p">,</span> <span class="nx">ok1</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">ch</span>			<span class="c1">// Ê≠§Êó∂channel‰æùÁÑ∂ÊúâÊï∞ÊçÆÊú™ËØªÂÆå
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">v1</span><span class="p">,</span> <span class="nx">ok1</span><span class="p">)</span>	<span class="c1">// 1 true
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">v2</span><span class="p">,</span> <span class="nx">ok2</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">ch</span>			<span class="c1">// Ê≠§Êó∂channelÊ≤°Êï∞ÊçÆÂèØËØª
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">v2</span><span class="p">,</span> <span class="nx">ok2</span><span class="p">)</span>	<span class="c1">// 0 false
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 2. Êó†ÁºìÂÜ≤Êó∂ÔºåÂèØ‰ª•ÈÖ±Á¥´Âà§Êñ≠„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ch</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">int</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//ch &lt;- 1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nb">close</span><span class="p">(</span><span class="nx">ch</span><span class="p">)</span>            <span class="c1">// Ê≠§Â§ÑÂ∑≤ÂÖ≥Èó≠
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">v1</span><span class="p">,</span> <span class="nx">ok1</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">ch</span>      
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">v1</span><span class="p">,</span> <span class="nx">ok1</span><span class="p">)</span> <span class="c1">// 0 false
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">v2</span><span class="p">,</span> <span class="nx">ok2</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">ch</span>      <span class="c1">// Ê≠§Êó∂channelÊ≤°Êï∞ÊçÆÂèØËØª
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">v2</span><span class="p">,</span> <span class="nx">ok2</span><span class="p">)</span> <span class="c1">// 0 false
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÈÄöËøá <code>for range</code>Ôºå‰ºöËá™Âä®Âà§Êñ≠ channel ÊòØÂê¶ÁªìÊùüÔºåÂ¶ÇÊûúÁªìÊùüÂàôËá™Âä®ÈÄÄÂá∫ for Âæ™ÁéØ„ÄÇ</li>
</ul>
<p>Âêå‰∏äÔºå‰πüÂæóÂàÜÊúâÊó†ÁºìÂÜ≤„ÄÇ</p>
<p>‰ºº‰πéÔºåÊ≤°Êúâ‰ªÄ‰πàÂ•ΩÂäûÊ≥ïÔºü</p>
<blockquote>
<h4 id="ÈóÆchannel-ÊúâÂï•Â∫îÁî®">ÈóÆÔºöChannel ÊúâÂï•Â∫îÁî®Ôºü</h4>
</blockquote>
<ul>
<li>
<p>ÁªàÊ≠¢‰ø°Âè∑ÈÄöÁü•„ÄÇ‰æãÂ¶ÇÔºå<code>main goroutine</code>Á≠âÂæÖ<code>hello goroutine</code>ÊâßË°åÂÆåÊØïÔºõ</p>
</li>
<li>
<p>‰ªªÂä°ÂÆöÊó∂„ÄÇ‰∏é<code>timer</code>ÁªìÂêàÔºåÂÆûÁé∞<strong>Ë∂ÖÊó∂ÊéßÂà∂</strong>„ÄÇEtcd‰∏≠ÂæàÂ∏∏ËßÅ</p>
<ul>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="k">select</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="o">&lt;-</span><span class="nx">time</span><span class="p">.</span><span class="nf">After</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Millisecond</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="o">&lt;-</span><span class="nx">s</span><span class="p">.</span><span class="nx">stopc</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
<li>
<p>Áîü‰∫ßËÄÖÂíåÊ∂àË¥πËÄÖ„ÄÇÁîü‰∫ßËÄÖÂêë<code>Channel</code>ÂÜôÊï∞ÊçÆÔºåÊ∂àË¥πËÄÖ‰ªé<code>Channel</code>ËØªÊï∞ÊçÆÔºõ</p>
</li>
<li>
<p>ÊéßÂà∂Âπ∂ÂèëÊï∞Ôºõ</p>
<ul>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">limit</span> <span class="p">=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">int</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ‚Ä¶‚Ä¶‚Ä¶‚Ä¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">w</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">work</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">limit</span> <span class="o">&lt;-</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">            <span class="nf">w</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="o">&lt;-</span><span class="nx">limit</span>
</span></span><span class="line"><span class="cl">        <span class="p">}()</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ‚Ä¶‚Ä¶‚Ä¶‚Ä¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
</ul>
<blockquote>
<h4 id="ÈóÆchannel-Âï•Êó∂ÂÄô‰ºöÂØºËá¥ÂÜÖÂ≠òÊ≥ÑÊºè">ÈóÆÔºöChannel Âï•Êó∂ÂÄô‰ºöÂØºËá¥ÂÜÖÂ≠òÊ≥ÑÊºèÔºü</h4>
</blockquote>
<p>Ê≥ÑÊºèÁöÑÂéüÂõ†ÊòØ goroutine Êìç‰Ωú channel ÂêéÔºåÂ§Ñ‰∫éÂèëÈÄÅÊàñÊé•Êî∂ÈòªÂ°ûÁä∂ÊÄÅÔºåËÄå channel Â§Ñ‰∫éÊª°ÊàñÁ©∫ÁöÑÁä∂ÊÄÅÔºå‰∏ÄÁõ¥Âæó‰∏çÂà∞ÊîπÂèò„ÄÇ</p>
<p>Ê≠§Êó∂ <code>goroutine</code> ‰∏ÄÁõ¥ÈòªÂ°ûÔºåÂæó‰∏çÂà∞ÈáäÊîæÔºåÂ∞±ÈÄ†Êàê‰∫ÜÂÜÖÂ≠òÊ≥ÑÈú≤„ÄÇÂÖ∂ÂÆûÂπ∂‰∏çÊòØ<code>channel</code>Êú¨Ë∫´ÁöÑÂÜÖÂ≠òÊ≥ÑÊºèÔºü</p>
<blockquote>
<h4 id="ÈóÆchannelÁöÑÂ∫ïÂ±ÇÊòØÊÄéÊ†∑ÁöÑ">ÈóÆÔºö<code>channel</code>ÁöÑÂ∫ïÂ±ÇÊòØÊÄéÊ†∑ÁöÑÔºü</h4>
</blockquote>
<p>Áî®<code>make</code>ÂàõÂª∫<code>chan</code>Êó∂ÔºåÂáΩÊï∞Ê†àÂ∏ß‰∏ä‰ºöÂ≠òÂÇ®<code>chan</code>ÁöÑÊåáÈíàÔºåÊåáÂêëÂ†Ü‰∏äÁöÑ<code>hchan</code>ÁªìÊûÑ‰Ωì„ÄÇ</p>
<ul>
<li>Âõ†‰∏∫<code>channel</code>ÊîØÊåÅÂçèÁ®ãÈó¥Âπ∂ÂèëËÆøÈóÆÔºåÊâÄ‰ª•Ë¶ÅÊúâ‰∏ÄÊää**ÈîÅ<code>lock</code>**Êù•‰øùÊä§Êï¥‰∏™Êï∞ÊçÆÁªìÊûÑ„ÄÇ</li>
<li>ÂØπ‰∫éÊúâÁºìÂÜ≤Êù•ËÆ≤ÔºåÈúÄË¶ÅÁü•ÈÅì<strong>ÁºìÂÜ≤Âå∫</strong>Âú®Âì™ÔºåÂ∑≤ÁªèÂ≠òÂÇ®‰∫ÜÂ§öÂ∞ë‰∏™ÂÖÉÁ¥†ÔºåÊúÄÂ§öÂ≠òÂÇ®Â§öÂ∞ë‰∏™ÂÖÉÁ¥†ÔºåÊØè‰∏™ÂÖÉÁ¥†Âç†Â§öÂ§ßÁ©∫Èó¥ÔºåÊâÄ‰ª•ÂÆûÈôÖ‰∏äÔºåÁºìÂÜ≤Âå∫Â∞±ÊòØ‰∏™Êï∞ÁªÑ<code>buf</code>„ÄÅ<code>elemsize</code>„ÄÇ</li>
<li>Âõ†‰∏∫ Go ËøêË°å‰∏≠ÔºåÂÜÖÂ≠òÂ§çÂà∂„ÄÅÂûÉÂúæÂõûÊî∂Á≠âÊú∫Âà∂‰æùËµñÊï∞ÊçÆÁöÑÁ±ªÂûã‰ø°ÊÅØÔºåÊâÄ‰ª•<code>hchan</code>ËøòË¶ÅÊúâ‰∏Ä‰∏™ÊåáÈíàÔºåÊåáÂêëÂÖÉÁ¥†Á±ªÂûãÁöÑ<strong>Á±ªÂûãÂÖÉÊï∞ÊçÆ</strong><code>elemtype</code>„ÄÇ</li>
<li>Ê≠§Â§ñÔºå<code>channel</code>ÊîØÊåÅ‰∫§ÊõøÁöÑËØª(Êé•Êî∂)ÂÜô(ÂèëÈÄÅ)ÔºåÈúÄË¶ÅÂàÜÂà´ËÆ∞ÂΩï<strong>ËØª„ÄÅÂÜô‰∏ãÊ†áÁöÑ‰ΩçÁΩÆ</strong><code>recvx</code>„ÄÅ<code>sendx</code>„ÄÇ</li>
<li>ÂΩìËØªÂíåÂÜô‰∏çËÉΩÁ´ãÂç≥ÂÆåÊàêÊó∂ÔºåÈúÄË¶ÅËÉΩÂ§üËÆ©ÂΩìÂâçÂçèÁ®ãÂú®<code>channel</code>‰∏äÁ≠âÂæÖÔºåÂæÖÂà∞Êù°‰ª∂Êª°Ë∂≥Êó∂ÔºåË¶ÅËÉΩÂ§üÁ´ãÂç≥Âî§ÈÜíÁ≠âÂæÖÁöÑÂçèÁ®ãÔºåÊâÄ‰ª•Ë¶ÅÊúâ‰∏§‰∏™<strong>Á≠âÂæÖÈòüÂàó</strong>ÔºåÂàÜÂà´ÈíàÂØπËØª(Êé•Êî∂)ÂíåÂÜô(ÂèëÈÄÅ)<code>recvq</code>„ÄÅ<code>sendq</code>„ÄÇ</li>
<li>Ê≠§Â§ñÔºå<code>channel</code>ËÉΩÂ§ü<code>close</code>ÔºåÊâÄ‰ª•ËøòË¶ÅËÆ∞ÂΩïÂÆÉÁöÑ<strong>ÂÖ≥Èó≠Áä∂ÊÄÅ<code>closed</code></strong>„ÄÇ</li>
</ul>
<blockquote>
<h4 id="ÈóÆchannelÊòØÂ¶Ç‰ΩïËøõË°åËØªÂÜôÁöÑ">ÈóÆÔºö<code>channel</code>ÊòØÂ¶Ç‰ΩïËøõË°åËØªÂÜôÁöÑÔºü</h4>
</blockquote>
<p><code>channel</code>ÁöÑËØªÂÜôÊòØÂàÜ‰∏∫ÈòªÂ°ûÂºèÂíåÈùûÈòªÂ°ûÂºèÁöÑ„ÄÇ</p>
<ol>
<li><strong>ÈòªÂ°ûÂºèÂÜô</strong>Ôºö<code>ch &lt;- 10</code></li>
</ol>
<ul>
<li><strong>ÊúâÁºìÂÜ≤Âå∫ÁöÑ<code>channel</code></strong></li>
</ul>
<p>ÂØπ‰∫éÊúâÁºìÂÜ≤Âå∫ÁöÑ<code>channel</code>Êù•ËØ¥ÔºåËã•ÁºìÂÜ≤Âå∫ÊúâÁ©∫Èó≤ÔºåÂ∞±ÂèØ‰ª•ÈÄöËøáÂÜôÊåáÈíàÂ∞ÜÊï∞ÊçÆÂÜôÂÖ•ÊåáÂÆö‰∏ãÊ†á„ÄÇËã•ÁºìÂÜ≤Âå∫Â∑≤Êª°ÔºåÂ∞±‰ºöËøõÂÖ•<code>channel</code>ÁöÑÂèëÈÄÅÈòªÂ°ûÈòüÂàó„ÄÇÂÄºÂæó‰∏ÄÊèêÁöÑÊòØÔºå<code>channel</code>ÁöÑÁºìÂÜ≤Âå∫ÊòØ‰∏Ä‰∏™ÁéØÂΩ¢ÁºìÂÜ≤Âå∫ÔºåÂÜôÊåáÈíàÂíåËØªÊåáÈíàÈÉΩÂú®‰∏çÂÅúÁöÑÂæ™ÁéØ„ÄÇ</p>
<ul>
<li><strong>Êó†ÁºìÂÜ≤Âå∫ÁöÑ<code>channel</code></strong></li>
</ul>
<p>ÂØπ‰∫éÊó†ÁºìÂÜ≤Âå∫ÁöÑ<code>channel</code>Êù•ËØ¥ÔºåËã•ÊúâÂÖ∂‰ªñÂçèÁ®ãÊ≠£Âú®ËØªÔºåÂ∞±ÂèØ‰ª•ÂèëÈÄÅÊï∞ÊçÆ„ÄÇËã•Êó†ÂÖ∂‰ªñÂçèÁ®ãÊ≠£Âú®ËØªÔºåÂ∞±‰ºöËøõÂÖ•<code>channel</code>ÁöÑÂèëÈÄÅÈòªÂ°ûÈòüÂàó„ÄÇ</p>
<ol start="2">
<li><strong>ÈùûÈòªÂ°ûÂºèÂÜô</strong>Ôºö<code>select case default</code></li>
</ol>
<p>Â¶ÇÊûúÂèëÁîüÈòªÂ°ûÁöÑÊÉÖÂÜµ ÔºåÂ∞±‰ºöÊâßË°å<code>default</code>ÂàÜÊîØ„ÄÇ</p>
<ol start="3">
<li><strong>ÈòªÂ°ûÂºèËØª</strong>Ôºö<code>&lt;-ch</code></li>
</ol>
<ul>
<li><strong>ÊúâÁºìÂÜ≤Âå∫ÁöÑ<code>channel</code></strong></li>
</ul>
<p>ÂØπ‰∫éÊúâÁºìÂÜ≤Âå∫ÁöÑ<code>channel</code>Êù•ËØ¥ÔºåËã•ÁºìÂÜ≤Âå∫‰∏≠ÊúâÊï∞ÊçÆÔºåÂ∞±ÂèØ‰ª•ÈÄöËøáËØªÊåáÈíàÂ∞ÜÊï∞ÊçÆËØªÂá∫„ÄÇËã•ÁºìÂÜ≤Âå∫‰∏∫Á©∫ÔºåÂ∞±‰ºöËøõÂÖ•<code>channel</code>ÁöÑÊé•Êî∂ÈòªÂ°ûÈòüÂàó„ÄÇ</p>
<ul>
<li><strong>Êó†ÁºìÂÜ≤Âå∫ÁöÑ<code>channel</code></strong></li>
</ul>
<p>ÂØπ‰∫éÊó†ÁºìÂÜ≤Âå∫ÁöÑ<code>channel</code>Êù•ËØ¥ÔºåËã•ÊúâÂÖ∂‰ªñÂçèÁ®ãÊ≠£Âú®ÂÜôÔºåÂ∞±ÂèØ‰ª•Êé•Êî∂Êï∞ÊçÆ„ÄÇËã•Êó†ÂÖ∂‰ªñÂçèÁ®ãÂèëÈÄÅÊï∞ÊçÆÊó∂ÔºåÂ∞±‰ºöËøõÂÖ•<code>channel</code>ÁöÑÊé•Êî∂ÈòªÂ°ûÈòüÂàó„ÄÇ</p>
<ol start="4">
<li><strong>ÈùûÈòªÂ°ûÂºèËØª</strong>Ôºö<code>select case default</code></li>
</ol>
<p>Â¶ÇÊûúÂèëÁîüÈòªÂ°ûÁöÑÊÉÖÂÜµÔºåÂ∞±‰ºöÊâßË°å<code>default</code>ÂàÜÊîØ„ÄÇ</p>
<blockquote>
<h4 id="ÈóÆÂ§öË∑Ø-select">ÈóÆÔºö<code>Â§öË∑Ø select</code>Ôºü</h4>
</blockquote>
<p>**Â§öË∑Ø<code>select</code>**ÊòØÊåáÂ≠òÂú®‰∏§‰∏™ÊàñÊõ¥Â§öÁöÑ<code>case</code>ÂàÜÊîØÔºåÊØè‰∏™ÂàÜÊîØÂèØ‰ª•ÊòØ‰∏Ä‰∏™<code>channel</code>ÁöÑ<code>send</code>Êàñ<code>recv</code>Êìç‰Ωú„ÄÇ</p>
<p><code>select</code>‰ºöÂ∞ÜÊâÄÊúâÁöÑ<code>channel</code>ËÆ∞ÂΩïÂà∞ÈìæË°®Ôºå<code>send channel</code>Âú®ÂâçÔºå<code>recv channel</code>Âú®Âêé„ÄÇÂΩì<code>select</code>ÂºÄÂßãÊâßË°åÊó∂Ôºö</p>
<ol>
<li><strong>ÊåâÂ∫èÂä†ÈîÅÔºö<strong>È¶ñÂÖàÔºå‰ºöÊåâÁÖß</strong>ÊúâÂ∫èÁöÑÂä†ÈîÅÈ°∫Â∫è</strong>ÂØπÊâÄÊúâÁöÑ<code>channel</code>ËøõË°åÂä†ÈîÅ„ÄÇËøôÊòØ‰∏∫‰∫Ü‰øùÈöú<code>channel</code>ÁöÑÂéüÂ≠êÊÄßÔºå<strong>ÊúâÂ∫èÊòØ‰∏∫‰∫ÜÈÅøÂÖçÊ≠ªÈîÅ</strong>Ôºõ</li>
<li><strong>‰π±Â∫èËΩÆËØ¢Ôºö<strong>ÁÑ∂Âêé‰ºöÊåâÁÖß</strong>‰π±Â∫èÁöÑËΩÆËØ¢È°∫Â∫è</strong>ÔºåÊ£ÄÊü•ÊâÄÊúâ<code>channel</code>ÁöÑÁ≠âÂæÖÈòüÂàóÂíåÁºìÂÜ≤Âå∫ÔºåÊù•Á°ÆÂÆöÊâßË°åÂì™‰∏™<code>case</code>ÂàÜÊîØ„ÄÇ<strong>‰π±Â∫èÊòØ‰∏∫‰∫Ü‰øùËØÅÂÖ¨Âπ≥ÊÄß</strong>„ÄÇ</li>
<li>**ÊåÇËµ∑Á≠âÂæÖÔºö**Â¶ÇÊûúËΩÆËØ¢ÂÆåÊØïÊ≤°ÊúâÂèëÁé∞ÂèØ‰ª•ÊâßË°åÁöÑ<code>case</code>ÂàÜÊîØÔºåÈÇ£‰πà‰ºöÂ∞Ü<code>goroutine</code>Ê∑ªÂä†Âà∞ÊâÄÊúâ<code>channel</code>ÁöÑÈòªÂ°ûÈòüÂàó‰∏≠ÔºåÁÑ∂ÂêéÊåÇËµ∑Á≠âÂæÖ„ÄÇ</li>
<li>**ÊåâÂ∫èËß£ÈîÅÔºö**ÊúÄÂêé‰ºöÊåâÂ∫èÂ∞ÜÊâÄÊúâ<code>channel</code>Ëß£ÈîÅ„ÄÇ</li>
<li>**Âî§ÈÜíÊâßË°åÔºö**ÂÅáÂ¶ÇÁé∞Âú®ÊúâÊï∞ÊçÆÂèØËØª/ÂÜô‰∫ÜÔºå<code>goroutine</code>Â∞±‰ºöË¢´Âî§ÈÜíÔºåÊâßË°åÁõ∏Â∫î<code>case</code>„ÄÇ</li>
<li><strong>Á¶ªÂºÄÈòüÂàóÔºö</strong><code>case</code>ÊâßË°åÂÆåÊØïÂêéÔºå‰ºöÂØπÊâÄÊúâ<code>channel</code>Âä†ÈîÅÔºåÂπ∂Â∞Ü<code>goroutine</code>‰ªéÊâÄÊúâÁöÑ<code>channel</code>ÁöÑÈòªÂ°ûÈòüÂàó‰∏≠Âà†Èô§„ÄÇ</li>
<li>**Ëß£ÈîÅËøîÂõûÔºö**ÁÑ∂ÂêéËß£ÈîÅÊâÄÊúâ<code>channel</code>Âπ∂ËøîÂõû„ÄÇ</li>
</ol>
<h2 id="39-ÂÜÖÂ≠ò">3.9 ÂÜÖÂ≠ò</h2>
<blockquote>
<h4 id="ÈóÆÂÜÖÂ≠òÈÄÉÈÄ∏">ÈóÆÔºöÂÜÖÂ≠òÈÄÉÈÄ∏Ôºü‚≠êüö©</h4>
</blockquote>
<p>ÁºñËØëÂô®‰ºöÊ†πÊçÆÂèòÈáè<strong>ÊòØÂê¶Ë¢´Â§ñÈÉ®ÂºïÁî®</strong>Êù•ÂÜ≥ÂÆöÊòØÂê¶ÈÄÉÈÄ∏Ôºö</p>
<ul>
<li>Â¶ÇÊûúÂáΩÊï∞Â§ñÈÉ®Ê≤°ÊúâÂºïÁî®ÔºåÂàô‰ºòÂÖàÊîæÂà∞Ê†à‰∏≠Ôºõ</li>
<li>Â¶ÇÊûúÂáΩÊï∞Â§ñÈÉ®Â≠òÂú®ÂºïÁî®ÔºåÂàôÂøÖÂÆöÊîæÂà∞Â†Ü‰∏≠Ôºõ</li>
<li>Â¶ÇÊûúÊ†à‰∏äÊîæ‰∏ç‰∏ãÔºåÂàôÂøÖÂÆöÊîæÂà∞Â†Ü‰∏äÔºõ</li>
</ul>
<p><strong>Ê°à‰æãÔºö</strong></p>
<ul>
<li>**ÊåáÈíàÈÄÉÈÄ∏Ôºö**ÂáΩÊï∞ËøîÂõûÂÄº‰∏∫Â±ÄÈÉ®ÂèòÈáèÁöÑÊåáÈíàÔºåÂáΩÊï∞ËôΩÁÑ∂ÈÄÄÂá∫‰∫ÜÔºå‰ΩÜÊòØÂõ†‰∏∫ÊåáÈíàÁöÑÂ≠òÂú®ÔºåÊåáÂêëÁöÑÂÜÖÂ≠ò‰∏çËÉΩÈöèÁùÄÂáΩÊï∞ÁªìÊùüËÄåÂõûÊî∂ÔºåÂõ†Ê≠§Âè™ËÉΩÂàÜÈÖçÂú®Â†Ü‰∏ä„ÄÇ</li>
<li>**Ê†àÁ©∫Èó¥‰∏çË∂≥Ôºö**ÂΩìÊ†àÁ©∫Èó¥Ë∂≥Â§üÊó∂Ôºå‰∏ç‰ºöÂèëÁîüÈÄÉÈÄ∏Ôºå‰ΩÜÊòØÂΩìÂèòÈáèËøáÂ§ßÊó∂ÔºåÂ∑≤ÁªèÂÆåÂÖ®Ë∂ÖËøáÊ†àÁ©∫Èó¥ÁöÑÂ§ßÂ∞èÊó∂ÔºåÂ∞Ü‰ºöÂèëÁîüÈÄÉÈÄ∏Âà∞Â†Ü‰∏äÂàÜÈÖçÂÜÖÂ≠ò„ÄÇÂ±ÄÈÉ®ÂèòÈáèsÂç†Áî®ÂÜÖÂ≠òËøáÂ§ßÔºåÁºñËØëÂô®‰ºöÂ∞ÜÂÖ∂ÂàÜÈÖçÂà∞Â†Ü‰∏äÔºõ</li>
<li>**ÂèòÈáèÂ§ßÂ∞è‰∏çÁ°ÆÂÆöÔºö**ÁºñËØëÊúüÈó¥Êó†Ê≥ïÁ°ÆÂÆösliceÁöÑÈïøÂ∫¶ÔºåËøôÁßçÊÉÖÂÜµ‰∏∫‰∫Ü‰øùËØÅÂÜÖÂ≠òÁöÑÂÆâÂÖ®ÔºåÁºñËØëÂô®‰πü‰ºöËß¶ÂèëÈÄÉÈÄ∏ÔºåÂú®Â†Ü‰∏äËøõË°åÂàÜÈÖçÂÜÖÂ≠òÔºõ</li>
<li>**Âä®ÊÄÅÁ±ªÂûãÔºö**Âä®ÊÄÅÁ±ªÂûãÂ∞±ÊòØÁºñËØëÊúüÈó¥‰∏çÁ°ÆÂÆöÂèÇÊï∞ÁöÑÁ±ªÂûã„ÄÅÂèÇÊï∞ÁöÑÈïøÂ∫¶‰πü‰∏çÁ°ÆÂÆöÁöÑÊÉÖÂÜµ‰∏ãÂ∞±‰ºöÂèëÁîüÈÄÉÈÄ∏Ôºõ</li>
<li>**Èó≠ÂåÖÂºïÁî®ÂØπË±°Ôºö**Èó≠ÂåÖÂáΩÊï∞‰∏≠Â±ÄÈÉ®ÂèòÈáèiÂú®ÂêéÁª≠ÂáΩÊï∞ÊòØÁªßÁª≠‰ΩøÁî®ÁöÑÔºåÁºñËØëÂô®Â∞ÜÂÖ∂ÂàÜÈÖçÂà∞Â†Ü‰∏äÔºõ</li>
<li><strong>ÂèçÂ∞ÑÔºö</strong><code>ValueOf</code>„ÄÇ</li>
</ul>
<blockquote>
<h4 id="ÈóÆmakeÂíånewÊúâÂï•Âå∫Âà´">ÈóÆÔºömakeÂíånewÊúâÂï•Âå∫Âà´Ôºü</h4>
</blockquote>
<ul>
<li>**‰∏§ËÄÖÁöÑ‰ΩúÁî®Á±ªÂûã‰∏çÂêåÔºö**newÁªô<code>int</code>„ÄÅ<code>string</code>„ÄÅÊï∞ÁªÑÂàÜÈÖçÂÜÖÂ≠òÔºåmakeÁªô<code>slice</code>„ÄÅ<code>map</code>„ÄÅ<code>channel</code>ÂàÜÈÖçÂÜÖÂ≠òÔºõ</li>
<li>**‰∏§ËÄÖÁöÑËøîÂõûÂÄº‰∏çÂêåÔºö**newÁöÑËøîÂõûÂÄºÁ±ªÂûã‰∏∫‰∏Ä‰∏™ÊåáÂêëÊñ∞ÂàÜÈÖçÂ•ΩÁöÑÂÜÖÂ≠òÁ©∫Èó¥ÁöÑ‰∏Ä‰∏™ÊåáÂÆöÁ±ªÂûãÊåáÈíà„ÄÇËÄåmakeÁöÑËøîÂõûÂÄºÁ±ªÂûã‰∏∫ÂÆÉÊú¨Ë∫´„ÄÇ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">hash</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="kt">bool</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>	<span class="c1">// hash ÊòØ‰∏Ä‰∏™ÊåáÂêë runtime.hmap ÁªìÊûÑ‰ΩìÁöÑÊåáÈíà
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">ch</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">int</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>			<span class="c1">// ch ÊòØ‰∏Ä‰∏™ÊåáÂêë runtime.hchan ÁªìÊûÑ‰ΩìÁöÑÊåáÈíà
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>newÂàÜÈÖçÁöÑÂÜÖÂ≠òÁ©∫Èó¥‰ºöË¢´Ê∏ÖÈõ∂ÔºåmakeÂàÜÈÖçÁ©∫Èó¥‰πãÂêé‰ºöË¢´ÂàùÂßãÂåñ„ÄÇ</li>
<li>newÂàÜÈÖçÁöÑÂÜÖÂ≠òÁ©∫Èó¥‰∏ç‰∏ÄÂÆö‰ºöÂú®Â†Ü‰∏äÂàÜÈÖçÔºåÊØîÂ¶ÇËØ¥ËØ•ÊåáÈíàÂ∞±Âú®Êú¨ÂáΩÊï∞ÂÜÖ‰ΩøÁî®„ÄÇ</li>
</ul>
<p><strong>Ëã•Áî®<code>ps := new([]string)</code>ÂàùÂßãÂåñÔºånew ÊòØ‰∏çË¥üË¥£Â∫ïÂ±ÇÊï∞ÁªÑÁöÑÂàÜÈÖçÁöÑÔºå‰ªÖ‰ªÖËøîÂõûsliceÁöÑËµ∑ÂßãÂú∞ÂùÄÔºåÊ≠§Êó∂Ëøô‰∏™sliceËøòÊ≤°ÊúâÂ∫ïÂ±ÇÊï∞ÁªÑÔºåÂ¶ÇÊûúÂØπÂÖ∂ËøõË°åËµãÂÄºÔºåÂ∞±‰ºöÂá∫Èîô„ÄÇ</strong></p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230405224743545.png" alt="image-20230405224743545" style="zoom:33%;" />
<p><strong>ÈúÄË¶ÅÈÄöËøáAppendËøõË°åÂàÜÈÖçÂ∫ïÂ±ÇÊï∞ÁªÑ„ÄÇ</strong></p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230405224814298.png" alt="image-20230405224814298" style="zoom:33%;" />
<blockquote>
<h4 id="ÈóÆ‰∏∫‰ªÄ‰πàË¶ÅÂÜÖÂ≠òÂØπÈΩê-1">ÈóÆÔºö‰∏∫‰ªÄ‰πàË¶ÅÂÜÖÂ≠òÂØπÈΩêÔºü</h4>
</blockquote>
<p>È¶ñÂÖàÔºåCPU ËÆøÈóÆÂÜÖÂ≠òÊó∂ÔºåÂπ∂‰∏çÊòØÈÄê‰∏™Â≠óËäÇËÆøÈóÆÔºåËÄåÊòØ‰ª•Â≠óÈïøÔºàword sizeÔºâ‰∏∫Âçï‰ΩçËÆøÈóÆ„ÄÇÊØîÂ¶Ç 32 ‰ΩçÁöÑ CPU ÔºåÂ≠óÈïø‰∏∫ 4 Â≠óËäÇÔºåÈÇ£‰πà <strong>CPU ËÆøÈóÆÂÜÖÂ≠òÁöÑÂçï‰Ωç‰πüÊòØ 4 Â≠óËäÇ</strong>„ÄÇ</p>
<p><strong>Êúâ‰∏§‰∏™ÁõÆÁöÑ</strong>Ôºö</p>
<ul>
<li><strong>ÂáèÂ∞ëËÆøÂ≠òÊ¨°Êï∞</strong>Ôºõ</li>
<li><strong>‰æø‰∫éÂéüÂ≠êÊÄßÊìç‰Ωú</strong>„ÄÇ</li>
</ul>
<p><strong>ÂáèÂ∞ë CPU ËÆøÈóÆÂÜÖÂ≠òÁöÑÊ¨°Êï∞ÔºåÂä†Â§ß CPU ËÆøÈóÆÂÜÖÂ≠òÁöÑÂêûÂêêÈáè</strong>„ÄÇÊØîÂ¶ÇÔºö</p>
<ul>
<li>ÂΩìÂÜÖÂ≠òÂØπÈΩêÊó∂ÔºåËØªÂèñ b Âè™ÈúÄË¶ÅËØªÂèñ‰∏ÄÊ¨°ÂÜÖÂ≠ò„ÄÇ</li>
<li>ÈùûÂÜÖÂ≠òÂØπÈΩêÊó∂ÔºåËØªÂèñ b ÈúÄË¶Å‰∏§Ê¨°ËÆøÂ≠ò([0, 3]Ôºå[4, 7]ÔºåÁÑ∂ÂêéÊãºÊé•Âá∫ b)Ôºö</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/memory_alignment.png" alt="memory alignment" style="zoom:50%;" />
<p><strong>ÂÜÖÂ≠òÂØπÈΩêÂØπÂÆûÁé∞ÂèòÈáèÁöÑÂéüÂ≠êÊÄßÊìç‰Ωú‰πüÊòØÊúâÂ•ΩÂ§ÑÁöÑ</strong>Ôºå<strong>ÊØèÊ¨°ÂÜÖÂ≠òËÆøÈóÆÊòØÂéüÂ≠êÁöÑ</strong>ÔºåÂ¶ÇÊûúÂèòÈáèÁöÑÂ§ßÂ∞è‰∏çË∂ÖËøáÂ≠óÈïøÔºåÈÇ£‰πà<strong>ÂÜÖÂ≠òÂØπÈΩêÂêéÔºåÂØπËØ•ÂèòÈáèÁöÑËÆøÈóÆÂ∞±ÊòØÂéüÂ≠êÁöÑ</strong>ÔºåËøô‰∏™ÁâπÊÄßÂú®Âπ∂ÂèëÂú∫ÊôØ‰∏ãËá≥ÂÖ≥ÈáçË¶Å„ÄÇ</p>
<blockquote>
<h4 id="ÈóÆÁªìÊûÑ‰ΩìÊòØÊÄé‰πàËøõË°åÂÜÖÂ≠òÂØπÈΩêÁöÑÊàêÂëòÁöÑÈ°∫Â∫è‰∏çÂêåÁªìÊûÑ‰ΩìÁöÑÂ§ßÂ∞è‰ºö‰∏çÂêåÂêó">ÈóÆÔºöÁªìÊûÑ‰ΩìÊòØÊÄé‰πàËøõË°åÂÜÖÂ≠òÂØπÈΩêÁöÑÔºüÊàêÂëòÁöÑÈ°∫Â∫è‰∏çÂêåÔºåÁªìÊûÑ‰ΩìÁöÑÂ§ßÂ∞è‰ºö‰∏çÂêåÂêóÔºü</h4>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">demo1</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">a</span> <span class="kt">int8</span>
</span></span><span class="line"><span class="cl">	<span class="nx">b</span> <span class="kt">int16</span>
</span></span><span class="line"><span class="cl">	<span class="nx">c</span> <span class="kt">int32</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">demo2</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">a</span> <span class="kt">int8</span>
</span></span><span class="line"><span class="cl">	<span class="nx">c</span> <span class="kt">int32</span>
</span></span><span class="line"><span class="cl">	<span class="nx">b</span> <span class="kt">int16</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">unsafe</span><span class="p">.</span><span class="nf">Sizeof</span><span class="p">(</span><span class="nx">demo1</span><span class="p">{}))</span> <span class="c1">// 8
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">unsafe</span><span class="p">.</span><span class="nf">Sizeof</span><span class="p">(</span><span class="nx">demo2</span><span class="p">{}))</span> <span class="c1">// 12
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>==<strong>ÁªìÊûÑ‰ΩìÂÜÖÂ≠òÂØπÈΩêËßÑÂàô</strong>==Ôºö</p>
<ul>
<li>ÊØè‰∏™Â≠óÊÆµÊåâÁÖßËá™Ë∫´ÁöÑÂØπÈΩêÂÄçÊï∞Êù•Á°ÆÂÆöÂú®ÂÜÖÂ≠ò‰∏≠ÁöÑÂÅèÁßªÈáèÔºåÂØπÈΩêÂÄçÊï∞ = <code>min(Ëá™Ë∫´ÁöÑÈïøÂ∫¶ÔºåÊú∫Âô®Â≠óÈïø)</code>Ôºõ</li>
<li>ÊéíÂàóÂÆåÊàêÂêéÔºåÈúÄË¶ÅÂØπÁªìÊûÑ‰ΩìÊï¥‰ΩìÂÜçËøõË°å‰∏ÄÊ¨°ÂÜÖÂ≠òÂØπÈΩê„ÄÇ</li>
<li>ÊàêÂëòÁöÑÈ°∫Â∫è‰∏çÂêåÔºåÁªìÊûÑ‰ΩìÁöÑÂ§ßÂ∞èÂèØËÉΩ‰∏çÂêåÔºåÂõ†Ê≠§ÁªìÊûÑ‰ΩìÁöÑÂÜÖÂ≠òÂØπÈΩêÊúâÊäÄÂ∑ß„ÄÇ</li>
</ul>
<p><strong>ÂàÜÊûê‰∏äÈù¢ÁöÑ‰ª£Á†ÅÁ§∫‰æã</strong>(Êú∫Âô®Â≠óÈïø 32 ‰Ωç)Ôºå<strong>È¶ñÂÖàÊòØ demo1</strong>Ôºö</p>
<ul>
<li>a ÊòØÁ¨¨‰∏Ä‰∏™Â≠óÊÆµÔºåÈªòËÆ§ÊòØÂ∑≤ÁªèÂØπÈΩêÁöÑÔºå‰ªéÁ¨¨ 0 ‰∏™‰ΩçÁΩÆÂºÄÂßãÂç†ÊçÆ 1 Â≠óËäÇ„ÄÇ</li>
<li>b ÊòØÁ¨¨‰∫å‰∏™Â≠óÊÆµÔºåÂØπÈΩêÂÄçÊï∞‰∏∫ 2ÔºåÂõ†Ê≠§ÔºåÂøÖÈ°ªÁ©∫Âá∫ 1 ‰∏™Â≠óËäÇÔºåÂÅèÁßªÈáèÊâçÊòØ 2 ÁöÑÂÄçÊï∞Ôºå‰ªéÁ¨¨ 2 ‰∏™‰ΩçÁΩÆÂºÄÂßãÂç†ÊçÆ 2 Â≠óËäÇ„ÄÇ</li>
<li>c ÊòØÁ¨¨‰∏â‰∏™Â≠óÊÆµÔºåÂØπÈΩêÂÄçÊï∞‰∏∫ 4ÔºåÊ≠§Êó∂ÔºåÂÜÖÂ≠òÂ∑≤ÁªèÊòØÂØπÈΩêÁöÑÔºå‰ªéÁ¨¨ 4 ‰∏™‰ΩçÁΩÆÂºÄÂßãÂç†ÊçÆ 4 Â≠óËäÇÂç≥ÂèØ„ÄÇ</li>
</ul>
<p>Âõ†Ê≠§ demo1 ÁöÑÂÜÖÂ≠òÂç†Áî®‰∏∫ <strong>8 Â≠óËäÇ</strong>„ÄÇ</p>
<p><strong>ÂÖ∂Ê¨°ÊòØ demo2</strong>Ôºö</p>
<ul>
<li>a ÊòØÁ¨¨‰∏Ä‰∏™Â≠óÊÆµÔºåÈªòËÆ§ÊòØÂ∑≤ÁªèÂØπÈΩêÁöÑÔºå‰ªéÁ¨¨ 0 ‰∏™‰ΩçÁΩÆÂºÄÂßãÂç†ÊçÆ 1 Â≠óËäÇ„ÄÇ</li>
<li>c ÊòØÁ¨¨‰∫å‰∏™Â≠óÊÆµÔºåÂØπÈΩêÂÄçÊï∞‰∏∫ 4ÔºåÂõ†Ê≠§ÔºåÂøÖÈ°ªÁ©∫Âá∫ 3 ‰∏™Â≠óËäÇÔºåÂÅèÁßªÈáèÊâçÊòØ 4 ÁöÑÂÄçÊï∞Ôºå‰ªéÁ¨¨ 4 ‰∏™‰ΩçÁΩÆÂºÄÂßãÂç†ÊçÆ 4 Â≠óËäÇ„ÄÇ</li>
<li>b ÊòØÁ¨¨‰∏â‰∏™Â≠óÊÆµÔºåÂØπÈΩêÂÄçÊï∞‰∏∫ 2Ôºå‰ªéÁ¨¨ 8 ‰∏™‰ΩçÁΩÆÂºÄÂßãÂç†ÊçÆ 2 Â≠óËäÇ„ÄÇ</li>
</ul>
<p><strong>demo2 ÁöÑÂØπÈΩêÂÄçÊï∞Áî± c ÁöÑÂØπÈΩêÂÄçÊï∞ÂÜ≥ÂÆö</strong>Ôºå‰πüÊòØ 4ÔºåÂõ†Ê≠§Ôºådemo2 ÁöÑÂÜÖÂ≠òÂç†Áî®‰∏∫ <strong>12 Â≠óËäÇ</strong>„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/memory_alignment_order.png" alt="memory alignment" style="zoom: 50%;" />
<p><strong>==È¢ùÂ§ñÁöÑÈóÆÈ¢ò==</strong>ÔºöÁ©∫ <code>struct{}</code> ÁöÑÂØπÈΩê</p>
<p><strong>Á©∫ <code>struct{}</code> Â§ßÂ∞è‰∏∫ 0</strong>Ôºå<strong>‰Ωú‰∏∫ÂÖ∂‰ªñ struct ÁöÑÂ≠óÊÆµÊó∂</strong>Ôºå<strong>‰∏ÄËà¨‰∏çÈúÄË¶ÅÂÜÖÂ≠òÂØπÈΩê</strong>„ÄÇ‰ΩÜÊòØ<strong>Êúâ‰∏ÄÁßçÊÉÖÂÜµÈô§Â§ñ</strong>ÔºöÂç≥<strong>ÂΩì <code>struct{}</code> ‰Ωú‰∏∫ÁªìÊûÑ‰ΩìÊúÄÂêé‰∏Ä‰∏™Â≠óÊÆµÊó∂ÔºåÈúÄË¶ÅÂÜÖÂ≠òÂØπÈΩê</strong>„ÄÇ<strong>Âõ†‰∏∫Â¶ÇÊûúÊúâÊåáÈíàÊåáÂêëËØ•Â≠óÊÆµÔºåËøîÂõûÁöÑÂú∞ÂùÄÂ∞ÜÂú®ÁªìÊûÑ‰Ωì‰πãÂ§ñ</strong>ÔºåÂ¶ÇÊûúÊ≠§ÊåáÈíà‰∏ÄÁõ¥Â≠òÊ¥ª‰∏çÈáäÊîæÂØπÂ∫îÁöÑÂÜÖÂ≠òÔºåÂ∞±‰ºöÊúâÂÜÖÂ≠òÊ≥ÑÈú≤ÁöÑÈóÆÈ¢òÔºàËØ•ÂÜÖÂ≠ò‰∏çÂõ†ÁªìÊûÑ‰ΩìÈáäÊîæËÄåÈáäÊîæÔºâ„ÄÇ</p>
<p>Âõ†Ê≠§ÔºåÂΩì <code>struct{}</code> ‰Ωú‰∏∫ÂÖ∂‰ªñ struct ÊúÄÂêé‰∏Ä‰∏™Â≠óÊÆµÊó∂ÔºåÈúÄË¶Å<strong>Â°´ÂÖÖÈ¢ùÂ§ñÁöÑÂÜÖÂ≠ò</strong>‰øùËØÅÂÆâÂÖ®„ÄÇÊàë‰ª¨ÂÅö‰∏™ËØïÈ™åÔºåÈ™åËØÅ‰∏ãËøôÁßçÊÉÖÂÜµ„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">demo3</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">c</span> <span class="kt">int32</span>
</span></span><span class="line"><span class="cl">	<span class="nx">a</span> <span class="kd">struct</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">demo4</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">a</span> <span class="kd">struct</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">c</span> <span class="kt">int32</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">unsafe</span><span class="p">.</span><span class="nf">Sizeof</span><span class="p">(</span><span class="nx">demo3</span><span class="p">{}))</span> <span class="c1">// 8
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">unsafe</span><span class="p">.</span><span class="nf">Sizeof</span><span class="p">(</span><span class="nx">demo4</span><span class="p">{}))</span> <span class="c1">// 4
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂèØ‰ª•ÁúãÂà∞Ôºå<code>demo4{}</code> ÁöÑÂ§ßÂ∞è‰∏∫ 4 Â≠óËäÇÔºå‰∏éÂ≠óÊÆµ c Âç†ÊçÆÁ©∫Èó¥‰∏ÄËá¥ÔºåËÄå <code>demo3{}</code> ÁöÑÂ§ßÂ∞è‰∏∫ 8 Â≠óËäÇÔºåÂç≥È¢ùÂ§ñÂ°´ÂÖÖ‰∫Ü 4 Â≠óËäÇÁöÑÁ©∫Èó¥„ÄÇ</p>
<p><strong>Âè¶</strong>ÔºåÊ≤°Êúâ‰ªª‰ΩïÂ≠óÊÆµÁöÑÁ©∫ struct{} ÂíåÊ≤°Êúâ‰ªª‰ΩïÂÖÉÁ¥†ÁöÑ array Âç†ÊçÆÁöÑÂÜÖÂ≠òÁ©∫Èó¥Â§ßÂ∞è‰∏∫ 0Ôºå<strong>‰∏çÂêåÁöÑÂ§ßÂ∞è‰∏∫ 0 ÁöÑÂèòÈáèÂèØËÉΩÊåáÂêëÂêå‰∏ÄÂùóÂú∞ÂùÄ</strong>„ÄÇ</p>
<h2 id="310-Êï∞ÊçÆÁªìÊûÑ">3.10 Êï∞ÊçÆÁªìÊûÑ</h2>
<blockquote>
<h4 id="ÈóÆmap-ÊòØÂπ∂ÂèëÂÆâÂÖ®ÁöÑÂêóÈÇ£ÊÄé‰πàËÆ©‰ªñÂπ∂ÂèëÂÆâÂÖ®ÈÇ£Âä†ÈîÅÁöÑ-map-Âíå-syncmap-ÊúâÂï•Âå∫Âà´syncmap-ÁöÑÈÄÇÁî®Âú∫ÊôØ">ÈóÆÔºömap ÊòØÂπ∂ÂèëÂÆâÂÖ®ÁöÑÂêóÔºüÈÇ£ÊÄé‰πàËÆ©‰ªñÂπ∂ÂèëÂÆâÂÖ®ÔºüÈÇ£Âä†ÈîÅÁöÑ map Âíå sync.map ÊúâÂï•Âå∫Âà´Ôºüsync.map ÁöÑÈÄÇÁî®Âú∫ÊôØÔºü‚≠êüö©</h4>
</blockquote>
<p>ÊôÆÈÄöÁöÑ<code>map</code>‰∏çÊòØÂπ∂ÂèëÂÆâÂÖ®ÁöÑÔºå<code>sync.map</code>ÊòØÂπ∂ÂèëÂÆâÂÖ®ÁöÑ„ÄÇ</p>
<hr>
<p>Â¶Ç‰ΩïËÆ©ÊôÆÈÄöÁöÑ<code>map</code>Âπ∂ÂèëÂÆâÂÖ®Ôºå‰∏ÄËà¨ÁöÑÊÄùË∑ØÊúâ‰∏§ÁßçÔºö</p>
<ul>
<li><strong>Âä†ÈîÅ</strong>ÔºåÊìç‰ΩúÂâçÂÖàËé∑ÂèñÈîÅÔºåÊìç‰ΩúÂÆåÈáäÊîæ„ÄÇÁº∫ÁÇπÊòØÔºöÁ≤íÂ∫¶Â§™Â§ßÔºåÊïàÁéá‰∏çÈ´òÔºõ</li>
<li><strong>ÂàíÂàÜÊàêÂá†‰∏™Â∞èÁöÑ <code>map</code></strong>ÔºåÂè™Êìç‰ΩúÁõ∏Â∫îÂ∞èÁöÑ <code>map</code>„ÄÇÁº∫ÁÇπÊòØÔºöÂÆûÁé∞Â§çÊùÇÔºåÂÆπÊòìÂá∫Èîô„ÄÇ</li>
</ul>
<hr>
<p>ÂÖàÁúãÁúã<code>sync.map</code>Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Map</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">mu</span> <span class="nx">Mutex</span>						<span class="c1">// ‰øùÊä§ dirty Âíå read
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">read</span> <span class="nx">atomic</span><span class="p">.</span><span class="nx">Value</span> 				<span class="c1">// readOnlyÔºåÂè™ËØªÔºåÊâÄ‰ª•ÊòØÂπ∂ÂèëÂÆâÂÖ®ÁöÑ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">dirty</span> <span class="kd">map</span><span class="p">[</span><span class="kd">interface</span><span class="p">{}]</span><span class="o">*</span><span class="nx">entry</span>	<span class="c1">// ‰∏Ä‰∏™ÈùûÁ∫øÁ®ãÂÆâÂÖ®ÁöÑÂéüÂßã map
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">misses</span> <span class="kt">int</span>						<span class="c1">// ËÆ°Êï∞‰ΩúÁî®„ÄÇÊØèÊ¨°‰ªéread‰∏≠ËØªÂ§±Ë¥•ÔºåÂàôËÆ°Êï∞+1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>map+ÈîÅ Âíå sync.map ÁöÑÂØπÊØî</strong>Ôºö</p>
<ul>
<li>Ëá™Â∑±ÂÆûÁé∞ÁöÑÂä†ÈîÅÁöÑMapÔºåÊØèÊ¨°Êìç‰ΩúÈÉΩÈúÄË¶ÅÂÖàËé∑ÂæóÈîÅÔºåËøôÂ∞±ÈÄ†ÊàêÊûÅÂ§ßÁöÑÊÄßËÉΩÊµ™Ë¥πÔºõ</li>
<li><code>sync.map</code>‰∏≠Êúâ<strong>Âè™ËØªÊï∞ÊçÆ<code>read</code>„ÄÅÈîÅ<code>mu</code>„ÄÅÊôÆÈÄöÁöÑMap<code>dirty</code>„ÄÅËÆ°Êï∞Âô®<code>misses</code></strong>„ÄÇÂÖ∂‰∏≠ÔºåÊâßË°åÂ¢ûÂà†Êü•ÊîπÂâçÔºåÈÉΩ‰ºöÂÖàÂØπ<code>read</code>ËøõË°åÊìç‰ΩúÔºåÂõ†‰∏∫ËøôÊòØÂè™ËØªÁöÑÔºåÊîØÊåÅÂéüÂ≠êÊìç‰ΩúÔºå‰πüÂ∞±ÊîØÊåÅÂπ∂ÂèëËÆøÈóÆ„ÄÇËøôÂ∞±‰ºö<strong>ÁúÅÂéªÂæàÂ§ß‰∏ÄÈÉ®ÂàÜÂä†ÈîÅËß£ÈîÅÂ∏¶Êù•ÁöÑÂºÄÈîÄ</strong>„ÄÇ</li>
</ul>
<p><strong>ÊÄßËÉΩÊµãËØïÁªìËÆ∫</strong>Ôºö</p>
<ul>
<li><strong>ÊèíÂÖ•ÂÖÉÁ¥†</strong>ÔºöSyncMapStore &lt; MapStore &lt; RwMapStoreÔºõ</li>
<li><strong>Êü•ÊâæÂÖÉÁ¥†</strong>ÔºöMapLookup &lt; RwMapLookup &lt; SyncMapLookupÔºõ</li>
<li><strong>Âà†Èô§ÂÖÉÁ¥†</strong>ÔºöRwMapDelete &lt; MapDelete &lt; SyncMapDelete</li>
</ul>
<p><strong>ÊµãËØïÂ¶Ç‰∏ã</strong>Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="err">‚ùØ</span> <span class="k">go</span> <span class="nx">test</span> <span class="o">-</span><span class="nx">bench</span><span class="p">=.</span>
</span></span><span class="line"><span class="cl"><span class="nx">goos</span><span class="p">:</span> <span class="nx">windows</span>
</span></span><span class="line"><span class="cl"><span class="nx">goarch</span><span class="p">:</span> <span class="nx">amd64</span>
</span></span><span class="line"><span class="cl"><span class="nx">pkg</span><span class="p">:</span> <span class="nx">goLearn</span><span class="o">/</span><span class="nx">sync</span><span class="o">/</span><span class="mi">08</span><span class="o">-</span><span class="nx">sync</span><span class="p">.</span><span class="kd">map</span>
</span></span><span class="line"><span class="cl"><span class="nx">cpu</span><span class="p">:</span> <span class="mi">12</span><span class="nx">th</span> <span class="nx">Gen</span> <span class="nf">Intel</span><span class="p">(</span><span class="nx">R</span><span class="p">)</span> <span class="nf">Core</span><span class="p">(</span><span class="nx">TM</span><span class="p">)</span> <span class="nx">i7</span><span class="o">-</span><span class="mi">12700</span><span class="nx">K</span>
</span></span><span class="line"><span class="cl"><span class="nx">BenchmarkBuiltinMapStoreParalell</span><span class="o">-</span><span class="mi">20</span>             <span class="mi">15114511</span>                <span class="mf">81.30</span> <span class="nx">ns</span><span class="o">/</span><span class="nx">op</span>
</span></span><span class="line"><span class="cl"><span class="nx">BenchmarkBuiltinRwMapStoreParalell</span><span class="o">-</span><span class="mi">20</span>           <span class="mi">16176103</span>                <span class="mf">83.39</span> <span class="nx">ns</span><span class="o">/</span><span class="nx">op</span>
</span></span><span class="line"><span class="cl"><span class="nx">BenchmarkSyncMapStoreParalell</span><span class="o">-</span><span class="mi">20</span>                 <span class="mi">8515656</span>               <span class="mf">171.0</span> <span class="nx">ns</span><span class="o">/</span><span class="nx">op</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">BenchmarkBuiltinMapLookupParalell</span><span class="o">-</span><span class="mi">20</span>            <span class="mi">21025113</span>                <span class="mf">61.02</span> <span class="nx">ns</span><span class="o">/</span><span class="nx">op</span>
</span></span><span class="line"><span class="cl"><span class="nx">BenchmarkBuiltinRwMapLookupParalell</span><span class="o">-</span><span class="mi">20</span>          <span class="mi">26539101</span>                <span class="mf">45.61</span> <span class="nx">ns</span><span class="o">/</span><span class="nx">op</span>
</span></span><span class="line"><span class="cl"><span class="nx">BenchmarkSyncMapLookupParalell</span><span class="o">-</span><span class="mi">20</span>               <span class="mi">285766286</span>                <span class="mf">4.159</span> <span class="nx">ns</span><span class="o">/</span><span class="nx">op</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">BenchmarkBuiltinMapDeleteParalell</span><span class="o">-</span><span class="mi">20</span>            <span class="mi">20315636</span>                <span class="mf">60.36</span> <span class="nx">ns</span><span class="o">/</span><span class="nx">op</span>
</span></span><span class="line"><span class="cl"><span class="nx">BenchmarkBuiltinRwMapDeleteParalell</span><span class="o">-</span><span class="mi">20</span>          <span class="mi">18308758</span>                <span class="mf">69.12</span> <span class="nx">ns</span><span class="o">/</span><span class="nx">op</span>
</span></span><span class="line"><span class="cl"><span class="nx">BenchmarkSyncMapDeleteParalell</span><span class="o">-</span><span class="mi">20</span>               <span class="mi">296166151</span>                <span class="mf">4.112</span> <span class="nx">ns</span><span class="o">/</span><span class="nx">op</span>
</span></span><span class="line"><span class="cl"><span class="nx">PASS</span>
</span></span><span class="line"><span class="cl"><span class="nx">ok</span>      <span class="nx">goLearn</span><span class="o">/</span><span class="nx">sync</span><span class="o">/</span><span class="mi">08</span><span class="o">-</span><span class="nx">sync</span><span class="p">.</span><span class="kd">map</span>        <span class="mf">13.145</span><span class="nx">s</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Âú∫ÊôØÂàÜÊûê</strong>Ôºö</p>
<ul>
<li><code>sync.map</code>ÁöÑËØªÂíåÂà†ÔºåÊÄßËÉΩÈùûÂ∏∏Â•ΩÔºåÈ¢ÜÂÖà map+ÈîÅÔºõ</li>
<li>ÂÜôÔºåÊÄßËÉΩÈùûÂ∏∏Â∑ÆÔºåËêΩÂêé‰∫é map+ÈîÅ„ÄÇ</li>
</ul>
<p><strong><code>sync.map</code>ÁöÑÈÄÇÁî®Âú∫ÊôØÔºöÂ§ßÈáèËØªÔºåÂ∞ëÈáèÂÜô</strong>„ÄÇËøôÊòØÂõ†‰∏∫Ôºå<strong>sync.map</strong>Êú¨Ë¥®‰∏äÊòØÂà©Áî®‰∫Ü**==ËØªÂÜôÂàÜÁ¶ª==<strong>ÔºåÂ¶ÇÊûúÊòØ</strong>Â§ßÈáèÂÜô<strong>ÁöÑÂú∫ÊôØÔºå‰ºöÂØºËá¥<code>missess</code>‰∏ÄÁõ¥Â¢ûÂä†Ôºå‰πüÂ∞±‰ºö</strong>‰∏ÄÁõ¥Ëß¶Âèë<code>dirty</code>ÊôãÂçá‰∏∫<code>read</code><strong>ÔºåÂØºËá¥ÊÄßËÉΩ</strong>ÂèçËÄå‰∏çÂ¶ÇÊôÆÈÄöÁöÑMap+ÈîÅ**„ÄÇ</p>
<hr>
<p><strong>ÊÄùÁª¥ÂèëÊï£Ôºö</strong></p>
<p>ÂèØ‰ª•ÂØπÂ§ßMapËøõ‰∏ÄÊ≠•ÂàíÂàÜÔºåÂàÜÊàêÂæàÂ§ö‰∏™Â∞èMapÔºåÂçïÁã¨ÂØπÊØèÈÉ®ÂàÜÂä†ÈîÅËß£ÈîÅÔºå‰πüÂ∞±ÊòØÁªÜÂåñÈîÅÁöÑÁ≤íÂ∫¶„ÄÇÂè™ÊòØÂÆûÁé∞Ëµ∑Êù•Â§™È∫ªÁÉ¶‰∫Ü„ÄÇ</p>
<blockquote>
<h4 id="ÈóÆmap‰∏≠keyÂèØ‰ª•‰∏∫nilÂêó">ÈóÆÔºömap‰∏≠ÔºåkeyÂèØ‰ª•‰∏∫nilÂêóÔºü‚≠êüö©</h4>
</blockquote>
<p>ÈúÄË¶ÅÂàÜÊÉÖÂÜµËÆ®ËÆ∫„ÄÇ</p>
<ul>
<li><code>nil</code>ÊòØ<code>interface{}</code>„ÄÅ<code>chan</code>„ÄÅ<code>map</code>Á≠âÁ±ªÂûãÁöÑ<strong>Èõ∂ÂÄº</strong>„ÄÇÂõ†Ê≠§ÔºåÂ¶ÇÊûúmapÁöÑkeyÁöÑÁ±ªÂûãÊòØ<code>interface{}</code>ÔºåÈÇ£‰πàkeyÂèØ‰ª•‰∏∫nilÔºåÂ∞±Ë∑üÁ©∫Êé•Âè£ÊïàÊûú‰∏ÄÊ†∑Ôºõ</li>
<li>Â¶ÇÊûúÊòØÂÖ∂‰ªñÁ±ªÂûãÔºånilÊòØËÇØÂÆö‰∏çË°åÁöÑÔºå‰ΩÜÊòØÂØπÂ∫îÁ±ªÂûãÁöÑÈõ∂ÂÄºÊòØokÁöÑ„ÄÇ</li>
</ul>
<blockquote>
<h4 id="ÈóÆmap‰∏≠func-ÂèØ‰ª•ÂÅökeyÂêó‰ªÄ‰πàÁ±ªÂûãËÉΩÂÅö‰∏∫‰ªÄ‰πà">ÈóÆÔºömap‰∏≠Ôºåfunc ÂèØ‰ª•ÂÅökeyÂêóÔºü‰ªÄ‰πàÁ±ªÂûãËÉΩÂÅöÔºü‰∏∫‰ªÄ‰πàÔºü‚≠êüö©</h4>
</blockquote>
<p>**‰∏çÂèØ‰ª•„ÄÇ**ÂøÖÈ°ªÊòØÂèØÊØîËæÉÁ±ªÂûãÊâçËÉΩÂÅökey„ÄÇÈÇ£‰∏∫‰ªÄ‰πàË¶ÅÂèØÊØîËæÉÁöÑÁ±ªÂûãÊâçËÉΩÂÅökeyÂë¢Ôºü‰∏çÊòØÁõ¥Êé•ÈÄöËøá top 8 ‰ΩçÂ∞±ËÉΩÊãøÂà∞ÂêóÔºü</p>
<p>Âõ†‰∏∫Êü•Êâæ key ÁöÑËøáÁ®ãÊòØËøôÊ†∑ÁöÑÔºöÂΩìÂá∫Áé∞ÂìàÂ∏åÂÜ≤Á™ÅÔºåÂ∞±‰ºöÂà∞Âêå‰∏Ä‰∏™Ê°∂‰∏≠ÂØªÊâæÔºåÈÄöËøá top 8 ‰ΩçÊâæÂà∞ÂØπÂ∫îÁöÑ key&rsquo;ÔºåÁî® key&rsquo; Âíå key ËøõË°å<strong>ÂØπÊØî</strong>ÔºåÂ¶ÇÊûú‰∏ÄÊ†∑ÔºåÂ∞±ÂèØ‰ª•ÊãøÂà∞ÂØπÂ∫îÁöÑ value„ÄÇ</p>
<p>Âõ†‰∏∫ËøòÈúÄË¶Å‰∏ÄÊ¨° <strong>ÂØπÊØî</strong>ÔºÅÊâÄ‰ª•ÂΩìÁÑ∂Ë¶ÅÂèØÊØîËæÉ„ÄÇ„ÄÇ„ÄÇ</p>
<blockquote>
<h4 id="ÈóÆbyte-Âíå-string-ÊÄé‰πàËΩ¨Êç¢ÊÄßËÉΩÂéüÁêÜÂêÑËá™ÁöÑÈÄÇÁî®Âú∫ÊôØ">ÈóÆÔºö[]byte{} Âíå string ÊÄé‰πàËΩ¨Êç¢ÔºüÊÄßËÉΩÔºüÂéüÁêÜÔºüÂêÑËá™ÁöÑÈÄÇÁî®Âú∫ÊôØÔºü‚≠êüö©</h4>
</blockquote>
<p>ÂÖ±‰∏§ÁßçÊñπÊ≥ïÔºö</p>
<ul>
<li><strong>Ê†áÂáÜËΩ¨Êç¢</strong></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">s1</span> <span class="o">:=</span> <span class="s">&#34;hello&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nx">b</span> <span class="o">:=</span> <span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">s1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">s2</span> <span class="o">:=</span> <span class="nb">string</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>Âº∫Âà∂ËΩ¨Êç¢</strong></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">String2Bytes</span><span class="p">(</span><span class="nx">s</span> <span class="kt">string</span><span class="p">)</span> <span class="p">[]</span><span class="kt">byte</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">sh</span> <span class="o">:=</span> <span class="p">(</span><span class="o">*</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">StringHeader</span><span class="p">)(</span><span class="nx">unsafe</span><span class="p">.</span><span class="nf">Pointer</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">s</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="nx">bh</span> <span class="o">:=</span> <span class="nx">reflect</span><span class="p">.</span><span class="nx">SliceHeader</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Data</span><span class="p">:</span> <span class="nx">sh</span><span class="p">.</span><span class="nx">Data</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Len</span><span class="p">:</span>  <span class="nx">sh</span><span class="p">.</span><span class="nx">Len</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Cap</span><span class="p">:</span>  <span class="nx">sh</span><span class="p">.</span><span class="nx">Len</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="p">[]</span><span class="kt">byte</span><span class="p">)(</span><span class="nx">unsafe</span><span class="p">.</span><span class="nf">Pointer</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">bh</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">Bytes2String</span><span class="p">(</span><span class="nx">b</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="kt">string</span><span class="p">)(</span><span class="nx">unsafe</span><span class="p">.</span><span class="nf">Pointer</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">b</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Âº∫ËΩ¨Êç¢ÊñπÂºèÁöÑÊÄßËÉΩ‰ºöÊòéÊòæ‰ºò‰∫éÊ†áÂáÜËΩ¨Êç¢„ÄÇ</strong></p>
<p>==<strong>ÂèØ‰ª•Âª∂‰º∏Â¶Ç‰∏ãÈóÆÈ¢ò</strong>==Ôºö</p>
<ul>
<li><strong>‰∏∫Âï•Âº∫ËΩ¨Êç¢ÊÄßËÉΩ‰ºöÊØîÊ†áÂáÜËΩ¨Êç¢Â•ΩÔºü</strong></li>
</ul>
<p>ÂØπ‰∫éÊ†áÂáÜËΩ¨Êç¢ÔºåÊó†ËÆ∫ÊòØ‰ªé[]byteËΩ¨stringËøòÊòØstringËΩ¨[]byteÈÉΩ‰ºöÊ∂âÂèäÂ∫ïÂ±ÇÊï∞ÁªÑÁöÑÊã∑Ë¥ù„ÄÇËÄåÂº∫ËΩ¨Êç¢ÊòØÁõ¥Êé•ÊõøÊç¢ÊåáÈíàÁöÑÊåáÂêëÔºå‰ªéËÄå‰ΩøÂæóstringÂíå[]byteÊåáÂêëÂêå‰∏Ä‰∏™Â∫ïÂ±ÇÊï∞ÁªÑ„ÄÇËøôÊ†∑ÔºåÂΩìÁÑ∂ÂêéËÄÖÁöÑÊÄßËÉΩ‰ºöÊõ¥Â•Ω„ÄÇ</p>
<ul>
<li><strong>‰∏∫Âï•ÂΩìxÁöÑÊï∞ÊçÆËæÉÂ§ßÊó∂ÔºåÊ†áÂáÜËΩ¨Êç¢ÊñπÂºè‰ºöÊúâ‰∏ÄÊ¨°ÂàÜÈÖçÂÜÖÂ≠òÁöÑÊìç‰ΩúÔºå‰ªéËÄåÂØºËá¥ÂÖ∂ÊÄßËÉΩÊõ¥Â∑ÆÔºåËÄåÂº∫ËΩ¨Êç¢ÊñπÂºèÂç¥‰∏çÂèóÂΩ±ÂìçÔºü</strong></li>
</ul>
<p>Ê†áÂáÜËΩ¨Êç¢Êó∂ÔºåÂΩìÊï∞ÊçÆÈïøÂ∫¶Â§ß‰∫é32‰∏™Â≠óËäÇÊó∂ÔºåÈúÄË¶ÅÈÄöËøámallocgcÁî≥ËØ∑Êñ∞ÁöÑÂÜÖÂ≠òÔºå‰πãÂêéÂÜçËøõË°åÊï∞ÊçÆÊã∑Ë¥ùÂ∑•‰Ωú„ÄÇËÄåÂº∫ËΩ¨Êç¢Âè™ÊòØÊõ¥ÊîπÊåáÈíàÊåáÂêë„ÄÇÊâÄ‰ª•ÔºåÂΩìËΩ¨Êç¢Êï∞ÊçÆËæÉÂ§ßÊó∂Ôºå‰∏§ËÄÖÊÄßËÉΩÂ∑ÆË∑ù‰ºöÊÑàÂä†ÊòéÊòæ„ÄÇ</p>
<ul>
<li><strong>Êó¢ÁÑ∂Âº∫ËΩ¨Êç¢ÊñπÂºèÊÄßËÉΩËøô‰πàÂ•ΩÔºå‰∏∫Âï•goÊèê‰æõÁªôÊàë‰ª¨‰ΩøÁî®ÁöÑÊòØÊ†áÂáÜËΩ¨Êç¢ÊñπÂºèÔºü</strong></li>
</ul>
<p>È¶ñÂÖàÔºåÊàë‰ª¨ÈúÄË¶ÅÁü•ÈÅìGoÊòØ‰∏ÄÈó®Á±ªÂûãÂÆâÂÖ®ÁöÑËØ≠Ë®ÄÔºåËÄåÂÆâÂÖ®ÁöÑ‰ª£‰ª∑Â∞±ÊòØÊÄßËÉΩÁöÑÂ¶•Âçè„ÄÇ‰ΩÜÊòØÔºåÊÄßËÉΩÁöÑÂØπÊØîÊòØÁõ∏ÂØπÁöÑÔºåËøôÁÇπÊÄßËÉΩÁöÑÂ¶•ÂçèÂØπ‰∫éÁé∞Âú®ÁöÑÊú∫Âô®ËÄåË®ÄÂæÆ‰πéÂÖ∂ÂæÆ„ÄÇÂè¶Â§ñÂº∫ËΩ¨Êç¢ÁöÑÊñπÂºèÔºå‰ºöÁªôÊàë‰ª¨ÁöÑÁ®ãÂ∫èÂ∏¶Êù•ÊûÅÂ§ßÁöÑÂÆâÂÖ®ÈöêÊÇ£„ÄÇ<strong>Â¶Ç‰∏ã‰ª£Á†Å‰ºöÁõ¥Êé•Êä•Èîô</strong>Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">s</span> <span class="o">:=</span> <span class="s">&#34;hello&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="nx">b</span> <span class="o">:=</span> <span class="nf">String2Bytes</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">=</span> <span class="sc">&#39;l&#39;</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">unexpected</span> <span class="nx">fault</span> <span class="nx">address</span> <span class="mh">0x6c47f8</span>
</span></span><span class="line"><span class="cl"><span class="nx">fatal</span> <span class="kt">error</span><span class="p">:</span> <span class="nx">fault</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="nx">signal</span> <span class="mh">0xc0000005</span> <span class="nx">code</span><span class="p">=</span><span class="mh">0x1</span> <span class="nx">addr</span><span class="p">=</span><span class="mh">0x6c47f8</span> <span class="nx">pc</span><span class="p">=</span><span class="mh">0x6ab5aa</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>sÊòØstringÁ±ªÂûãÔºåÊòØ‰∏çÂèØ‰øÆÊîπÁöÑ</strong>„ÄÇÈÄöËøáÂº∫ËΩ¨Êç¢Â∞ÜsÁöÑÂ∫ïÂ±ÇÊï∞ÁªÑËµãÁªôbÔºåËÄåbÊòØ‰∏Ä‰∏™[]byteÁ±ªÂûãÔºåÂÆÉÁöÑÂÄºÊòØÂèØ‰ª•‰øÆÊîπÁöÑÔºåÊâÄ‰ª•ËøôÊó∂ÂØπÂ∫ïÂ±ÇÊï∞ÁªÑÁöÑÂÄºËøõË°å‰øÆÊîπÔºåÂ∞Ü‰ºöÈÄ†Êàê‰∏•ÈáçÁöÑÈîôËØØÔºàÈÄöËøádefer+recover‰πü‰∏çËÉΩÊçïËé∑Ôºâ„ÄÇ</p>
<ul>
<li><strong>string‰∏∫Âï•Ë¶ÅËÆæËÆ°Êàê‰∏çÂèØ‰øÆÊîπÁöÑÔºü</strong></li>
</ul>
<p>string‰∏çÂèØ‰øÆÊîπÔºåÊÑèÂë≥ÂÆÉÊòØÂè™ËØªÂ±ûÊÄßÔºåËøôÊ†∑ÁöÑÂ•ΩÂ§ÑÂ∞±ÊòØÔºöÂú®Âπ∂ÂèëÂú∫ÊôØ‰∏ãÔºåÊàë‰ª¨ÂèØ‰ª•Âú®‰∏çÂä†ÈîÅÁöÑÊéßÂà∂‰∏ãÔºåÂ§öÊ¨°‰ΩøÁî®Âêå‰∏ÄÂ≠óÁ¨¶‰∏≤ÔºåÂú®‰øùËØÅÈ´òÊïàÂÖ±‰∫´ÁöÑÊÉÖÂÜµ‰∏ãËÄå‰∏çÁî®ÊãÖÂøÉÂÆâÂÖ®ÈóÆÈ¢ò„ÄÇ</p>
<p><strong>Âõ†Ê≠§ÔºåÂØπ‰∫éËøô‰∏§ÁßçÊñπÊ≥ïÁöÑÈÄÇÁî®Âú∫ÊôØÔºåÊúâÂ¶Ç‰∏ãÂèÇËÄÉ</strong>Ôºö</p>
<ol>
<li>Âú®‰Ω†‰∏çÁ°ÆÂÆöÂÆâÂÖ®ÈöêÊÇ£ÁöÑÊù°‰ª∂‰∏ãÔºåÂ∞ΩÈáèÈááÁî®<strong>Ê†áÂáÜÊñπÂºèËøõË°åÊï∞ÊçÆËΩ¨Êç¢</strong>„ÄÇ</li>
<li>ÂΩì<strong>Á®ãÂ∫èÂØπËøêË°åÊÄßËÉΩÊúâÈ´òË¶ÅÊ±Ç</strong>ÔºåÂêåÊó∂Êª°Ë∂≥ÂØπÊï∞ÊçÆ<strong>‰ªÖ‰ªÖÂè™ÊúâËØªÊìç‰Ωú</strong>ÁöÑÊù°‰ª∂Ôºå‰∏î<strong>Â≠òÂú®È¢ëÁπÅËΩ¨Êç¢Ôºà‰æãÂ¶ÇÊ∂àÊÅØËΩ¨ÂèëÂú∫ÊôØÔºâ</strong>ÔºåÂèØ‰ª•‰ΩøÁî®<strong>Âº∫ËΩ¨Êç¢</strong>„ÄÇ</li>
</ol>
<blockquote>
<h4 id="ÈóÆ‰∏§ÁßçÊñπÊ≥ïÁöÑËΩ¨Êç¢ÂéüÁêÜ">ÈóÆÔºö‰∏§ÁßçÊñπÊ≥ïÁöÑËΩ¨Êç¢ÂéüÁêÜÔºü</h4>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// slice ÁöÑÂ∫ïÂ±ÇÊï∞ÊçÆÁªìÊûÑ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">slice</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">array</span> <span class="nx">unsafe</span><span class="p">.</span><span class="nx">Pointer</span>	<span class="c1">// ÊåáÂêëÁöÑÊòØÊüê‰∏™Êï∞ÁªÑÁöÑÈ¶ñÂú∞ÂùÄ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">len</span>   <span class="kt">int</span>
</span></span><span class="line"><span class="cl">	<span class="nx">cap</span>   <span class="kt">int</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// string ÁöÑÂ∫ïÂ±ÇÊï∞ÊçÆÁªìÊûÑ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">stringStruct</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">str</span> <span class="nx">unsafe</span><span class="p">.</span><span class="nx">Pointer</span>	  <span class="c1">// ÊåáÂêëÁöÑÊòØÊüê‰∏™Êï∞ÁªÑÁöÑÈ¶ñÂú∞ÂùÄ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">len</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li><strong>Ê†áÂáÜËΩ¨Êç¢</strong></li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">const</span> <span class="nx">tmpStringBufSize</span> <span class="p">=</span> <span class="mi">32</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">tmpBuf</span> <span class="p">[</span><span class="nx">tmpStringBufSize</span><span class="p">]</span><span class="kt">byte</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">stringtoslicebyte</span><span class="p">(</span><span class="nx">buf</span> <span class="o">*</span><span class="nx">tmpBuf</span><span class="p">,</span> <span class="nx">s</span> <span class="kt">string</span><span class="p">)</span> <span class="p">[]</span><span class="kt">byte</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">b</span> <span class="p">[]</span><span class="kt">byte</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">buf</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="o">&amp;&amp;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">buf</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="o">*</span><span class="nx">buf</span> <span class="p">=</span> <span class="nx">tmpBuf</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">		<span class="nx">b</span> <span class="p">=</span> <span class="nx">buf</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="nx">s</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">b</span> <span class="p">=</span> <span class="nf">rawbyteslice</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">s</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nb">copy</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span> <span class="nx">s</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">b</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// rawbyteslice allocates a new byte slice. The byte slice is not zeroed.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">rawbyteslice</span><span class="p">(</span><span class="nx">size</span> <span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="nx">b</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">cap</span> <span class="o">:=</span> <span class="nf">roundupsize</span><span class="p">(</span><span class="nb">uintptr</span><span class="p">(</span><span class="nx">size</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="nx">p</span> <span class="o">:=</span> <span class="nf">mallocgc</span><span class="p">(</span><span class="nx">cap</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">cap</span> <span class="o">!=</span> <span class="nb">uintptr</span><span class="p">(</span><span class="nx">size</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nf">memclrNoHeapPointers</span><span class="p">(</span><span class="nf">add</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="nb">uintptr</span><span class="p">(</span><span class="nx">size</span><span class="p">)),</span> <span class="nx">cap</span><span class="o">-</span><span class="nb">uintptr</span><span class="p">(</span><span class="nx">size</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="nx">slice</span><span class="p">)(</span><span class="nx">unsafe</span><span class="p">.</span><span class="nf">Pointer</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">b</span><span class="p">))</span> <span class="p">=</span> <span class="nx">slice</span><span class="p">{</span><span class="nx">p</span><span class="p">,</span> <span class="nx">size</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="nx">cap</span><span class="p">)}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>go ÈúÄË¶ÅË∞ÉÁî® mallocgc ÂàÜÈÖç‰∏ÄÂùóÊñ∞ÁöÑÂÜÖÂ≠òÔºàÂ§ßÂ∞èÁî±sÂÜ≥ÂÆöÔºâÔºåÁÑ∂ÂêéËøõË°åÊã∑Ë¥ù„ÄÇ</p>
<ol start="2">
<li><strong>Âº∫Âà∂ËΩ¨Êç¢</strong></li>
</ol>
<p>ÈúÄË¶Å‰ªé‰∏§ÊñπÈù¢ËøõË°åËÆ®ËÆ∫Ôºö</p>
<ul>
<li><strong>‰∏áËÉΩÁöÑ <code>unsafe.Pointer</code> ÊåáÈíà</strong></li>
</ul>
<p>Âú® go ‰∏≠Ôºå<strong>‰ªª‰ΩïÁ±ªÂûãÁöÑÊåáÈíà <code>*T</code> ÈÉΩÂèØ‰ª•ËΩ¨Êç¢‰∏∫ <code>unsafe.Pointer</code> Á±ªÂûãÁöÑÊåáÈíà</strong>ÔºåÂÆÉÂèØ‰ª•Â≠òÂÇ®‰ªª‰ΩïÂèòÈáèÁöÑÂú∞ÂùÄ„ÄÇÂêåÊó∂Ôºå <code>unsafe.Pointer</code> Á±ªÂûãÁöÑÊåáÈíà‰πüÂèØ‰ª•ËΩ¨Êç¢ÂõûÊôÆÈÄöÊåáÈíàÔºåËÄå‰∏îÂèØ‰ª•‰∏çÂøÖÂíå‰πãÂâçÁöÑÁ±ªÂûã <code>*T</code> Áõ∏Âêå„ÄÇÂè¶Â§ñÔºå<code>unsafe.Pointer</code> Á±ªÂûãËøòÂèØ‰ª•ËΩ¨Êç¢‰∏∫ <code>uintptr</code> Á±ªÂûãÔºåËØ•Á±ªÂûã‰øùÂ≠ò‰∫ÜÊåáÈíàÊâÄÊåáÂêëÂú∞ÂùÄÁöÑÊï∞ÂÄºÔºå‰ªéËÄåÂèØ‰ª•‰ΩøÊàë‰ª¨ÂØπÂú∞ÂùÄËøõË°åÊï∞ÂÄºËÆ°ÁÆó„ÄÇ‰ª•‰∏äÂ∞±ÊòØÂº∫ËΩ¨Êç¢ÊñπÂºèÁöÑÂÆûÁé∞‰æùÊçÆ„ÄÇ</p>
<p><strong>ËÄå <code>string</code> Âíå <code>slice</code> Âú® <code>reflect</code> ÂåÖ‰∏≠ÔºåÂØπÂ∫îÁöÑÁªìÊûÑ‰ΩìÊòØ <code>reflect.StringHeader</code> Âíå <code>reflect.SliceHeader</code></strong>ÔºåÂÆÉ‰ª¨ÊòØ <code>string</code> Âíå <code>slice</code> ÁöÑËøêË°åÊó∂Ë°®Ëææ„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">StringHeader</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Data</span> <span class="kt">uintptr</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Len</span>  <span class="kt">int</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">SliceHeader</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Data</span> <span class="kt">uintptr</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Len</span>  <span class="kt">int</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Cap</span>  <span class="kt">int</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>ÂÜÖÂ≠òÂ∏ÉÂ±Ä</strong></li>
</ul>
<p>‰ªé <code>string</code> Âíå <code>slice</code> ÁöÑËøêË°åÊó∂Ë°®ËææÂèØ‰ª•ÁúãÂá∫ÔºåÈô§‰∫Ü <code>SilceHeader</code> Â§ö‰∫Ü‰∏Ä‰∏™ <code>int</code> Á±ªÂûãÁöÑ <code>Cap</code> Â≠óÊÆµÔºå<code>Date</code> Âíå <code>Len</code> Â≠óÊÆµÊòØ‰∏ÄËá¥ÁöÑ„ÄÇÊâÄ‰ª•ÔºåÂÆÉ‰ª¨ÁöÑ<strong>ÂÜÖÂ≠òÂ∏ÉÂ±ÄÊòØÂèØÂØπÈΩêÁöÑ</strong>ÔºåËøôËØ¥ÊòéÊàë‰ª¨Â∞±ÂèØ‰ª•Áõ¥Êé•ÈÄöËøá <code>unsafe.Pointer</code> ËøõË°åËΩ¨Êç¢„ÄÇ</p>
<h2 id="311-ÁªìÊûÑ‰ΩìÂíåÊé•Âè£">3.11 ÁªìÊûÑ‰ΩìÂíåÊé•Âè£</h2>
<h4 id="Âü∫Á°Ä">Âü∫Á°Ä</h4>
<blockquote>
<h4 id="ÈóÆgo-Â¶Ç‰ΩïÂÆûÁé∞-Â§öÊÄÅÂéüÁêÜÊòØ‰ªÄ‰πà">ÈóÆÔºöGo Â¶Ç‰ΩïÂÆûÁé∞ Â§öÊÄÅÔºüÂéüÁêÜÊòØ‰ªÄ‰πàÔºü‚≠êüö©</h4>
</blockquote>
<p><strong>Â¶Ç‰ΩïÂÆûÁé∞</strong>Ôºö</p>
<p>Â§öÊÄÅ‰ΩøÂÜÖÈÉ®ÁªìÊûÑ‰∏çÂêåÁöÑÂØπË±°ÂèØ‰ª•ÂÖ±‰∫´Áõ∏ÂêåÁöÑÂ§ñÈÉ®Êé•Âè£„ÄÇ</p>
<p>Go ÈÄöËøá<strong>Êé•Âè£</strong>ÂÆûÁé∞Â§öÊÄÅÔºö</p>
<ul>
<li><strong>Êüê‰∏™Á±ªÂûã</strong>Ëã•ÂÆûÁé∞‰∫ÜÊé•Âè£ÁöÑÊâÄÊúâÊñπÊ≥ïÔºåÂ∞±ÈöêÂºèÁöÑÂÆûÁé∞‰∫ÜËØ•Êé•Âè£Ôºõ</li>
<li><strong>Êüê‰∏™Á±ªÂûãÁöÑÂØπË±°</strong>ÂèØ‰ª•ËµãÁªôÂÆÉÊâÄÂÆûÁé∞ÁöÑ‰ªªÊÑèÊé•Âè£Á±ªÂûãÁöÑÂèòÈáèÔºõ</li>
</ul>
<p>(ÁΩë‰∏äÊ≤°ÊâæÂà∞Âï•Â•ΩÁöÑËÆ≤Ëß£ÔºåËá™Â∑±Â∞ùËØïÂÜô‰∏™Âêß‚Ä¶)</p>
<p><strong>ÂéüÁêÜ</strong>Ôºö</p>
<p>È¶ñÂÖàË¶ÅÊòéÁ°ÆÔºåÊØè‰∏™Á±ªÂûãÂú®Â∫ïÂ±ÇÈÉΩ‰ºöÊúâ‰∏Ä‰∏™Á±ªÂûãÂÖÉÊï∞ÊçÆÔºåÂ≠òÊîæÁùÄÁ±ªÂûã‰ø°ÊÅØÂíåÊñπÊ≥ïÂÖÉÊï∞ÊçÆÂàóË°®„ÄÇ</p>
<ul>
<li>
<p>ÁÑ∂ÂêéÔºå<strong>ÂÆö‰πâ‰∏Ä‰∏™ÈùûÁ©∫Êé•Âè£ÔºåÂπ∂ËÆ©ÊüêÁ±ªÂûãÂÆûÁé∞ËØ•Êé•Âè£</strong>Ôºõ</p>
</li>
<li>
<p>Âú®Â§öÊÄÅÁöÑÂú∫ÊôØ‰∏ãÔºåÊØîÂ¶Ç‰∏Ä‰∏™ÂáΩÊï∞ÁöÑÂÖ•ÂèÇÊòØÂÆö‰πâÁöÑÈùûÁ©∫Êé•Âè£Á±ªÂûãÔºåË∞ÉÁî®ËØ•ÂáΩÊï∞Êó∂‰º†ÂèÇ‰∏∫<strong>ÂÖ∑‰ΩìÁ±ªÂûãÁöÑÂØπË±°</strong>ÔºåÂÖ∂ÂÆûÂ∞±‰ºöÊää<strong>ËØ•ÂÖ∑‰ΩìÁ±ªÂûãÁöÑÂØπË±°ËµãÂÄºÁªôËØ•ÈùûÁ©∫Êé•Âè£</strong>„ÄÇËøôÈáåË¶Å‰∫ÜËß£ÔºåÈùûÁ©∫Êé•Âè£ÁöÑÂ∫ïÂ±ÇÁªìÊûÑ‰ΩìÈáåÂÖ±Êúâ‰∏§‰∏™Â≠óÊÆµÔºå‰∏Ä‰∏™ÊòØ<code>itab</code>Ôºå‰∏Ä‰∏™ÊòØ<code>data</code>Ôºö</p>
<ul>
<li><code>itab</code>‰∏≠‰ºöËÆ∞ÂΩï<strong>Êé•Âè£ÁöÑÁ±ªÂûãÂÖÉÊï∞ÊçÆ(ÂåÖÂê´Êé•Âè£ÁöÑÊñπÊ≥ïÂàóË°®)</strong>„ÄÅ<strong>Âä®ÊÄÅÁ±ªÂûãÂÖÉÊï∞ÊçÆ</strong>„ÄÅ<strong>Âä®ÊÄÅÁ±ªÂûãÂÆûÁé∞ÁöÑ(Êé•Âè£ÊâÄÈúÄË¶ÅÁöÑ)ÊñπÊ≥ïÁöÑÂú∞ÂùÄÂàóË°®<code>fun</code></strong>Ôºõ</li>
<li><code>data</code>‰∏∫<strong>Âä®ÊÄÅÂÄº</strong>ÔºåÊåáÂêëÂÖ∑‰ΩìÁ±ªÂûãÁöÑÂØπË±°„ÄÇ</li>
</ul>
</li>
<li>
<p>Âõ†Ê≠§Ôºå<strong>ËµãÂÄºËøáÁ®ã</strong>Â∞±ÊòØÊää<code>data</code>ÊåáÂêëÂÖ∑‰ΩìÁ±ªÂûãÁöÑÂØπË±°Ôºå‰øÆÊîπ<code>itab</code>‰∏≠ÁöÑ<strong>Âä®ÊÄÅÁ±ªÂûãÂÖÉÊï∞ÊçÆ‰∏∫ÂÖ∑‰ΩìÁ±ªÂûãÁöÑÁ±ªÂûãÂÖÉÊï∞ÊçÆ</strong>ÔºåÂπ∂‰ªé<strong>ËØ•Á±ªÂûãÂÖÉÊï∞ÊçÆ</strong>‰∏≠ÁöÑ<strong>ÊñπÊ≥ïÂÖÉÊï∞ÊçÆÂàóË°®</strong>Êã∑Ë¥ùÊñπÊ≥ïÂú∞ÂùÄÂà∞<code>fun</code>„ÄÇ</p>
</li>
</ul>
<p>ÁªôÂá∫‰∏ÄÊÆµÁ§∫‰æã‰ª£Á†ÅÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">test</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nb">print</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">hello</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">h</span> <span class="nx">hello</span><span class="p">)</span> <span class="nb">print</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;hello&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Â§öÊÄÅÂú∫ÊôØ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">hi</span><span class="p">(</span><span class="nx">t</span> <span class="nx">test</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">t</span><span class="p">.</span><span class="nb">print</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">h</span> <span class="o">:=</span> <span class="nx">hello</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Á¨¨‰∏ÄÁßçË∞ÉÁî®ÊñπÂºè
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kd">var</span> <span class="nx">t</span> <span class="nx">test</span>
</span></span><span class="line"><span class="cl">	<span class="nx">t</span> <span class="p">=</span> <span class="nx">h</span>
</span></span><span class="line"><span class="cl">	<span class="nx">t</span><span class="p">.</span><span class="nb">print</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Á¨¨‰∫åÁßç
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nf">hi</span><span class="p">(</span><span class="nx">h</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<h4 id="ÈóÆgo-Â¶Ç‰ΩïÂÆûÁé∞-ÁªÑÂêà-Âíå-ÁªßÊâø">ÈóÆÔºöGo Â¶Ç‰ΩïÂÆûÁé∞ ÁªÑÂêà Âíå ÁªßÊâøÔºü</h4>
</blockquote>
<p>Go ËØ≠Ë®Ä‰∏≠Ê≤°ÊúâÁªßÊâøÁöÑÊ¶ÇÂøµÔºåÊõ¥ÊèêÂÄ°ÁöÑÊòØ<strong>ÁªÑÂêà</strong>„ÄÇ<strong>Êé•Âè£</strong>Âíå<strong>ÁªìÊûÑ‰Ωì</strong>ÈÉΩÂèØ‰ª•ÁªÑÂêà„ÄÇ</p>
<ol>
<li><strong>Êé•Âè£ÁöÑÁªÑÂêà</strong>ÔºåÂ¶Ç‰∏ã‰ª£Á†ÅÊâÄÁ§∫Ôºö</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Reader</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">Read</span><span class="p">(</span><span class="nx">p</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">)</span> <span class="p">(</span><span class="nx">n</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Writer</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">Write</span><span class="p">(</span><span class="nx">p</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">)</span> <span class="p">(</span><span class="nx">n</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//ReadWriterÊòØReaderÂíåWriterÁöÑÁªÑÂêà
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">ReadWriter</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Reader</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Writer</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ReadWriter Êé•Âè£Â∞±ÊòØ Reader Âíå Writer ÁöÑÁªÑÂêàÔºåÁªÑÂêàÂêéÁöÑ <strong>ReadWriter Êé•Âè£ÂÖ∑Êúâ Reader Âíå Writer ‰∏≠ÁöÑÊâÄÊúâÊñπÊ≥ï</strong>ÔºåËøôÊ†∑Êñ∞Êé•Âè£ ReadWriter Â∞±‰∏çÁî®ÂÆö‰πâËá™Â∑±ÁöÑÊñπÊ≥ï‰∫ÜÔºåÁªÑÂêà Reader Âíå Writer ÁöÑÂ∞±ÂèØ‰ª•‰∫Ü„ÄÇ</p>
<ol start="2">
<li><strong>ÁªìÊûÑ‰ΩìÁöÑÁªÑÂêà</strong>ÔºåÂ¶Ç‰∏ã‰ª£Á†ÅÊâÄÁ§∫Ôºö</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">person</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">name</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">    <span class="nx">age</span> <span class="kt">uint</span>
</span></span><span class="line"><span class="cl">    <span class="nx">address</span>	
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Áõ¥Êé•ÊääÁªìÊûÑ‰ΩìÁ±ªÂûãÊîæËøõÊù•ÔºåÂ∞±ÊòØÁªÑÂêàÔºå‰∏çÈúÄË¶ÅÂ≠óÊÆµÂêç„ÄÇ<strong>ÁªÑÂêàÂêéÔºåË¢´ÁªÑÂêàÁöÑ address Áß∞‰∏∫</strong>ÂÜÖÈÉ®Á±ªÂûã</strong>Ôºåperson Áß∞‰∏∫<strong>Â§ñÈÉ®Á±ªÂûã</strong>Ôºö</p>
<ul>
<li><strong>Â§ñÈÉ®Á±ªÂûã</strong>‰∏ç‰ªÖÂèØ‰ª•‰ΩøÁî®<strong>ÂÜÖÈÉ®Á±ªÂûãÁöÑÂ≠óÊÆµ</strong>Ôºå‰πüÂèØ‰ª•‰ΩøÁî®<strong>ÂÜÖÈÉ®Á±ªÂûãÁöÑÊñπÊ≥ï</strong>ÔºåÂ∞±ÂÉè‰ΩøÁî®Ëá™Â∑±ÁöÑÊñπÊ≥ï‰∏ÄÊ†∑Ôºõ</li>
<li>Â¶ÇÊûúÂ§ñÈÉ®Á±ªÂûãÂÆö‰πâ‰∫ÜÂíåÂÜÖÈÉ®Á±ªÂûãÂêåÊ†∑ÁöÑÊñπÊ≥ïÔºåÈÇ£‰πàÂ§ñÈÉ®Á±ªÂûãÁöÑ‰ºöË¶ÜÁõñÂÜÖÈÉ®Á±ªÂûãÔºåËøôÂ∞±ÊòØ<strong>ÊñπÊ≥ïÁöÑË¶ÜÂÜô</strong>„ÄÇ<strong>ÊñπÊ≥ïË¶ÜÂÜô‰∏ç‰ºöÂΩ±ÂìçÂÜÖÈÉ®Á±ªÂûãÁöÑÊñπÊ≥ïÂÆûÁé∞</strong>„ÄÇ</li>
</ul>
<p>Â¶Ç‰∏ãÊâÄÁ§∫Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">p</span><span class="o">:=</span><span class="nx">person</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">age</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">name</span><span class="p">:</span><span class="s">&#34;È£ûÈõ™Êó†ÊÉÖ&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">address</span><span class="p">:</span><span class="nx">address</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">province</span><span class="p">:</span> <span class="s">&#34;Âåó‰∫¨&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">city</span><span class="p">:</span>     <span class="s">&#34;Âåó‰∫¨&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">//ÂÉè‰ΩøÁî®Ëá™Â∑±ÁöÑÂ≠óÊÆµ‰∏ÄÊ†∑ÔºåÁõ¥Êé•‰ΩøÁî®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">province</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Âõ†‰∏∫ person ÁªÑÂêà‰∫Ü addressÔºåÊâÄ‰ª• address ÁöÑÂ≠óÊÆµÂ∞±ÂÉè person Ëá™Â∑±ÁöÑ‰∏ÄÊ†∑ÔºåÂèØ‰ª•<strong>Áõ¥Êé•‰ΩøÁî®</strong>„ÄÇ</p>
<h4 id="È¢òÁõÆ1-1">È¢òÁõÆÔºö1</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">People</span> <span class="kd">struct</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">p</span> <span class="o">*</span><span class="nx">People</span><span class="p">)</span> <span class="nf">ShowA</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;showA&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">p</span><span class="p">.</span><span class="nf">ShowB</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">p</span> <span class="o">*</span><span class="nx">People</span><span class="p">)</span> <span class="nf">ShowB</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;showB&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Teacher</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">People</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">Teacher</span><span class="p">)</span> <span class="nf">ShowB</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;teacher showB&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">t</span> <span class="o">:=</span> <span class="nx">Teacher</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">t</span><span class="p">.</span><span class="nf">ShowA</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ËøôÈáåÂÆö‰πâ‰∫Ü‰∏§‰∏™Á±ªÂûãÔºåÁ±ªÂûã<code>Teacher</code>‰∏≠ÂµåÂÖ•‰∫ÜÁ±ªÂûã<code>People</code>„ÄÇ**ÈóÆÈ¢òÊòØÔºö**ÈÄöËøá<code>Teacher</code>Á±ªÂûãÁöÑÂèòÈáè<code>t</code>Ë∞ÉÁî®ÊñπÊ≥ï<code>showA()</code>ÔºåËæìÂá∫ÁªìÊûúÊòØ‰ªÄ‰πàÔºü</p>
<p><strong>Á≠îÊ°àÔºö</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">showA</span>
</span></span><span class="line"><span class="cl"><span class="nx">showB</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Ëß£ÈáäÔºö</strong></p>
<p>È¶ñÂÖàË¶ÅÊòéÁ°Æ<code>T</code>Âíå<code>*T</code>ÊòØ‰∏§ÁßçÁ±ªÂûãÔºåÂàÜÂà´ÂØπÂ∫îËá™Â∑±ÁöÑÁ±ªÂûãÂÖÉÊï∞ÊçÆÔºåÊúâÁùÄÂêÑËá™ÁöÑÊñπÊ≥ïÈõÜÔºåÂÖ∂‰∏≠ÂåÖÂê´‰∫ÜËá™ÂÆö‰πâÁöÑÊñπÊ≥ï‰ª•ÂèäÁºñËØëÂô®ÁîüÊàêÁöÑÊñπÊ≥ï„ÄÇÈÄöËøá<code>go tool compile -l -p main main.go</code>ÂèØ‰ª•ÁîüÊàê<code>main.go</code>ÁöÑ<code>obj</code>Êñá‰ª∂ÔºåÂÜçÈÄöËøá<code>go tool nm main.o</code>Â∞±ÂèØ‰ª•Êü•ÁúãÊñπÊ≥ïÂàóË°®Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="err">‚ùØ</span> <span class="k">go</span> <span class="nx">tool</span> <span class="nx">nm</span> <span class="nx">main</span><span class="p">.</span><span class="nx">o</span> <span class="p">|</span> <span class="nx">grep</span> <span class="sc">&#39;T&#39;</span> <span class="p">|</span> <span class="nx">grep</span> <span class="nx">People</span>
</span></span><span class="line"><span class="cl">    <span class="mi">301</span><span class="nx">c</span> <span class="nx">T</span> <span class="nx">main</span><span class="p">.(</span><span class="o">*</span><span class="nx">People</span><span class="p">).</span><span class="nx">ShowA</span>
</span></span><span class="line"><span class="cl">    <span class="mi">308</span><span class="nx">a</span> <span class="nx">T</span> <span class="nx">main</span><span class="p">.(</span><span class="o">*</span><span class="nx">People</span><span class="p">).</span><span class="nx">ShowB</span>
</span></span><span class="line"><span class="cl"><span class="err">‚ùØ</span> <span class="k">go</span> <span class="nx">tool</span> <span class="nx">nm</span> <span class="nx">main</span><span class="p">.</span><span class="nx">o</span> <span class="p">|</span> <span class="nx">grep</span> <span class="sc">&#39;T&#39;</span> <span class="p">|</span> <span class="nx">grep</span> <span class="nx">Teacher</span>
</span></span><span class="line"><span class="cl">    <span class="mi">36</span><span class="nx">d9</span> <span class="nx">T</span> <span class="nx">main</span><span class="p">.(</span><span class="o">*</span><span class="nx">Teacher</span><span class="p">).</span><span class="nx">ShowA</span>
</span></span><span class="line"><span class="cl">    <span class="mf">30e0</span> <span class="nx">T</span> <span class="nx">main</span><span class="p">.(</span><span class="o">*</span><span class="nx">Teacher</span><span class="p">).</span><span class="nx">ShowB</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂèØ‰ª•ÂèëÁé∞Ôºå<code>People</code>Âíå<code>*People</code>ÁöÑÊñπÊ≥ïÈõÜÂêå‰ª£Á†Å‰∏≠ÂÆö‰πâÁöÑ‰∏ÄËá¥Ôºå‰ΩÜ<code>Teacher</code>Âíå<code>*Teacher</code>Áõ∏ÂÖ≥ÁöÑÊñπÊ≥ïÂàóË°®‰∏≠Â§ö‰∫Ü‰∏Ä‰∏™<code>ShowA()</code>ÊñπÊ≥ïÔºåËøôÂ∞±ÊòØÁºñËØëÂô®Ëá™Âä®ÁîüÊàêÁöÑ‰∫ÜÔºåÊâÄ‰ª•ÁºñËØëÂô®‰∏∫<code>*Teacher</code>ÁîüÊàê‰∫ÜËøôÊ†∑‰∏Ä‰∏™ÂåÖË£ÖÊñπÊ≥ï(Á∫¢Â≠óÈÉ®ÂàÜ)Ôºö</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230131160051014.png" alt="image-20230131160051014" style="zoom:50%;" />
<p>ÊâÄ‰ª•ÔºåË∞ÉÁî®ËøáÁ®ã‰∏∫Ôºö<code>t.ShowA()</code>‰ºöÂú®ËØ≠Ê≥ïÁ≥ñÁöÑ‰ΩúÁî®‰∏ãËΩ¨Êç¢‰∏∫ÂØπ<code>(*Teacher).ShowA()</code>ÊñπÊ≥ïÁöÑË∞ÉÁî®ÔºåËÄåÂÆÉÂèà‰ºöÂèñÂá∫<code>People</code>ÊàêÂëòÁöÑÂú∞ÂùÄ‰Ωú‰∏∫Êé•Êî∂ËÄÖÂéªÊâßË°å<code>*People</code>ËøôÈáåÁöÑ<code>ShowA()</code>ÊñπÊ≥ïÔºåÊâÄ‰ª•‰ºöÊúâÂ¶Ç‰∏äËæìÂá∫„ÄÇ</p>
<h4 id="È¢òÁõÆ2-1">È¢òÁõÆÔºö2</h4>
<p>Ëß£ÈáäÂà∞ËøôÈáåÔºåËøôÈÅìÈ¢òÂ∑≤ÁªèËß£ÂÜ≥‰∫Ü„ÄÇ‰ΩÜÊó†Ê≥ïÁü•ÈÅì<strong>‰∏∫‰ªÄ‰πàÁºñËØëÂô®Âè™Áªô<code>*Teacher</code>ÁîüÊàê‰∫ÜÂåÖË£ÖÊñπÊ≥ïÔºü<strong>‰∏∫Ê≠§Êé¢Á¥¢‰∏Ä‰∏ã</strong>ÁºñËØëÂô®ÁîüÊàêÂåÖË£ÖÊñπÊ≥ïÁöÑËßÑÂàô</strong>„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">A</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">a</span> <span class="nx">A</span><span class="p">)</span> <span class="nf">Value</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">a</span> <span class="o">*</span><span class="nx">A</span><span class="p">)</span> <span class="nf">Set</span><span class="p">(</span><span class="nx">n</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="o">*</span><span class="nx">a</span> <span class="p">=</span> <span class="nf">A</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">B</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">A</span>
</span></span><span class="line"><span class="cl">	<span class="nx">b</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">C</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="o">*</span><span class="nx">A</span>
</span></span><span class="line"><span class="cl">	<span class="nx">c</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂàÜÊûê‰ª•‰∏ä<code>B</code>Âíå<code>C</code>‰ºöÂàÜÂà´ÁªßÊâøÂì™‰∫õÊñπÊ≥ï„ÄÇ</p>
<p>È¶ñÂÖàÔºåÂÄºÊé•Êî∂ËÄÖ<code>A</code>Êúâ<code>Value()</code>ÊñπÊ≥ïÔºåÂâçÈù¢Â∑≤ÁªèËÆ≤ËøáÔºå‰∏∫‰∫ÜÊîØÊåÅÊé•Âè£ÔºåÁºñËØëÂô®‰ºö‰∏∫ÂÄºÊé•Êî∂ËÄÖÊñπÊ≥ïÁîüÊàêÊåáÈíàÊé•Êî∂ËÄÖÁöÑÂåÖË£ÖÊñπÊ≥ïÔºåÊâÄ‰ª•<code>*A</code>‰ºöÊúâ<code>Value()</code>Âíå<code>Set()</code>ÊñπÊ≥ïÔºõ<code>B</code>Âíå<code>C</code>Êã•ÊúâÁöÑÊñπÊ≥ïÂ¶Ç‰∏ãÔºö</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230131161145152.png" alt="image-20230131161145152" style="zoom:50%;" />
<p>ÂÖ∂‰∏≠ÔºåÂè™Êúâ<code>B</code>Âè™ÁªßÊâø‰∫Ü<code>Value()</code>ÊñπÊ≥ïÔºåËøôÊòØÂõ†‰∏∫‰ª•<code>B</code>‰∏∫Êé•Êî∂ËÄÖË∞ÉÁî®ÊñπÊ≥ïÊó∂ÔºåÊñπÊ≥ïÊìç‰ΩúÁöÑÂ∑≤ÁªèÊòØ<code>B</code>ÁöÑÂâØÊú¨ÔºåÊó†Ê≥ïËé∑ÂèñÂµåÂÖ•ÁöÑ<code>A</code>ÁöÑÂéüÂßãÂú∞ÂùÄÔºõËÄå<code>*A</code>ÁöÑÊñπÊ≥ï‰ªéËØ≠‰πâ‰∏äÊù•ËÆ≤ÈúÄË¶ÅÊìç‰ΩúÂéüÂßãÂèòÈáèÔºå‰πüÂ∞±ÊòØËØ¥ÔºåÂØπ‰∫é<code>B</code>ËÄåË®ÄÂÆÉÁªßÊâø<code>*A</code>ÁöÑÊñπÊ≥ïÊòØÊ≤°ÊúâÊÑè‰πâÁöÑÔºåÊâÄ‰ª•ÁºñËØëÂô®Âπ∂Ê≤°ÊúâÁªô<code>B</code>ÁîüÊàê<code>Set()</code>ÊñπÊ≥ï„ÄÇ</p>
<p>**ÁªìËÆ∫Â∞±ÊòØÔºö**Êó†ËÆ∫ÊòØÂµåÂÖ•ÂÄºËøòÊòØÂµåÂÖ•ÊåáÈíàÔºåÂÄºÊé•Êî∂ËÄÖÊñπÊ≥ïÂßãÁªàËÉΩÂ§üË¢´ÁªßÊâøÔºõËÄåÂè™ÊúâÂú®ËÉΩÂ§üÊãøÂà∞ÂµåÂÖ•ÂØπË±°ÁöÑÂú∞ÂùÄÊó∂ÔºåÊâçËÉΩÁªßÊâøÊåáÈíàÊé•Êî∂ËÄÖÊñπÊ≥ï„ÄÇ</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230131162321168.png" alt="image-20230131162321168" style="zoom:50%;" />
<h2 id="312-ÂØπÊØî-java">3.12 ÂØπÊØî Java</h2>
<blockquote>
<h4 id="ÈóÆgo-Âíå-java-ÁöÑÂå∫Âà´">ÈóÆÔºöGo Âíå Java ÁöÑÂå∫Âà´Ôºü</h4>
</blockquote>
<ol>
<li><strong>ÊÄßËÉΩ</strong>ÔºöÊó†ËÆ∫Âú®‰∏≤Ë°åËøòÊòØÂπ∂ÂèëÁöÑÁöÑ‰∏öÂä°‰∏ãÔºåJavaÁöÑÊÄßËÉΩÈÉΩÊØîGoÂ∑ÆÔºõ</li>
</ol>
<ul>
<li>goroutine ÈªòËÆ§Âç†Áî®ÂÜÖÂ≠òËøúÊØî Java „ÄÅC ÁöÑÁ∫øÁ®ãÂ∞ë(goroutineÔºö2KBÔºåÁ∫øÁ®ãÔºö8MB)ÔºåÂç†Áî®ËµÑÊ∫êÊõ¥Â∞ëÔºõ</li>
<li>goroutine ÂèØ‰ª•ÈÅøÂÖçÂÜÖÊ†∏ÊÄÅÂíåÁî®Êà∑ÊÄÅÁöÑÂàáÊç¢ÂØºËá¥ÁöÑÊàêÊú¨„ÄÇ</li>
</ul>
<ol start="2">
<li><strong>ÈÉ®ÁΩ≤ÁºñËØë</strong>Ôºö</li>
</ol>
<ul>
<li>JavaÈÄöËøáËôöÊãüÊú∫ÁºñËØëÔºå‰ΩøÁî®JVMË∑®Âπ≥Âè∞ÁºñËØëÔºõ</li>
<li>GoËØ≠Ë®ÄÈíàÂØπ‰∏çÂêåÁöÑÂπ≥Âè∞ÔºåÁºñËØëÂØπÂ∫îÁöÑÊú∫Âô®Á†Å„ÄÇ</li>
</ul>
<ol start="3">
<li><strong>ËÆøÈóÆÊùÉÈôê</strong>Ôºö</li>
</ol>
<ul>
<li>Java‰ΩøÁî®public„ÄÅprotected„ÄÅprivate„ÄÅÈªòËÆ§Á≠âÂá†Áßç‰øÆÈ•∞Á¨¶Êù•ÊéßÂà∂ËÆøÈóÆÊùÉÈôêÔºõ</li>
<li>GoËØ≠Ë®ÄÈÄöËøáÂ§ßÂ∞èÂÜôÊéßÂà∂ÂåÖÂ§ñÂèØËÆøÈóÆËøòÊòØ‰∏çÂèØËÆøÈóÆ„ÄÇGoËØ≠Ë®Ä‰∏≠Ê†πÊçÆÈ¶ñÂ≠óÊØçÁöÑÂ§ßÂ∞èÂÜôÊù•Á°ÆÂÆöÂèØ‰ª•ËÆøÈóÆÁöÑÊùÉÈôê„ÄÇÊó†ËÆ∫ÊòØÊñπÊ≥ïÂêç„ÄÅÂ∏∏Èáè„ÄÅÂèòÈáèÂêçËøòÊòØÁªìÊûÑ‰ΩìÁöÑÂêçÁß∞ÔºåÂ¶ÇÊûúÈ¶ñÂ≠óÊØçÂ§ßÂÜôÔºåÂàôÂèØ‰ª•Ë¢´ÂÖ∂‰ªñÁöÑÂåÖËÆøÈóÆÔºõÂ¶ÇÊûúÈ¶ñÂ≠óÊØçÂ∞èÂÜôÔºåÂàôÂè™ËÉΩÂú®Êú¨ÂåÖ‰∏≠‰ΩøÁî®„ÄÇÂèØ‰ª•ÁÆÄÂçïÁöÑÁêÜËß£ÊàêÔºåÈ¶ñÂ≠óÊØçÂ§ßÂÜôÊòØÂÖ¨ÊúâÁöÑÔºåÈ¶ñÂ≠óÊØçÂ∞èÂÜôÊòØÁßÅÊúâÁöÑ„ÄÇ</li>
</ul>
<ol start="4">
<li><strong>Êé•Âè£</strong></li>
</ol>
<ul>
<li>JavaÁ≠âÈù¢ÂêëÂØπË±°ÁºñÁ®ãÁöÑÊé•Âè£ÊòØ‰æµÂÖ•ÂºèÊé•Âè£ÔºåÈúÄË¶ÅÊòéÁ°ÆÂ£∞ÊòéËá™Â∑±ÂÆûÁé∞‰∫ÜÊüê‰∏™Êé•Âè£Ôºõ</li>
<li>GoËØ≠Ë®ÄÁöÑÈùû‰æµÂÖ•ÂºèÊé•Âè£‰∏çÈúÄË¶ÅÈÄöËøá‰ªª‰ΩïÂÖ≥ÈîÆÂ≠óÂ£∞ÊòéÁ±ªÂûã‰∏éÊé•Âè£‰πãÈó¥ÁöÑÂÆûÁé∞ÂÖ≥Á≥ªÔºåÂè™Ë¶Å‰∏Ä‰∏™Á±ªÂûãÂÆûÁé∞‰∫ÜÊé•Âè£ÁöÑÊâÄÊúâÊñπÊ≥ïÔºåÈÇ£‰πàËøô‰∏™Á±ªÂûãÂ∞±ÊòØËøô‰∏™Êé•Âè£ÁöÑÂÆûÁé∞Á±ªÂûã„ÄÇ</li>
</ul>
<ol start="5">
<li><strong>ÂºÇÂ∏∏Â§ÑÁêÜ</strong></li>
</ol>
<ul>
<li>Java‰∏≠ÈîôËØØÔºàErrorÔºâÂíåÂºÇÂ∏∏(Exception)Ë¢´ÂàÜÁ±ªÁÆ°ÁêÜÔºå‰∫åËÄÖÁöÑÂå∫Âà´ÊòØÔºö
<ul>
<li>ErrorÔºàÈîôËØØÔºâÔºöÁ®ãÂ∫èÂú®ÊâßË°åËøáÁ®ã‰∏≠ÊâÄÈÅáÂà∞ÁöÑÁ°¨‰ª∂ÊàñÊìç‰ΩúÁ≥ªÁªüÁöÑÈîôËØØ„ÄÇÈîôËØØÂØπÁ®ãÂ∫èËÄåË®ÄÊòØËá¥ÂëΩÁöÑÔºåÂ∞ÜÂØºËá¥Á®ãÂ∫èÊó†Ê≥ïËøêË°å„ÄÇÂ∏∏ËßÅÁöÑÈîôËØØÊúâÂÜÖÂ≠òÊ∫¢Âá∫ÔºåjvmËôöÊãüÊú∫Ëá™Ë∫´ÁöÑÈùûÊ≠£Â∏∏ËøêË°åÔºåcalssÊñá‰ª∂Ê≤°Êúâ‰∏ªÊñπÊ≥ï„ÄÇÁ®ãÂ∫èÊú¨ÁîüÊòØ‰∏çËÉΩÂ§ÑÁêÜÈîôËØØÁöÑÔºåÂè™ËÉΩ‰æùÈù†Â§ñÁïåÂπ≤È¢Ñ„ÄÇErrorÊòØÁ≥ªÁªüÂÜÖÈÉ®ÁöÑÈîôËØØÔºåÁî±jvmÊäõÂá∫Ôºå‰∫§ÁªôÁ≥ªÁªüÊù•Â§ÑÁêÜÔºõ</li>
<li>EXCEPTIONÔºàÂºÇÂ∏∏ÔºâÔºöÊòØÁ®ãÂ∫èÊ≠£Â∏∏ËøêË°å‰∏≠ÔºåÂèØ‰ª•È¢ÑÊñôÁöÑÊÑèÂ§ñÊÉÖÂÜµ„ÄÇÊØîÂ¶ÇÊï∞ÊçÆÂ∫ìËøûÊé•‰∏≠Êñ≠ÔºåÁ©∫ÊåáÈíàÔºåÊï∞ÁªÑ‰∏ãÊ†áË∂äÁïå„ÄÇÂºÇÂ∏∏Âá∫Áé∞ÂèØ‰ª•ÂØºËá¥Á®ãÂ∫èÈùûÊ≠£Â∏∏ÁªàÊ≠¢Ôºå‰πüÂèØ‰ª•È¢ÑÂÖàÊ£ÄÊµãÔºåË¢´ÊçïËé∑Â§ÑÁêÜÊéâÔºå‰ΩøÁ®ãÂ∫èÁªßÁª≠ËøêË°å„ÄÇ</li>
</ul>
</li>
<li>GoËØ≠Ë®Ä‰∏≠Âè™ÊúâerrorÔºå‰∏ÄÊó¶ÂèëÁîüÈîôËØØÈÄêÂ±ÇËøîÂõûÔºåÁõ¥Âà∞Ë¢´Â§ÑÁêÜ„ÄÇGolang‰∏≠ÂºïÂÖ•‰∏§‰∏™ÂÜÖÁΩÆÂáΩÊï∞panicÂíårecoverÊù•Ëß¶ÂèëÂíåÁªàÊ≠¢ÂºÇÂ∏∏Â§ÑÁêÜÊµÅÁ®ãÔºåÂêåÊó∂ÂºïÂÖ•ÂÖ≥ÈîÆÂ≠ódeferÊù•Âª∂ËøüÊâßË°ådeferÂêéÈù¢ÁöÑÂáΩÊï∞„ÄÇgolangÂº±Âåñ‰∫ÜÂºÇÂ∏∏ÔºåÂè™ÊúâÈîôËØØÔºåÂú®ÊÑèÊñô‰πãÂ§ñÁöÑpanicÂèëÁîüÊó∂ÔºåÂú®defer‰∏≠ÈÄöËøárecoverÊçïËé∑Ëøô‰∏™ÊÅêÊÖåÔºåËΩ¨Âåñ‰∏∫ÈîôËØØ‰ª•code,messageÁöÑÂΩ¢ÂºèËøîÂõûÁªôÊñπÊ≥ïË∞ÉÁî®ËÄÖÔºåË∞ÉÁî®ËÄÖÂéªÂ§ÑÁêÜÔºåËøô‰πüÊòØgoÊûÅÁÆÄÁöÑÁ≤æÈ´ì„ÄÇ</li>
</ul>
<ol start="6">
<li><strong>ÁªßÊâø</strong></li>
</ol>
<ul>
<li>JavaÁöÑÁªßÊâøÈÄöËøáextendsÂÖ≥ÈîÆÂ≠óÂÆåÊàêÔºå‰∏çÊîØÊåÅÂ§öÁªßÊâøÔºõ</li>
<li>GoËØ≠Ë®ÄÁöÑÁªßÊâøÈÄöËøáÂåøÂêçÁªÑÂêàÂÆåÊàêÔºöÂü∫Á±ª‰ª•StructÁöÑÊñπÂºèÂÆö‰πâÔºåÂ≠êÁ±ªÂè™ÈúÄË¶ÅÊääÂü∫Á±ª‰Ωú‰∏∫ÊàêÂëòÊîæÂú®Â≠êÁ±ªÁöÑÂÆö‰πâ‰∏≠ÔºåÊîØÊåÅÂ§öÁªßÊâø„ÄÇ</li>
</ul>
<ol start="7">
<li><strong>Â§öÊÄÅ</strong></li>
</ol>
<ul>
<li>
<p>JavaÁöÑÂ§öÊÄÅÔºåÂøÖÈ°ªÊª°Ë∂≥ÁªßÊâøÔºåÈáçÂÜôÔºåÂêë‰∏äËΩ¨ÂûãÔºõ‰ªª‰ΩïÁî®Êà∑ÂÆö‰πâÁöÑÁ±ªÂûãÈÉΩÂèØ‰ª•ÂÆûÁé∞‰ªª‰ΩïÊé•Âè£ÔºåÊâÄ‰ª•ÈÄöËøá‰∏çÂêåÂÆû‰ΩìÁ±ªÂûãÂØπÊé•Âè£ÂÄºÊñπÊ≥ïÁöÑË∞ÉÁî®Â∞±ÊòØÂ§öÊÄÅ„ÄÇ</p>
</li>
<li>
<p>Âú®GoËØ≠Ë®Ä‰∏≠ÈÄöËøáÊé•Âè£ÂÆûÁé∞Â§öÊÄÅÔºåÂØπÊé•Âè£ÁöÑÂÆûÁé∞Âè™ÈúÄË¶ÅÊüê‰∏™Á±ªÂûãTÂÆûÁé∞‰∫ÜÊé•Âè£‰∏≠ÁöÑÊñπÊ≥ïÔºåÂ∞±Áõ∏ÂΩì‰∫éÂÆûÁé∞‰∫ÜËØ•Êé•Âè£„ÄÇ</p>
</li>
</ul>
<ol start="8">
<li><strong>ÊåáÈíà</strong></li>
</ol>
<ul>
<li>Java‰∏≠‰∏çÂ≠òÂú®ÊòæÂºèÁöÑÊåáÈíàÔºåËÄåGolang‰∏≠Â≠òÂú®ÊòæÂºèÁöÑÊåáÈíàÊìç‰ΩúÔºå‰ΩøÁî® * Êù•ÂÆö‰πâÂíåÂ£∞ÊòéÊåáÈíàÔºåÈÄöËøá&amp;Êù•ÂèñÂæóÂØπË±°ÁöÑÊåáÈíà„ÄÇÊ≥®ÊÑèÔºåJavaÂíåGolangÈÉΩÊòØÂè™Â≠òÂú®ÂÄº‰º†ÈÄí„ÄÇ</li>
</ul>
<ol start="9">
<li><strong>Âπ∂Âèë</strong></li>
</ol>
<ul>
<li>Âú®Java‰∏≠ÔºåÈÄöÂ∏∏ÂÄüÂä©‰∫éÂÖ±‰∫´ÂÜÖÂ≠òÔºàÂÖ®Â±ÄÂèòÈáèÔºâ‰Ωú‰∏∫Á∫øÁ®ãÈó¥ÈÄö‰ø°ÁöÑÂ™í‰ªãÔºåÈÄöÂ∏∏‰ºöÊúâÁ∫øÁ®ã‰∏çÂÆâÂÖ®ÈóÆÈ¢òÔºå‰ΩøÁî®‰∫ÜÂä†ÈîÅÔºàÂêåÊ≠•ÂåñÔºâ„ÄÅ‰ΩøÁî®ÂéüÂ≠êÁ±ª„ÄÅ‰ΩøÁî®volatileÊèêÂçáÂèØËßÅÊÄßÁ≠âËß£ÂÜ≥Ôºõ</li>
<li>‰ΩÜÂú®GoËØ≠Ë®Ä‰∏≠‰ΩøÁî®ÁöÑÊòØÈÄöÈÅìÔºàChannelÔºâ‰Ωú‰∏∫ÂçèÁ®ãÈó¥ÈÄö‰ø°ÁöÑÂ™í‰ªãÔºåËøô‰πüÊòØGoËØ≠Ë®Ä‰∏≠Âº∫Ë∞ÉÁöÑÔºö<strong>‰∏çË¶ÅÈÄöËøáÂÖ±‰∫´ÂÜÖÂ≠òÈÄö‰ø°ÔºåËÄåÈÄöËøáÈÄö‰ø°Êù•ÂÖ±‰∫´ÂÜÖÂ≠ò</strong>„ÄÇ</li>
</ul>
<ol start="10">
<li><strong>ÂûÉÂúæÂõûÊî∂ÂíåÂÜÖÂ≠òÁÆ°ÁêÜÊú∫Âà∂</strong></li>
</ol>
<ul>
<li>JavaÂü∫‰∫éJVMËôöÊãüÊú∫ÁöÑÂàÜ‰ª£Êî∂ÈõÜÁÆóÊ≥ïÂÆåÊàêGCÔºåGoËØ≠Ë®ÄÂÜÖÂ≠òÈáäÊîæÊòØËØ≠Ë®ÄÂ±ÇÈù¢ÔºåÂØπ‰∏çÂÜç‰ΩøÁî®ÁöÑÂÜÖÂ≠òËµÑÊ∫êËøõË°åËá™Âä®ÂõûÊî∂Ôºå‰ΩøÁî®‰∏âËâ≤Ê†áËÆ∞ÁÆóÊ≥ïÔºõ</li>
</ul>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2023-04-25</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/10-%E6%B7%B1%E5%BA%A6%E6%8E%A2%E7%B4%A2go%E8%AF%AD%E8%A8%80/index.md" target="_blank">Read Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://blog.seucy.me/10-%E6%B7%B1%E5%BA%A6%E6%8E%A2%E7%B4%A2go%E8%AF%AD%E8%A8%80/" data-title="Ê∑±Â∫¶Êé¢Á¥¢GoËØ≠Ë®Ä" data-hashtags="Go"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://blog.seucy.me/10-%E6%B7%B1%E5%BA%A6%E6%8E%A2%E7%B4%A2go%E8%AF%AD%E8%A8%80/" data-hashtag="Go"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="https://blog.seucy.me/10-%E6%B7%B1%E5%BA%A6%E6%8E%A2%E7%B4%A2go%E8%AF%AD%E8%A8%80/" data-title="Ê∑±Â∫¶Êé¢Á¥¢GoËØ≠Ë®Ä"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="https://blog.seucy.me/10-%E6%B7%B1%E5%BA%A6%E6%8E%A2%E7%B4%A2go%E8%AF%AD%E8%A8%80/" data-title="Ê∑±Â∫¶Êé¢Á¥¢GoËØ≠Ë®Ä"><i data-svg-src="/lib/simple-icons/icons/line.min.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on ÂæÆÂçö" data-sharer="weibo" data-url="https://blog.seucy.me/10-%E6%B7%B1%E5%BA%A6%E6%8E%A2%E7%B4%A2go%E8%AF%AD%E8%A8%80/" data-title="Ê∑±Â∫¶Êé¢Á¥¢GoËØ≠Ë®Ä"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/go/">Go</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/%E4%BB%A3%E7%90%86/" class="prev" rel="prev" title="‰ª£ÁêÜ"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>‰ª£ÁêÜ</a>
            <a href="/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AE%97%E6%B3%95/" class="next" rel="next" title="Ë¥üËΩΩÂùáË°°ÁÆóÊ≥ï">Ë¥üËΩΩÂùáË°°ÁÆóÊ≥ï<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
<div id="comments"><div id="valine" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://valine.js.org/">Valine</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
    <div class="footer-container">
        <div class="footer-line">
            <span id="run-time"></span>
        </div><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer"
                title="Hugo 0.115.1">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank"
                rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw"
                    aria-hidden="true"></i> LoveIt</a>
        </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a
                    href="/" target="_blank">Chuyu</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
    </div>
</footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/valine/valine.min.css"><link rel="stylesheet" href="/lib/lightgallery/css/lightgallery-bundle.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script type="text/javascript" src="/lib/valine/Valine.min.js"></script><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lightgallery.min.js"></script><script type="text/javascript" src="/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js"></script><script type="text/javascript" src="/lib/lightgallery/plugins/zoom/lg-zoom.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/cookieconsent/cookieconsent.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{"valine":{"appId":"agUqGfsZRxSQL7fq0tYPH6Zp-MdYXbMMI","appKey":"2e9VDVO0nPzBiJqpzPN6kVPC","avatar":"mp","el":"#valine","emojiCDN":"https://cdn.jsdelivr.net/npm/emoji-datasource-google@14.0.0/img/google/64/","emojiMaps":{"100":"1f4af.png","alien":"1f47d.png","anger":"1f4a2.png","angry":"1f620.png","anguished":"1f627.png","astonished":"1f632.png","black_heart":"1f5a4.png","blue_heart":"1f499.png","blush":"1f60a.png","bomb":"1f4a3.png","boom":"1f4a5.png","broken_heart":"1f494.png","brown_heart":"1f90e.png","clown_face":"1f921.png","cold_face":"1f976.png","cold_sweat":"1f630.png","confounded":"1f616.png","confused":"1f615.png","cry":"1f622.png","crying_cat_face":"1f63f.png","cupid":"1f498.png","dash":"1f4a8.png","disappointed":"1f61e.png","disappointed_relieved":"1f625.png","dizzy":"1f4ab.png","dizzy_face":"1f635.png","drooling_face":"1f924.png","exploding_head":"1f92f.png","expressionless":"1f611.png","face_vomiting":"1f92e.png","face_with_cowboy_hat":"1f920.png","face_with_hand_over_mouth":"1f92d.png","face_with_head_bandage":"1f915.png","face_with_monocle":"1f9d0.png","face_with_raised_eyebrow":"1f928.png","face_with_rolling_eyes":"1f644.png","face_with_symbols_on_mouth":"1f92c.png","face_with_thermometer":"1f912.png","fearful":"1f628.png","flushed":"1f633.png","frowning":"1f626.png","ghost":"1f47b.png","gift_heart":"1f49d.png","green_heart":"1f49a.png","grimacing":"1f62c.png","grin":"1f601.png","grinning":"1f600.png","hankey":"1f4a9.png","hear_no_evil":"1f649.png","heart":"2764-fe0f.png","heart_decoration":"1f49f.png","heart_eyes":"1f60d.png","heart_eyes_cat":"1f63b.png","heartbeat":"1f493.png","heartpulse":"1f497.png","heavy_heart_exclamation_mark_ornament":"2763-fe0f.png","hole":"1f573-fe0f.png","hot_face":"1f975.png","hugging_face":"1f917.png","hushed":"1f62f.png","imp":"1f47f.png","innocent":"1f607.png","japanese_goblin":"1f47a.png","japanese_ogre":"1f479.png","joy":"1f602.png","joy_cat":"1f639.png","kiss":"1f48b.png","kissing":"1f617.png","kissing_cat":"1f63d.png","kissing_closed_eyes":"1f61a.png","kissing_heart":"1f618.png","kissing_smiling_eyes":"1f619.png","laughing":"1f606.png","left_speech_bubble":"1f5e8-fe0f.png","love_letter":"1f48c.png","lying_face":"1f925.png","mask":"1f637.png","money_mouth_face":"1f911.png","nauseated_face":"1f922.png","nerd_face":"1f913.png","neutral_face":"1f610.png","no_mouth":"1f636.png","open_mouth":"1f62e.png","orange_heart":"1f9e1.png","partying_face":"1f973.png","pensive":"1f614.png","persevere":"1f623.png","pleading_face":"1f97a.png","pouting_cat":"1f63e.png","purple_heart":"1f49c.png","rage":"1f621.png","relaxed":"263a-fe0f.png","relieved":"1f60c.png","revolving_hearts":"1f49e.png","right_anger_bubble":"1f5ef-fe0f.png","robot_face":"1f916.png","rolling_on_the_floor_laughing":"1f923.png","scream":"1f631.png","scream_cat":"1f640.png","see_no_evil":"1f648.png","shushing_face":"1f92b.png","skull":"1f480.png","skull_and_crossbones":"2620-fe0f.png","sleeping":"1f634.png","sleepy":"1f62a.png","slightly_frowning_face":"1f641.png","slightly_smiling_face":"1f642.png","smile":"1f604.png","smile_cat":"1f638.png","smiley":"1f603.png","smiley_cat":"1f63a.png","smiling_face_with_3_hearts":"1f970.png","smiling_imp":"1f608.png","smirk":"1f60f.png","smirk_cat":"1f63c.png","sneezing_face":"1f927.png","sob":"1f62d.png","space_invader":"1f47e.png","sparkling_heart":"1f496.png","speak_no_evil":"1f64a.png","speech_balloon":"1f4ac.png","star-struck":"1f929.png","stuck_out_tongue":"1f61b.png","stuck_out_tongue_closed_eyes":"1f61d.png","stuck_out_tongue_winking_eye":"1f61c.png","sunglasses":"1f60e.png","sweat":"1f613.png","sweat_drops":"1f4a6.png","sweat_smile":"1f605.png","thinking_face":"1f914.png","thought_balloon":"1f4ad.png","tired_face":"1f62b.png","triumph":"1f624.png","two_hearts":"1f495.png","unamused":"1f612.png","upside_down_face":"1f643.png","weary":"1f629.png","white_frowning_face":"2639-fe0f.png","white_heart":"1f90d.png","wink":"1f609.png","woozy_face":"1f974.png","worried":"1f61f.png","yawning_face":"1f971.png","yellow_heart":"1f49b.png","yum":"1f60b.png","zany_face":"1f92a.png","zipper_mouth_face":"1f910.png","zzz":"1f4a4.png"},"enableQQ":true,"highlight":true,"lang":"zh-CN","meta":["nick","mail","link"],"pageSize":10,"placeholder":"ÂºÄÂßãÂèãÂ•ΩÁöÑ‰∫§ÊµÅÂêß~","recordIP":true,"serverURLs":"https://mukjinfv.api.lncldglobal.com","visitor":true}},"cookieconsent":{"content":{"dismiss":"Got it!","link":"Learn more","message":"This website uses Cookies to improve your experience."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"lightgallery":true,"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jquery@2.1.3/dist/jquery.min.js"></script><script type="text/javascript" src="/js/custom.js"></script></body>
</html>
