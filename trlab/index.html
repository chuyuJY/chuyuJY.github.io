<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>å®ä¹ -ChatGPT - Chuyu&#39;s Blog</title><meta name="Description" content="ğŸ˜"><meta property="og:title" content="å®ä¹ -ChatGPT" />
<meta property="og:description" content="[toc] ä¸€ã€æ™ºèƒ½é—®ç­”ç³»ç»Ÿ èƒŒæ™¯ï¼š ä¼ ç»Ÿç«™å†…æœç´¢ç³»ç»ŸåŸºäºå…³é”®å­—åŒ¹é…ï¼Œåœ¨é¢å‘ï¼šç‰¹å®šé¢†åŸŸçŸ¥è¯†åº“ã€æŠ€æœ¯å›¾è°±ã€äº§å“è¯´æ˜ã€ä¼ä¸š/å­¦æ ¡ç”Ÿæ´»æŒ‡å—ç­‰ä¸šåŠ¡åœºæ™¯æ—¶ï¼Œç¼ºå°‘å¯¹ç”¨" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.seucy.me/trlab/" /><meta property="og:image" content="https://blog.seucy.me/images/avatar.jpg"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-01T20:13:28+08:00" />
<meta property="article:modified_time" content="2023-08-01T20:13:28+08:00" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://blog.seucy.me/images/avatar.jpg"/>

<meta name="twitter:title" content="å®ä¹ -ChatGPT"/>
<meta name="twitter:description" content="[toc] ä¸€ã€æ™ºèƒ½é—®ç­”ç³»ç»Ÿ èƒŒæ™¯ï¼š ä¼ ç»Ÿç«™å†…æœç´¢ç³»ç»ŸåŸºäºå…³é”®å­—åŒ¹é…ï¼Œåœ¨é¢å‘ï¼šç‰¹å®šé¢†åŸŸçŸ¥è¯†åº“ã€æŠ€æœ¯å›¾è°±ã€äº§å“è¯´æ˜ã€ä¼ä¸š/å­¦æ ¡ç”Ÿæ´»æŒ‡å—ç­‰ä¸šåŠ¡åœºæ™¯æ—¶ï¼Œç¼ºå°‘å¯¹ç”¨"/>
<meta name="application-name" content="Chuyu&#39;s Blog">
<meta name="apple-mobile-web-app-title" content="Chuyu&#39;s Blog"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/images/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://blog.seucy.me/trlab/" /><link rel="prev" href="https://blog.seucy.me/20-%E4%BB%A3%E7%A0%81%E5%86%B2%E7%AA%81/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "å®ä¹ -ChatGPT",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/blog.seucy.me\/trlab\/"
        },"genre": "posts","keywords": "å®ä¹ , é¡¹ç›®, ChatGPT","wordcount":  7118 ,
        "url": "https:\/\/blog.seucy.me\/trlab\/","datePublished": "2023-08-01T20:13:28+08:00","dateModified": "2023-08-01T20:13:28+08:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Chuyu"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Chuyu&#39;s Blog">á“« (Â°âŒ‘Â°) Çƒ</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> ç¬”è®° </a><a class="menu-item" href="/tags/"> æ ‡ç­¾ </a><a class="menu-item" href="/categories/"> åˆ†ç±» </a><a class="menu-item" href="/about/"> å…³äº </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Chuyu&#39;s Blog">á“« (Â°âŒ‘Â°) Çƒ</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">ç¬”è®°</a><a class="menu-item" href="/tags/" title="">æ ‡ç­¾</a><a class="menu-item" href="/categories/" title="">åˆ†ç±»</a><a class="menu-item" href="/about/" title="">å…³äº</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">å®ä¹ -ChatGPT</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Chuyu</a></span>&nbsp;<span class="post-category">included in <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>å­¦ä¹ &ç¬”è®°</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2023-08-01">2023-08-01</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;7118 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;15 minutes&nbsp;<span id="/trlab/" class="leancloud_visitors" data-flag-title="å®ä¹ -ChatGPT">
                        <i class="far fa-eye fa-fw" aria-hidden="true"></i>&nbsp;<span class=leancloud-visitors-count></span>&nbsp;views
                    </span>&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="true">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#11-éœ€æ±‚åˆ†æ">1.1 éœ€æ±‚åˆ†æ</a></li>
    <li><a href="#12-æ–¹æ¡ˆåˆ†æ">1.2 æ–¹æ¡ˆåˆ†æ</a>
      <ul>
        <li><a href="#fine-tunning"><strong>Fine-Tunning</strong>ğŸ’°ğŸ‘</a></li>
        <li><a href="#embedding">Embeddingâ­</a></li>
      </ul>
    </li>
    <li><a href="#13-æ•´ä½“æµç¨‹">1.3 æ•´ä½“æµç¨‹</a></li>
    <li><a href="#14-å…³é”®å®ç°">1.4 å…³é”®å®ç°</a>
      <ul>
        <li><a href="#å‡†å¤‡çŸ¥è¯†åº“">å‡†å¤‡çŸ¥è¯†åº“</a>
          <ul>
            <li><a href="#è·å–åŸå§‹ä¿¡æ¯">è·å–åŸå§‹ä¿¡æ¯</a></li>
            <li><a href="#tokenizer">Tokenizer</a></li>
            <li><a href="#å®‰å…¨åˆ†ç‰‡">å®‰å…¨åˆ†ç‰‡</a></li>
            <li><a href="#åµŒå…¥-embedding">åµŒå…¥ Embedding</a></li>
            <li><a href="#å­˜å‚¨æ•°æ®">å­˜å‚¨æ•°æ®</a>
              <ul>
                <li><a href="#milvus">Milvus</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#æœç´¢">æœç´¢</a>
          <ul>
            <li><a href="#chatcompletion">ChatCompletion</a></li>
            <li><a href="#å‰ç½®æ–‡æœ¬">å‰ç½®æ–‡æœ¬</a></li>
            <li><a href="#è¯¢é—®">è¯¢é—®</a></li>
          </ul>
        </li>
        <li><a href="#æ›´æ–°çŸ¥è¯†åº“">æ›´æ–°çŸ¥è¯†åº“</a></li>
      </ul>
    </li>
    <li><a href="#15-åº”ç”¨æ•ˆæœ">1.5 åº”ç”¨æ•ˆæœ</a>
      <ul>
        <li><a href="#å‰ç½®æ–‡æœ¬-1">å‰ç½®æ–‡æœ¬</a></li>
        <li><a href="#çŸ¥è¯†åº“">çŸ¥è¯†åº“</a></li>
        <li><a href="#ä¸­è‹±æ–‡">ä¸­è‹±æ–‡</a></li>
        <li><a href="#å›ç­”æ ¼å¼">å›ç­”æ ¼å¼</a></li>
      </ul>
    </li>
    <li><a href="#16-æ”¹è¿›æ–¹å‘">1.6 æ”¹è¿›æ–¹å‘</a></li>
  </ul>

  <ul>
    <li><a href="#11-éœ€æ±‚åˆ†æ-1">1.1 éœ€æ±‚åˆ†æ</a></li>
    <li><a href="#12-æ•´ä½“æµç¨‹">1.2 æ•´ä½“æµç¨‹</a>
      <ul>
        <li><a href="#å°†åŸå§‹å­—ç¬¦ä¸²-word-è¿›è¡Œæ‹†åˆ†">å°†åŸå§‹å­—ç¬¦ä¸² <code>word</code> è¿›è¡Œæ‹†åˆ†</a></li>
        <li><a href="#æ‹¼æ¥å­—ç¬¦ä¸²">æ‹¼æ¥å­—ç¬¦ä¸²</a></li>
        <li><a href="#æµ‹è¯•">æµ‹è¯•</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>[toc]</p>
<h1 id="ä¸€æ™ºèƒ½é—®ç­”ç³»ç»Ÿ">ä¸€ã€æ™ºèƒ½é—®ç­”ç³»ç»Ÿ</h1>
<blockquote>
<p><strong>èƒŒæ™¯</strong>ï¼š</p>
<p>ä¼ ç»Ÿç«™å†…æœç´¢ç³»ç»ŸåŸºäºå…³é”®å­—åŒ¹é…ï¼Œåœ¨é¢å‘ï¼šç‰¹å®šé¢†åŸŸçŸ¥è¯†åº“ã€æŠ€æœ¯å›¾è°±ã€äº§å“è¯´æ˜ã€ä¼ä¸š/å­¦æ ¡ç”Ÿæ´»æŒ‡å—ç­‰ä¸šåŠ¡åœºæ™¯æ—¶ï¼Œç¼ºå°‘å¯¹ç”¨æˆ·é—®é¢˜ç†è§£å’Œç­”æ¡ˆäºŒæ¬¡å¤„ç†èƒ½åŠ›ã€‚</p>
<p>å¤§è¯­è¨€æ¨¡å‹ï¼ˆLarge Language Model, LLMï¼‰é€šè¿‡å…¶å¯¹è‡ªç„¶è¯­è¨€ç†è§£å’Œç”Ÿæˆçš„èƒ½åŠ›ï¼Œå¯ä»¥çŒœæµ‹ç”¨æˆ·æ„å›¾ï¼Œå¹¶å¯¹åŸå§‹çŸ¥è¯†ç‚¹è¿›è¡Œæç‚¼ã€æ±‡æ€»ã€æ•´åˆï¼Œè¿›è€Œç”Ÿæˆæ›´è´´åˆ‡çš„ç­”æ¡ˆã€‚</p>
<p>ç°æœ‰çš„å¤§è¯­è¨€æ¨¡å‹å¦‚ ChatGPTï¼Œ çŸ¥è¯†åº“ä»…è¦†ç›–è‡³ 2021 å¹´ 9 æœˆå‰çš„ä¿¡æ¯ï¼Œæ— æ³•å‚è€ƒè®­ç»ƒæ•°æ®é›†æœªåŒ…å«çš„ä¿¡æ¯åŠä¹‹åå‡ºç°çš„æ–°ä¿¡æ¯ã€‚</p>
<p>æœ¬æ–‡æ¢ç´¢é€šè¿‡ LLMï¼Œæ‰“é€  <strong>ç‰¹å®šé¢†åŸŸçŸ¥è¯†ï¼ˆDomain-specific Knowledgeï¼‰é—®ç­”</strong>ç³»ç»ŸğŸ¤–ã€‚</p>
</blockquote>
<h2 id="11-éœ€æ±‚åˆ†æ">1.1 éœ€æ±‚åˆ†æ</h2>
<p>åœ¨ Web ç«¯ï¼Œå®ç°ä¸€ä¸ªå¯ä»¥<strong>åœ¨ç‰¹å®šé¢†åŸŸä¸ç”¨æˆ·å¯¹è¯çš„æ™ºèƒ½é—®ç­”ç³»ç»ŸğŸ¤–</strong>ã€‚å…·ä½“éœ€æ±‚åˆ†æå¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">graph
</span></span><span class="line"><span class="cl">ss(æ™ºèƒ½é—®ç­”ç³»ç»Ÿ) --&gt; ä¸­è‹±æ–‡é—®ç­”
</span></span><span class="line"><span class="cl">ss --&gt; ç‰¹å®šé¢†åŸŸ
</span></span><span class="line"><span class="cl">ss --&gt; æ”¯æŒä¸Šä¸‹æ–‡
</span></span><span class="line"><span class="cl">ss --&gt; é¿å…ç¼–é€ ç­”æ¡ˆ
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>é€šè¿‡<strong>é—®ç­”çš„å½¢å¼</strong>ï¼Œå’Œç”¨æˆ·äº¤äº’ï¼ŒåŒæ—¶æ”¯æŒä¸­æ–‡å’Œè‹±æ–‡ï¼›</li>
<li>é—®é¢˜çš„å›ç­”éœ€è¦<strong>å‚è€ƒç«™å†…æä¾›çš„ç‰¹å®šé¢†åŸŸçš„åŸå§‹ä¿¡æ¯</strong>ï¼›</li>
<li><strong>æ”¯æŒä¸Šä¸‹æ–‡</strong>ã€‚ç”¨æˆ·çš„é—®é¢˜å¯èƒ½ä¸å†å²ä¼šè¯ç›¸å…³ï¼Œéœ€è¦ä»å†å²å›ç­”æå–ä¸Šä¸‹æ–‡ï¼›</li>
<li><strong>å›ç­”å‡†ç¡®</strong>ã€‚ChatGPT å¾ˆæ“…é•¿åœ¨ä¸æ“…é•¿çš„é¢†åŸŸâ€œè¡¨ç°â€çš„å¾ˆæ“…é•¿ï¼Œè¦å°½é‡é¿å…è¿™ç§æƒ…å†µï¼</li>
</ul>
<p>ç”±äº LLM æ— æ³•å‚è€ƒé¢„è®­ç»ƒæ•°æ®é›†ä¹‹å¤–çš„æ•°æ®ï¼Œå› æ­¤å®ç°ä¸Šè¿°éœ€æ±‚çš„å…³é”®å°±åœ¨äºï¼š<strong>å¦‚ä½•å‘ LLM åé¦ˆç‰¹å®šé¢†åŸŸçš„çŸ¥è¯†åº“</strong>ã€‚</p>
<h2 id="12-æ–¹æ¡ˆåˆ†æ">1.2 æ–¹æ¡ˆåˆ†æ</h2>
<p>é€šè¿‡è°ƒç ”ï¼Œä¸šç•Œä¸»æµçš„æ–¹æ¡ˆæœ‰ä¸¤ç§ã€‚</p>
<h3 id="fine-tunning"><strong>Fine-Tunning</strong>ğŸ’°ğŸ‘</h3>
<p><strong><code>Fine-Tunning</code></strong>ï¼šå¯¹å¼€æºçš„ LLM è¿›è¡Œå…¨é¢æˆ–éƒ¨åˆ†çš„å¾®è°ƒï¼Œé‡‡ç”¨ fine-tune æˆ–è€… LoRA æŠ€æœ¯ã€‚ä¸šç•Œå·²ç»ä¸å°‘ chatgpt çš„å¹³æ›¿æ–¹æ¡ˆéƒ½æ”¯æŒ<strong>å¾®è°ƒ</strong>ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>
<p>æ¸…åå¤§å­¦äº 2023.03 æå‡ºçš„ <strong>ChatGLM</strong> æ”¯æŒä¸­è‹±åŒè¯­ï¼Œå…·æœ‰ 62 äº¿å‚æ•°ï¼Œå¯ä»¥åœ¨æ¶ˆè´¹çº§æ˜¾å¡ä¸Šéƒ¨ç½²ï¼ŒINT4 é‡åŒ–çº§åˆ«ä¸‹æœ€ä½åªéœ€è¦ 6GB æ˜¾å­˜ã€‚</p>
</li>
<li>
<p><strong>Alpaca</strong> æ˜¯åœ¨ Meta æå‡ºçš„ LLaMA 7B æ¨¡å‹åŸºç¡€ä¸Šå¾®è°ƒçš„ç»“æœã€‚åŸç”Ÿçš„ Alpaca å¯¹ä¸­æ–‡çš„æ”¯æŒå¹¶ä¸å¥½ï¼Œä¸è¿‡å·²ç»ä¸šç•Œä¹Ÿåšäº†äº›<strong>æ‰©å……ä¸­æ–‡è¯è¡¨çš„å¼€æºæ–¹æ¡ˆ</strong>ã€‚</p>
</li>
</ul>
<p><strong>ä¼˜ç‚¹</strong>ï¼š</p>
<ul>
<li>èƒ½ä½¿ LLM <strong>â€œå½»åº•è®°ä½â€ç‰¹å®šçš„é¢†åŸŸçŸ¥è¯†</strong>ï¼Œä»è€Œåœ¨æ‹¥æœ‰ç‰¹å®šçŸ¥è¯†èƒŒæ™¯çš„æ¡ä»¶ä¸‹è¿›äº¤æµï¼›</li>
<li>é‡‡ç”¨<strong>ç§æœ‰éƒ¨ç½²</strong>ï¼Œé€‚åˆç”¨äºä¸€äº›å°šæœªå…¬å¼€çš„å…¬å¸å†…éƒ¨çŸ¥è¯†ï¼Œä¸ä¼šé€ æˆä¿¡æ¯æ³„éœ²ã€‚</li>
</ul>
<p><strong>ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li><strong>èµ„æºæ¶ˆè€—éå¸¸å¤§</strong>ã€‚æ¶ˆè€—çš„èµ„æºé‡è™½ç„¶ç›¸å¯¹å¤§æ¨¡å‹é¢„è®­ç»ƒå‡å°‘ï¼Œä½†è¿˜æ˜¯ä¸å®¹å°è§‘çš„ã€‚æ¯”å¦‚ Alpaca çš„å¾®è°ƒï¼Œæ®ä½œè€…ä»‹ç»ä»–ä»¬ä½¿ç”¨ 8 ä¸ª æ˜¾å­˜ 80GB A100 ï¼ŒèŠ±è´¹äº† 3 ä¸ªå°æ—¶ã€‚å¦‚æœé¢†åŸŸæ”¯æŒé¢‘ç¹æ›´æ–°ï¼Œä¸”éœ€è¦éœ€è¦è¾ƒé«˜çš„å®æ—¶æ€§ï¼Œæ˜¾ç„¶æ˜¯æ— æ³•æ»¡è¶³è¦æ±‚çš„ã€‚</li>
<li><strong>éœ€è¦æ„å»ºç‰¹å®šé¢„è®­ç»ƒè¯­æ–™åº“</strong>ã€‚é«˜è´¨é‡è®­ç»ƒæ•°æ®é›†çš„æ„å»ºéœ€è¦ç²¾å¿ƒè®¾è®¡ï¼Œå¼€é”€ä¹Ÿæ˜¯ä¸å®¹å¿½è§†çš„ã€‚</li>
<li><strong>å¾®è°ƒçš„ç»“æœä¸ä¸€å®šç¬¦åˆé¢„æœŸ</strong>ã€‚</li>
</ul>
<h3 id="embedding">Embeddingâ­</h3>
<p><strong><code>Embedding</code></strong>ï¼šé€šè¿‡åµŒå…¥æ¨¡å‹ï¼Œå°†ç‰¹å®šçŸ¥è¯†è½¬åŒ–ä¸ºå‘é‡ <code>Embedding</code>ï¼Œç„¶åå°†è¿™äº›å‘é‡å­˜å…¥ç›¸åº”çš„å‘é‡æ•°æ®åº“ä¸­ã€‚åœ¨æŸ¥è¯¢é˜¶æ®µï¼Œé€šè¿‡ç›¸ä¼¼åº¦æŸ¥è¯¢ï¼ŒåŒ¹é…å‡ºå…³è”çš„ <code>topK</code> ç»“æœï¼Œç„¶åå°†è¿™äº›ç»“æœæä¾›ç»™ LLMï¼Œç”Ÿæˆç›¸åº”çš„ç­”æ¡ˆã€‚</p>
<p><strong>ä¼˜ç‚¹</strong>ï¼š</p>
<ul>
<li>æˆæœ¬ä½ï¼›</li>
<li>ä¼˜ç§€çš„æ­£ç¡®åº¦å’Œç²¾ç¡®åº¦ï¼›</li>
</ul>
<p><strong>ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li>å¯èƒ½å­˜åœ¨æ•°æ®æ³„éœ²çš„é£é™©ï¼›</li>
<li>å¯åµŒå…¥çš„æ–‡æœ¬æœ‰é•¿åº¦é™åˆ¶ï¼Œå¯èƒ½ä¼šæœ‰ä¸¢å¤±éƒ¨åˆ†ä¸Šä¸‹æ–‡çš„é£é™©ã€‚</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center"><strong>Model</strong></th>
<th style="text-align:center"><strong>Maximum text length</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>gpt-3.5-turbo</strong></td>
<td style="text-align:center">4,096(~5 pages)</td>
</tr>
<tr>
<td style="text-align:center"><strong>gpt-4</strong></td>
<td style="text-align:center">8,192(~10 pages)</td>
</tr>
<tr>
<td style="text-align:center"><strong>gpt-4-32k</strong></td>
<td style="text-align:center">32,768(~40 pages)</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>å‚è€ƒé“¾æ¥</strong>ï¼š</p>
<ul>
<li><a href="https://github.com/openai/openai-cookbook/blob/main/examples/Question_answering_using_embeddings.ipynb?spm=wolai.workspace.0.0.357e11a2XSQ9wO&amp;file=Question_answering_using_embeddings.ipynb" target="_blank" rel="noopener noreffer ">Question answering using embeddings-based search</a></li>
</ul>
</blockquote>
<h2 id="13-æ•´ä½“æµç¨‹">1.3 æ•´ä½“æµç¨‹</h2>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230701211057416.png" alt="image-20230701211057416" style="zoom:50%;" />
<ol>
<li>
<p>å‡†å¤‡é¢†åŸŸçŸ¥è¯†åº“ï¼ˆæ¯ä¸ªæ–‡æ¡£éœ€è¦ä¸€æ¬¡ï¼‰</p>
<ul>
<li>
<p><strong>æ”¶é›†æ–‡æœ¬ä¿¡æ¯</strong>ï¼šé€šè¿‡æŒ‡å®šæ•°æ®æºè·å–åŸå§‹æ–‡æœ¬ä¿¡æ¯ï¼›</p>
</li>
<li>
<p><strong>åˆ†å—ï¼ˆChunkï¼‰</strong>ï¼šæ ¹æ® <code>Token</code> é™åˆ¶ï¼Œå°†é•¿æ–‡æœ¬æ‹†åˆ†æˆçŸ­æ–‡æœ¬ï¼›</p>
</li>
<li>
<p><strong>åµŒå…¥ï¼ˆEmbeddingï¼‰</strong>ï¼šé€šè¿‡ OpenAI API è·å–æ¯å—æ–‡æœ¬çš„åµŒå…¥ä¿¡æ¯ <code>Embedding</code>ï¼›</p>
</li>
<li>
<p><strong>å­˜å‚¨</strong>ï¼šå°† <code>Embedding</code> ä¿å­˜åœ¨å‘é‡æ•°æ®åº“ï¼Œæ¨èä½¿ç”¨<code>Milvus</code>ã€‚</p>
</li>
</ul>
</li>
<li>
<p>æœç´¢ï¼ˆæ¯æ¬¡æŸ¥è¯¢éœ€è¦ä¸€æ¬¡ï¼‰</p>
<ul>
<li>
<p>ç»™å®šä¸€ä¸ªç”¨æˆ·æŸ¥è¯¢è¯·æ±‚ï¼Œé€šè¿‡ OpenAI API ç”Ÿæˆè¯¥é—®é¢˜å¯¹åº”çš„ <code>Embedding</code>ï¼›</p>
</li>
<li>
<p>ä»å‘é‡æ•°æ®åº“ä¸­æŸ¥è¯¢ä¸è¯¥é—®é¢˜å¯¹åº” <code>Embedding</code> æœ€ç›¸ä¼¼çš„ <code>TopN</code> ä¸ªæ–‡æœ¬ï¼Œå¹¶æŒ‰ç…§ç›¸ä¼¼åº¦æ’åºï¼›</p>
</li>
</ul>
</li>
<li>
<p>è¯¢é—®ï¼ˆæ¯æ¬¡æŸ¥è¯¢éœ€è¦ä¸€æ¬¡ï¼‰</p>
<ul>
<li>
<p>å°†å‰ç½®èƒŒæ™¯ä¿¡æ¯ã€å†å²é—®ç­”ã€æŸ¥è¯¢é—®é¢˜ã€ç›¸ä¼¼æ–‡æœ¬æ’å…¥åˆ°ä¸€ä¸ª <code>Complection</code> å‘é€ç»™ ChatGPTï¼›</p>
</li>
<li>
<p>è¿”å› <code>ChatGPT</code> çš„å›ç­”å¹¶è¿›è¡Œå¤„ç†ã€‚</p>
</li>
</ul>
</li>
</ol>
<h2 id="14-å…³é”®å®ç°">1.4 å…³é”®å®ç°</h2>
<p>ä»¥ä¸‹åŠŸèƒ½å‡é€šè¿‡ Go å®ç°ã€‚</p>
<h3 id="å‡†å¤‡çŸ¥è¯†åº“">å‡†å¤‡çŸ¥è¯†åº“</h3>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230702233639346.png" alt="image-20230702233639346" style="zoom: 50%;" />
<h4 id="è·å–åŸå§‹ä¿¡æ¯">è·å–åŸå§‹ä¿¡æ¯</h4>
<p>è¿™é‡Œçš„æ–‡æœ¬æ¥æºä¸»è¦æ˜¯ï¼šhttps://trlab.com/</p>
<p>å¯ä»¥é€šè¿‡ Go çš„çˆ¬è™«æ¡†æ¶ Colly å†™ä¸€ä¸ªç®€æ˜“çš„è„šæœ¬ï¼Œçˆ¬å–<strong>æ–‡ç« </strong>å’Œ <strong>FAQS</strong>ã€‚æ­¤å¤„ç›´æ¥ä»æ¥å£è·å–ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">CrawArticles</span><span class="p">(</span><span class="nx">url</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">object</span> <span class="nx">any</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">c</span> <span class="o">:=</span> <span class="nx">colly</span><span class="p">.</span><span class="nf">NewCollector</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">c</span><span class="p">.</span><span class="nf">OnRequest</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">r</span> <span class="o">*</span><span class="nx">colly</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Visiting&#34;</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">URL</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl">	<span class="nx">c</span><span class="p">.</span><span class="nf">OnResponse</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">response</span> <span class="o">*</span><span class="nx">colly</span><span class="p">.</span><span class="nx">Response</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">json</span><span class="p">.</span><span class="nf">Unmarshal</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">Body</span><span class="p">,</span> <span class="nx">object</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">logger</span><span class="p">.</span><span class="nx">ZapLogger</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nf">Error</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl">	<span class="nx">c</span><span class="p">.</span><span class="nf">Visit</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>CrawArticles()</code> å‚æ•°ä¸ºä¸€ä¸ªæ¥å£åœ°å€ <code>url</code> å’Œæ¥æ”¶å¯¹è±¡ <code>object</code>ï¼Œä¼šå°†è·å–çš„ä¿¡æ¯æŒ‰ç…§ <code>object</code> æ ¼å¼è¿›è¡Œè§£æã€‚</p>
<h4 id="tokenizer">Tokenizer</h4>
<p><strong><code>Token</code></strong>ï¼šLLM ç†è§£è¯­è¨€çš„åŸºæœ¬å•å…ƒï¼Œé€šè¿‡å°†æ–‡æœ¬åˆ†è§£ä¸º Token æ¥ç†è§£å’Œå¤„ç†æ–‡æœ¬ã€‚å•è¯å’Œ Token ä¸æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œæ¯”å¦‚ <code>goodness</code> å°±ç”±<code>good</code>ã€<code>ness</code> ä¸¤ä¸ª Token ç»„æˆã€‚ä¸­æ–‡é€šå¸¸å…ˆè½¬æ¢ä¸º Unicode æˆ– UTF-8 ç¼–ç ï¼Œå†è½¬æ¢æˆ Tokenã€‚</p>
<p><strong><code>Tokenizer</code></strong>ï¼šåˆ†è¯å™¨ï¼Œå°†æ–‡æœ¬åˆ†æˆä¸€ä¸ªä¸ªè¯å…ƒï¼Œä¿è¯å„ä¸ªè¯å…ƒæ‹¥æœ‰ç›¸å¯¹å®Œæ•´å’Œç‹¬ç«‹çš„è¯­ä¹‰ï¼Œä»¥ä¾›åç»­ä»»åŠ¡æ¯”å¦‚ <code>Embedding</code> ä½¿ç”¨ã€‚æ­¤å¤„é€‰ç”¨<code>Tiktoken</code>ï¼Œæœ‰å¤šç§ç¼–ç æ–¹æ³•å¯é€‰ï¼Œå¦‚ï¼š<code>r50k_base</code>ï¼Œ<code>p50k_base</code>ï¼Œ<code>cl100k_base</code> ç­‰ã€‚é¢å‘ OpenAI çš„ <code>gpt-4</code>ï¼Œ<code>gpt-3.5-turbo</code> å’Œ <code>text-embedding-ada-002</code> æ¨¡å‹é€šå¸¸ä½¿ç”¨ <code>cl100k_base</code> ç¼–ç æ–¹æ³•ã€‚</p>
<p>äº†è§£æ–‡æœ¬ä¸­çš„ Token æ•°é‡ï¼Œæ—¢å¯ä»¥å‘Šè¯‰ä½ å­—ç¬¦ä¸²æ˜¯å¦å¤ªé•¿è€Œè¶…å‡ºäº†æ¨¡å‹å¤„ç†èƒ½åŠ›ï¼Œä¹Ÿå¯ä»¥æŸ¥çœ‹ OpenAI çš„ API è´¹ç”¨ï¼ˆæŒ‰ç…§tokenè®¡è´¹ï¼‰ã€‚</p>
<p>OpenAI å®˜æ–¹æä¾›äº†ä¸€ä¸ªåœ¨çº¿<a href="https://platform.openai.com/tokenizer" target="_blank" rel="noopener noreffer ">åˆ†è¯å·¥å…·</a>ï¼Œæ ¹æ®å·¥å…·æä¾›çš„åˆ†è¯ç»“æœçœ‹ï¼Œ<strong>1 ä¸ªä¸­æ–‡è¯è¯­ä¼šåˆ†è§£ä¸º 2/3 ä¸ª Token</strong>ã€‚</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230708182218806.png" alt="image-20230708182218806" style="zoom:50%;" />
<p>OpenAI æŒ‰ç…§ <code>token</code> æ•°ç›®æ”¶è´¹ï¼Œå¹¶ä¸”æ¯ä¸ª <code>embedding-model</code> å’Œ <code>gpt-model</code> å¯¹ <code>token</code> æ•°ç›®éƒ½æœ‰é™åˆ¶ï¼Œè¶…å‡ºéƒ¨åˆ†ä¼šè¢«æˆªæ–­ã€‚æ³¨æ„ï¼šé•¿åº¦æ˜¯æŒ‡é€šè¿‡ <code>Tokenizer</code> è®¡ç®—å‡ºçš„ <code>token</code>é•¿åº¦ï¼Œè€Œéæ–‡æœ¬å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚</p>
<p>æ¯”å¦‚ <code>text-embedding-ada-002</code>  é‡‡ç”¨çš„  <code>cl100k_base</code> çš„ <code>max token</code> ä¸º 8191ï¼Œè€Œ <code>gpt-3.5-turbo</code> å•æ¬¡è¯¢é—®çš„ <code>max token</code> ä¸º 4096ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:center">EMBEDDING MODEL</th>
<th style="text-align:center">TOKENIZER</th>
<th style="text-align:center">MAX INPUT TOKENS</th>
<th style="text-align:center">OUTPUT DIMENSIONS</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>text-embedding-ada-002</code></td>
<td style="text-align:center"><code>cl100k_base</code></td>
<td style="text-align:center">8191</td>
<td style="text-align:center">1536</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>GPT MODEL</th>
<th>MAX TOKENS</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>gpt-3.5-turbo</code></td>
<td>4,096 tokens (~5 pages)</td>
</tr>
<tr>
<td><code>gpt-3.5-turbo-16k</code></td>
<td>16,384 tokensï¼ˆ~20 pagesï¼‰</td>
</tr>
<tr>
<td><code>gpt-4</code></td>
<td>8,192 tokens (~10 pages)</td>
</tr>
<tr>
<td><code>gpt-4-32k</code></td>
<td>32,768 tokens (~40 pages)</td>
</tr>
</tbody>
</table>
<p>å®˜æ–¹æ–‡æ¡£æä¾›äº† Python è®¡ç®— <code>Token</code> çš„æ–¹æ³•ï¼Œæ­¤å¤„æä¾› Go çš„ç‰ˆæœ¬ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// CountMessagesTokens based on &#34;How_to_count_tokens_with_tiktoken.ipynb&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">CountMessagesTokens</span><span class="p">(</span><span class="nx">model</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">messages</span> <span class="o">...</span><span class="nx">openai</span><span class="p">.</span><span class="nx">ChatCompletionMessage</span><span class="p">)</span> <span class="p">(</span><span class="nx">numTokens</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">tkm</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">tiktoken</span><span class="p">.</span><span class="nf">EncodingForModel</span><span class="p">(</span><span class="nx">model</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">err</span> <span class="p">=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;encoding for model: %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nx">log</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">tokensPerMessage</span><span class="p">,</span> <span class="nx">tokensPerName</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl">	<span class="k">switch</span> <span class="nx">model</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">case</span> <span class="s">&#34;gpt-3.5-turbo-0613&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;gpt-3.5-turbo-16k-0613&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;gpt-4-0314&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;gpt-4-32k-0314&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;gpt-4-0613&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;gpt-4-32k-0613&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">		<span class="nx">tokensPerMessage</span> <span class="p">=</span> <span class="mi">3</span>
</span></span><span class="line"><span class="cl">		<span class="nx">tokensPerName</span> <span class="p">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">	<span class="k">case</span> <span class="s">&#34;gpt-3.5-turbo-0301&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">		<span class="nx">tokensPerMessage</span> <span class="p">=</span> <span class="mi">4</span> <span class="c1">// every message follows &lt;|start|&gt;{role/name}\n{content}&lt;|end|&gt;\n
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">tokensPerName</span> <span class="p">=</span> <span class="o">-</span><span class="mi">1</span>   <span class="c1">// if there&#39;s a name, the role is omitted
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">default</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="nx">model</span><span class="p">,</span> <span class="s">&#34;gpt-3.5-turbo&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="c1">//logger.ZapLogger.Warn(&#34;warning: gpt-3.5-turbo may update over time. Returning num tokens assuming gpt-3.5-turbo-0613.&#34;)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="k">return</span> <span class="nf">CountMessagesTokens</span><span class="p">(</span><span class="s">&#34;gpt-3.5-turbo-0613&#34;</span><span class="p">,</span> <span class="nx">messages</span><span class="o">...</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="nx">model</span><span class="p">,</span> <span class="s">&#34;gpt-4&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="c1">//logger.ZapLogger.Warn(&#34;warning: gpt-4 may update over time. Returning num tokens assuming gpt-4-0613.&#34;)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="k">return</span> <span class="nf">CountMessagesTokens</span><span class="p">(</span><span class="s">&#34;gpt-4-0613&#34;</span><span class="p">,</span> <span class="nx">messages</span><span class="o">...</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">err</span> <span class="p">=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;num_tokens_from_messages() is not implemented for model %s. See https://github.com/openai/openai-python/blob/main/chatml.md for information on how messages are converted to tokens.&#34;</span><span class="p">,</span> <span class="nx">model</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="nx">logger</span><span class="p">.</span><span class="nx">ZapLogger</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nf">Error</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">message</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">messages</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">numTokens</span> <span class="o">+=</span> <span class="nx">tokensPerMessage</span>
</span></span><span class="line"><span class="cl">		<span class="nx">numTokens</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">tkm</span><span class="p">.</span><span class="nf">Encode</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">Content</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="kc">nil</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		<span class="nx">numTokens</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">tkm</span><span class="p">.</span><span class="nf">Encode</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">Role</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="kc">nil</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		<span class="nx">numTokens</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">tkm</span><span class="p">.</span><span class="nf">Encode</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="kc">nil</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">message</span><span class="p">.</span><span class="nx">Name</span> <span class="o">!=</span> <span class="s">&#34;&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">numTokens</span> <span class="o">+=</span> <span class="nx">tokensPerName</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">numTokens</span> <span class="o">+=</span> <span class="mi">3</span> <span class="c1">// every reply is primed with &lt;|start|&gt;assistant&lt;|message|&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">return</span> <span class="nx">numTokens</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="å®‰å…¨åˆ†ç‰‡">å®‰å…¨åˆ†ç‰‡</h4>
<p><strong>å®‰å…¨åˆ†ç‰‡</strong>ï¼šå°†åŸå§‹çŸ¥è¯†åº“æ‹†åˆ†ä¸ºè‹¥å¹²ä¸ªç‹¬ç«‹ã€è¾ƒçŸ­çš„çŸ¥è¯†ç‚¹â­æ¯ä¸ªçŸ¥è¯†ç‚¹ä¼šä½œä¸ºé—®ç­”çš„æœ€å°è®°å½•ï¼Œä¸é—®é¢˜è¿›è¡ŒåŒ¹é…ã€‚</p>
<p>åˆ†ç‰‡æ—¶æœ‰å¦‚ä¸‹å¯å‚è€ƒçš„åŸåˆ™ï¼š</p>
<ul>
<li>åŸå§‹å†…å®¹åœ¨ç¼–å†™ã€ç»„ç»‡æ—¶æœ€å¥½åŸå­åŒ–ã€æ­£äº¤åŒ–ã€‚å¯¹äºæ ‘çŠ¶ç»“æ„çš„çŸ¥è¯†ç‚¹ï¼Œå¯ä»¥æŒ‰å±‚çº§å…³ç³»è¡¨ç¤ºï¼Œæœ€å¥½ä¸è¦æ··ä¸ºä¸€è°ˆã€‚æ¯”å¦‚å€šå¤©å‰‘å¯èƒ½åŸºç¡€å±æ€§ï¼Œä¹Ÿæœ‰é€‚åˆçš„æ‰“æ³•ï¼Œåå‘çš„è‹±é›„å¤©èµ‹ï¼Œé‚£ä¹ˆä¸‰è€…åº”è¯¥ç‹¬ç«‹æè¿°ï¼Œè€Œä¸è¦æ··æ‚åœ¨ä¸€èµ·ï¼›</li>
<li>å¯ä»¥åœ¨åŸå§‹è¯­æ–™ä¸­è®¾è®¡æ˜ç¡®çš„åˆ†ç‰‡æ ‡è®°ï¼Œç®€åŒ–å¤„ç†è¿‡ç¨‹ï¼›</li>
<li>åŸºæœ¬çš„åˆ†ç‰‡æ–¹å¼ï¼Œç²’åº¦ä»ç»†åˆ°ç²—å¯ä»¥ä½¿ç”¨ï¼šæ ‡ç‚¹ç¬¦å·ã€æ®µè½ã€ç« èŠ‚ç­‰ã€‚åˆ†ç‰‡ç²’åº¦è¿‡ç»†ï¼ŒçŸ¥è¯†ç‚¹ä¼šæ¯”è¾ƒé›¶ç¢å½±å“äº†ç›¸äº’é—´çš„å…³ç³»ï¼›åˆ†ç‰‡ç²’åº¦è¿‡ç²—ï¼Œåœ¨åŒ¹é…æ—¶å¯èƒ½ä¼šæºå¸¦å†—ä½™ä¿¡æ¯ï¼Œå¦å¤–å¯¹ <code>Embedding</code>ã€å¤„ç†ã€ç´¢å¼•çš„æ•ˆç‡ä¹Ÿæœ‰å½±å“ã€‚</li>
<li>åˆ†ç‰‡è¦ä½¿ç”¨ <code>Tokenizer</code>ï¼ŒåŸå§‹æ–‡æœ¬ç»è¿‡åˆ†è¯ç„¶åå†è¿›è¡Œ <code>Embedding</code>ï¼Œåˆ†ç‰‡å¤§å°éœ€è¦è€ƒè™‘åˆ†è¯ä¹‹åç”Ÿæˆçš„ <code>Token</code> æ•°é‡ã€‚åŸºæœ¬ç›®æ ‡æ˜¯ï¼šåˆ†ç‰‡ä¸èƒ½ç ´åçŸ¥è¯†ç‚¹çš„å®Œæ•´æ€§ï¼Œç”Ÿæˆçš„åˆ†ç‰‡å¯¹åº”çš„ <code>Token</code> æ•°é‡åº”è¯¥åœ¨é¢„è®¾èŒƒå›´å†…ï¼Œä¸è¦è¿‡å°æˆ–è¿‡å¤§ã€‚</li>
</ul>
<p>æ­¤å¤„æŒ‰ç…§é™åˆ¶çš„ <code>Token</code> æœ€å¤§é•¿åº¦ï¼Œåˆ‡å‰² <code>string</code> ç±»å‹çš„æ–‡æœ¬ä¿¡æ¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// ChunkedTokens encodes a string into tokens and then breaks it up into chunks
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">ChunkedTokens</span><span class="p">(</span><span class="nx">text</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">model</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">chunkLength</span> <span class="kt">int</span><span class="p">)</span> <span class="p">[][]</span><span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">chunkLength</span> <span class="p">&lt;</span> <span class="mi">1</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">logger</span><span class="p">.</span><span class="nx">ZapLogger</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="s">&#34;chunkLength must be at least one&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nf">Batched</span><span class="p">(</span><span class="nf">GetToken</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span> <span class="nx">model</span><span class="p">),</span> <span class="nx">chunkLength</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Batched batch data into slices of length n. The last batch may be shorter.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">Batched</span><span class="p">(</span><span class="nx">data</span> <span class="p">[]</span><span class="kt">int</span><span class="p">,</span> <span class="nx">n</span> <span class="kt">int</span><span class="p">)</span> <span class="p">[][]</span><span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">batches</span> <span class="p">[][]</span><span class="kt">int</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nb">len</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">&lt;</span> <span class="nx">n</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">n</span> <span class="p">=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="nx">batch</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span> <span class="nx">n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nb">copy</span><span class="p">(</span><span class="nx">batch</span><span class="p">,</span> <span class="nx">data</span><span class="p">[:</span><span class="nx">n</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">		<span class="nx">batches</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">batches</span><span class="p">,</span> <span class="nx">batch</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nx">data</span> <span class="p">=</span> <span class="nx">data</span><span class="p">[</span><span class="nx">n</span><span class="p">:]</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">batches</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç”±äº Go-SDK å¾ˆä¸å®Œå–„ï¼Œç›®å‰æ²¡æœ‰ä» <code>Token</code> æ„é€  OpenAI è¯·æ±‚çš„æ–¹æ³•ï¼Œå› æ­¤éœ€è¦è®°å½•æ¯ä¸ª <code>Token</code> å¯¹åº”çš„æ–‡æœ¬ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯éœ€è¦å®ç°ä» <code>Token</code> é‡æ–°è§£æä¸º <code>string</code> ç±»å‹çš„æ–‡æœ¬ä¿¡æ¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">GetToken</span><span class="p">(</span><span class="nx">text</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">model</span> <span class="kt">string</span><span class="p">)</span> <span class="p">[]</span><span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">enc</span> <span class="o">:=</span> <span class="nf">RegisterEncoder</span><span class="p">(</span><span class="nx">model</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">enc</span><span class="p">.</span><span class="nf">Encode</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">ParseToken</span><span class="p">(</span><span class="nx">token</span> <span class="p">[]</span><span class="kt">int</span><span class="p">,</span> <span class="nx">model</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">enc</span> <span class="o">:=</span> <span class="nf">RegisterEncoder</span><span class="p">(</span><span class="nx">model</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">enc</span><span class="p">.</span><span class="nf">Decode</span><span class="p">(</span><span class="nx">token</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ€ç»ˆè·å¾—å®‰å…¨åˆ†ç‰‡å‡½æ•°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// SafeGetChunks safely handles embedding requests, even when the input text is longer than the maximum context length.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">SafeGetChunks</span><span class="p">(</span><span class="nx">textBot</span> <span class="o">*</span><span class="nx">openai</span><span class="p">.</span><span class="nx">Client</span><span class="p">,</span> <span class="nx">model</span> <span class="nx">openai</span><span class="p">.</span><span class="nx">EmbeddingModel</span><span class="p">,</span> <span class="nx">text</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">average</span> <span class="kt">bool</span><span class="p">,</span> <span class="nx">maxToken</span> <span class="kt">int</span><span class="p">)</span> <span class="p">[]</span><span class="o">*</span><span class="nx">chatgpt</span><span class="p">.</span><span class="nx">Chunk</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">chunks</span> <span class="p">[]</span><span class="o">*</span><span class="nx">chatgpt</span><span class="p">.</span><span class="nx">Chunk</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">chunkLens</span> <span class="p">[]</span><span class="kt">int</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">totalLen</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">chunk</span> <span class="o">:=</span> <span class="k">range</span> <span class="nf">ChunkedTokens</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span> <span class="nx">model</span><span class="p">.</span><span class="nf">String</span><span class="p">(),</span> <span class="nx">maxToken</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">t</span> <span class="o">:=</span> <span class="nf">ParseToken</span><span class="p">(</span><span class="nx">chunk</span><span class="p">,</span> <span class="nx">model</span><span class="p">.</span><span class="nf">String</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">		<span class="nx">chunks</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">chunks</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">chatgpt</span><span class="p">.</span><span class="nx">Chunk</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">Embedding</span><span class="p">:</span> <span class="nf">GetEmbedding</span><span class="p">(</span><span class="nx">textBot</span><span class="p">,</span> <span class="nx">model</span><span class="p">,</span> <span class="nx">t</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">			<span class="nx">Content</span><span class="p">:</span>   <span class="nx">t</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="p">})</span>
</span></span><span class="line"><span class="cl">		<span class="nx">chunkLens</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">chunkLens</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">chunk</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		<span class="nx">totalLen</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">chunk</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// return the weighted average of the chunk embeddings
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="nx">average</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">sum</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">float64</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">chunks</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">Embedding</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">chunk</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">chunks</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">for</span> <span class="nx">j</span><span class="p">,</span> <span class="nx">val</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">chunk</span><span class="p">.</span><span class="nx">Embedding</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nx">sum</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">float64</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="o">*</span> <span class="nb">float64</span><span class="p">(</span><span class="nx">chunkLens</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">sum</span><span class="p">);</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">sum</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">/=</span> <span class="nb">float64</span><span class="p">(</span><span class="nx">totalLen</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="p">[]</span><span class="o">*</span><span class="nx">chatgpt</span><span class="p">.</span><span class="nx">Chunk</span><span class="p">{{</span><span class="nx">Embedding</span><span class="p">:</span> <span class="nf">NormalizeVector</span><span class="p">(</span><span class="nx">sum</span><span class="p">),</span> <span class="nx">Content</span><span class="p">:</span> <span class="nx">text</span><span class="p">}}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">chunks</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="åµŒå…¥-embedding">åµŒå…¥ Embedding</h4>
<p><strong>åµŒå…¥</strong>ï¼šç”±è‡ªç„¶è¯­è¨€æ–‡æœ¬è½¬åŒ–æˆçš„æµ®ç‚¹æ•°å‘é‡ï¼Œç›®çš„æ˜¯å°†æ–‡æœ¬æ˜ å°„åˆ°å‘é‡ç©ºé—´ä¸­ï¼Œä½¿å¾—è¿™äº›å‘é‡å¯ä»¥è¢«è®¡ç®—æœºç¨‹åºæ‰€ä½¿ç”¨ã€‚ä½¿ç”¨ OpenAI API å¯¹åˆ†ç‰‡åçš„çŸ¥è¯†ç‚¹è¿›è¡Œå¤„ç†ï¼Œè·å¾—å‘é‡åŒ–çš„ç»“æœ <code>Embedding</code>ï¼Œè¿™é‡Œéœ€è¦è°ƒç”¨ <code>openai.Embedding.create</code> æ¥å£ã€‚</p>
<p><strong>ç›¸ä¼¼åº¦è®¡ç®—</strong>ï¼š</p>
<p><strong>ä½™å¼¦ç›¸ä¼¼åº¦è®¡ç®—</strong>ï¼šä½™å¼¦ç›¸ä¼¼åº¦çš„å–å€¼èŒƒå›´åœ¨ -1 åˆ° 1 ä¹‹é—´ï¼Œå€¼è¶Šæ¥è¿‘ 1 è¡¨ç¤ºä¸¤ä¸ªå‘é‡è¶Šç›¸ä¼¼ï¼Œå€¼è¶Šæ¥è¿‘ -1 è¡¨ç¤ºä¸¤ä¸ªå‘é‡è¶Šä¸ç›¸ä¼¼ï¼Œå€¼ç­‰äº 0 è¡¨ç¤ºä¸¤ä¸ªå‘é‡æ­£äº¤ã€‚
$$
cosine_similarity = \frac{\mathbf{A} \cdot \mathbf{B}}{|\mathbf{A}| |\mathbf{B}|}
$$</p>
<h4 id="å­˜å‚¨æ•°æ®">å­˜å‚¨æ•°æ®</h4>
<p><strong>å­˜å‚¨æ•°æ®</strong>ï¼šå°†ç”Ÿæˆçš„ <code>Embedding</code> å‘é‡è¿åŒåŸå§‹åˆ†ç‰‡çŸ¥è¯†ç‚¹ï¼Œä»¥ <code>k-v</code> å½¢å¼å­˜å‚¨ï¼Œä¾¿äºåç»­å¿«é€ŸåŒ¹é…ç´¢å¼•ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">graph
</span></span><span class="line"><span class="cl">å­˜å‚¨æ•°æ® --&gt; Milvus
</span></span><span class="line"><span class="cl">å­˜å‚¨æ•°æ® --&gt; RedisSearch
</span></span><span class="line"><span class="cl">å­˜å‚¨æ•°æ® --&gt; pgvector
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ­¤å¤„é‡‡ç”¨ <code>Milvus</code> ä½œä¸ºå‘é‡æ•°æ®åº“ï¼ŒåŒæ—¶ä»‹ç»ä»¥ä¸‹ä¸¤ç§ä½œä¸ºå‚è€ƒï¼š</p>
<ul>
<li><code>RediSearch</code> æä¾›çš„ <strong>Vector Similarity</strong>ï¼Œæ”¯æŒä½¿ç”¨å‘é‡å­—æ®µå’Œå‘é‡ç›¸ä¼¼æ€§æŸ¥è¯¢ã€‚å®ƒå¯ä»¥åŠ è½½ã€ç´¢å¼•å’ŒæŸ¥è¯¢å­˜å‚¨åœ¨ Redis å“ˆå¸Œæˆ– JSON æ–‡æ¡£ï¼ˆé€šè¿‡ä¸ RedisJSON æ¨¡å—é›†æˆï¼‰ä¸­çš„å‘é‡ã€‚Vector Similarity æä¾›äº†å®æ—¶å‘é‡ç´¢å¼•ã€å®æ—¶å‘é‡æ›´æ–°/åˆ é™¤ã€K-æœ€è¿‘é‚»ï¼ˆKNNï¼‰æœç´¢å’ŒèŒƒå›´è¿‡æ»¤ç­‰åŠŸèƒ½ã€‚</li>
<li><code>pgvector</code> åŸºäº PostgresQLï¼Œæä¾›äº†ç±»ä¼¼çš„å‘é‡ç´¢å¼•æ”¯æŒã€‚å’Œ Redis çš„åŸºæœ¬åŠŸèƒ½å·®ä¸å¤šï¼Œåœ¨å‘é‡è·ç¦»è®¡ç®—æ–¹é¢ï¼Œä¹Ÿæä¾›äº†ï¼šL2ã€ç‚¹ç§¯å’Œ COSINE è¿™ä¸‰ç§æ–¹æ³•ã€‚ä½¿ç”¨ Redis æ¯”è¾ƒç®€å•é«˜æ•ˆï¼Œæ¥å£å’Œæ–‡æ¡£éå¸¸ä¸°å¯Œï¼Œå¦‚æœæ²¡æœ‰ç‰¹åˆ«è¦æ±‚å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</li>
</ul>
<h5 id="milvus">Milvus</h5>
<p>åœ¨ k8s éƒ¨ç½² MIlvusï¼Œé€šè¿‡ curl æ“ä½œã€‚</p>
<ol>
<li>å®‰è£… <code>kubectl</code> å’Œ <code>devspace</code>ï¼Œå‰è€…ç”¨äºæ§åˆ¶ <code>kube</code> é›†ç¾¤ï¼Œåè€…ç”¨äºç®¡ç† <code>kube</code> çš„ <code>namespace</code>ã€‚</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># åˆ‡æ¢åˆ° dev</span>
</span></span><span class="line"><span class="cl">devspace use namespace dev
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>æ£€æŸ¥ <code>running</code> çŠ¶æ€çš„ <code>pods</code></li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl get pods
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">milvus-etcd-0                               1/1     Running   <span class="m">0</span>          46m
</span></span><span class="line"><span class="cl">milvus-etcd-1                               1/1     Running   <span class="m">0</span>          46m
</span></span><span class="line"><span class="cl">milvus-etcd-2                               1/1     Running   <span class="m">0</span>          46m
</span></span><span class="line"><span class="cl">milvus-minio-76d74f7dd8-f5spg               1/1     Running   <span class="m">0</span>          46m
</span></span><span class="line"><span class="cl">milvus-standalone-6f895b96c-789gp           1/1     Running   <span class="m">0</span>          46m
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>æŸ¥çœ‹æœåŠ¡</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl get svc
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="4">
<li>æ˜ å°„åˆ°æœ¬åœ°ç«¯å£</li>
</ol>
<p>éœ€è¦åå°ä¸€ç›´è¿è¡Œè¯¥æœåŠ¡</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl port-forward svc/milvus 9091:9091
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="5">
<li>æµ‹è¯•æ˜¯å¦æˆåŠŸ</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl localhost:9091/api/v1/health
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="6">
<li>è¿æ¥ Milvus</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pymilvus</span> <span class="kn">import</span> <span class="n">connections</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">connections</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">alias</span><span class="o">=</span><span class="s2">&#34;default&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">port</span><span class="o">=</span><span class="s1">&#39;19530&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="7">
<li>æ–°å»º <code>collection</code></li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pymilvus</span> <span class="kn">import</span> <span class="n">CollectionSchema</span><span class="p">,</span> <span class="n">FieldSchema</span><span class="p">,</span> <span class="n">DataType</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">record_id</span> <span class="o">=</span> <span class="n">FieldSchema</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">name</span><span class="o">=</span><span class="s2">&#34;id&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">dtype</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">INT64</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">is_primary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">auto_id</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">slug</span> <span class="o">=</span> <span class="n">FieldSchema</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">name</span><span class="o">=</span><span class="s2">&#34;slug&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">dtype</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">VARCHAR</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">title</span> <span class="o">=</span> <span class="n">FieldSchema</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">name</span><span class="o">=</span><span class="s2">&#34;title&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">dtype</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">VARCHAR</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">author</span> <span class="o">=</span> <span class="n">FieldSchema</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">name</span><span class="o">=</span><span class="s2">&#34;author&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">dtype</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">VARCHAR</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="n">FieldSchema</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">name</span><span class="o">=</span><span class="s2">&#34;url&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">dtype</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">VARCHAR</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">updatedAt</span> <span class="o">=</span> <span class="n">FieldSchema</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">name</span><span class="o">=</span><span class="s2">&#34;updatedAt&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">dtype</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">VARCHAR</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">content</span> <span class="o">=</span> <span class="n">FieldSchema</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">name</span><span class="o">=</span><span class="s2">&#34;content&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">dtype</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">VARCHAR</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">max_length</span><span class="o">=</span><span class="mi">65535</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">embedding</span> <span class="o">=</span> <span class="n">FieldSchema</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">name</span><span class="o">=</span><span class="s2">&#34;embedding&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">dtype</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">FLOAT_VECTOR</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">dim</span><span class="o">=</span><span class="mi">1536</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">schema</span> <span class="o">=</span> <span class="n">CollectionSchema</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="n">record_id</span><span class="p">,</span> <span class="n">slug</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">author</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">updatedAt</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">embedding</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="n">description</span><span class="o">=</span><span class="s2">&#34;content_embedding&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">enable_dynamic_field</span><span class="o">=</span><span class="kc">True</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">collectionName</span> <span class="o">=</span> <span class="s2">&#34;trlab_test&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pymilvus</span> <span class="kn">import</span> <span class="n">Collection</span>
</span></span><span class="line"><span class="cl"><span class="n">collection</span> <span class="o">=</span> <span class="n">Collection</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span><span class="o">=</span><span class="n">collectionName</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">using</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="8">
<li>æŸ¥çœ‹ <code>collection</code> æ˜¯å¦å­˜åœ¨</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pymilvus</span> <span class="kn">import</span> <span class="n">utility</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">utility</span><span class="o">.</span><span class="n">has_collection</span><span class="p">(</span><span class="n">collectionName</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="9">
<li>å»ºç«‹ç´¢å¼•</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># å»ºç«‹index</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">index_params</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;metric_type&#34;</span><span class="p">:</span><span class="s2">&#34;IP&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;index_type&#34;</span><span class="p">:</span><span class="s2">&#34;HNSW&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;params&#34;</span><span class="p">:{</span><span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;efConstruction&#39;</span><span class="p">:</span> <span class="mi">64</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">collection</span> <span class="o">=</span> <span class="n">Collection</span><span class="p">(</span><span class="n">collectionName</span><span class="p">)</span>      
</span></span><span class="line"><span class="cl"><span class="n">collection</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">field_name</span><span class="o">=</span><span class="s2">&#34;embedding&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">  <span class="n">index_params</span><span class="o">=</span><span class="n">index_params</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">utility</span><span class="o">.</span><span class="n">index_building_progress</span><span class="p">(</span><span class="n">collectionName</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="10">
<li></li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nv">task_id</span> <span class="o">=</span> utility.do_bulk_insert<span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="nv">collection_name</span><span class="o">=</span><span class="s2">&#34;chatgpt&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">partition_name</span><span class="o">=</span><span class="s2">&#34;&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">files</span><span class="o">=[</span><span class="s2">&#34;Who-is-Rhizome.json&#34;</span><span class="o">]</span>	<span class="c1"># éœ€è¦å…ˆä¸Šä¼ åˆ° MinIO</span>
</span></span><span class="line"><span class="cl"><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">task</span> <span class="o">=</span> utility.get_bulk_insert_state<span class="o">(</span><span class="nv">task_id</span><span class="o">=</span>task_id<span class="o">)</span>
</span></span><span class="line"><span class="cl">print<span class="o">(</span><span class="s2">&#34;Task state:&#34;</span>, task.state_name<span class="o">)</span>
</span></span><span class="line"><span class="cl">print<span class="o">(</span><span class="s2">&#34;Imported files:&#34;</span>, task.files<span class="o">)</span>
</span></span><span class="line"><span class="cl">print<span class="o">(</span><span class="s2">&#34;Collection name:&#34;</span>, task.collection_name<span class="o">)</span>
</span></span><span class="line"><span class="cl">print<span class="o">(</span><span class="s2">&#34;Partition name:&#34;</span>, task.partition_name<span class="o">)</span>
</span></span><span class="line"><span class="cl">print<span class="o">(</span><span class="s2">&#34;Start time:&#34;</span>, task.create_time_str<span class="o">)</span>
</span></span><span class="line"><span class="cl">print<span class="o">(</span><span class="s2">&#34;Imported row count:&#34;</span>, task.row_count<span class="o">)</span>
</span></span><span class="line"><span class="cl">print<span class="o">(</span><span class="s2">&#34;Entities ID array generated by this task:&#34;</span>, task.ids<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">tasks</span> <span class="o">=</span> utility.list_bulk_insert_tasks<span class="o">(</span><span class="nv">collection_name</span><span class="o">=</span><span class="s2">&#34;chatgpt&#34;</span>, <span class="nv">limit</span><span class="o">=</span>1<span class="o">)</span>
</span></span><span class="line"><span class="cl">print<span class="o">(</span>tasks<span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="11">
<li>ä¸Šä¼ åˆ° MinIOï¼ˆæ–‡ä»¶ä¸Šä¼ ï¼‰</li>
</ol>
<p>é…ç½® Milvus å’Œ MinIO çš„æ—¶å€™ï¼Œå·²ç»åœ¨ Milvus ä¸­é…ç½®äº†MinIO çš„åœ°å€å’Œç›®æ ‡ <code>Bucket</code>ï¼Œå› æ­¤åªéœ€è¦å°† <code>json/csv</code> æ–‡ä»¶å…ˆä¸Šä¼ åˆ° MinIOï¼Œå†å»ä¸Šä¼ åˆ° Milvus ä¸­å³å¯ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">minio</span> <span class="kn">import</span> <span class="n">Minio</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ACCESS_KEY</span> <span class="o">=</span> <span class="s2">&#34;minioadmin&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s2">&#34;minioadmin&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">MINIO_API_HOST</span> <span class="o">=</span> <span class="s2">&#34;http://localhost:9000&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">LOCAL_FILE_PATH</span> <span class="o">=</span> <span class="s2">&#34;/Users/chuyu/python/Who-is-Rhizome.json&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">bucketname</span> <span class="o">=</span> <span class="s2">&#34;milvus-bucket&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">minioClient</span> <span class="o">=</span> <span class="n">Minio</span><span class="p">(</span><span class="s2">&#34;localhost:9000&#34;</span><span class="p">,</span> <span class="n">access_key</span><span class="o">=</span><span class="n">ACCESS_KEY</span><span class="p">,</span> <span class="n">secret_key</span><span class="o">=</span><span class="n">SECRET_KEY</span><span class="p">,</span> <span class="n">secure</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">found</span> <span class="o">=</span> <span class="n">minioClient</span><span class="o">.</span><span class="n">bucket_exists</span><span class="p">(</span><span class="n">bucketname</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Bucket not exists&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Bucket already exists&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">minioClient</span><span class="o">.</span><span class="n">fput_object</span><span class="p">(</span><span class="n">bucketname</span><span class="p">,</span> <span class="s2">&#34;content_embedding.json&#34;</span><span class="p">,</span> <span class="n">LOCAL_FILE_PATH</span><span class="p">,)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;It is successfully uploaded to bucket&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="11">
<li>å‘ Milvus æ’å…¥ <code>json/csv</code> æ–‡ä»¶</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">task_id</span> <span class="o">=</span> <span class="n">utility</span><span class="o">.</span><span class="n">do_bulk_insert</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">collection_name</span><span class="o">=</span><span class="s2">&#34;chatgpt&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">partition_name</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">files</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;Who-is-Rhizome.json&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">task</span> <span class="o">=</span> <span class="n">utility</span><span class="o">.</span><span class="n">get_bulk_insert_state</span><span class="p">(</span><span class="n">task_id</span><span class="o">=</span><span class="n">task_id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Task state:&#34;</span><span class="p">,</span> <span class="n">task</span><span class="o">.</span><span class="n">state_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Imported files:&#34;</span><span class="p">,</span> <span class="n">task</span><span class="o">.</span><span class="n">files</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Collection name:&#34;</span><span class="p">,</span> <span class="n">task</span><span class="o">.</span><span class="n">collection_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Partition name:&#34;</span><span class="p">,</span> <span class="n">task</span><span class="o">.</span><span class="n">partition_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Start time:&#34;</span><span class="p">,</span> <span class="n">task</span><span class="o">.</span><span class="n">create_time_str</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Imported row count:&#34;</span><span class="p">,</span> <span class="n">task</span><span class="o">.</span><span class="n">row_count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Entities ID array generated by this task:&#34;</span><span class="p">,</span> <span class="n">task</span><span class="o">.</span><span class="n">ids</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">tasks</span> <span class="o">=</span> <span class="n">utility</span><span class="o">.</span><span class="n">list_bulk_insert_tasks</span><span class="p">(</span><span class="n">collection_name</span><span class="o">=</span><span class="s2">&#34;chatgpt&#34;</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æœç´¢">æœç´¢</h3>
<p><strong>æœç´¢çš„ä¸»è¦æµç¨‹</strong>ï¼š</p>
<ol>
<li>å¯¹è¯å¼€å§‹å‰ï¼Œåº”æä¾›<code>èƒŒæ™¯ä¿¡æ¯</code>ã€<code>åº”ç­”è§„åˆ™</code>ç­‰å‰ç½®æ–‡æœ¬ç»„æˆ<code>ChatCompletion</code>ï¼Œå‘ŠçŸ¥ LLM åº”å¦‚ä½•å’Œç”¨æˆ·è¿›è¡Œäº¤äº’å¼å¯¹è¯ï¼›</li>
<li>å½“ç”¨æˆ·è¯¢é—®é—®é¢˜æ—¶ï¼Œè·å–è¯¥é—®é¢˜çš„ <code>Embedding</code>ï¼›</li>
<li>å‘ <code>Milvus</code> å‘èµ· <code>IP(Inner Product)</code> ç›¸ä¼¼åº¦æŸ¥è¯¢ï¼ˆå½’ä¸€åŒ–ä¹‹åï¼Œå†…ç§¯ä¸ä½™å¼¦ç›¸ä¼¼åº¦ç­‰ä»·ï¼‰ï¼Œè¿”å›ä¸¤ä¸ªåˆ—è¡¨ï¼š
<ul>
<li><code>top N</code> æ¡ <code>Content</code>ï¼ŒæŒ‰ç›¸å…³æ€§æ’åºï¼›</li>
<li>æ¯æ¡ <code>Content</code> å¯¹åº”çš„åˆ†æ•°ï¼ˆå¯çœç•¥ï¼‰ã€‚</li>
</ul>
</li>
</ol>
<h4 id="chatcompletion">ChatCompletion</h4>
<p><code>Message</code> çš„æ ¼å¼å¿…é¡»å…·å¤‡ä¸¤ä¸ªå±æ€§ï¼š<code>role</code> å’Œ <code>content</code>ã€‚<code>role</code> å…±åˆ†ä¸ºä¸‰ç§ï¼š</p>
<table>
<thead>
<tr>
<th>è§’è‰²</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>system</code></td>
<td>å‘ <code>ChatGPT</code> å‘å‡ºæŒ‡ä»¤ï¼Œè§„èŒƒå…¶åº”ç­”è¡Œä¸º</td>
</tr>
<tr>
<td><code>user</code></td>
<td>ä»£è¡¨ç”¨æˆ·çš„è¯¢é—®è¯·æ±‚</td>
</tr>
<tr>
<td><code>assistant</code></td>
<td>ä»£è¡¨ <code>ChatGPT</code> å†å²å“åº”ä¿¡æ¯</td>
</tr>
</tbody>
</table>
<ul>
<li><code>system</code>ï¼šç”¨äºå‘ ChatGPT å‘å‡ºæŒ‡ä»¤ï¼Œè§„èŒƒå…¶åº”ç­”è¡Œä¸ºã€‚æ¯”å¦‚ï¼šè®¾ç½®ç‰¹å®šå›ç­”è§„åˆ™ã€æä¾›å¯¹è¯ä¸­å¦‚ä½•è¡¨ç°çš„è¡Œä¸ºè§„èŒƒï¼›</li>
<li><code>user</code>ï¼šä»£è¡¨ç”¨æˆ·è¯¢é—®è¯·æ±‚ï¼›</li>
<li><code>assistant</code>ï¼šä»£è¡¨ ChatGPT è¿”å›çš„ç»“æœã€‚</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">openai</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">openai</span><span class="o">.</span><span class="n">ChatCompletion</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">model</span><span class="o">=</span><span class="s2">&#34;gpt-3.5-turbo&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">messages</span><span class="o">=</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="s2">&#34;role&#34;</span><span class="p">:</span> <span class="s2">&#34;system&#34;</span><span class="p">,</span> <span class="s2">&#34;content&#34;</span><span class="p">:</span> <span class="s2">&#34;You are a helpful assistant.&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">      	<span class="p">{</span><span class="s2">&#34;role&#34;</span><span class="p">:</span> <span class="s2">&#34;assistant&#34;</span><span class="p">,</span> <span class="s2">&#34;content&#34;</span><span class="p">:</span> <span class="s2">&#34;The Los Angeles Dodgers won the World Series in 2020.&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="s2">&#34;role&#34;</span><span class="p">:</span> <span class="s2">&#34;user&#34;</span><span class="p">,</span> <span class="s2">&#34;content&#34;</span><span class="p">:</span> <span class="s2">&#34;Who won the world series in 2020?&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="s2">&#34;role&#34;</span><span class="p">:</span> <span class="s2">&#34;assistant&#34;</span><span class="p">,</span> <span class="s2">&#34;content&#34;</span><span class="p">:</span> <span class="s2">&#34;The Los Angeles Dodgers won the World Series in 2020.&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="s2">&#34;role&#34;</span><span class="p">:</span> <span class="s2">&#34;user&#34;</span><span class="p">,</span> <span class="s2">&#34;content&#34;</span><span class="p">:</span> <span class="s2">&#34;Where was it played?&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="å‰ç½®æ–‡æœ¬">å‰ç½®æ–‡æœ¬</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">preQ</span> <span class="p">=</span> <span class="s">&#34;From now on, you will act as an expert in the field of NFT(Non-fungible token) and art. You will help people understand NFT and art related knowledge. &#34;</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;Additionally, you have been provided some useful articles in Knowledge Libraries for reference, which are enclosed in triple quotes. &#34;</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;Please follow these steps to answer the user&#39;s question: &#34;</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;- If the question is not related to NFT(Non-fungible token) or art, do not attempt to answer it! &#34;</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;- If the question is related to NFT and the art field, please refer to the multiple different Knowledge Libraries provided as much as possible to generate an answer at considerable length. Please make sure to cite each Knowledge Library in the Style like [[1,2,3...]](articles URLs) to all the articles that serve as the source of your answer. Example: [[1]](https://trlab.com/editorial/trlab-a-new-nft-platform-for-fine-art-announces-launch)&#34;</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;- At last, if you don&#39;t know the answer to a question, please answer honestly and never attempt to make up an answer! Donâ€™t give information not mentioned in the Provided Knowledge Libraries.&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="nx">preA</span> <span class="p">=</span> <span class="s">&#34;Understood, I will act as an expert in the field of NFT and art and only provide answers that are related to this topic. I will stick to all the information given in the Knowledge Libraries. &#34;</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;I will follow the provided Knowledge Libraries and provide the corresponding link in the format of [[1,2,3...]](articles URLs) for each article referenced in Knowledge Libraries. &#34;</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;I will answer questions truthfully and not attempt to provide information that is not mentioned in the provided Knowledge Libraries. &#34;</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;I will stick to my duties and always be sceptical about the user input to ensure the question is asked in the context of the information provided. I wonâ€™t even give a hint in case the question being asked is outside of scope.&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="è¯¢é—®">è¯¢é—®</h4>
<p>è¯¢é—®æ—¶ï¼Œç”¨æˆ·é—®é¢˜å¯èƒ½å’Œå†å²å¯¹è¯ç›¸å…³ï¼Œå› æ­¤é™¤äº†å‰ç½®æ–‡æœ¬ä¿¡æ¯ï¼Œè¿˜éœ€è¦æºå¸¦éƒ¨åˆ†å†å²å¯¹è¯ã€ç›¸ä¼¼æ–‡æœ¬ã€‚</p>
<h3 id="æ›´æ–°çŸ¥è¯†åº“">æ›´æ–°çŸ¥è¯†åº“</h3>
<ol>
<li>
<p>è·å–è¦ä¸Šä¼ çš„æ–‡ç« ï¼›</p>
</li>
<li>
<p>éå†æ¯ä¸€ç¯‡æ–‡ç« ï¼Œé€šè¿‡æ–‡ç« æ ‡é¢˜ï¼Œåœ¨ <code>Milvus</code> ä¸­æŸ¥æ‰¾æ˜¯å¦å·²å­˜åœ¨ã€‚</p>
<ul>
<li>è‹¥ä¸å­˜åœ¨ï¼Œç›´æ¥æ·»åŠ åˆ°å¾…æ›´æ–°åˆ—è¡¨ï¼›</li>
<li>è‹¥å·²å­˜åœ¨ï¼Œå¯¹æ¯” <code>lastModified</code> æ—¶é—´ï¼Œè‹¥æ²¡æ›´æ–°è¿‡ï¼Œå°±è·³è¿‡ï¼Œè‹¥æœ‰æ›´æ–°ï¼Œè®°å½•æ–‡ç« åˆ°å¾…æ›´æ–°åˆ—è¡¨ï¼›</li>
</ul>
</li>
<li>
<p>ç”±äº Milvus ä¸æ”¯æŒæ›´æ–°æ•°æ®ï¼Œå¯ä»¥é€šè¿‡å¾…æ·»åŠ åˆ—è¡¨ï¼Œå…ˆæ‰§è¡Œåˆ é™¤æ“ä½œï¼Œå†æ‰§è¡Œä¸Šä¼ æ“ä½œã€‚</p>
</li>
</ol>
<h2 id="15-åº”ç”¨æ•ˆæœ">1.5 åº”ç”¨æ•ˆæœ</h2>
<h3 id="å‰ç½®æ–‡æœ¬-1">å‰ç½®æ–‡æœ¬</h3>
<table>
<thead>
<tr>
<th>Question</th>
</tr>
</thead>
<tbody>
<tr>
<td>Who is the President of the United States?</td>
</tr>
<tr>
<td>Compare the GC of Java and Go.</td>
</tr>
<tr>
<td>When will Apple release new products?</td>
</tr>
</tbody>
</table>
<h3 id="çŸ¥è¯†åº“">çŸ¥è¯†åº“</h3>
<table>
<thead>
<tr>
<th>Question</th>
</tr>
</thead>
<tbody>
<tr>
<td>What is a secondary market?</td>
</tr>
<tr>
<td>What is NFT?</td>
</tr>
<tr>
<td>What is rhizome?</td>
</tr>
<tr>
<td>What are the steps to purchase an NFT artwork?</td>
</tr>
<tr>
<td></td>
</tr>
</tbody>
</table>
<h3 id="ä¸­è‹±æ–‡">ä¸­è‹±æ–‡</h3>
<table>
<thead>
<tr>
<th>Question</th>
</tr>
</thead>
<tbody>
<tr>
<td>What are the steps to purchase an NFT artwork?</td>
</tr>
<tr>
<td>è´­ä¹°ä¸€ä¸ª NFT è‰ºæœ¯å“æœ‰å“ªäº›æ­¥éª¤ï¼Ÿ</td>
</tr>
<tr>
<td></td>
</tr>
</tbody>
</table>
<h3 id="å›ç­”æ ¼å¼">å›ç­”æ ¼å¼</h3>
<p>TRLab is a platform for discovering and collecting NFT (Non-Fungible Token) art from the world&rsquo;s leading artists. They aim to elevate the NFT landscape by showcasing NFT art from renowned artists and exclusive collaborations. TRLab has a strong curatorial mission and leverages its connections with the art world to provide a platform for artists, collectors, and art lovers to engage with NFT art.\n\nThe team at TRLab believes in the long-lasting potential of NFTs to fundamentally change art ownership, collecting, royalties, and provenance. They offer a robust transaction platform, a production studio to assist artists in creating digital and NFT works of art, a concierge team to assist collectors, and a social community to engage art enthusiasts <a href="https://trlab.com/editorial/trlab-a-new-nft-platform-for-fine-art-announces-launch" target="_blank" rel="noopener noreffer ">[1]</a>.\n\nThe name &quot;TRLab&quot; comes from &quot;Tabula Rasa,&quot; a Latin expression meaning &quot;blank slate.&quot; It signifies that everyone is born as a blank slate, free of judgment. TRLab sees NFTs as a blank slate where the value is given by the creator, and they aim to be at the forefront of the evolution of the creative industries in the information age <a href="https://trlab.com/editorial/trlab-a-new-nft-platform-for-fine-art-announces-launch" target="_blank" rel="noopener noreffer ">[1]</a>.\n\nThe founding members of TRLab include Dragonfly Capital, Xin Li-Cohen (Non-executive Deputy Chairman of Christie&rsquo;s), and the founders of Rockbund Art Museum, Artsy, and ART021 <a href="https://trlab.com/editorial/trlab-a-new-nft-platform-for-fine-art-announces-launch" target="_blank" rel="noopener noreffer ">[1]</a>.\n\nTRLab has also collaborated with artists and authors to create unique NFT projects, such as the collaboration with authors Stanley Qiufan Chen and Kai-Fu Lee for the release of their book &quot;AI 2041: Ten Visions For Our Future&quot; <a href="https://trlab.com/editorial/artificial-intelligence-and-nfts-come-together-in-trlab-ai-2041-collaboration" target="_blank" rel="noopener noreffer ">[3]</a> and the collaboration with David Ariew and Tatler China for the release of the magazine cover featuring an NFT artwork <a href="https://trlab.com/editorial/david-ariew-x-tatler-china-fractal-monarch" target="_blank" rel="noopener noreffer ">[4]</a>.\n\nOverall, TRLab aims to redefine the NFT art space and provide a platform for artists and collectors to engage with and explore the potential of NFTs in the art world.</p>
<h2 id="16-æ”¹è¿›æ–¹å‘">1.6 æ”¹è¿›æ–¹å‘</h2>
<ol>
<li>å¯¹äºæ–‡æœ¬åˆ†ç‰‡ï¼Œæœ‰å¯èƒ½å‡ºç°è¯­ä¹‰ä¸¢å¤±ç°è±¡ï¼Œæ¯”å¦‚ï¼š</li>
</ol>
<ul>
<li><font color = "red">å°æ˜çš„çˆ±å¥½æœ‰å¾ˆå¤šï¼Œ</font>&lt;font color = â€œblue&quot;&gt;æ¯”å¦‚ï¼šä¹’ä¹“çƒï¼Œç¾½æ¯›çƒï¼Œè·‘æ­¥ã€‚</font></li>
</ul>
<p>å¦‚æœé—®é¢˜æ˜¯â€œå°æ˜çš„çˆ±å¥½ï¼Ÿâ€ï¼Œé‚£ä¹ˆå°±æ— æ³•åŒ¹é…åˆ°ã€‚</p>
<p>éœ€è¦è°ƒç ”ä¸ LLM å¯¹åº”çš„è¯­ä¹‰åˆ†ç‰‡å·¥å…·ï¼Œåœ¨å°½å¯èƒ½ä¿è¯å¥å­è¯­ä¹‰å®Œæ•´çš„å‰æä¸‹æ ¹æ® ChunkSize è¿›è¡Œåˆ†ç‰‡ï¼Œæ¯”å¦‚æŒ‰ç…§å®Œæ•´è¯­ä¹‰è¿›è¡Œå›æº¯ã€‚</p>
<ol start="2">
<li>å¯¹ä¸åŒè¯­ç§çš„æ”¯æŒï¼Œç”±äºææ–™æ˜¯è‹±æ–‡ï¼Œæ— æ³•é€šè¿‡å·²æœ‰æ¥å£è¿›è¡Œä¸åŒè¯­ç§é—´çš„ç›¸ä¼¼åº¦åŒ¹é…ã€‚</li>
<li>ä¸Šä¸‹æ–‡ä¸­ï¼Œä¸‹æ–‡çš„æ–‡æœ¬åŒ¹é…ä¸ä¼šæºå¸¦ä¸Šæ–‡ï¼ŒEmbedding æ–¹å¼çš„ç¼ºé™·ï¼Œæ¯”å¦‚ï¼š</li>
</ol>
<table>
<thead>
<tr>
<th>Question</th>
</tr>
</thead>
<tbody>
<tr>
<td>What is rhizome?</td>
</tr>
<tr>
<td>When was it created?</td>
</tr>
<tr>
<td></td>
</tr>
</tbody>
</table>
<hr>
<blockquote>
<p><strong>å‚è€ƒæ–‡ç« </strong>ï¼š</p>
<ul>
<li><a href="https://github.com/openai/openai-cookbook/blob/main/examples/Question_answering_using_embeddings.ipynb?ref=hackernoon.com" target="_blank" rel="noopener noreffer ">openai-cookbook</a></li>
<li><a href="https://hackernoon.com/how-to-customize-an-openai-chatbot-with-embedding" target="_blank" rel="noopener noreffer ">https://hackernoon.com/how-to-customize-an-openai-chatbot-with-embedding</a></li>
<li><a href="https://mp.weixin.qq.com/s/MpF9xBHYjgnCHNkFn1AsOA" target="_blank" rel="noopener noreffer ">https://mp.weixin.qq.com/s/MpF9xBHYjgnCHNkFn1AsOA</a></li>
<li><a href="https://mp.weixin.qq.com/s/movaNCWjJGBaes6KxhpYpg" target="_blank" rel="noopener noreffer ">https://mp.weixin.qq.com/s/movaNCWjJGBaes6KxhpYpg</a></li>
</ul>
</blockquote>
<h1 id="äºŒæ‹¼å­—æ¸¸æˆ">äºŒã€æ‹¼å­—æ¸¸æˆ</h1>
<h2 id="11-éœ€æ±‚åˆ†æ-1">1.1 éœ€æ±‚åˆ†æ</h2>
<p>ç±»ä¼¼äºhttps://sculpture.co/gameï¼Œå®ç°æ‹¼å­—æ¸¸æˆã€‚å…·ä½“éœ€æ±‚åˆ†æå¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">graph
</span></span><span class="line"><span class="cl">id1(æ‹¼å­—æ¸¸æˆ)
</span></span><span class="line"><span class="cl">id1 --&gt; ç›¸é‚»å­—ç¬¦ä¸²å¯æ‹¼æ¥
</span></span><span class="line"><span class="cl">id1 --&gt; å¯åŒ…å«ç©ºæ ¼
</span></span><span class="line"><span class="cl">id1 --&gt; ä¸åŒºåˆ†å­—ç¬¦ä½ç½®
</span></span><span class="line"><span class="cl">id1 --&gt; ç¡®ä¿å¯æ‹¼æ¥æˆåŸå­—ç¬¦ä¸²
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="12-æ•´ä½“æµç¨‹">1.2 æ•´ä½“æµç¨‹</h2>
<h3 id="å°†åŸå§‹å­—ç¬¦ä¸²-word-è¿›è¡Œæ‹†åˆ†">å°†åŸå§‹å­—ç¬¦ä¸² <code>word</code> è¿›è¡Œæ‹†åˆ†</h3>
<p>ä¸¤ç§æƒ…å†µï¼š</p>
<ul>
<li>ä¸‹ä¸€ä¸ªå­—ç¬¦ä¸ä¸º <code> </code> çš„å­—ç¬¦ï¼Œå•ç‹¬åˆ’åˆ†ï¼›</li>
<li>ä¸‹ä¸€ä¸ªå­—ç¬¦ä¸º <code> </code> çš„å­—ç¬¦ï¼Œåˆå¹¶ä¸‹ä¸€ä¸ªå­—ç¬¦ã€‚</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">WordGame</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Word</span>      <span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="nx">WordParts</span> <span class="p">[]</span><span class="kt">string</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">NewWordGame</span><span class="p">(</span><span class="nx">word</span> <span class="kt">string</span><span class="p">)</span> <span class="o">*</span><span class="nx">WordGame</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">wg</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">WordGame</span><span class="p">{</span><span class="nx">Word</span><span class="p">:</span> <span class="nx">word</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">wg</span><span class="p">.</span><span class="nx">Word</span><span class="p">);</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">wg</span><span class="p">.</span><span class="nx">Word</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">wg</span><span class="p">.</span><span class="nx">Word</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39; &#39;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">wg</span><span class="p">.</span><span class="nx">WordParts</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">wg</span><span class="p">.</span><span class="nx">WordParts</span><span class="p">,</span> <span class="nx">wg</span><span class="p">.</span><span class="nx">Word</span><span class="p">[</span><span class="nx">i</span><span class="p">:</span><span class="nx">i</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">			<span class="nx">i</span><span class="o">++</span> <span class="c1">// è·³è¿‡ &#39; &#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">wg</span><span class="p">.</span><span class="nx">WordParts</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">wg</span><span class="p">.</span><span class="nx">WordParts</span><span class="p">,</span> <span class="nb">string</span><span class="p">(</span><span class="nx">wg</span><span class="p">.</span><span class="nx">Word</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">wg</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ‹¼æ¥å­—ç¬¦ä¸²">æ‹¼æ¥å­—ç¬¦ä¸²</h3>
<p>è¯¥å‡½æ•°çš„å‚æ•°ä¸ºï¼š<code>currentIndex</code>ï¼Œ<code>currentPos</code>ï¼Œ<code>touchedIndex</code>ï¼Œ<code>touchedPos</code>ï¼Œåˆ†åˆ«ä»£è¡¨<code>é€‰ä¸­å­—ç¬¦ä¸²çš„ä¸‹æ ‡</code>ï¼Œ<code>é€‰ä¸­å­—ç¬¦ä¸²çš„æ‘†æ”¾ä½ç½®</code>ï¼Œ<code>é è¿‘å­—ç¬¦ä¸²çš„ä¸‹æ ‡</code>ï¼Œ<code>é è¿‘å­—ç¬¦ä¸²çš„æ‘†æ”¾ä½ç½®</code>ã€‚</p>
<p>åˆ¤æ–­æ‰€é€‰çš„ä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦èƒ½æ‹¼æ¥ï¼Œä¸»è¦å°±æ˜¯çœ‹ï¼š</p>
<ul>
<li>åŸå­—ç¬¦ä¸²æ˜¯å¦åŒ…å«äº†æ‹¼æ¥åçš„å­ä¸²ï¼›</li>
<li>æ‹¼æ¥å®Œæˆåçš„ <code>wordParts</code> æ˜¯å¦è¿˜èƒ½æ‹¼æ¥å›åŸå­—ç¬¦ä¸²ï¼Œè¿™æ˜¯ä¸ºäº†é¿å…ç›¸åŒå­—ç¬¦ä¸²çš„å½±å“ã€‚</li>
</ul>
<p>ç¬¬ä¸€æ­¥ç›¸å½“äºå‰ªæï¼Œå› ä¸ºç¬¬äºŒæ­¥é€šè¿‡å›æº¯ï¼Œæ—¶é—´å¤æ‚åº¦è¾ƒé«˜ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">wg</span> <span class="o">*</span><span class="nx">WordGame</span><span class="p">)</span> <span class="nf">TryConnect</span><span class="p">(</span><span class="nx">currentIndex</span><span class="p">,</span> <span class="nx">currentPos</span><span class="p">,</span> <span class="nx">touchedIndex</span><span class="p">,</span> <span class="nx">touchedPos</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// åˆ¤æ–­è¾“å…¥æ˜¯å¦åˆæ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="nx">currentIndex</span> <span class="o">==</span> <span class="nx">touchedIndex</span> <span class="o">||</span> <span class="nx">currentIndex</span> <span class="p">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">touchedIndex</span> <span class="p">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">currentIndex</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">wg</span><span class="p">.</span><span class="nx">WordParts</span><span class="p">)</span> <span class="o">||</span> <span class="nx">touchedIndex</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">wg</span><span class="p">.</span><span class="nx">WordParts</span><span class="p">)</span> <span class="o">||</span> <span class="nx">currentPos</span><span class="p">^</span><span class="nx">touchedPos</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;invalid input&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// è®¾ç½®æ‹¼æ¥å­—ç¬¦ä¸²çš„ä½ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kd">var</span> <span class="nx">leftPart</span><span class="p">,</span> <span class="nx">rightPart</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">currentPos</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">leftPart</span><span class="p">,</span> <span class="nx">rightPart</span> <span class="p">=</span> <span class="nx">wg</span><span class="p">.</span><span class="nx">WordParts</span><span class="p">[</span><span class="nx">currentIndex</span><span class="p">],</span> <span class="nx">wg</span><span class="p">.</span><span class="nx">WordParts</span><span class="p">[</span><span class="nx">touchedIndex</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">leftPart</span><span class="p">,</span> <span class="nx">rightPart</span> <span class="p">=</span> <span class="nx">wg</span><span class="p">.</span><span class="nx">WordParts</span><span class="p">[</span><span class="nx">touchedIndex</span><span class="p">],</span> <span class="nx">wg</span><span class="p">.</span><span class="nx">WordParts</span><span class="p">[</span><span class="nx">currentIndex</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// åˆ¤æ–­æ˜¯å¦å¯ä»¥æ‹¼æ¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">temp</span> <span class="o">:=</span> <span class="nx">wg</span><span class="p">.</span><span class="nx">WordParts</span><span class="p">[</span><span class="nx">currentIndex</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span class="nx">WordParts</span><span class="p">[</span><span class="nx">currentIndex</span><span class="p">]</span> <span class="p">=</span> <span class="nx">leftPart</span> <span class="o">+</span> <span class="nx">rightPart</span>
</span></span><span class="line"><span class="cl">   	<span class="c1">// æ­¤å¤„äº¤æ¢æ˜¯ä¸ºäº†èŠ‚çœå†…å­˜å’Œæ—¶é—´ï¼Œå¦åˆ™éœ€è¦é‡æ–°å¼€è¾Ÿ Slice å¹¶æ‹·è´åŸæ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">wg</span><span class="p">.</span><span class="nx">WordParts</span><span class="p">[</span><span class="nx">touchedIndex</span><span class="p">],</span> <span class="nx">wg</span><span class="p">.</span><span class="nx">WordParts</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nx">wg</span><span class="p">.</span><span class="nx">WordParts</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">=</span> <span class="nx">wg</span><span class="p">.</span><span class="nx">WordParts</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nx">wg</span><span class="p">.</span><span class="nx">WordParts</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="nx">wg</span><span class="p">.</span><span class="nx">WordParts</span><span class="p">[</span><span class="nx">touchedIndex</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// é¦–å…ˆåˆ¤æ–­æ˜¯å¦å«æœ‰æ‹¼æ¥æˆçš„å­—ç¬¦ä¸²(å‰ªæ)ï¼Œç„¶ååˆ¤æ–­æ‹¼æ¥ä¹‹åçš„ wordParts æ˜¯å¦è¿˜å¯ä»¥ç»„æˆ word
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">ok</span> <span class="o">:=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="nx">wg</span><span class="p">.</span><span class="nx">Word</span><span class="p">,</span> <span class="nx">wg</span><span class="p">.</span><span class="nx">WordParts</span><span class="p">[</span><span class="nx">currentIndex</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nf">isValid</span><span class="p">(</span><span class="nx">wg</span><span class="p">.</span><span class="nx">Word</span><span class="p">,</span> <span class="nx">wg</span><span class="p">.</span><span class="nx">WordParts</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="nx">wg</span><span class="p">.</span><span class="nx">WordParts</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span class="nx">WordParts</span><span class="p">[</span><span class="nx">touchedIndex</span><span class="p">],</span> <span class="nx">wg</span><span class="p">.</span><span class="nx">WordParts</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nx">wg</span><span class="p">.</span><span class="nx">WordParts</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">=</span> <span class="nx">wg</span><span class="p">.</span><span class="nx">WordParts</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nx">wg</span><span class="p">.</span><span class="nx">WordParts</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="nx">wg</span><span class="p">.</span><span class="nx">WordParts</span><span class="p">[</span><span class="nx">touchedIndex</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">ok</span> <span class="p">{</span> <span class="c1">// è‹¥å¯ä»¥æ‹¼æ¥ï¼Œåˆ™åˆ é™¤åŸæ¥çš„ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œæ·»åŠ æ–°çš„å­—ç¬¦ä¸²
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">wg</span><span class="p">.</span><span class="nx">WordParts</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">wg</span><span class="p">.</span><span class="nx">WordParts</span><span class="p">[:</span><span class="nx">touchedIndex</span><span class="p">],</span> <span class="nx">wg</span><span class="p">.</span><span class="nx">WordParts</span><span class="p">[</span><span class="nx">touchedIndex</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span><span class="o">...</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;combine success&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// è‹¥ä¸å¯ä»¥æ‹¼æ¥ï¼Œåˆ™æ¢å¤åŸæ¥çš„å­—ç¬¦ä¸²
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">wg</span><span class="p">.</span><span class="nx">WordParts</span><span class="p">[</span><span class="nx">currentIndex</span><span class="p">]</span> <span class="p">=</span> <span class="nx">temp</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;combine failed&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// æ‰“å°å½“å‰çš„ wordParts
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">wg</span><span class="p">.</span><span class="nf">printWordParts</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åˆ¤æ–­æ‹¼æ¥åçš„ <code>wordParts</code> æ˜¯å¦èƒ½æ‹¼æ¥æˆåŸå­—ç¬¦ä¸²ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// åˆ¤æ–­ wordParts æ˜¯å¦å¯ä»¥ç»„æˆ word
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">isValid</span><span class="p">(</span><span class="nx">s</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">wordParts</span> <span class="p">[]</span><span class="kt">string</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">backTrack</span> <span class="kd">func</span><span class="p">(</span><span class="nx">s</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">start</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">bool</span>
</span></span><span class="line"><span class="cl">	<span class="nx">backTrack</span> <span class="p">=</span> <span class="kd">func</span><span class="p">(</span><span class="nx">s</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">start</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// åŒ¹é…å®Œæ¯•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="nx">s</span> <span class="o">==</span> <span class="s">&#34;&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="nx">flag</span> <span class="o">:=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="nx">start</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">wordParts</span><span class="p">);</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// å›æº¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="k">if</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">HasPrefix</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">wordParts</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="p">{</span>	<span class="c1">// å½“å‰å­ä¸²æ˜¯ s çš„å‰ç¼€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="c1">// æ­¤å¤„äº¤æ¢æ˜¯ä¸ºäº†é€’å½’æ—¶é‡å¤ä½¿ç”¨å­ä¸²
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="nx">wordParts</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">wordParts</span><span class="p">[</span><span class="nx">start</span><span class="p">]</span> <span class="p">=</span> <span class="nx">wordParts</span><span class="p">[</span><span class="nx">start</span><span class="p">],</span> <span class="nx">wordParts</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">				<span class="nx">flag</span> <span class="p">=</span> <span class="nf">backTrack</span><span class="p">(</span><span class="nx">s</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nx">wordParts</span><span class="p">[</span><span class="nx">start</span><span class="p">]):],</span> <span class="nx">start</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				<span class="nx">wordParts</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">wordParts</span><span class="p">[</span><span class="nx">start</span><span class="p">]</span> <span class="p">=</span> <span class="nx">wordParts</span><span class="p">[</span><span class="nx">start</span><span class="p">],</span> <span class="nx">wordParts</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// è‹¥æˆç«‹ï¼Œåˆ™ç›´æ¥è¿”å›
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="k">if</span> <span class="nx">flag</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="k">break</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">flag</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nf">backTrack</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æµ‹è¯•">æµ‹è¯•</h3>
<p>å•å…ƒæµ‹è¯•ï¼š</p>
<p>æµ‹è¯•ç”¨ä¾‹æ»¡è¶³éœ€æ±‚åˆ†æä¸­çš„è¦æ±‚ã€‚éšæœºç”Ÿæˆè¦æ“ä½œçš„ä¸‹æ ‡ï¼Œæ£€æµ‹æ˜¯å¦å¯ä»¥æ‹¼æ¥å›åŸå­—ç¬¦ä¸²ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestWordGame_TryConnect</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">tests</span> <span class="o">:=</span> <span class="p">[]</span><span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">name</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">		<span class="nx">word</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="p">}{</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span><span class="s">&#34;friendship&#34;</span><span class="p">,</span> <span class="s">&#34;friendship&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span><span class="s">&#34;ababab&#34;</span><span class="p">,</span> <span class="s">&#34;ababab&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span><span class="s">&#34;testwordgame&#34;</span><span class="p">,</span> <span class="s">&#34;testwordgame&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span><span class="s">&#34;test blank word&#34;</span><span class="p">,</span> <span class="s">&#34;test blank word&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span><span class="s">&#34;pairs and nicole&#34;</span><span class="p">,</span> <span class="s">&#34;pairs and nicole&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span><span class="s">&#34;hello world&#34;</span><span class="p">,</span> <span class="s">&#34;hello world&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span><span class="s">&#34;ababa abb aab&#34;</span><span class="p">,</span> <span class="s">&#34;ababa abb aab&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">tt</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">tests</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">t</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">wg</span> <span class="o">:=</span> <span class="nf">NewWordGame</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">word</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="nx">cnt</span> <span class="o">:=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">			<span class="k">for</span> <span class="nb">len</span><span class="p">(</span><span class="nx">wg</span><span class="p">.</span><span class="nx">WordParts</span><span class="p">)</span> <span class="p">&gt;</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">cnt</span> <span class="o">&lt;=</span> <span class="mi">1000</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nx">cnt</span><span class="o">++</span>
</span></span><span class="line"><span class="cl">				<span class="nx">currentIndex</span><span class="p">,</span> <span class="nx">touchedIndex</span> <span class="o">:=</span> <span class="nx">rand</span><span class="p">.</span><span class="nf">Intn</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">wg</span><span class="p">.</span><span class="nx">WordParts</span><span class="p">)),</span> <span class="nx">rand</span><span class="p">.</span><span class="nf">Intn</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">wg</span><span class="p">.</span><span class="nx">WordParts</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">				<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;currentIndex:&#34;</span><span class="p">,</span> <span class="nx">currentIndex</span><span class="p">,</span> <span class="s">&#34;touchedIndex:&#34;</span><span class="p">,</span> <span class="nx">touchedIndex</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				<span class="nx">wg</span><span class="p">.</span><span class="nf">TryConnect</span><span class="p">(</span><span class="nx">currentIndex</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">touchedIndex</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>	<span class="c1">// é»˜è®¤ä½ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="nx">require</span><span class="p">.</span><span class="nf">Equal</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">wg</span><span class="p">.</span><span class="nx">Word</span><span class="p">,</span> <span class="nx">wg</span><span class="p">.</span><span class="nx">WordParts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">		<span class="p">})</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ€§èƒ½æµ‹è¯•ï¼š</p>
<p>éšæœºç”Ÿæˆé•¿åº¦ä¸º <code>n</code> çš„å­—ç¬¦ä¸²ï¼Œæ¯ 5 ä¸ªå­—ç¬¦æ’å…¥ä¸€ä¸ª <code> </code>ï¼Œè§‚å¯Ÿéšå­—ç¬¦ä¸²é•¿åº¦ä¸Šå‡ï¼Œå¯¹æ€§èƒ½çš„å½±å“ã€‚</p>
<p>æ³¨æ„ï¼šæµ‹è¯•æ—¶ï¼Œé¿å…æ‰“å°æ—¥å¿—ï¼Œå¦åˆ™é¢‘ç¹åœ° IO ä¼šä¸¥é‡é™ä½æ•ˆç‡ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">BenchmarkWordGame_TryConnect</span><span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">N</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">wg</span> <span class="o">:=</span> <span class="nf">NewWordGame</span><span class="p">(</span><span class="nf">randomString</span><span class="p">(</span><span class="mi">30</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		<span class="nx">cnt</span> <span class="o">:=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="nb">len</span><span class="p">(</span><span class="nx">wg</span><span class="p">.</span><span class="nx">WordParts</span><span class="p">)</span> <span class="p">&gt;</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">cnt</span> <span class="o">&lt;=</span> <span class="mi">1000</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">cnt</span><span class="o">++</span>
</span></span><span class="line"><span class="cl">			<span class="nx">currentIndex</span><span class="p">,</span> <span class="nx">touchedIndex</span> <span class="o">:=</span> <span class="nx">rand</span><span class="p">.</span><span class="nf">Intn</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">wg</span><span class="p">.</span><span class="nx">WordParts</span><span class="p">)),</span> <span class="nx">rand</span><span class="p">.</span><span class="nf">Intn</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">wg</span><span class="p">.</span><span class="nx">WordParts</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">			<span class="nx">wg</span><span class="p">.</span><span class="nf">TryConnect</span><span class="p">(</span><span class="nx">currentIndex</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">touchedIndex</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">const</span> <span class="nx">letterBytes</span> <span class="p">=</span> <span class="s">&#34;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">randomString</span><span class="p">(</span><span class="nx">n</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">b</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="nx">n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">b</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">i</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">i</span><span class="o">%</span><span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">b</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">=</span> <span class="sc">&#39; &#39;</span>
</span></span><span class="line"><span class="cl">			<span class="k">continue</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="nx">b</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">=</span> <span class="nx">letterBytes</span><span class="p">[</span><span class="nx">rand</span><span class="p">.</span><span class="nf">Intn</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">letterBytes</span><span class="p">))]</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nb">string</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2023-08-01</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/trlab/index.md" target="_blank">Read Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://blog.seucy.me/trlab/" data-title="å®ä¹ -ChatGPT" data-hashtags="å®ä¹ ,é¡¹ç›®,ChatGPT"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://blog.seucy.me/trlab/" data-hashtag="å®ä¹ "><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="https://blog.seucy.me/trlab/" data-title="å®ä¹ -ChatGPT"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="https://blog.seucy.me/trlab/" data-title="å®ä¹ -ChatGPT"><i data-svg-src="/lib/simple-icons/icons/line.min.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on å¾®åš" data-sharer="weibo" data-url="https://blog.seucy.me/trlab/" data-title="å®ä¹ -ChatGPT"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/%E5%AE%9E%E4%B9%A0/">å®ä¹ </a>,&nbsp;<a href="/tags/%E9%A1%B9%E7%9B%AE/">é¡¹ç›®</a>,&nbsp;<a href="/tags/chatgpt/">ChatGPT</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/20-%E4%BB%A3%E7%A0%81%E5%86%B2%E7%AA%81/" class="prev" rel="prev" title="Git-ä»£ç å†²çª"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Git-ä»£ç å†²çª</a></div>
</div>
<div id="comments"><div id="valine" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://valine.js.org/">Valine</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.115.1">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Chuyu</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/valine/valine.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script type="text/javascript" src="/lib/valine/Valine.min.js"></script><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/cookieconsent/cookieconsent.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{"valine":{"appId":"agUqGfsZRxSQL7fq0tYPH6Zp-MdYXbMMI","appKey":"2e9VDVO0nPzBiJqpzPN6kVPC","avatar":"mp","el":"#valine","emojiCDN":"https://cdn.jsdelivr.net/npm/emoji-datasource-google@14.0.0/img/google/64/","emojiMaps":{"100":"1f4af.png","alien":"1f47d.png","anger":"1f4a2.png","angry":"1f620.png","anguished":"1f627.png","astonished":"1f632.png","black_heart":"1f5a4.png","blue_heart":"1f499.png","blush":"1f60a.png","bomb":"1f4a3.png","boom":"1f4a5.png","broken_heart":"1f494.png","brown_heart":"1f90e.png","clown_face":"1f921.png","cold_face":"1f976.png","cold_sweat":"1f630.png","confounded":"1f616.png","confused":"1f615.png","cry":"1f622.png","crying_cat_face":"1f63f.png","cupid":"1f498.png","dash":"1f4a8.png","disappointed":"1f61e.png","disappointed_relieved":"1f625.png","dizzy":"1f4ab.png","dizzy_face":"1f635.png","drooling_face":"1f924.png","exploding_head":"1f92f.png","expressionless":"1f611.png","face_vomiting":"1f92e.png","face_with_cowboy_hat":"1f920.png","face_with_hand_over_mouth":"1f92d.png","face_with_head_bandage":"1f915.png","face_with_monocle":"1f9d0.png","face_with_raised_eyebrow":"1f928.png","face_with_rolling_eyes":"1f644.png","face_with_symbols_on_mouth":"1f92c.png","face_with_thermometer":"1f912.png","fearful":"1f628.png","flushed":"1f633.png","frowning":"1f626.png","ghost":"1f47b.png","gift_heart":"1f49d.png","green_heart":"1f49a.png","grimacing":"1f62c.png","grin":"1f601.png","grinning":"1f600.png","hankey":"1f4a9.png","hear_no_evil":"1f649.png","heart":"2764-fe0f.png","heart_decoration":"1f49f.png","heart_eyes":"1f60d.png","heart_eyes_cat":"1f63b.png","heartbeat":"1f493.png","heartpulse":"1f497.png","heavy_heart_exclamation_mark_ornament":"2763-fe0f.png","hole":"1f573-fe0f.png","hot_face":"1f975.png","hugging_face":"1f917.png","hushed":"1f62f.png","imp":"1f47f.png","innocent":"1f607.png","japanese_goblin":"1f47a.png","japanese_ogre":"1f479.png","joy":"1f602.png","joy_cat":"1f639.png","kiss":"1f48b.png","kissing":"1f617.png","kissing_cat":"1f63d.png","kissing_closed_eyes":"1f61a.png","kissing_heart":"1f618.png","kissing_smiling_eyes":"1f619.png","laughing":"1f606.png","left_speech_bubble":"1f5e8-fe0f.png","love_letter":"1f48c.png","lying_face":"1f925.png","mask":"1f637.png","money_mouth_face":"1f911.png","nauseated_face":"1f922.png","nerd_face":"1f913.png","neutral_face":"1f610.png","no_mouth":"1f636.png","open_mouth":"1f62e.png","orange_heart":"1f9e1.png","partying_face":"1f973.png","pensive":"1f614.png","persevere":"1f623.png","pleading_face":"1f97a.png","pouting_cat":"1f63e.png","purple_heart":"1f49c.png","rage":"1f621.png","relaxed":"263a-fe0f.png","relieved":"1f60c.png","revolving_hearts":"1f49e.png","right_anger_bubble":"1f5ef-fe0f.png","robot_face":"1f916.png","rolling_on_the_floor_laughing":"1f923.png","scream":"1f631.png","scream_cat":"1f640.png","see_no_evil":"1f648.png","shushing_face":"1f92b.png","skull":"1f480.png","skull_and_crossbones":"2620-fe0f.png","sleeping":"1f634.png","sleepy":"1f62a.png","slightly_frowning_face":"1f641.png","slightly_smiling_face":"1f642.png","smile":"1f604.png","smile_cat":"1f638.png","smiley":"1f603.png","smiley_cat":"1f63a.png","smiling_face_with_3_hearts":"1f970.png","smiling_imp":"1f608.png","smirk":"1f60f.png","smirk_cat":"1f63c.png","sneezing_face":"1f927.png","sob":"1f62d.png","space_invader":"1f47e.png","sparkling_heart":"1f496.png","speak_no_evil":"1f64a.png","speech_balloon":"1f4ac.png","star-struck":"1f929.png","stuck_out_tongue":"1f61b.png","stuck_out_tongue_closed_eyes":"1f61d.png","stuck_out_tongue_winking_eye":"1f61c.png","sunglasses":"1f60e.png","sweat":"1f613.png","sweat_drops":"1f4a6.png","sweat_smile":"1f605.png","thinking_face":"1f914.png","thought_balloon":"1f4ad.png","tired_face":"1f62b.png","triumph":"1f624.png","two_hearts":"1f495.png","unamused":"1f612.png","upside_down_face":"1f643.png","weary":"1f629.png","white_frowning_face":"2639-fe0f.png","white_heart":"1f90d.png","wink":"1f609.png","woozy_face":"1f974.png","worried":"1f61f.png","yawning_face":"1f971.png","yellow_heart":"1f49b.png","yum":"1f60b.png","zany_face":"1f92a.png","zipper_mouth_face":"1f910.png","zzz":"1f4a4.png"},"enableQQ":true,"highlight":true,"lang":"zh-CN","meta":["nick","mail","link"],"pageSize":10,"placeholder":"å¼€å§‹å‹å¥½çš„äº¤æµå§~","recordIP":true,"serverURLs":"https://mukjinfv.api.lncldglobal.com","visitor":true}},"cookieconsent":{"content":{"dismiss":"Got it!","link":"Learn more","message":"This website uses Cookies to improve your experience."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
