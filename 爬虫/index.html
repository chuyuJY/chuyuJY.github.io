<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>爬虫 - Chuyu&#39;s Blog</title><meta name="Description" content="😁"><meta property="og:title" content="爬虫" />
<meta property="og:description" content="爬虫 一、概述 1.1 requests入门 安装requests 1 conda install requests 1 2 3 # windows 需要加上 encoding=&#34;utf-8&#34;, mac是默认的 with open(&#34;mybaidu.html&#34;, mode=&#34;w&#34;, encoding=&#34;utf-8&#34;) as f: f.write(resp.read().decode(&#34;utf-8&#34;)) 在地址栏中输入搜索的内容，这种" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.seucy.me/%E7%88%AC%E8%99%AB/" /><meta property="og:image" content="https://blog.seucy.me/images/avatar.jpg"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-18T20:13:28+08:00" />
<meta property="article:modified_time" content="2023-07-18T20:13:28+08:00" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://blog.seucy.me/images/avatar.jpg"/>

<meta name="twitter:title" content="爬虫"/>
<meta name="twitter:description" content="爬虫 一、概述 1.1 requests入门 安装requests 1 conda install requests 1 2 3 # windows 需要加上 encoding=&#34;utf-8&#34;, mac是默认的 with open(&#34;mybaidu.html&#34;, mode=&#34;w&#34;, encoding=&#34;utf-8&#34;) as f: f.write(resp.read().decode(&#34;utf-8&#34;)) 在地址栏中输入搜索的内容，这种"/>
<meta name="application-name" content="Chuyu&#39;s Blog">
<meta name="apple-mobile-web-app-title" content="Chuyu&#39;s Blog"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/images/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://blog.seucy.me/%E7%88%AC%E8%99%AB/" /><link rel="next" href="https://blog.seucy.me/go%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "爬虫",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/blog.seucy.me\/%E7%88%AC%E8%99%AB\/"
        },"genre": "posts","keywords": "计算机基础, 爬虫, python","wordcount":  11747 ,
        "url": "https:\/\/blog.seucy.me\/%E7%88%AC%E8%99%AB\/","datePublished": "2022-07-18T20:13:28+08:00","dateModified": "2023-07-18T20:13:28+08:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Chuyu"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Chuyu&#39;s Blog">ᓫ (°⌑°) ǃ</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 归档 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><a class="menu-item" href="/about/"> 关于 </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Chuyu&#39;s Blog">ᓫ (°⌑°) ǃ</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">归档</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a class="menu-item" href="/about/" title="">关于</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">爬虫</h1><h2 class="single-subtitle">爬虫</h2><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Chuyu</a></span>&nbsp;<span class="post-category">included in <a href="/categories/%E9%80%9A%E7%94%A8/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>通用</a>&nbsp;<a href="/categories/python/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>python</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2022-07-18">2022-07-18</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;11747 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;24 minutes&nbsp;<span id="/%E7%88%AC%E8%99%AB/" class="leancloud_visitors" data-flag-title="爬虫">
                        <i class="far fa-eye fa-fw" aria-hidden="true"></i>&nbsp;<span class=leancloud-visitors-count></span>&nbsp;views
                    </span>&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#一概述">一、概述</a>
      <ul>
        <li><a href="#11-requests入门">1.1 requests入门</a></li>
      </ul>
    </li>
    <li><a href="#二数据解析">二、数据解析</a>
      <ul>
        <li><a href="#21-re解析">2.1 Re解析</a>
          <ul>
            <li><a href="#211-re-豆瓣top250">2.1.1 Re-豆瓣Top250</a></li>
          </ul>
        </li>
        <li><a href="#22-bs4解析">2.2 bs4解析</a></li>
        <li><a href="#23-xpath解析">2.3 Xpath解析</a></li>
      </ul>
    </li>
    <li><a href="#三request进阶">三、request进阶</a>
      <ul>
        <li><a href="#31-模拟登录-cookie">3.1 模拟登录-cookie</a></li>
        <li><a href="#32-防盗链">3.2 防盗链</a></li>
        <li><a href="#33-代理">3.3 代理</a></li>
        <li><a href="#34-网易云评论">3.4 网易云评论</a></li>
      </ul>
    </li>
    <li><a href="#四加速">四、加速</a>
      <ul>
        <li><a href="#41-多线程">4.1 多线程</a></li>
        <li><a href="#42-多进程">4.2 多进程</a></li>
        <li><a href="#43-线程池进程池">4.3 线程池\进程池</a></li>
        <li><a href="#44-协程">4.4 协程</a></li>
        <li><a href="#45-aiohttp模块应用">4.5 aiohttp模块应用</a></li>
        <li><a href="#46-抓取小说">4.6 抓取小说</a></li>
        <li><a href="#47-视频抓取">4.7 视频抓取</a>
          <ul>
            <li><a href="#471-简单难度">4.7.1 简单难度</a></li>
            <li><a href="#472-复杂91">4.7.2 复杂91</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#五selenium">五、selenium</a>
      <ul>
        <li><a href="#51-概述">5.1 概述</a></li>
        <li><a href="#52-窗口切换">5.2 窗口切换</a></li>
        <li><a href="#53-无头浏览器">5.3 无头浏览器</a></li>
        <li><a href="#54-验证码识别">5.4 验证码识别</a></li>
        <li><a href="#55-防止自动化被屏蔽">5.5 防止自动化被屏蔽</a></li>
      </ul>
    </li>
    <li><a href="#六js逆向">六、Js逆向</a>
      <ul>
        <li><a href="#61-断点">6.1 断点</a></li>
      </ul>
    </li>
    <li><a href="#七scrapy框架">七、Scrapy框架</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h1 id="爬虫">爬虫</h1>
<h2 id="一概述">一、概述</h2>
<h3 id="11-requests入门">1.1 requests入门</h3>
<ul>
<li>
<p>安装requests</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">conda</span> <span class="n">install</span> <span class="n">requests</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># windows 需要加上 encoding=&#34;utf-8&#34;, mac是默认的</span>
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;mybaidu.html&#34;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&#34;w&#34;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&#34;utf-8&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&#34;utf-8&#34;</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<ol>
<li>
<p>在地址栏中输入搜索的内容，这种方式都是get</p>
<p>若被发现是自动设备发出的请求而被拒绝，可以通过添加agent，如下图中：</p>
</li>
</ol>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220218101506003.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220218101506003.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220218101506003.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220218101506003.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220218101506003.png"
        title="image-20220218101506003" /></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 添加agent 防止被识别为自动化请求</span>
</span></span><span class="line"><span class="cl"><span class="n">dic</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;user-agent&#34;</span><span class="p">:</span> <span class="s2">&#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.102 Safari/537.36&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">dic</span><span class="p">)</span>   <span class="c1"># 处理了一个小反爬</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>实现翻译功能</li>
</ol>
<p>寻找下图中的请求：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220218105817002.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220218105817002.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220218105817002.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220218105817002.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220218105817002.png"
        title="image-20220218105817002" /></p>
<p>其请求方式为post方式，从载荷中查看提交的数据，并构造json进行提交：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;https://fanyi.sogou.com/reventondc/suggV3&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">s</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&#34;请输入你要查询的单词:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">dat</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;from&#34;</span><span class="p">:</span> <span class="s2">&#34;auto&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;to&#34;</span><span class="p">:</span> <span class="s2">&#34;zh-CHS&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;client&#34;</span><span class="p">:</span> <span class="s2">&#34;web&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;text&#34;</span><span class="p">:</span> <span class="n">s</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;uuid&#34;</span><span class="p">:</span> <span class="s2">&#34;da793e6d-1a41-4448-8df5-ae35fc402c3a&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;pid&#34;</span><span class="p">:</span> <span class="s2">&#34;sogou-dict-vr&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;addSugg&#34;</span><span class="p">:</span> <span class="s2">&#34;on&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">dat</span><span class="p">)</span>     <span class="c1"># 将服务器返回的内容直接处理成json()  ==&gt; dict格式</span>
</span></span><span class="line"><span class="cl"><span class="n">dic</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">dic</span><span class="p">[</span><span class="s1">&#39;sugg&#39;</span><span class="p">])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>爬取豆瓣电影榜单</li>
</ol>
<p>查看载荷，发现每次新刷新内容，只有start+20，所以可以通过改变请求中的start数据来爬取所有榜单信息。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220218112901922.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220218112901922.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220218112901922.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220218112901922.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220218112901922.png"
        title="image-20220218112901922" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220218112917801.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220218112917801.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220218112917801.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220218112917801.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220218112917801.png"
        title="image-20220218112917801" /></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;https://movie.douban.com/j/chart/top_list&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">info</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">header</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;User-Agent&#34;</span><span class="p">:</span> <span class="s2">&#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.102 Safari/537.36&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">20</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">param</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;type&#34;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;interval_id&#39;</span><span class="p">:</span> <span class="s2">&#34;100:90&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;action&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;start&#34;</span><span class="p">:</span> <span class="n">count</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;limit&#34;</span><span class="p">:</span> <span class="mi">20</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">param</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">header</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="n">resp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  <span class="c1"># 关掉resp</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="二数据解析">二、数据解析</h2>
<p>提供三种解析方式：</p>
<ul>
<li>re解析</li>
<li>bs4解析（使用方便，但解析速度较慢）</li>
<li>xpath解析</li>
</ul>
<p>掌握之后，再考虑性能问题。</p>
<h3 id="21-re解析">2.1 Re解析</h3>
<p>Re，正则表达式。</p>
<p>语法：使用元字符进行排列组合用来匹配字符串，在线测试正则表达式：https://tool.oschina.net/regex</p>
<p>元字符：具有固定含义的特殊符号</p>
<p>常用元字符：https://cloud.tencent.com/developer/article/1337734</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">.</span>		<span class="n">匹配除换行符以外的任意字符</span>
</span></span><span class="line"><span class="cl">\<span class="n">w</span>		<span class="n">匹配字母</span><span class="err">、</span><span class="n">数字</span><span class="err">、</span><span class="n">下划线</span>
</span></span><span class="line"><span class="cl">\<span class="n">s</span>		<span class="n">匹配任意的空白符</span>
</span></span><span class="line"><span class="cl">\<span class="n">d</span>		<span class="n">匹配数字</span>
</span></span><span class="line"><span class="cl">\<span class="n">n</span>		<span class="n">匹配一个换行符</span>
</span></span><span class="line"><span class="cl">\<span class="n">t</span>		<span class="n">匹配一个制表符</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">^</span>		<span class="n">匹配字符串的开始</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span>		<span class="n">匹配字符串的结尾</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">\<span class="n">W</span>		<span class="n">匹配非字母</span><span class="err">、</span><span class="n">非数字</span><span class="err">、</span><span class="n">非下划线</span>
</span></span><span class="line"><span class="cl">\<span class="n">D</span>		<span class="n">匹配非数字</span>
</span></span><span class="line"><span class="cl">\<span class="n">S</span>		<span class="n">匹配非空白符</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span><span class="o">|</span><span class="n">b</span>		<span class="n">匹配字符a或字符b</span>
</span></span><span class="line"><span class="cl"><span class="p">()</span>		<span class="n">匹配括号内的表达式</span><span class="err">，</span><span class="n">也表示一个组</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">...</span><span class="p">]</span>	<span class="n">匹配字符组中的字符</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">^...</span><span class="p">]</span>	<span class="n">匹配除了字符组中字符的所有字符</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>量词：控制前面的元字符出现的次数。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">*</span>		<span class="n">重复零次或更多次</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>		<span class="n">重复一次或更多次</span>
</span></span><span class="line"><span class="cl"><span class="err">?</span>		<span class="n">重复零次或不出现</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="n">n</span><span class="p">}</span>		<span class="n">重复n次</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="n">n</span><span class="p">,}</span>	<span class="n">重复n次或更多次</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="p">}</span>	<span class="n">重复n到m次</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>贪婪匹配和惰性匹配</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">.*</span>		<span class="n">贪婪匹配</span>							 <span class="p">(</span><span class="n">玩儿吃鸡游戏</span><span class="err">，</span><span class="n">玩什么游戏</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">.*</span><span class="err">?</span>		<span class="n">找最短的</span><span class="err">，?</span><span class="n">使尽可能少的</span><span class="o">*</span><span class="err">，</span><span class="n">尽可能少的匹配</span>  <span class="p">(</span><span class="n">玩儿吃鸡游戏</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>例：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&#34;jay&#34;</span><span class="o">&gt;</span><span class="n">周杰伦</span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&#34;jj&#34;</span><span class="o">&gt;</span><span class="n">林俊杰</span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">使用</span><span class="err">：</span><span class="o">&lt;.*</span><span class="err">?</span><span class="s2">&#34;.*?&#34;</span><span class="o">&gt;.*</span><span class="err">?</span><span class="o">&gt;</span> <span class="n">或</span> <span class="o">.*</span><span class="err">?</span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">结果</span><span class="err">：</span><span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&#34;jay&#34;</span><span class="o">&gt;</span><span class="n">周杰伦</span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">	 <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&#34;jj&#34;</span><span class="o">&gt;</span><span class="n">林俊杰</span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>我们爬虫用的最多的就是==惰性匹配==</p>
<p>==重点==：</p>
<p>以下几个功能就足够使用：</p>
<table>
<thead>
<tr>
<th style="text-align:left">finditer</th>
<th>和findall功能相似（查找所有），但是返回迭代器，效率高</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">findall</td>
<td>查找所有，返回list</td>
</tr>
<tr>
<td style="text-align:left">search</td>
<td>能够进行全文匹配，但检索到第一个就停止并返回</td>
</tr>
<tr>
<td style="text-align:left">match</td>
<td>只能从字符串的头部开始匹配</td>
</tr>
</tbody>
</table>
<p>预加载正则：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">obj</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;正则&#34;</span><span class="p">)</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>从迭代器中拿到内容需要：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">返回的迭代器对象</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>提取有用的数据：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">(</span><span class="err">?</span><span class="n">P</span><span class="o">&lt;</span><span class="n">group</span><span class="o">&gt;</span><span class="n">正则</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 最重要*** finditer: 匹配字符串中所有的内容[返回的是迭代器]</span>
</span></span><span class="line"><span class="cl"><span class="n">it</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;\d+&#34;</span><span class="p">,</span> <span class="s2">&#34;我的电话号是:10086, 我女朋友的电话是:10010&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 从迭代器中拿到内容需要 .group()</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">it</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 预加载正则  可以提高效率</span>
</span></span><span class="line"><span class="cl"><span class="n">obj</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;\d+&#34;</span><span class="p">)</span>  <span class="c1"># 可以多次使用</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="s2">&#34;我的电话号是:10086, 我女朋友的电话是:10010&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ret</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 非常非常重要的点 ********</span>
</span></span><span class="line"><span class="cl"><span class="n">s</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;div class=&#39;jay&#39;&gt;&lt;span id=&#39;1&#39;&gt;郭麒麟&lt;/span&gt;&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;div class=&#39;jj&#39;&gt;&lt;span id=&#39;2&#39;&gt;宋铁&lt;/span&gt;&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;div class=&#39;jolin&#39;&gt;&lt;span id=&#39;3&#39;&gt;大聪明&lt;/span&gt;&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;div class=&#39;sylar&#39;&gt;&lt;span id=&#39;4&#39;&gt;范思哲&lt;/span&gt;&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;div class=&#39;tory&#39;&gt;&lt;span id=&#39;5&#39;&gt;胡说八道&lt;/span&gt;&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">obj</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;&lt;div class=&#39;.*?&#39;&gt;&lt;span id=&#39;\d+&#39;&gt;.*?&lt;/span&gt;&lt;/div&gt;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ret</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 提取有用的数据 (?P&lt;group&gt;正则)</span>
</span></span><span class="line"><span class="cl"><span class="n">obj</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;&lt;div class=&#39;(?P&lt;class&gt;.*?)&#39;&gt;&lt;span id=&#39;(?P&lt;id&gt;\d+)&#39;&gt;(?P&lt;name&gt;.*?)&lt;/span&gt;&lt;/div&gt;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ret</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;class:&#34;</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&#34;class&#34;</span><span class="p">),</span> <span class="s2">&#34;id:&#34;</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&#34;id&#34;</span><span class="p">),</span> <span class="s2">&#34;name:&#34;</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&#34;name&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># findall: 匹配字符串中所有的符合正则的内容[返回的是数组]  (不经常用 数组效率低)</span>
</span></span><span class="line"><span class="cl"><span class="n">lst</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;\d+&#34;</span><span class="p">,</span> <span class="s2">&#34;我的电话号是:10086, 我女朋友的电话是:10010&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># search: 全文进行匹配，找到一个结果就返回，不会全都找到。</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 返回的结果是match对象, 拿数据需要 .group()</span>
</span></span><span class="line"><span class="cl"><span class="n">s</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;\d+&#34;</span><span class="p">,</span> <span class="s2">&#34;我的电话号是:10086, 我女朋友的电话是:10010&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># match: 从头开始匹配，</span>
</span></span><span class="line"><span class="cl"><span class="n">s</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="k">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;\d+&#34;</span><span class="p">,</span> <span class="s2">&#34;10086, 我女朋友的电话是:10010&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="211-re-豆瓣top250">2.1.1 Re-豆瓣Top250</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 拿到页面源代码——requests</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 通过re来提取想要的有效信息——re</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 存储数据</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">csv</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">num</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;User-Agent&#34;</span><span class="p">:</span> <span class="s2">&#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.102 Safari/537.36&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;x-client-data&#34;</span><span class="p">:</span> <span class="s2">&#34;CJe2yQEIo7bJAQjEtskBCKmdygEInvnLAQjmhMwBCNKPzAEIrZzMAQ==&#34;</span>     <span class="c1"># # 由于被限制，不被限制就不加 需要更新</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 解析数据</span>
</span></span><span class="line"><span class="cl"><span class="n">obj</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&lt;em class=&#34;&#34;&gt;(?P&lt;num&gt;.*?)&lt;/em&gt;.*?&#39;</span>
</span></span><span class="line"><span class="cl">                 <span class="sa">r</span><span class="s1">&#39;&lt;div class=&#34;info&#34;&gt;.*?&lt;span class=&#34;title&#34;&gt;(?P&lt;name&gt;.*?)&lt;/span&gt;.*?&#39;</span>
</span></span><span class="line"><span class="cl">                 <span class="sa">r</span><span class="s1">&#39;&lt;p class=&#34;&#34;&gt;.*?&lt;br&gt;(?P&lt;year&gt;.*?)&amp;nbsp.*?&#39;</span>
</span></span><span class="line"><span class="cl">                 <span class="sa">r</span><span class="s1">&#39;property=&#34;v:average&#34;&gt;(?P&lt;rate&gt;.*?)&lt;/span&gt;.*?&#39;</span>
</span></span><span class="line"><span class="cl">                 <span class="sa">r</span><span class="s1">&#39;&lt;span&gt;(?P&lt;people&gt;.*?)&lt;/span&gt;.*?&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">S</span><span class="p">)</span>  <span class="c1"># re.S 是允许跨行识别</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 如果不使用re.S参数，则只在每一行内进行匹配，如果一行没有，就换下一行重新开始，不会跨行。</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 而使用re.S参数以后，正则表达式会将这个字符串作为一个整体，将“\n”当做一个普通的字符加入到这个字符串中，在整体中进行匹配。</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 生成csv文件 便于数据分析</span>
</span></span><span class="line"><span class="cl"><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;data.csv&#34;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&#34;w&#34;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&#34;utf-8&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">csv_write</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 拿到页面源代码</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;https://movie.douban.com/top250?start=&#34;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="o">*</span><span class="mi">25</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">paper_text</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># print(resp.text)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 进行匹配</span>
</span></span><span class="line"><span class="cl">    <span class="n">rect</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">paper_text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rect</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">dict</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="nb">dict</span><span class="p">[</span><span class="s2">&#34;year&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">[</span><span class="s2">&#34;year&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">csv_write</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;over!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># for i in rect:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     print(&#34;num:&#34;, i.group(&#34;num&#34;))</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     print(&#34;name:&#34;, i.group(&#34;name&#34;))</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     print(&#34;year:&#34;, i.group(&#34;year&#34;).strip())</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     print(&#34;rate:&#34;, i.group(&#34;rate&#34;))</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     print(&#34;people:&#34;, i.group(&#34;people&#34;))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="22-bs4解析">2.2 bs4解析</h3>
<blockquote>
<p>&lt;标签 属性=“属性值”&gt;被标记的内容&lt;/标签&gt;</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">h1</span> <span class="na">align</span><span class="o">=</span><span class="s">&#34;center&#34;</span><span class="p">&gt;</span>i love you<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"># h1: 标签
</span></span><span class="line"><span class="cl"># align: 属性
</span></span><span class="line"><span class="cl"># center: 属性值
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;http://www.baidu.com&#34;</span><span class="p">&gt;</span>周杰伦<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"># a: 标签
</span></span><span class="line"><span class="cl"># href: 属性
</span></span><span class="line"><span class="cl"># http: 属性值
</span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li>
<p>把页面源代码交给BeautifulSoup处理，生成bs对象</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">page</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s2">&#34;html.parser&#34;</span><span class="p">)</span> <span class="c1"># 指定html解析器</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>从bs对象中查找数据</p>
</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># find(标签, 属性=值)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># find_all(标签, 属性=值)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;https://movie.douban.com/top250&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;User-Agent&#34;</span><span class="p">:</span> <span class="s2">&#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.102 Safari/537.36&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;x-client-data&#34;</span><span class="p">:</span> <span class="s2">&#34;CJe2yQEIo7bJAQjEtskBCKmdygEInvnLAQjmhMwBCNKPzAEIrZzMAQ==&#34;</span>  <span class="c1"># # 由于被限制，不被限制就不加 需要更新</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># print(resp.text)</span>
</span></span><span class="line"><span class="cl"><span class="n">page_text</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s2">&#34;html.parser&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">pic_list</span> <span class="o">=</span> <span class="n">page_text</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&#34;div&#34;</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s2">&#34;pic&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pic_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">img_list</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&#34;img&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">img_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># print(img)</span>
</span></span><span class="line"><span class="cl">        <span class="n">name</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;alt&#34;</span><span class="p">)</span>   <span class="c1"># 拿到名字</span>
</span></span><span class="line"><span class="cl">        <span class="n">src</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;src&#34;</span><span class="p">)</span>    <span class="c1"># 直接通过get就可以拿到属性的值, 刚好是子页面的下载路径</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 下载图片</span>
</span></span><span class="line"><span class="cl">        <span class="n">img_resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">img_byte</span> <span class="o">=</span> <span class="n">img_resp</span><span class="o">.</span><span class="n">content</span>    <span class="c1"># 这里拿到的是字节</span>
</span></span><span class="line"><span class="cl">        <span class="n">img_name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&#34;.jpg&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;img/&#34;</span> <span class="o">+</span> <span class="n">img_name</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&#34;wb&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>   <span class="c1"># 对文件夹mark directory as exclude   可以避免pycharm一直对文件进行索引</span>
</span></span><span class="line"><span class="cl">            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">img_byte</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;over!!&#34;</span><span class="p">,</span> <span class="n">img_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="23-xpath解析">2.3 Xpath解析</h3>
<blockquote>
<p>xpath是在xml文档中搜索内容的一门语言，html是xml的一个子集。</p>
</blockquote>
<p>安装lxml模块：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">conda</span> <span class="n">install</span> <span class="n">lxml</span> 
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以把各级标签模拟为各级目录</p>
<blockquote>
<ol>
<li>使用 / 表示层级关系，第一个/表示根节点</li>
<li>使用 // 取出所有的后代</li>
<li>/*/ *表示通配符 任意的节点</li>
<li>/text() 取出其中的文本内容</li>
<li>xpath下标从1开始 [1]</li>
</ol>
</blockquote>
<p>读取html文件：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">etree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&#34;xxx.html&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>筛选属性：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&#34;/html/body/ul/li[1]/a/text()&#34;</span><span class="p">)</span>   <span class="c1"># 可以拿出第一个li标签中a标签的文本</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&#34;/html/body/ul/li/a[@href=&#39;dapao&#39;]/text()&#34;</span><span class="p">)</span>	<span class="c1"># 可以拿出a标签中属性href=dapao的文本</span>
</span></span><span class="line"><span class="cl"><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&#34;/html/body/ul/li/a/@href&#34;</span><span class="p">)</span>		<span class="c1"># 拿出标签a的所有href属性</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>返回列表：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">ol_li_list</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&#34;/html/body/ol/li&#34;</span><span class="p">)</span>	<span class="c1"># 返回li标签列表</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">li</span> <span class="ow">in</span> <span class="n">ol_li_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 使用 .表示相对路径   相当于li其实</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">=</span> <span class="n">li</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&#34;./a/text()&#34;</span><span class="p">)</span>	<span class="c1"># 取li中a标签的文本，相对查找</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">=</span> <span class="n">li</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&#34;./a/@href&#34;</span><span class="p">)</span>	<span class="c1"># 拿到属性值: @属性</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 拿到页面源代码</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 提取和解析数据</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>
</span></span><span class="line"><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;https://nanjing.zbj.com/search/f/?kw=saas&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># print(resp.text)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 解析</span>
</span></span><span class="line"><span class="cl"><span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">div_list</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&#34;/html/body/div[6]/div/div/div[2]/div[5]/div[1]/div&#34;</span><span class="p">)</span>     <span class="c1"># 拿到每一个服务商的div标签</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">div</span> <span class="ow">in</span> <span class="n">div_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">price</span> <span class="o">=</span> <span class="n">div</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&#34;./div/div/a[2]/div[2]/div[1]/span[1]/text()&#34;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&#34;¥&#34;</span><span class="p">)</span>  <span class="c1"># price: [&#39;¥898&#39;]  使用strip()处理数据</span>
</span></span><span class="line"><span class="cl">    <span class="n">title</span> <span class="o">=</span> <span class="s2">&#34;SaaS&#34;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">div</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&#34;./div/div/a[2]/div[2]/div[2]/p/text()&#34;</span><span class="p">))</span>     <span class="c1"># [&#39;软件开发/OA/软件定制开发/&#39;, &#39;软件/原生混合/物联网&#39;] 中间应该是有SasS的 但是没有提取出来  因此用join进行拼接</span>
</span></span><span class="line"><span class="cl">    <span class="n">company</span> <span class="o">=</span> <span class="n">div</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&#34;./div/div/a[1]/div[1]/p/text()&#34;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>                      <span class="c1"># company: [&#39;\n\n&#39;, &#39;\n\n彬达科技&#39;]  使用strip()可以直接去掉\n</span>
</span></span><span class="line"><span class="cl">    <span class="n">location</span> <span class="o">=</span> <span class="n">div</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&#34;./div/div/a[1]/div[1]/div/span/text()&#34;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;title:&#34;</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="s2">&#34;price:&#34;</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="s2">&#34;company:&#34;</span><span class="p">,</span> <span class="n">company</span><span class="p">,</span> <span class="s2">&#34;location:&#34;</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="三request进阶">三、request进阶</h2>
<h3 id="31-模拟登录-cookie">3.1 模拟登录-cookie</h3>
<p>发现访问该网站可以得到<code>cookie</code>，注意：<code>cookie</code>一般不会在 <code>预览 </code>中， 一般在 <code>响应标头</code> 中</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220513160421732.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220513160421732.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220513160421732.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220513160421732.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220513160421732.png"
        title="image-20220513160421732" /></p>
<p>因此可以<code>POST</code>该网站得到cookie</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">    <span class="c1"># 获得cookie，构造headers</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_cookie</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">cookie_url</span> <span class="o">=</span> <span class="s2">&#34;http://ehall.seu.edu.cn/ygfw/sys/swpubapp/xxx&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">cookie_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">cookie_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;USERID&#34;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_info</span><span class="o">.</span><span class="n">user_id</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">		<span class="c1"># 将cookies转化为字典格式</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">cookie_response</span><span class="o">.</span><span class="n">cookies</span><span class="o">.</span><span class="n">get_dict</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">$</span> <span class="n">python</span> <span class="n">main</span><span class="o">.</span><span class="n">py</span>
</span></span><span class="line"><span class="cl"><span class="n">得到Cookie</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">NSC_ESNS</span><span class="o">=</span><span class="mi">57</span><span class="n">d88235</span><span class="o">-</span><span class="mi">1</span><span class="n">b4a</span><span class="o">-</span><span class="mf">127e-9678</span><span class="o">-</span><span class="mf">00e0</span><span class="n">ed9d66bd_2375465377_1978659927_00000000005768517823</span><span class="p">;</span> 				<span class="n">NSC_JOqgyvhaegq01uld2umxhgbeip03kb0</span><span class="o">=</span><span class="n">ffffffff09489f1745525d5f4f58455e445a4a423660</span><span class="p">;</span> <span class="n">_WEU</span><span class="o">=</span><span class="n">tbZT</span>
</span></span><span class="line"><span class="cl">	<span class="n">ZDIpO9DfzKWosRmHWCxuajrVVDsuty8Dy6k2GDK0hXp7irsDDNISCgMQIZQTK</span><span class="o">*</span><span class="n">DeyDKn7eS0h2lzXOQEjo</span><span class="o">..</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>但此时的Cookie不够，还缺少</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220513165255251.png" alt="image-20220513165255251" style="zoom:67%;" />
<p>当重新登录并抓包，可以发现红色框中的Cookie在首次登陆时获得：</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220513165349310.png" alt="image-20220513165349310" style="zoom:67%;" />
<p>因此在login的时候，就应该保存该Cookie。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"></code></pre></td></tr></table>
</div>
</div><p>提交表单需要编码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;application/x-www-form-urlencoded; charset=UTF-8&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="n">parse</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">post_info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="32-防盗链">3.2 防盗链</h3>
<p>Referer: “”   用于验证你的资源链接是从哪来的？ 相当于溯源</p>
<p>从梨视频网站下载视频 流程：</p>
<ol>
<li>拿到请求网址和contID</li>
</ol>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228095048876.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228095048876.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228095048876.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228095048876.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228095048876.png"
        title="image-20220228095048876" /></p>
<ol start="2">
<li>拿到videoStatus返回的.json &ndash;&gt; srcUrl</li>
</ol>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220225110624940.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220225110624940.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220225110624940.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220225110624940.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220225110624940.png"
        title="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220225110624940.png" /></p>
<ol start="3">
<li>修正srcUrl</li>
</ol>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220225110714800.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220225110714800.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220225110714800.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220225110714800.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220225110714800.png"
        title="image-20220225110714800" /></p>
<ol start="4">
<li>下载视频</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 1. 拿到contID</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 2. 拿到videoStatus返回的.json --&gt; srcUrl</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 3. 修正srcUrl</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 4. 下载视频</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 拉取视频资源网站</span>
</span></span><span class="line"><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;https://www.pearvideo.com/video_1752547&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">url_cont</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;_&#34;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>    <span class="c1"># 以 _ 分割为两个元素，取第二个</span>
</span></span><span class="line"><span class="cl"><span class="n">video_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;https://www.pearvideo.com/videoStatus.jsp?contId=</span><span class="si">{</span><span class="n">url_cont</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;User-Agent&#34;</span><span class="p">:</span> <span class="s2">&#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.102 Safari/537.36&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;Referer&#34;</span><span class="p">:</span> <span class="n">url</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 拿到响应包</span>
</span></span><span class="line"><span class="cl"><span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">video_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 从网络响应包中找到网络资源地址：</span>
</span></span><span class="line"><span class="cl"><span class="c1"># https://video.pearvideo.com/mp4/adshort/20220222/1646013336252-15830346_adpkg-ad_hd.mp4</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 从https://www.pearvideo.com/video_1658861的页面元素中找到视频地址为：</span>
</span></span><span class="line"><span class="cl"><span class="c1"># https://video.pearvideo.com/mp4/adshort/20220222/cont-1752547-15830346_adpkg-ad_hd.mp4</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">dic</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">srcUrl</span> <span class="o">=</span> <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;videoInfo&#39;</span><span class="p">][</span><span class="s1">&#39;videos&#39;</span><span class="p">][</span><span class="s1">&#39;srcUrl&#39;</span><span class="p">]</span>  <span class="c1"># 拿到的网址并不能直接使用，通过以上的对比进行修改</span>
</span></span><span class="line"><span class="cl"><span class="n">sysTime</span> <span class="o">=</span> <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;systemTime&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 修改srcUrl</span>
</span></span><span class="line"><span class="cl"><span class="n">srcUrl</span> <span class="o">=</span> <span class="n">srcUrl</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">sysTime</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&#34;cont-</span><span class="si">{</span><span class="n">url_cont</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">srcUrl</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 请求video资源</span>
</span></span><span class="line"><span class="cl"><span class="n">video</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">srcUrl</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;a.mp4&#34;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&#34;wb&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">video</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Over!!&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>通过对比，发现只有 cont-1658861 不一样，并且cont后面的数字和原链接最后的数字相同，因此对响应包中的资源url进行修正。</p>
<h3 id="33-代理">3.3 代理</h3>
<p>原理：</p>
<blockquote>
<p>通过第三方的机器去发送请求</p>
</blockquote>
<h3 id="34-网易云评论">3.4 网易云评论</h3>
<p>里边用到加密算法，需要安装：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">conda</span> <span class="n">install</span> <span class="n">pycrypto</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">Crypto.Cipher</span> <span class="kn">import</span> <span class="n">AES</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>考虑过程为：</p>
<ol>
<li>找到未加密的参数</li>
<li>想办法对参数进行加密（按照网易的加密方法），params和encSecKey</li>
<li>请求到网易，拿到评论信息</li>
</ol>
<p>找到评论所在请求：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228104640739.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228104640739.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228104640739.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228104640739.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228104640739.png"
        title="image-20220228104640739" /></p>
<p>找到请求评论的链接：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228105427485.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228105427485.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228105427485.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228105427485.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228105427485.png"
        title="image-20220228105427485" /></p>
<p>因为请求方法是Post，发现表单数据被加密：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228105237796.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228105237796.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228105237796.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228105237796.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228105237796.png"
        title="image-20220228105237796" /></p>
<p>查看程序调用堆栈。选取最上面那个。因为他是最后执行的，也就是发送数据的：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228112248871.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228112248871.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228112248871.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228112248871.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228112248871.png"
        title="image-20220228112248871" /></p>
<p>完事进去之后发现程序停留在这一行，刚好是send，在这一行设置程序断点：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228112137142.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228112137142.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228112137142.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228112137142.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228112137142.png"
        title="image-20220228112137142" /></p>
<p>查看当前请求的url，发现和我们想要的评论url不同：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228112735702.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228112735702.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228112735702.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228112735702.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228112735702.png"
        title="image-20220228112735702" /></p>
<p>继续执行，直到我们想要的url为止，此时data里的param被加密：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228112927837.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228112927837.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228112927837.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228112927837.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228112927837.png"
        title="image-20220228112927837" /></p>
<p>需要往回找未加密的，通过 调用堆栈 往上找：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228113313254.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228113313254.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228113313254.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228113313254.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228113313254.png"
        title="image-20220228113313254" /></p>
<p>打开之后发现依然是加密的：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228143828196.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228143828196.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228143828196.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228143828196.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228143828196.png"
        title="image-20220228143828196" /></p>
<p>那么需要再往上找，直到找到未加密的参数，也就是说在下一层t0x.be0x中数据才被加密：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228144023553.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228144023553.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228144023553.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228144023553.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228144023553.png"
        title="image-20220228144023553" /></p>
<p>那么回到上一层中，找到集体在何处被加密：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228144352363.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228144352363.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228144352363.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228144352363.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228144352363.png"
        title="image-20220228144352363" /></p>
<p>在函数中逐行设置断点，慢慢检测在何处数据被加密：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228145014406.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228145014406.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228145014406.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228145014406.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228145014406.png"
        title="image-20220228145014406" /></p>
<p>使用图中按钮可以逐行检测代码结果，在window&hellip;这一行还是明文：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228155519551.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228155519551.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228155519551.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228155519551.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228155519551.png"
        title="image-20220228155519551" /></p>
<p>到了下一行，参数被加密，因此可以断定加密函数是window&hellip;，并可以得到原文：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228155635105.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228155635105.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228155635105.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228155635105.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228155635105.png"
        title="image-20220228155635105" /></p>
<p>可以看出，params ==&gt; encText，encSecKey ==&gt; encSecKey：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228152032516.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228152032516.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228152032516.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228152032516.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228152032516.png"
        title="image-20220228152032516" /></p>
<p>取加密函数：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228161314968.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228161314968.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228161314968.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228161314968.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228161314968.png"
        title="image-20220228161314968" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228161536508.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228161536508.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228161536508.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228161536508.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228161536508.png"
        title="image-20220228161536508" /></p>
<p>注意原函数里面的参数，需要给他配齐，对应着调用处的实参，可以对其进行赋值：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228161739509.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228161739509.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228161739509.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228161739509.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228161739509.png"
        title="image-20220228161739509" /></p>
<p>通过在控制台运行，可以得到其他参数：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228161847193.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228161847193.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228161847193.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228161847193.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228161847193.png"
        title="image-20220228161847193" /></p>
<p>或者通过以下方式也可以得到参数：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228192455256.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228192455256.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228192455256.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228192455256.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228192455256.png"
        title="image-20220228192455256" /></p>
<p>设置断点拿到以下参数：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228193251392.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228193251392.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228193251392.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228193251392.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220228193251392.png"
        title="image-20220228193251392" /></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 找到未加密的参数</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 想办法把参数进行加密（必须参考网易的逻辑），params，encSecKey</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 请求到网易 拿到评论信息</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">Crypto.Cipher</span> <span class="kn">import</span> <span class="n">AES</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">base64</span> <span class="kn">import</span> <span class="n">b64encode</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;https://music.163.com/weapi/comment/resource/comments/get?csrf_token=&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 请求方法是POST</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 找到真实参数</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">e</span> <span class="o">=</span> <span class="s1">&#39;010001&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">f</span> <span class="o">=</span> <span class="s1">&#39;00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341&#39;</span> \
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82&#39;</span> \
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span> <span class="o">=</span> <span class="s1">&#39;0CoJUm6Qyw8W8jud&#39;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># i是个随机值，因此我们只能去响应包中拿取i</span>
</span></span><span class="line"><span class="cl"><span class="n">i</span> <span class="o">=</span> <span class="s1">&#39;9bdHkFpLbUCNTAnl&#39;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 为了简化运算（不想处理c函数），设置为固定的   i固定 则它也固定</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_encSecKey</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s2">&#34;1eb5a1efb12baafd580884b5c41b0a5bbbaee1c0de49f9d0470f05aa2a9215c25563b0ad5da008dacd85f65e0406addbd&#34;</span> \
</span></span><span class="line"><span class="cl">           <span class="s2">&#34;a43bbe77716896089f607826000aa4797f34e03e8eb822096c166ec8ae4463ec1f7dab60c045eff18dfdef9f78555301f&#34;</span> \
</span></span><span class="line"><span class="cl">           <span class="s2">&#34;3107d521918fea66940b6589749b9db575afa03f74ec04d01f1726f22ba1d2&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_params</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 此处的data需要是字符串格式，不能是字典格式，因此需要使用json转换</span>
</span></span><span class="line"><span class="cl">    <span class="n">first</span> <span class="o">=</span> <span class="n">enc_params</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">params</span> <span class="o">=</span> <span class="n">enc_params</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">params</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">enc_params</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>   <span class="c1"># 加密过程</span>
</span></span><span class="line"><span class="cl">    <span class="n">iv</span> <span class="o">=</span> <span class="s2">&#34;0102030405060708&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">aes</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&#34;utf-8&#34;</span><span class="p">),</span> <span class="n">IV</span><span class="o">=</span><span class="n">iv</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&#34;utf-8&#34;</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="n">AES</span><span class="o">.</span><span class="n">MODE_CBC</span><span class="p">)</span>     <span class="c1"># 创建一个AES对象</span>
</span></span><span class="line"><span class="cl">    <span class="n">bs</span> <span class="o">=</span> <span class="n">aes</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">to_16</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>   <span class="c1"># 加密，加密内容必须是16的倍数</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 由于加密结果是不能直接转为字符串的，需要先转化为base64才行，然后再转化为字符串</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">b64encode</span><span class="p">(</span><span class="n">bs</span><span class="p">),</span> <span class="s2">&#34;utf-8&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">to_16</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">pam</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">%</span> <span class="mi">16</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">pam</span><span class="p">)</span> <span class="o">*</span> <span class="n">pam</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">data</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 进行加密过程</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    function a(a = 16) {    # 随机产生16位随机码
</span></span></span><span class="line"><span class="cl"><span class="s2">        var d, e, b = &#34;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#34;, c = &#34;&#34;;
</span></span></span><span class="line"><span class="cl"><span class="s2">        for (d = 0; a &gt; d; d += 1)  # 随机16次
</span></span></span><span class="line"><span class="cl"><span class="s2">            e = Math.random() * b.length,   # 随机数
</span></span></span><span class="line"><span class="cl"><span class="s2">            e = Math.floor(e),     # 取整
</span></span></span><span class="line"><span class="cl"><span class="s2">            c += b.charAt(e);     # 去字符串中的xxx位置 b
</span></span></span><span class="line"><span class="cl"><span class="s2">        return c
</span></span></span><span class="line"><span class="cl"><span class="s2">    }
</span></span></span><span class="line"><span class="cl"><span class="s2">    function b(a, b) {
</span></span></span><span class="line"><span class="cl"><span class="s2">        var c = CryptoJS.enc.Utf8.parse(b)
</span></span></span><span class="line"><span class="cl"><span class="s2">          , d = CryptoJS.enc.Utf8.parse(&#34;0102030405060708&#34;)
</span></span></span><span class="line"><span class="cl"><span class="s2">          , e = CryptoJS.enc.Utf8.parse(a)
</span></span></span><span class="line"><span class="cl"><span class="s2">          , f = CryptoJS.AES.encrypt(e, c, {    # AES算法 e原文，c是密钥
</span></span></span><span class="line"><span class="cl"><span class="s2">            iv: d,      # 偏移量
</span></span></span><span class="line"><span class="cl"><span class="s2">            mode: CryptoJS.mode.CBC     # 模式：CBC
</span></span></span><span class="line"><span class="cl"><span class="s2">        });
</span></span></span><span class="line"><span class="cl"><span class="s2">        return f.toString()
</span></span></span><span class="line"><span class="cl"><span class="s2">    }
</span></span></span><span class="line"><span class="cl"><span class="s2">    function c(a, b, c) {
</span></span></span><span class="line"><span class="cl"><span class="s2">        var d, e;
</span></span></span><span class="line"><span class="cl"><span class="s2">        return setMaxDigits(131),
</span></span></span><span class="line"><span class="cl"><span class="s2">        d = new RSAKeyPair(b,&#34;&#34;,c),
</span></span></span><span class="line"><span class="cl"><span class="s2">        e = encryptedString(d, a)
</span></span></span><span class="line"><span class="cl"><span class="s2">    }
</span></span></span><span class="line"><span class="cl"><span class="s2">    function d(d, e, f, g) {  # d:data, e:&#39;010001&#39;, f:很长, g:&#39;0CoJUm6Qyw8W8jud&#39;
</span></span></span><span class="line"><span class="cl"><span class="s2">        var h = </span><span class="si">{}</span><span class="s2">   # 设置一个空对象
</span></span></span><span class="line"><span class="cl"><span class="s2">          , i = a(16);  # i就是一个随机值
</span></span></span><span class="line"><span class="cl"><span class="s2">        return h.encText = b(d, g),  # g 当作密钥 
</span></span></span><span class="line"><span class="cl"><span class="s2">        h.encText = b(h.encText, i),  # 返回的就是params
</span></span></span><span class="line"><span class="cl"><span class="s2">        h.encSecKey = c(i, e, f),     # 返回的就是encSecKey   其中e、f都是定死的，只有i是变量，若固定i，则得到的key一定是固定的
</span></span></span><span class="line"><span class="cl"><span class="s2">        h
</span></span></span><span class="line"><span class="cl"><span class="s2">    }
</span></span></span><span class="line"><span class="cl"><span class="s2">    function e(a, b, d, e) {
</span></span></span><span class="line"><span class="cl"><span class="s2">        var f = </span><span class="si">{}</span><span class="s2">;
</span></span></span><span class="line"><span class="cl"><span class="s2">        return f.encText = c(a + e, b, d),
</span></span></span><span class="line"><span class="cl"><span class="s2">        f
</span></span></span><span class="line"><span class="cl"><span class="s2">    }
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_comments</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">song_id</span><span class="p">,</span> <span class="n">page_num</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">rid</span> <span class="o">=</span> <span class="s2">&#34;R_SO_4_&#34;</span> <span class="o">+</span> <span class="n">song_id</span>
</span></span><span class="line"><span class="cl">    <span class="n">threadId</span> <span class="o">=</span> <span class="s2">&#34;R_SO_4_&#34;</span> <span class="o">+</span> <span class="n">song_id</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;cursor&#34;</span><span class="p">:</span> <span class="s2">&#34;-1&#34;</span><span class="p">,</span>  <span class="c1"># 这个和paperNo共同决定哪一页的评论1610629253639  1621187632097</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;offset&#34;</span><span class="p">:</span> <span class="n">page_num</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">%</span> <span class="mi">200</span><span class="p">,</span>  <span class="c1"># 代表最新评论的页数</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;orderType&#34;</span><span class="p">:</span> <span class="s2">&#34;1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;pageNo&#34;</span><span class="p">:</span> <span class="n">page_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># 代表热评的页数</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;pageSize&#34;</span><span class="p">:</span> <span class="s2">&#34;20&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;rid&#34;</span><span class="p">:</span> <span class="n">rid</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;threadId&#34;</span><span class="p">:</span> <span class="n">threadId</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;params&#34;</span><span class="p">:</span> <span class="n">get_params</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;encSecKey&#34;</span><span class="p">:</span> <span class="n">get_encSecKey</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="n">source</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&#34;data&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># print(source)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">source</span><span class="p">[</span><span class="s2">&#34;hotComments&#34;</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">page_num</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;=====hotComments=====&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">hot_comment</span> <span class="ow">in</span> <span class="n">source</span><span class="p">[</span><span class="s2">&#34;hotComments&#34;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="n">hot_comment</span><span class="p">[</span><span class="s2">&#34;user&#34;</span><span class="p">][</span><span class="s2">&#34;nickname&#34;</span><span class="p">],</span> <span class="s2">&#34;:&#34;</span><span class="p">,</span> <span class="n">hot_comment</span><span class="p">[</span><span class="s2">&#34;content&#34;</span><span class="p">],</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">time:&#34;</span><span class="p">,</span> <span class="n">hot_comment</span><span class="p">[</span><span class="s2">&#34;timeStr&#34;</span><span class="p">],</span> <span class="s2">&#34;点赞数:&#34;</span><span class="p">,</span> <span class="n">hot_comment</span><span class="p">[</span><span class="s2">&#34;likedCount&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;-&#34;</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="n">source</span><span class="p">[</span><span class="s2">&#34;comments&#34;</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;=====latestComments=====&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">latest_comment</span> <span class="ow">in</span> <span class="n">source</span><span class="p">[</span><span class="s2">&#34;comments&#34;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="n">latest_comment</span><span class="p">[</span><span class="s2">&#34;user&#34;</span><span class="p">][</span><span class="s2">&#34;nickname&#34;</span><span class="p">],</span> <span class="s2">&#34;:&#34;</span><span class="p">,</span> <span class="n">latest_comment</span><span class="p">[</span><span class="s2">&#34;content&#34;</span><span class="p">],</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">time:&#34;</span><span class="p">,</span> <span class="n">latest_comment</span><span class="p">[</span><span class="s2">&#34;timeStr&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;-&#34;</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;nil&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># for num in range(1, 34):</span>
</span></span><span class="line"><span class="cl"><span class="c1">#     get_comments(url, num)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">song_id</span> <span class="o">=</span> <span class="s2">&#34;1923184888&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">page_num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;*****第</span><span class="si">{</span><span class="n">page_num</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">页*****&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">get_comments</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">song_id</span><span class="p">,</span> <span class="n">page_num</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&#34;nil&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;over!!!&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="四加速">四、加速</h2>
<blockquote>
<p>进程是一个资源单位，线程是一个执行单位</p>
<p>eg: xxx进程包含多个线程；一个项目组（进程）包含多个工作人员（线程）；</p>
</blockquote>
<h3 id="41-多线程">4.1 多线程</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 多线程</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">Thread</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MyThread</span><span class="p">(</span><span class="n">Thread</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># 固定的，  -&gt; 当线程被执行的时候，被执行的就是run()</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;子线程: &#34;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">t</span> <span class="o">=</span> <span class="n">MyThread</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># t.run()  # 这种方法是调用方法，依然是单线程</span>
</span></span><span class="line"><span class="cl">    <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>  <span class="c1"># 开启线程，线程此时可以开始工作，但不必须，具体执行时间由CPU决定</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;主线程:&#34;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl"><span class="c1"># =========重命名=========      </span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MyThread</span><span class="p">(</span><span class="n">Thread</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">Thread</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># 固定的，  -&gt; 当线程被执行的时候，被执行的就是run()</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">(),</span> <span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">t1</span> <span class="o">=</span> <span class="n">MyThread</span><span class="p">(</span><span class="s2">&#34;wlh&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># t.run()  # 这种方法是调用方法，依然是单线程</span>
</span></span><span class="line"><span class="cl">    <span class="n">t1</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>  <span class="c1"># 开启线程，线程此时可以开始工作，但不必须，具体执行时间由CPU决定</span>
</span></span><span class="line"><span class="cl">    <span class="n">t2</span> <span class="o">=</span> <span class="n">MyThread</span><span class="p">(</span><span class="s2">&#34;zjl&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># t.run()  # 这种方法是调用方法，依然是单线程</span>
</span></span><span class="line"><span class="cl">    <span class="n">t2</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>  <span class="c1"># 开启线程，线程此时可以开始工作，但不必须，具体执行时间由CPU决定</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># for i in range(1000):</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     print(&#34;主线程:&#34;, i)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>由于主线程和子线程同时执行，共同输出在工作台，所以会造成图中的情况：</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220301112917627.png" alt="image-20220301112917627" style="zoom: 67%;" />
<h3 id="42-多进程">4.2 多进程</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Process</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;子进程:&#34;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">p</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">func</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;主进程:&#34;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220307210355884.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220307210355884.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220307210355884.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220307210355884.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220307210355884.png"
        title="image-20220307210355884" /></p>
<h3 id="43-线程池进程池">4.3 线程池\进程池</h3>
<p>线程池：一次性开辟一些线程，用户直接给线程池提交任务，线程的任务调度交给线程池完成</p>
<p>创建线程池：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ThreadPoolExecutor</span>
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="k">as</span> <span class="n">t</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">t</span><span class="o">.</span><span class="n">submit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 线程池外的叫做守护，需要等待线程池内的任务执行完毕，才能继续执行</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li>如何提取单个页面 的数据</li>
<li>利用线程池，进行多个页面同时抓取</li>
</ol>
<p>北京新发地举例：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">csv</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ThreadPoolExecutor</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;xfd_list.csv&#34;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&#34;w&#34;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&#34;utf-8&#34;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>  <span class="c1"># newline 是为了过滤掉换行符</span>
</span></span><span class="line"><span class="cl"><span class="n">csv_writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">download_one_page</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">page_num</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;current&#34;</span><span class="p">:</span> <span class="n">page_num</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">html_page_json</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">price_list</span> <span class="o">=</span> <span class="n">html_page_json</span><span class="p">[</span><span class="s1">&#39;list&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">price_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># print(item)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># txt = [0 for _ in range(7)]</span>
</span></span><span class="line"><span class="cl">        <span class="n">txt</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">7</span>
</span></span><span class="line"><span class="cl">        <span class="n">txt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;prodName&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">txt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;lowPrice&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">txt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;highPrice&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">txt</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;avgPrice&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">txt</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;place&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">txt</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;unitInfo&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">txt</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;pubDate&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># txt.append(item[&#39;prodName&#39;])</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># txt.append(item[&#39;lowPrice&#39;])</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># txt.append(item[&#39;highPrice&#39;])</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># txt.append(item[&#39;avgPrice&#39;])</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># txt.append(item[&#39;place&#39;])</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># txt.append(item[&#39;unitInfo&#39;])</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># txt.append(item[&#39;pubDate&#39;])</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># print(info)</span>
</span></span><span class="line"><span class="cl">        <span class="n">csv_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">page_num</span><span class="p">,</span> <span class="s2">&#34;提取完毕！！！&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span> 		<span class="c1"># 开多了有可能出格式问题</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">f</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">download_one_page</span><span class="p">,</span> <span class="s2">&#34;http://www.xinfadi.com.cn/getPriceData.html&#34;</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;全部下载完毕!!!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># for num in range(1, 200):</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     download_one_page(&#34;http://www.xinfadi.com.cn/getPriceData.html&#34;, num)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="44-协程">4.4 协程</h3>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220308105704198.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220308105704198.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220308105704198.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220308105704198.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220308105704198.png"
        title="image-20220308105704198" /></p>
<p>要达到异步效果，需要将同步操作写为协程操作：</p>
<p><strong>（同步操作）</strong></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220308111517512.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220308111517512.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220308111517512.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220308111517512.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220308111517512.png"
        title="image-20220308111517512" /></p>
<p><strong>（异步操作）</strong></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220308111848262.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220308111848262.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220308111848262.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220308111848262.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220308111848262.png"
        title="image-20220308111848262" /></p>
<p>python不太希望上述写法，因为主进程里线程过多，建议下述写法：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># python不希望上面那种写法，因为主进程的线程过多</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">func1</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;你好！我是李雪琴！&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>     <span class="c1"># 将异步操作挂起</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;你好！我是李雪琴！&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">func2</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;你好！我是王建国！&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>     <span class="c1"># 将异步操作挂起</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;你好！我是王建国！&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">func3</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;你好！我是黎明！&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>     <span class="c1"># 将异步操作挂起</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;你好！我是黎明！&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 第一种写法</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># f1 = func1()</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># await f1  # 一般wait挂起操作放在协程对象前面</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># 第二种写法（推荐）</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 一次性启动多个任务（协程）</span>
</span></span><span class="line"><span class="cl">    <span class="n">tasks</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">func1</span><span class="p">()),</span>   <span class="c1"># 创建成task对象</span>
</span></span><span class="line"><span class="cl">        <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">func2</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl">        <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">func3</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span>   <span class="c1"># 挂起</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="n">t2</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">t2</span> <span class="o">-</span> <span class="n">t1</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>模拟爬虫应用：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 模拟爬虫应用</span>
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">download</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&#34;准备开始下载&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>    <span class="c1"># 模拟网络请求  实际中 只需在此处将爬虫网络请求语句写为协程形式即可</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&#34;下载完毕&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">urls</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># tasks = [asyncio.create_task(download(url)) for url in urls]   # 这样也可以 效果一样的 更加简洁</span>
</span></span><span class="line"><span class="cl">    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">urls</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;https://www.google.com/webhp&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;https://www.baidu.com/&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;https://www.bilibili.com/&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">(</span><span class="n">urls</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="45-aiohttp模块应用">4.5 aiohttp模块应用</h3>
<p>requests.get() 同步的代码  &mdash;&gt;  异步操作aiohttp</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">conda</span> <span class="n">install</span> <span class="n">aiohttp</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">aiohttp</span>
</span></span><span class="line"><span class="cl"><span class="c1"># aiohttp.ClientSession()  &lt;==&gt;  requests  几乎一模一样</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">download</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>                     <span class="c1"># 从右边切片，切一次，取第二个元素</span>
</span></span><span class="line"><span class="cl">    <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">Session</span><span class="p">:</span>   <span class="c1"># Session现在相当于requests</span>
</span></span><span class="line"><span class="cl">        <span class="k">async</span> <span class="k">with</span> <span class="n">Session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>         <span class="c1"># resp = requests.get(url)</span>
</span></span><span class="line"><span class="cl">            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>         <span class="c1"># 当请求返回，就可以开始写入文件 此处可以延申 aiofiles 异步写入文件</span>
</span></span><span class="line"><span class="cl">                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>   <span class="c1"># 读取内容是异步的，因此需要await挂起</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&#34;下载完毕！&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">urls</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span><span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">))</span> <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">urls</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;https://img.syt5.com/2021/0907/20210907082121262.jpg&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;https://img.syt5.com/2021/0907/20210907082121629.jpg&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;https://img.syt5.com/2021/0907/20210907082121801.jpg&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># asyncio.run(main(urls))   # 会报错，RuntimeError: Event loop is closed   改为如下：</span>
</span></span><span class="line"><span class="cl">    <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">main</span><span class="p">(</span><span class="n">urls</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="46-抓取小说">4.6 抓取小说</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">asyncio</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">aiohttp</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">aiofiles</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 所需网址</span>
</span></span><span class="line"><span class="cl"><span class="c1"># http://dushu.baidu.com/api/pc/getCatalog?data={&#34;book_id&#34;:&#34;4306063500&#34;}  # 小说章节</span>
</span></span><span class="line"><span class="cl"><span class="c1"># http://dushu.baidu.com/api/pc/getChapterContent?data={&#34;book_id&#34;:&#34;4306063500&#34;,&#34;cid&#34;:&#34;4306063500|1569782244&#34;,&#34;need_bookinfo&#34;:1}  # 小说章节内容</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">get_catalog</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">dict</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">book_id</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;novel&#39;</span><span class="p">][</span><span class="s1">&#39;book_id&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;novel&#39;</span><span class="p">][</span><span class="s1">&#39;items&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="n">title</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">cid</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;cid&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 此处可以开始进行获取小说内容</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 准备异步任务</span>
</span></span><span class="line"><span class="cl">        <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_content</span><span class="p">(</span><span class="n">book_id</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">cid</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 开始执行异步任务</span>
</span></span><span class="line"><span class="cl">    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;下载完毕！！！&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">get_content</span><span class="p">(</span><span class="n">book_id</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">cid</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;book_id&#34;</span><span class="p">:</span> <span class="n">book_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;cid&#34;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">book_id</span><span class="si">}</span><span class="s2">|</span><span class="si">{</span><span class="n">cid</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;need_bookinfo&#34;</span><span class="p">:</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;http://dushu.baidu.com/api/pc/getChapterContent?data=</span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">dict</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># 异步写入 aiofiles</span>
</span></span><span class="line"><span class="cl">            <span class="k">async</span> <span class="k">with</span> <span class="n">aiofiles</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;西游记/&#39;</span> <span class="o">+</span> <span class="n">title</span> <span class="o">+</span> <span class="s1">&#39;.txt&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">await</span> <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;novel&#39;</span><span class="p">][</span><span class="s1">&#39;content&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">book_id</span> <span class="o">=</span> <span class="s1">&#39;4306063500&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://dushu.baidu.com/api/pc/getCatalog?data={&#34;book_id&#34;:&#34;&#39;</span> <span class="o">+</span> <span class="n">book_id</span> <span class="o">+</span> <span class="s1">&#39;&#34;}&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># print(url)</span>
</span></span><span class="line"><span class="cl">    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">get_catalog</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>新建文档：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220308201310098.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220308201310098.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220308201310098.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220308201310098.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220308201310098.png"
        title="image-20220308201310098" /></p>
<h3 id="47-视频抓取">4.7 视频抓取</h3>
<p>首先，视频不可能直接加载到页面，因为这样会导致网页速度极慢&hellip;&hellip;不可能一次性加载完毕！！！</p>
<p>那视频网站一般怎么做呢？？？</p>
<p>答：用户上传 &ndash;&gt; 转码（把视频做处理，2k，1080，标清） &ndash;&gt; 切片处理（把单个的文件进行拆分）</p>
<blockquote>
<p>需要一个文件记录：1. 视频播放顺序，2. 视频存放路径。    M3U8  txt  json    ==&gt;  文本</p>
<p>想要抓取一个视频：</p>
<ol>
<li>找到m3u8文件（各种手段）</li>
<li>通过m3u8下载到ts文件</li>
<li>可以通过各种手段（不仅是编程手段） 把ts文件合并为一个mp4文件</li>
</ol>
</blockquote>
<h4 id="471-简单难度">4.7.1 简单难度</h4>
<p>流程：</p>
<ol>
<li>针对页面源代码中含有m3u8的视频，采用以下方法抓取到m3u8文件：</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://91kju.com/vod-play-id-1039-sid-1-pid-1.html&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;user-agent&#34;</span><span class="p">:</span> <span class="s2">&#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.102 Safari/537.36&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;origin&#34;</span><span class="p">:</span> <span class="s2">&#34;https://91kju.com&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># obj = re.compile(r&#34;\&#34;url\&#34;:(?P&lt;url&gt;.*?),&#34;, re.S)          # 注意！！！这样提取出来的网址是带引号的！必然是无法访问的，要提取不带引号的网址！！！</span>
</span></span><span class="line"><span class="cl">    <span class="n">obj</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;</span><span class="se">\&#34;</span><span class="s2">url</span><span class="se">\&#34;</span><span class="s2">:</span><span class="se">\&#34;</span><span class="s2">(?P&lt;url&gt;.*?)</span><span class="se">\&#34;</span><span class="s2">,&#34;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">S</span><span class="p">)</span>        <span class="c1"># 此处一定要注意！！！</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># print(resp.text)</span>
</span></span><span class="line"><span class="cl">    <span class="n">m3u8_url</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># print(m3u8_url)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 下载m3u8文件</span>
</span></span><span class="line"><span class="cl">    <span class="n">path</span> <span class="o">=</span> <span class="n">m3u8_url</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">resp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;user-agent&#34;</span><span class="p">:</span> <span class="s2">&#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.102 Safari/537.36&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;origin&#34;</span><span class="p">:</span> <span class="s2">&#34;https://91kju.com&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;path&#34;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;/</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;authority&#34;</span><span class="p">:</span> <span class="s2">&#34;m3api.awenhao.com&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">resp2</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">m3u8_url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;火星救援.m3u8&#34;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">resp2</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;m3u8下载完毕！&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">resp2</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>
<p>拿到m3u8文件后才可以开始下载视频</p>
<p>图中红框示例部分就是视频资源的链接，可以从其中下载视频片段</p>
</li>
</ol>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220309100436560.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220309100436560.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220309100436560.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220309100436560.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220309100436560.png"
        title="image-20220309100436560" /></p>
<ol start="3">
<li>下载视频片段</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 拿到m3u8后，就可以开始下载视频了</span>
</span></span><span class="line"><span class="cl"><span class="n">num</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;火星救援.m3u8&#34;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>     <span class="c1"># 去掉空格，空白，换行符</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">):</span>    <span class="c1"># 若行开头为 # , 不要</span>
</span></span><span class="line"><span class="cl">            <span class="k">continue</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># print(line)</span>
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;video/</span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s2">.mp4&#34;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">resp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;片段</span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s2">下载完毕！！！&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220309102034963.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220309102034963.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220309102034963.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220309102034963.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220309102034963.png"
        title="image-20220309102034963" /></p>
<ol start="4">
<li>最后需要软件将视频片段合成为完整的视频</li>
</ol>
<h4 id="472-复杂91">4.7.2 复杂91</h4>
<p>思路：</p>
<ol>
<li>拿到主页面的页面源代码，找到iframe</li>
<li>从iframe的页面源代码中拿到m3u8文件</li>
<li>下载第一层m3u8文件 &ndash;&gt; 下载第二层m3u8文件（视频存放路径）</li>
<li>下载视频</li>
<li>下载密钥，进行解密操作</li>
<li>将片段合成视频</li>
</ol>
<p>暂未实施</p>
<p>异步下载视频：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_m3u8</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">page_code</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># print(resp.text)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># 取m3u8的url</span>
</span></span><span class="line"><span class="cl">    <span class="n">obj</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&#34;url&#34;:&#34;(?P&lt;m3u8_url&gt;.*?)&#34;,&#34;&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">S</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">m3u8_url</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">page_code</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;m3u8_url&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># print(m3u8_url)</span>
</span></span><span class="line"><span class="cl">    <span class="n">m3u8</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">m3u8_url</span><span class="p">)</span><span class="o">.</span><span class="n">content</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># print(m3u8)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># 取title</span>
</span></span><span class="line"><span class="cl">    <span class="n">page_bs</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">page_code</span><span class="p">,</span> <span class="s2">&#34;html.parser&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">obj</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;《(?P&lt;title&gt;.*?)》&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">S</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">title</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">page_bs</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># print(title.text)</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1">.m3u8&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">m3u8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1">.m3u8 下载完毕！&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1">.m3u8&#39;</span>
</span></span><span class="line"><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 拿到m3u8后，就可以开始下载视频了 异步</span>
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">dowaload</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">session</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">async</span> <span class="k">with</span> <span class="n">aiofiles</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;video/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">await</span> <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>        <span class="c1"># 异步把下载的视频片段写入文件</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">下载完毕！&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">aio_download</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="n">m3u8</span><span class="o">=</span> <span class="n">get_m3u8</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 在此处创建session比在download里面创建session好，因为只需要创建一次，若是在download中创建session，则每个人物都需要重新创建session</span>
</span></span><span class="line"><span class="cl">    <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">Session</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># async with aiofiles.open(m3u8, mode=&#39;r&#39;, encoding=&#39;utf-8&#39;) as f:</span>
</span></span><span class="line"><span class="cl">        <span class="k">async</span> <span class="k">with</span> <span class="n">aiofiles</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">m3u8</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># 为了异步也可以按顺序排列视频片段，可以使用片段所在的行号进行命名</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># for num, line in enumerate(f, 1):</span>
</span></span><span class="line"><span class="cl">            <span class="k">async</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                    <span class="k">continue</span>
</span></span><span class="line"><span class="cl">                <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="c1"># print(line)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">num</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                    <span class="c1"># print(num)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s1">.mp4&#39;</span>
</span></span><span class="line"><span class="cl">                    <span class="c1"># print(name, line)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">task</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">dowaload</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">Session</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span>       <span class="c1"># 此处不能往前拉，只能写在for循环后</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">下载完毕！！！&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://91kju.com/vod-play-id-61412-sid-1-pid-1.html&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># # get_m3u8(url)</span>
</span></span><span class="line"><span class="cl">    <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">aio_download</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;搞定！&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>但其实这个方案无法按照片段顺序下载，所以可以得到行号以便进行排序，并且！！！行38和41根本不用异步吧？？？效果根本没有差别！！！可以用以下函数进行下载：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">aio_download</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="n">m3u8</span><span class="o">=</span> <span class="n">get_m3u8</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 在此处创建session比在download里面创建session好，因为只需要创建一次，若是在download中创建session，则每个人物都需要重新创建session</span>
</span></span><span class="line"><span class="cl">    <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">Session</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># async with aiofiles.open(m3u8, mode=&#39;r&#39;, encoding=&#39;utf-8&#39;) as f:</span>
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">m3u8</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># 为了异步也可以按顺序排列视频片段，可以使用片段所在的行号进行命名</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                    <span class="k">continue</span>
</span></span><span class="line"><span class="cl">                <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="c1"># print(num, line)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s1">.mp4&#39;</span>
</span></span><span class="line"><span class="cl">                    <span class="c1"># print(name, line)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">task</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">dowaload</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">Session</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span>       <span class="c1"># 此处不能往前拉，只能写在for循环后</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">下载完毕！！！&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="五selenium">五、selenium</h2>
<h3 id="51-概述">5.1 概述</h3>
<p>问题：</p>
<blockquote>
<p>能不能让我的程序连接到浏览器，让浏览器里来完成各种复杂的操作，我们只需要接受最后的结果</p>
</blockquote>
<p>selenium：</p>
<blockquote>
<p>自动化测试工具，可以打开浏览器，然后像人一样去操作浏览器，我们可以从selenium中直接提取网页上的各种信息</p>
</blockquote>
<p>环境搭建：</p>
<blockquote>
<p>conda install selenium</p>
<p>下载浏览器驱动：https://chromedriver.storage.googleapis.com/index.html</p>
<p>​		把解压缩的浏览器驱动 chromedriver 放在python解释器所在的文件夹</p>
<p>让selenium启动谷歌浏览器！！！</p>
</blockquote>
<p>查找浏览器的版本号：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220309212406908.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220309212406908.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220309212406908.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220309212406908.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220309212406908.png"
        title="image-20220309212406908" /></p>
<p>去给的网站里找对应的版本号：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220309212520333.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220309212520333.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220309212520333.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220309212520333.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220309212520333.png"
        title="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220309212520333.png" /></p>
<p>把解压缩的浏览器驱动 chromedriver 放在python解释器所在的文件夹，python解释器的路径如下：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220309212800807.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220309212800807.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220309212800807.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220309212800807.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220309212800807.png"
        title="image-20220309212800807" /></p>
<p>粘贴进去：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220309213028236.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220309213028236.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220309213028236.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220309213028236.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220309213028236.png"
        title="image-20220309213028236" /></p>
<p>让selenium启动浏览器：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">selenium.webdriver</span> <span class="kn">import</span> <span class="n">Chrome</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 1. 创建浏览器对象</span>
</span></span><span class="line"><span class="cl"><span class="n">web</span> <span class="o">=</span> <span class="n">Chrome</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 2. 打开一个网址</span>
</span></span><span class="line"><span class="cl"><span class="n">web</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;https://www.baidu.com&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220309213524995.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220309213524995.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220309213524995.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220309213524995.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220309213524995.png"
        title="image-20220309213524995" /></p>
<p>案例，抓取拉勾网信息：</p>
<p>要注意的是！！！一定要加等待时间，否则有可能发生 未加载完就点击（或者拉取信息）导致失败（或信息不全）！！！</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">web</span><span class="o">.</span><span class="n">implicitly_wait</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>  <span class="c1"># （智能）隐式等待，5秒内加载完就直接执行下一条指令，若超过5秒，报错</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># WebDriverWait(你的chrome()对象, maxWaitTime(s), checkInterval(s))</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 后面的 .until的意思是 直到括号内的lambda表达式成立，例如此处lambda的意思就是：加载出name为&#39;DZ_JSDTCJTW&#39;的element。</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 整行完整意思就是：每过0.2s就检查一下是否加载出名为&#39;DZ_JSDTCJTW&#39;的元素，若加载出，就执行下一行，若还无，最长等待10s。</span>
</span></span><span class="line"><span class="cl"><span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s1">&#39;DZ_JSDTCJTW&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s1">&#39;DZ_JSDTCJTW&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">random_temp</span><span class="p">())</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">selenium.webdriver</span> <span class="kn">import</span> <span class="n">Chrome</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="kn">import</span> <span class="n">Keys</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">web</span> <span class="o">=</span> <span class="n">Chrome</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">web</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;https://lagou.com&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 找到某个元素，点击它</span>
</span></span><span class="line"><span class="cl"><span class="n">el</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s1">&#39;//*[@id=&#34;changeCityBox&#34;]/p[1]/a&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">el</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>   <span class="c1"># 点击事件</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">web</span><span class="o">.</span><span class="n">implicitly_wait</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>  <span class="c1"># （智能）隐式等待，5秒内加载完就直接执行下一条指令，若超过5秒，报错</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 在搜索框中 搜索python</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">el</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s1">&#39;//*[@id=&#34;search_input&#34;]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s2">&#34;python&#34;</span><span class="p">,</span> <span class="n">Keys</span><span class="o">.</span><span class="n">ENTER</span><span class="p">)</span>   <span class="c1"># 找到输入框  输入python并回车</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">web</span><span class="o">.</span><span class="n">implicitly_wait</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>     <span class="c1"># 防止未加载完，导致输出不全   *****很重要！！！</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 找到信息所在位置  elements 是找到所有的</span>
</span></span><span class="line"><span class="cl"><span class="n">job_list</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">find_elements_by_xpath</span><span class="p">(</span><span class="s1">&#39;//*[@id=&#34;jobList&#34;]/div[1]/div&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">job_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># job_name = item.find_element_by_tag_name(&#34;a&#34;).text    # 查找 item中 a标签的值</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># print(job_name)</span>
</span></span><span class="line"><span class="cl">    <span class="n">job_name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s1">&#39;./div/div/div/a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span></span><span class="line"><span class="cl">    <span class="n">job_price</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s1">&#39;./div/div/div[2]/span&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>      <span class="c1"># ./ 相对路径</span>
</span></span><span class="line"><span class="cl">    <span class="n">job_company</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s1">&#39;./div/div[2]/div/a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">job_name</span><span class="p">,</span> <span class="n">job_price</span><span class="p">,</span> <span class="n">job_company</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>获取标签内元素的值：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">detail1</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s1">&#39;//*[@id=&#34;zpid_19506994&#34;]/div[2]/a&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">detail1</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">),</span> <span class="n">detail1</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="52-窗口切换">5.2 窗口切换</h3>
<p>如何进入到新窗口中进行提取</p>
<p>注意：在selenium眼中，新窗口默认是不切换过来的</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">web</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">window</span><span class="p">(</span><span class="n">web</span><span class="o">.</span><span class="n">window_handles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>		<span class="c1"># -1代表最后一个窗口（从右往左） 也可以切换到其他窗口！</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="53-无头浏览器">5.3 无头浏览器</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">selenium.webdriver.chrome.options</span> <span class="kn">import</span> <span class="n">Options</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">opt</span> <span class="o">=</span> <span class="n">Options</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">opt</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&#34;--headless&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">opt</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&#34;--disable-gpu&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">web</span> <span class="o">=</span> <span class="n">Chrome</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">opt</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="54-验证码识别">5.4 验证码识别</h3>
<p>**超级鹰！**或 <strong>ddddocr</strong></p>
<p>哪里用就往哪里搬！</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="mf">1.</span> <span class="n">chaojiying</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 用户中心&gt;&gt;软件ID 生成一个替换 96001</span>
</span></span><span class="line"><span class="cl"><span class="n">chaojiying</span> <span class="o">=</span> <span class="n">Chaojiying_Client</span><span class="p">(</span><span class="s1">&#39;15237174980&#39;</span><span class="p">,</span> <span class="s1">&#39;12345678&#39;</span><span class="p">,</span> <span class="s1">&#39;930009&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 本地图片文件路径 来替换 a.jpg 有时WIN系统须要//</span>
</span></span><span class="line"><span class="cl"><span class="n">im</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;a.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>     <span class="c1"># im就是图片的所有字节</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 1902 验证码类型  官方网站&gt;&gt;价格体系 3.4+版 print 后要加()</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">chaojiying</span><span class="o">.</span><span class="n">PostPic</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="mi">1902</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="mf">2.</span> <span class="n">ddddocr</span>	<span class="n">pip</span> <span class="n">install</span> <span class="n">ddddocr</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">identifyCode</span><span class="p">(</span><span class="n">imgPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">ocr</span> <span class="o">=</span> <span class="n">ddddocr</span><span class="o">.</span><span class="n">DdddOcr</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">img</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">imgPath</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">ocr</span><span class="o">.</span><span class="n">classification</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 上述是读取图片路径的方式，结合selenium也可以</span>
</span></span><span class="line"><span class="cl"><span class="n">img</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s1">&#39;图片的xpath&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">screenshot_as_png</span>
</span></span><span class="line"><span class="cl"><span class="n">ocr</span><span class="o">.</span><span class="n">classification</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="55-防止自动化被屏蔽">5.5 防止自动化被屏蔽</h3>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220311103544489.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220311103544489.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220311103544489.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220311103544489.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220311103544489.png"
        title="image-20220311103544489" /></p>
<p>这样有时会被屏蔽掉！！！</p>
<p>解决方法！其实和无头浏览器很相似！！！</p>
<p>Chrome版本号大于88时：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">selenium.webdriver.chrome.options</span> <span class="kn">import</span> <span class="n">Options</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">opt</span> <span class="o">=</span> <span class="n">Options</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">opt</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--disable-blink-features=AutomationControlled&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">web</span> <span class="o">=</span> <span class="n">Chrome</span><span class="p">(</span><span class="n">option</span><span class="o">=</span><span class="n">opt</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220311104253546.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220311104253546.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220311104253546.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220311104253546.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220311104253546.png"
        title="image-20220311104253546" /></p>
<h2 id="六js逆向">六、Js逆向</h2>
<p>本地运行JS，得到和浏览器一样的加密数据，发送给服务器</p>
<h3 id="61-断点">6.1 断点</h3>
<p>网站代码运行的时间轴：</p>
<p>加载html-&gt;加载js-&gt;运行js初始化-&gt;用户触发某个事件-&gt;调用了某段js-&gt;加密函数-&gt;给服务器发送信息（XHR-&gt;SEND）-&gt; 接受到服务器的数据-&gt; 解密函数-&gt;刷新网页渲染</p>
<p>分类：</p>
<blockquote>
<p>DOM断点：当渲染的时候（样子发生改变的时候），才有用；在加密过程中，其实是比较靠前的执行步骤，距离加密函数比较远，无法根据栈去快速定位，不太推荐用DOM断点</p>
<p>DOM事件断点：和DOM类似，如果不能用DOM下断，则考虑用DOM事件</p>
<p>XHR断点：执行的比较靠后，距离加密函数比较近，可以根据栈快速定位，非XHR发送的就无法断住</p>
<p>代码行断点</p>
<p>代码的断点  debugger</p>
<p>全局事件断点（浏览器事件断点）</p>
<p>异常捕获断点</p>
</blockquote>
<h2 id="七scrapy框架">七、Scrapy框架</h2>
<p>框架就是集成了很多功能并且具有很强通用性的一个项目模板，学习框架封装的各种功能的详细用法。</p>
<p>Scrapy是爬虫中封装好的一个明星框架，功能：高性能的持久化存储，异步数据下载，高性能的数据解析，分布式</p>
<p>基本使用：</p>
<ol>
<li>安装环境：</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">conda</span> <span class="n">install</span> <span class="n">wheel</span>
</span></span><span class="line"><span class="cl"><span class="n">下载twisted</span><span class="err">，</span><span class="n">下载地址为</span><span class="err">：</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">lfd</span><span class="o">.</span><span class="n">uci</span><span class="o">.</span><span class="n">edu</span><span class="o">/~</span><span class="n">gohlke</span><span class="o">/</span><span class="n">pythonlibs</span><span class="o">/</span><span class="c1">#twisted</span>
</span></span><span class="line"><span class="cl"><span class="n">安装twisted</span><span class="err">：</span><span class="n">conda</span> <span class="n">install</span> <span class="n">Twisted</span><span class="o">-...</span>
</span></span><span class="line"><span class="cl"><span class="n">conda</span> <span class="n">install</span> <span class="n">pywin32</span>
</span></span><span class="line"><span class="cl"><span class="n">conda</span> <span class="n">install</span> <span class="n">scrapy</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>python生成exe文件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">Pyinstaller -F setup.py 打包exe
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Pyinstaller -F -w setup.py 不带控制台的打包
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Pyinstaller -F -i xx.ico setup.py 打包指定exe图标打包
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>git bash 使用conda切换环境</strong></p>
<ol>
<li>
<p>将<a href="https://so.csdn.net/so/search?q=anaconda&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreffer ">anaconda</a>的图示的几个路径添加进去</p>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20220511145649670.png" alt="image-20220511145649670" style="zoom:50%;" />
</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">创建环境
</span></span><span class="line"><span class="cl">conda create -n your_env_name <span class="nv">python</span><span class="o">=</span>3.7
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">删除环境
</span></span><span class="line"><span class="cl">conda remove -n your_env_name --all
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">激活自定义的环境
</span></span><span class="line"><span class="cl"><span class="nb">source</span> activate your_env_name
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">退出环境
</span></span><span class="line"><span class="cl"><span class="nb">source</span> deactivate
</span></span><span class="line"><span class="cl">conda deactivate//或者这样
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">列出所有的环境
</span></span><span class="line"><span class="cl">conda env list
</span></span><span class="line"><span class="cl">conda info --envs//或者这样
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">conda安装包和卸载包
</span></span><span class="line"><span class="cl">conda install x //安装x包
</span></span><span class="line"><span class="cl">conda uninstall x //卸载x包
</span></span></code></pre></td></tr></table>
</div>
</div></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2023-07-18</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/%E7%88%AC%E8%99%AB/index.md" target="_blank">Read Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://blog.seucy.me/%E7%88%AC%E8%99%AB/" data-title="爬虫" data-hashtags="计算机基础,爬虫,python"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://blog.seucy.me/%E7%88%AC%E8%99%AB/" data-hashtag="计算机基础"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="https://blog.seucy.me/%E7%88%AC%E8%99%AB/" data-title="爬虫"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="https://blog.seucy.me/%E7%88%AC%E8%99%AB/" data-title="爬虫"><i data-svg-src="/lib/simple-icons/icons/line.min.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="https://blog.seucy.me/%E7%88%AC%E8%99%AB/" data-title="爬虫"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/">计算机基础</a>,&nbsp;<a href="/tags/%E7%88%AC%E8%99%AB/">爬虫</a>,&nbsp;<a href="/tags/python/">python</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav">
            <a href="/go%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/" class="next" rel="next" title="Go浅析-基础操作">Go浅析-基础操作<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
<div id="comments"><div id="valine" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://valine.js.org/">Valine</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
    <div class="footer-container">
        <div class="footer-line">
            <span id="run-time"></span>
        </div><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer"
                title="Hugo 0.115.1">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank"
                rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw"
                    aria-hidden="true"></i> LoveIt</a>
        </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a
                    href="/" target="_blank">Chuyu</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
    </div>
</footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/valine/valine.min.css"><link rel="stylesheet" href="/lib/lightgallery/css/lightgallery-bundle.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script type="text/javascript" src="/lib/valine/Valine.min.js"></script><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lightgallery.min.js"></script><script type="text/javascript" src="/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js"></script><script type="text/javascript" src="/lib/lightgallery/plugins/zoom/lg-zoom.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/cookieconsent/cookieconsent.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{"valine":{"appId":"agUqGfsZRxSQL7fq0tYPH6Zp-MdYXbMMI","appKey":"2e9VDVO0nPzBiJqpzPN6kVPC","avatar":"mp","el":"#valine","emojiCDN":"https://cdn.jsdelivr.net/npm/emoji-datasource-google@14.0.0/img/google/64/","emojiMaps":{"100":"1f4af.png","alien":"1f47d.png","anger":"1f4a2.png","angry":"1f620.png","anguished":"1f627.png","astonished":"1f632.png","black_heart":"1f5a4.png","blue_heart":"1f499.png","blush":"1f60a.png","bomb":"1f4a3.png","boom":"1f4a5.png","broken_heart":"1f494.png","brown_heart":"1f90e.png","clown_face":"1f921.png","cold_face":"1f976.png","cold_sweat":"1f630.png","confounded":"1f616.png","confused":"1f615.png","cry":"1f622.png","crying_cat_face":"1f63f.png","cupid":"1f498.png","dash":"1f4a8.png","disappointed":"1f61e.png","disappointed_relieved":"1f625.png","dizzy":"1f4ab.png","dizzy_face":"1f635.png","drooling_face":"1f924.png","exploding_head":"1f92f.png","expressionless":"1f611.png","face_vomiting":"1f92e.png","face_with_cowboy_hat":"1f920.png","face_with_hand_over_mouth":"1f92d.png","face_with_head_bandage":"1f915.png","face_with_monocle":"1f9d0.png","face_with_raised_eyebrow":"1f928.png","face_with_rolling_eyes":"1f644.png","face_with_symbols_on_mouth":"1f92c.png","face_with_thermometer":"1f912.png","fearful":"1f628.png","flushed":"1f633.png","frowning":"1f626.png","ghost":"1f47b.png","gift_heart":"1f49d.png","green_heart":"1f49a.png","grimacing":"1f62c.png","grin":"1f601.png","grinning":"1f600.png","hankey":"1f4a9.png","hear_no_evil":"1f649.png","heart":"2764-fe0f.png","heart_decoration":"1f49f.png","heart_eyes":"1f60d.png","heart_eyes_cat":"1f63b.png","heartbeat":"1f493.png","heartpulse":"1f497.png","heavy_heart_exclamation_mark_ornament":"2763-fe0f.png","hole":"1f573-fe0f.png","hot_face":"1f975.png","hugging_face":"1f917.png","hushed":"1f62f.png","imp":"1f47f.png","innocent":"1f607.png","japanese_goblin":"1f47a.png","japanese_ogre":"1f479.png","joy":"1f602.png","joy_cat":"1f639.png","kiss":"1f48b.png","kissing":"1f617.png","kissing_cat":"1f63d.png","kissing_closed_eyes":"1f61a.png","kissing_heart":"1f618.png","kissing_smiling_eyes":"1f619.png","laughing":"1f606.png","left_speech_bubble":"1f5e8-fe0f.png","love_letter":"1f48c.png","lying_face":"1f925.png","mask":"1f637.png","money_mouth_face":"1f911.png","nauseated_face":"1f922.png","nerd_face":"1f913.png","neutral_face":"1f610.png","no_mouth":"1f636.png","open_mouth":"1f62e.png","orange_heart":"1f9e1.png","partying_face":"1f973.png","pensive":"1f614.png","persevere":"1f623.png","pleading_face":"1f97a.png","pouting_cat":"1f63e.png","purple_heart":"1f49c.png","rage":"1f621.png","relaxed":"263a-fe0f.png","relieved":"1f60c.png","revolving_hearts":"1f49e.png","right_anger_bubble":"1f5ef-fe0f.png","robot_face":"1f916.png","rolling_on_the_floor_laughing":"1f923.png","scream":"1f631.png","scream_cat":"1f640.png","see_no_evil":"1f648.png","shushing_face":"1f92b.png","skull":"1f480.png","skull_and_crossbones":"2620-fe0f.png","sleeping":"1f634.png","sleepy":"1f62a.png","slightly_frowning_face":"1f641.png","slightly_smiling_face":"1f642.png","smile":"1f604.png","smile_cat":"1f638.png","smiley":"1f603.png","smiley_cat":"1f63a.png","smiling_face_with_3_hearts":"1f970.png","smiling_imp":"1f608.png","smirk":"1f60f.png","smirk_cat":"1f63c.png","sneezing_face":"1f927.png","sob":"1f62d.png","space_invader":"1f47e.png","sparkling_heart":"1f496.png","speak_no_evil":"1f64a.png","speech_balloon":"1f4ac.png","star-struck":"1f929.png","stuck_out_tongue":"1f61b.png","stuck_out_tongue_closed_eyes":"1f61d.png","stuck_out_tongue_winking_eye":"1f61c.png","sunglasses":"1f60e.png","sweat":"1f613.png","sweat_drops":"1f4a6.png","sweat_smile":"1f605.png","thinking_face":"1f914.png","thought_balloon":"1f4ad.png","tired_face":"1f62b.png","triumph":"1f624.png","two_hearts":"1f495.png","unamused":"1f612.png","upside_down_face":"1f643.png","weary":"1f629.png","white_frowning_face":"2639-fe0f.png","white_heart":"1f90d.png","wink":"1f609.png","woozy_face":"1f974.png","worried":"1f61f.png","yawning_face":"1f971.png","yellow_heart":"1f49b.png","yum":"1f60b.png","zany_face":"1f92a.png","zipper_mouth_face":"1f910.png","zzz":"1f4a4.png"},"enableQQ":true,"highlight":true,"lang":"zh-CN","meta":["nick","mail","link"],"pageSize":10,"placeholder":"开始友好的交流吧~","recordIP":true,"serverURLs":"https://mukjinfv.api.lncldglobal.com","visitor":true}},"cookieconsent":{"content":{"dismiss":"Got it!","link":"Learn more","message":"This website uses Cookies to improve your experience."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"lightgallery":true,"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jquery@2.1.3/dist/jquery.min.js"></script><script type="text/javascript" src="/js/custom.js"></script></body>
</html>
