<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title> - Chuyu&#39;s Blog</title><meta name="Description" content="😁"><meta property="og:title" content="" />
<meta property="og:description" content="[toc] 一、简介 1.1 部署方式的演变 传统部署时代：直接将应用程序部署在物理机上，不能为应用程序定义资源使用边界，很难合理地分配计算资源，所以程序之间容" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.seucy.me/15-kubernetes/" /><meta property="og:image" content="https://blog.seucy.me/images/avatar.jpg"/><meta property="article:section" content="posts" />


<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://blog.seucy.me/images/avatar.jpg"/>

<meta name="twitter:title" content=""/>
<meta name="twitter:description" content="[toc] 一、简介 1.1 部署方式的演变 传统部署时代：直接将应用程序部署在物理机上，不能为应用程序定义资源使用边界，很难合理地分配计算资源，所以程序之间容"/>
<meta name="application-name" content="Chuyu&#39;s Blog">
<meta name="apple-mobile-web-app-title" content="Chuyu&#39;s Blog"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/images/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://blog.seucy.me/15-kubernetes/" /><link rel="prev" href="https://blog.seucy.me/16-docker/" /><link rel="next" href="https://blog.seucy.me/14-%E5%BE%AE%E6%9C%8D%E5%8A%A1/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/blog.seucy.me\/15-kubernetes\/"
        },"genre": "posts","wordcount":  6426 ,
        "url": "https:\/\/blog.seucy.me\/15-kubernetes\/","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Chuyu"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Chuyu&#39;s Blog">ᓫ (°⌑°) ǃ</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 笔记 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><a class="menu-item" href="/about/"> 关于 </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Chuyu&#39;s Blog">ᓫ (°⌑°) ǃ</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">笔记</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a class="menu-item" href="/about/" title="">关于</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX"></h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Chuyu</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="0001-01-01">0001-01-01</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;6426 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;13 minutes&nbsp;<span id="/15-kubernetes/" class="leancloud_visitors" data-flag-title="">
                        <i class="far fa-eye fa-fw" aria-hidden="true"></i>&nbsp;<span class=leancloud-visitors-count></span>&nbsp;views
                    </span>&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="true">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#一简介">一、简介</a>
      <ul>
        <li><a href="#11-部署方式的演变">1.1 部署方式的演变</a></li>
      </ul>
    </li>
    <li><a href="#容器化部署的优势">容器化部署的优势：</a>
      <ul>
        <li>
          <ul>
            <li>
              <ul>
                <li><a href="#容器化部署带来的问题">容器化部署带来的问题：</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#12-为什么使用-kubernetes-k8s">1.2 为什么使用 Kubernetes (k8s)</a></li>
        <li><a href="#13-k8s-的组件">1.3 k8s 的组件</a></li>
      </ul>
    </li>
    <li><a href="#如何让-k8s-部署一个-nginx-服务">如何让 k8s 部署一个 nginx 服务？</a>
      <ul>
        <li><a href="#14-k8s-概念">1.4 k8s 概念</a></li>
      </ul>
    </li>
    <li><a href="#二集群环境搭建">二、集群环境搭建</a>
      <ul>
        <li><a href="#21-集群分类">2.1 集群分类</a></li>
        <li><a href="#22-安装">2.2 安装</a>
          <ul>
            <li><a href="#221-安装方式">2.2.1 安装方式</a></li>
            <li><a href="#222-准备环境">2.2.2 准备环境</a></li>
            <li><a href="#223-环境初始化">2.2.3 环境初始化</a>
              <ul>
                <li><a href="#2231-检查操作系统的版本">2.2.3.1 检查操作系统的版本</a></li>
                <li><a href="#2232-主机名解析">2.2.3.2 主机名解析</a></li>
                <li><a href="#2233-时间同步">2.2.3.3 时间同步</a></li>
                <li><a href="#2234-禁用iptable和firewalld服务">2.2.3.4 禁用iptable和firewalld服务</a></li>
                <li><a href="#2235-禁用selinux">2.2.3.5 禁用selinux</a></li>
                <li><a href="#2236-禁用swap分区">2.2.3.6 禁用swap分区</a></li>
                <li><a href="#2237-修改linux的内核参数">2.2.3.7 修改linux的内核参数</a></li>
                <li><a href="#2238-配置ipvs功能">2.2.3.8 配置ipvs功能</a></li>
                <li><a href="#2239-安装docker">2.2.3.9 安装docker</a></li>
                <li><a href="#22310-安装kubernetes组件">2.2.3.10 安装Kubernetes组件</a></li>
                <li><a href="#22311-准备集群镜像">2.2.3.11 准备集群镜像</a></li>
                <li><a href="#22311-集群初始化">2.2.3.11 集群初始化</a></li>
                <li><a href="#22313-安装网络插件只在master节点操作即可">2.2.3.13 安装网络插件，只在master节点操作即可</a></li>
                <li><a href="#22314-使用kubeadm-reset重置集群">2.2.3.14 使用kubeadm reset重置集群</a></li>
                <li><a href="#22315-重启kubelet和docker">2.2.3.15 重启kubelet和docker</a></li>
                <li><a href="#22316-kubeadm中的命令">2.2.3.16 kubeadm中的命令</a></li>
              </ul>
            </li>
            <li><a href="#224-集群测试">2.2.4 集群测试</a>
              <ul>
                <li><a href="#2241-创建一个nginx服务">2.2.4.1 创建一个nginx服务</a></li>
                <li><a href="#2242-暴露端口">2.2.4.2 暴露端口</a></li>
                <li><a href="#2243-查看服务">2.2.4.3 查看服务</a></li>
                <li><a href="#2244-查看pod">2.2.4.4 查看pod</a></li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#三资源管理">三、资源管理</a>
      <ul>
        <li><a href="#31-简介">3.1 简介</a>
          <ul>
            <li>
              <ul>
                <li><a href="#学习kubernetes的核心就是学习如何对集群上的podpod控制器service存储等各种资源进行操作">学习kubernetes的核心，就是学习如何对集群上的<code>Pod、Pod控制器、Service、存储</code>等各种资源进行操作。</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#32-yaml">3.2 YAML</a></li>
        <li><a href="#小提示">小提示：</a></li>
        <li><a href="#33-资源管理方式">3.3 资源管理方式</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>[toc]</p>
<h2 id="一简介">一、简介</h2>
<h3 id="11-部署方式的演变">1.1 部署方式的演变</h3>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20230416193626038.png" alt="image-20230416193626038" style="zoom:33%;" />
<ul>
<li><strong>传统部署时代</strong>：直接将应用程序部署在物理机上，不能为应用程序定义资源使用边界，很难合理地分配计算资源，所以<strong>程序之间容易产生影响</strong>；</li>
<li><strong>虚拟化部署时代</strong>：可以在一台物理机上运行多个虚拟机(比如 VM)，每个虚拟机都是独立的一个环境。缺点是<strong>增加了操作系统</strong>，浪费了部分资源；</li>
<li><strong>容器化部署时代</strong>：类似于虚拟化，被认为是<strong>轻量级</strong>的，具有自己的文件系统、CPU 、内存、进程空间等，运行应用程序所需要的资源都被容器包装，<strong>部署方便</strong>。</li>
</ul>
<blockquote>
<h2 id="容器化部署的优势">容器化部署的优势：</h2>
<ul>
<li>
<p><code>敏捷性</code>：敏捷应用程序的创建和部署。和使用 VM 镜像相比，提高了容器镜像创建的简便性和效率；</p>
</li>
<li>
<p><code>解耦性</code>：关注开发和运维的分离。在构建、发布时创建应用程序的容器镜像，而不是在部署的时候，从而将应用程序和基础架构分离；</p>
</li>
<li>
<p><code>跨平台</code>：跨开发、测试和生产的环境一致性。在便捷式的计算机上和在云上相同的运行；</p>
</li>
<li>
<p><code>大分布式</code>：松散耦合、分布式、弹性、解放的微服务。应用程序被分解成较小的独立部分，并且可以动态的部署和管理。</p>
</li>
</ul>
</blockquote>
<blockquote>
<h5 id="容器化部署带来的问题">容器化部署带来的问题：</h5>
<ul>
<li>故障转移：一个容器故障停机了，怎么样让另外一个容器立刻启动去替补停机的容器；</li>
<li>负载均衡：当并发访问量变大的时候，怎么样做到横向扩展容器数量。</li>
</ul>
</blockquote>
<p>这些问题统称为<strong>容器编排</strong>问题，Kubernetes 是最主流的容器编排软件。</p>
<h3 id="12-为什么使用-kubernetes-k8s">1.2 为什么使用 Kubernetes (k8s)</h3>
<p>Kubernetes 的本质是<strong>一组服务器集群</strong>，它可以在集群的每个节点上运行特定的程序，来对节点中的容器进行管理。目的是实现资源管理的自动化，主要提供了如下的主要功能：</p>
<ul>
<li><strong>自我修复</strong>：一旦某一个容器崩溃，能够在1秒中左右迅速启动新的容器；</li>
<li><strong>弹性伸缩</strong>：可以根据需要，自动对集群中正在运行的容器数量进行调整；</li>
<li><strong>服务发现</strong>：服务可以通过自动发现的形式找到它所依赖的服务；</li>
<li><strong>负载均衡</strong>：如果一个服务启动了多个容器，能够自动实现请求的负载均衡；</li>
<li><strong>版本回退</strong>：如果发现新发布的程序版本有问题，可以立即回退到原来的版本；</li>
<li><strong>存储编排</strong>：可以根据容器自身的需求自动创建存储卷。</li>
</ul>
<h3 id="13-k8s-的组件">1.3 k8s 的组件</h3>
<p>一个 k8s 集群主要是由<strong>控制节点(master)</strong>、**工作节点(node)**构成，每个节点上都会安装不同的组件：</p>
<p><strong>master：集群的控制平面，负责集群的决策 ( 管理 )</strong></p>
<ul>
<li><strong>ApiServer</strong>: 资源操作的唯一入口，接收用户输入的命令，提供认证、授权、API注册和发现等机制；</li>
<li><strong>Scheduler</strong>: 负责集群资源调度，按照预定的调度策略将Pod调度到相应的node节点上；</li>
<li><strong>ControllerManager</strong>: 负责维护集群的状态，比如程序部署安排、故障检测、自动扩展、滚动更新等；</li>
<li><strong>Etcd</strong>：负责存储集群中各种资源对象的信息。</li>
</ul>
<p><strong>node：集群的数据平面，负责为容器提供运行环境 ( 干活 )</strong></p>
<ul>
<li><strong>Kubelet</strong>: 负责维护容器的生命周期，即通过控制docker，来创建、更新、销毁容器；</li>
<li><strong>KubeProxy</strong>: 负责提供集群内部的服务发现和负载均衡；</li>
<li><strong>Docker</strong>: 负责节点上容器的各种操作。</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20200406184656917.png" alt="img" style="zoom:50%;" />
<blockquote>
<h2 id="如何让-k8s-部署一个-nginx-服务">如何让 k8s 部署一个 nginx 服务？</h2>
<ol>
<li>
<p>kubernetes环境启动之后，master和node都会将自身的信息存储到etcd数据库中；</p>
</li>
<li>
<p>一个nginx服务的安装请求会首先被发送到master节点的apiServer组件；</p>
</li>
<li>
<p>apiServer组件会调用scheduler组件来决定到底应该把这个服务安装到哪个node节点上；</p>
<p>在此时，它会从etcd中读取各个node节点的信息，然后按照一定的算法进行选择，并将结果告知apiServer；</p>
</li>
<li>
<p>apiServer调用controller-manager去调度Node节点安装nginx服务；</p>
</li>
<li>
<p>kubelet接收到指令后，会通知docker，然后由docker来启动一个nginx的pod；</p>
<p>pod是kubernetes的最小操作单元，容器必须跑在pod中；</p>
</li>
<li>
<p>至此，一个nginx服务就运行了，如果需要访问nginx，就需要通过kube-proxy来对pod产生访问的代理；</p>
</li>
<li>
<p>外界用户就可以访问集群中的nginx服务了。</p>
</li>
</ol>
</blockquote>
<h3 id="14-k8s-概念">1.4 k8s 概念</h3>
<ul>
<li>
<p><strong>Master</strong>：集群控制节点，每个集群需要至少一个master节点负责集群的管控；</p>
</li>
<li>
<p><strong>Node</strong>：工作负载节点，由master分配容器到这些node工作节点上，然后node节点上的docker负责容器的运行；</p>
</li>
<li>
<p><strong>Pod</strong>：kubernetes的最小控制单元，容器都是运行在pod中的，一个pod中可以有1个或者多个容器；</p>
</li>
<li>
<p><strong>Controller</strong>：控制器，通过它来实现对pod的管理，比如启动pod、停止pod、伸缩pod的数量等等；</p>
</li>
<li>
<p><strong>Service</strong>：pod对外服务的统一入口，下面可以维护者同一类的多个pod；</p>
</li>
<li>
<p><strong>Label</strong>：标签，用于对pod进行分类，同一类pod会拥有相同的标签；</p>
</li>
<li>
<p><strong>NameSpace</strong>：命名空间，用来隔离pod的运行环境。</p>
</li>
</ul>
<h2 id="二集群环境搭建">二、集群环境搭建</h2>
<h3 id="21-集群分类">2.1 集群分类</h3>
<p>Kubernetes 集群大致分为两类：</p>
<ul>
<li>
<ul>
<li><strong>一主多从</strong>：一个 Master 节点和多台 Node 节点，搭建简单，但是有单机故障风险，适合用于测试环境。</li>
</ul>
</li>
<li>
<ul>
<li><strong>多主多从</strong>(高可用)：多台 Master 节点和多台 Node 节点，搭建麻烦，安全性高，适合用于生产环境。</li>
</ul>
</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20200404094800622.png" alt="image-20200404094800622" style="zoom:50%;" />
<h3 id="22-安装">2.2 安装</h3>
<h4 id="221-安装方式">2.2.1 安装方式</h4>
<p>目前生产部署Kubernetes 集群主要有两种方式：</p>
<ul>
<li><strong>Kubeadm</strong>：Kubeadm 是一个K8s 部署工具，提供kubeadm init 和 kubeadm join，用于快速部署Kubernetes 集群。</li>
</ul>
<p>​	官方地址：<a href="https://gitee.com/link?target=https%3A%2F%2Fkubernetes.io%2Fdocs%2Freference%2Fsetup-tools%2Fkubeadm%2Fkubeadm%2F" target="_blank" rel="noopener noreffer ">https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm/</a></p>
<ul>
<li><strong>二进制包</strong>：从github 下载发行版的二进制包，手动部署每个组件，组成 Kubernetes 集群。</li>
</ul>
<p>方便起见，还是用 Kubeadm 吧hhh，以后再说用二进制包的方式。</p>
<h4 id="222-准备环境">2.2.2 准备环境</h4>
<p>在开始之前，部署 Kubernetes 集群机器需要满足以下几个条件：</p>
<ul>
<li>一台或多台机器，操作系统 CentOS7.x-86_x64</li>
<li>硬件配置：2GB 或更多RAM，2 个CPU 或更多CPU，硬盘30GB 或更多</li>
<li>集群中所有机器之间网络互通</li>
<li>可以访问外网，需要拉取镜像</li>
<li>禁止swap 分区</li>
</ul>
<p><strong>准备 3 个 CentOS7.x-86_x64 虚拟机</strong>：</p>
<ul>
<li>在所有节点上安装Docker 和kubeadm</li>
<li>部署Kubernetes Master</li>
<li>部署容器网络插件</li>
<li>部署Kubernetes Node，将节点加入Kubernetes 集群中</li>
<li>部署Dashboard Web 页面，可视化查看Kubernetes 资源</li>
</ul>
<table>
<thead>
<tr>
<th>角色</th>
<th>IP地址</th>
<th>组件</th>
</tr>
</thead>
<tbody>
<tr>
<td>master01</td>
<td>192.168.5.3</td>
<td>docker，kubectl，kubeadm，kubelet</td>
</tr>
<tr>
<td>node01</td>
<td>192.168.5.4</td>
<td>docker，kubectl，kubeadm，kubelet</td>
</tr>
<tr>
<td>node02</td>
<td>192.168.5.5</td>
<td>docker，kubectl，kubeadm，kubelet</td>
</tr>
</tbody>
</table>
<h4 id="223-环境初始化">2.2.3 环境初始化</h4>
<h5 id="2231-检查操作系统的版本">2.2.3.1 检查操作系统的版本</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 此方式下安装kubernetes集群要求Centos版本要在7.5或之上
</span></span><span class="line"><span class="cl">[root@master ~]# cat /etc/redhat-release
</span></span><span class="line"><span class="cl">Centos Linux 7.5.1804 (Core)
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="2232-主机名解析">2.2.3.2 主机名解析</h5>
<p>为了方便集群节点间的直接调用，在这个配置一下主机名解析，企业中推荐使用内部DNS服务器</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 主机名成解析 编辑三台服务器的/etc/hosts文件，添加下面内容
</span></span><span class="line"><span class="cl">192.168.90.100 master
</span></span><span class="line"><span class="cl">192.168.90.106 node1
</span></span><span class="line"><span class="cl">192.168.90.107 node2
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="2233-时间同步">2.2.3.3 时间同步</h5>
<p>kubernetes要求集群中的节点时间必须精确一直，这里使用chronyd服务从网络同步时间</p>
<p>企业中建议配置内部的会见同步服务器</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 启动chronyd服务
</span></span><span class="line"><span class="cl">[root@master ~]# systemctl start chronyd
</span></span><span class="line"><span class="cl">[root@master ~]# systemctl enable chronyd
</span></span><span class="line"><span class="cl">[root@master ~]# date
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="2234-禁用iptable和firewalld服务">2.2.3.4 禁用iptable和firewalld服务</h5>
<p>kubernetes和docker 在运行的中会产生大量的iptables规则，为了不让系统规则跟它们混淆，直接关闭系统的规则</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 1 关闭firewalld服务
</span></span><span class="line"><span class="cl">[root@master ~]# systemctl stop firewalld
</span></span><span class="line"><span class="cl">[root@master ~]# systemctl disable firewalld
</span></span><span class="line"><span class="cl"># 2 关闭iptables服务
</span></span><span class="line"><span class="cl">[root@master ~]# systemctl stop iptables
</span></span><span class="line"><span class="cl">[root@master ~]# systemctl disable iptables
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="2235-禁用selinux">2.2.3.5 禁用selinux</h5>
<p>selinux是linux系统下的一个安全服务，如果不关闭它，在安装集群中会产生各种各样的奇葩问题</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 编辑 /etc/selinux/config 文件，修改SELINUX的值为disable
</span></span><span class="line"><span class="cl"># 注意修改完毕之后需要重启linux服务
</span></span><span class="line"><span class="cl">SELINUX=disabled
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="2236-禁用swap分区">2.2.3.6 禁用swap分区</h5>
<p>swap分区指的是虚拟内存分区，它的作用是物理内存使用完，之后将磁盘空间虚拟成内存来使用，启用swap设备会对系统的性能产生非常负面的影响，因此kubernetes要求每个节点都要禁用swap设备，但是如果因为某些原因确实不能关闭swap分区，就需要在集群安装过程中通过明确的参数进行配置说明</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 编辑分区配置文件/etc/fstab，注释掉swap分区一行
</span></span><span class="line"><span class="cl"># 注意修改完毕之后需要重启linux服务
</span></span><span class="line"><span class="cl">vim /etc/fstab
</span></span><span class="line"><span class="cl">注释掉 /dev/mapper/centos-swap swap
</span></span><span class="line"><span class="cl"># /dev/mapper/centos-swap swap
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="2237-修改linux的内核参数">2.2.3.7 修改linux的内核参数</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 修改linux的内核采纳数，添加网桥过滤和地址转发功能
</span></span><span class="line"><span class="cl"># 编辑/etc/sysctl.d/kubernetes.conf文件，添加如下配置：
</span></span><span class="line"><span class="cl">net.bridge.bridge-nf-call-ip6tables = 1
</span></span><span class="line"><span class="cl">net.bridge.bridge-nf-call-iptables = 1
</span></span><span class="line"><span class="cl">net.ipv4.ip_forward = 1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 重新加载配置
</span></span><span class="line"><span class="cl">[root@master ~]# sysctl -p
</span></span><span class="line"><span class="cl"># 加载网桥过滤模块
</span></span><span class="line"><span class="cl">[root@master ~]# modprobe br_netfilter
</span></span><span class="line"><span class="cl"># 查看网桥过滤模块是否加载成功
</span></span><span class="line"><span class="cl">[root@master ~]# lsmod | grep br_netfilter
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="2238-配置ipvs功能">2.2.3.8 配置ipvs功能</h5>
<p>在Kubernetes中Service有两种带来模型，一种是基于iptables的，一种是基于ipvs的两者比较的话，ipvs的性能明显要高一些，但是如果要使用它，需要手动载入ipvs模块</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 1.安装ipset和ipvsadm</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master ~<span class="o">]</span><span class="c1"># yum install ipset ipvsadm -y</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 2.添加需要加载的模块写入脚本文件</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master ~<span class="o">]</span><span class="c1"># cat &lt;&lt;EOF&gt; /etc/sysconfig/modules/ipvs.modules</span>
</span></span><span class="line"><span class="cl"><span class="c1">#!/bin/bash</span>
</span></span><span class="line"><span class="cl">modprobe -- ip_vs
</span></span><span class="line"><span class="cl">modprobe -- ip_vs_rr
</span></span><span class="line"><span class="cl">modprobe -- ip_vs_wrr
</span></span><span class="line"><span class="cl">modprobe -- ip_vs_sh
</span></span><span class="line"><span class="cl">modprobe -- nf_conntrack_ipv4
</span></span><span class="line"><span class="cl">EOF
</span></span><span class="line"><span class="cl"><span class="c1"># 3.为脚本添加执行权限</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master ~<span class="o">]</span><span class="c1"># chmod +x /etc/sysconfig/modules/ipvs.modules</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 4.执行脚本文件</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master ~<span class="o">]</span><span class="c1"># /bin/bash /etc/sysconfig/modules/ipvs.modules</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 5.查看对应的模块是否加载成功</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master ~<span class="o">]</span><span class="c1"># lsmod | grep -e ip_vs -e nf_conntrack_ipv4</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="2239-安装docker">2.2.3.9 安装docker</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 1、切换镜像源
</span></span><span class="line"><span class="cl">[root@master ~]# wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo -O /etc/yum.repos.d/docker-ce.repo
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 2、查看当前镜像源中支持的docker版本
</span></span><span class="line"><span class="cl">[root@master ~]# yum list docker-ce --showduplicates
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 3、安装特定版本的docker-ce
</span></span><span class="line"><span class="cl"># 必须制定--setopt=obsoletes=0，否则yum会自动安装更高版本
</span></span><span class="line"><span class="cl">[root@master ~]# yum install --setopt=obsoletes=0 docker-ce-18.06.3.ce-3.el7 -y
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 4、添加一个配置文件
</span></span><span class="line"><span class="cl">#Docker 在默认情况下使用Vgroup Driver为cgroupfs，而Kubernetes推荐使用systemd来替代cgroupfs
</span></span><span class="line"><span class="cl">[root@master ~]# mkdir /etc/docker
</span></span><span class="line"><span class="cl">[root@master ~]# cat &lt;&lt;EOF&gt; /etc/docker/daemon.json
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	&#34;exec-opts&#34;: [&#34;native.cgroupdriver=systemd&#34;],
</span></span><span class="line"><span class="cl">	&#34;registry-mirrors&#34;: [&#34;https://kn0t2bca.mirror.aliyuncs.com&#34;]
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">EOF
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 5、启动dokcer
</span></span><span class="line"><span class="cl">[root@master ~]# systemctl restart docker
</span></span><span class="line"><span class="cl">[root@master ~]# systemctl enable docker
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="22310-安装kubernetes组件">2.2.3.10 安装Kubernetes组件</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 1、由于kubernetes的镜像在国外，速度比较慢，这里切换成国内的镜像源
</span></span><span class="line"><span class="cl"># 2、编辑/etc/yum.repos.d/kubernetes.repo,添加下面的配置
</span></span><span class="line"><span class="cl">[kubernetes]
</span></span><span class="line"><span class="cl">name=Kubernetes
</span></span><span class="line"><span class="cl">baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64
</span></span><span class="line"><span class="cl">enabled=1
</span></span><span class="line"><span class="cl">gpgchech=0
</span></span><span class="line"><span class="cl">repo_gpgcheck=0
</span></span><span class="line"><span class="cl">gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg
</span></span><span class="line"><span class="cl">			http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 3、安装kubeadm、kubelet和kubectl
</span></span><span class="line"><span class="cl">[root@master ~]# yum install --setopt=obsoletes=0 kubeadm-1.17.4-0 kubelet-1.17.4-0 kubectl-1.17.4-0 -y
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 4、配置kubelet的cgroup
</span></span><span class="line"><span class="cl">#编辑/etc/sysconfig/kubelet, 添加下面的配置
</span></span><span class="line"><span class="cl">KUBELET_CGROUP_ARGS=&#34;--cgroup-driver=systemd&#34;
</span></span><span class="line"><span class="cl">KUBE_PROXY_MODE=&#34;ipvs&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 5、设置kubelet开机自启
</span></span><span class="line"><span class="cl">[root@master ~]# systemctl enable kubelet
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="22311-准备集群镜像">2.2.3.11 准备集群镜像</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 在安装kubernetes集群之前，必须要提前准备好集群需要的镜像，所需镜像可以通过下面命令查看
</span></span><span class="line"><span class="cl">[root@master ~]# kubeadm config images list
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 下载镜像
</span></span><span class="line"><span class="cl"># 此镜像kubernetes的仓库中，由于网络原因，无法连接，下面提供了一种替换方案
</span></span><span class="line"><span class="cl">images=(
</span></span><span class="line"><span class="cl">	kube-apiserver:v1.17.4
</span></span><span class="line"><span class="cl">	kube-controller-manager:v1.17.4
</span></span><span class="line"><span class="cl">	kube-scheduler:v1.17.4
</span></span><span class="line"><span class="cl">	kube-proxy:v1.17.4
</span></span><span class="line"><span class="cl">	pause:3.1
</span></span><span class="line"><span class="cl">	etcd:3.4.3-0
</span></span><span class="line"><span class="cl">	coredns:1.6.5
</span></span><span class="line"><span class="cl">)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">for imageName in ${images[@]};do
</span></span><span class="line"><span class="cl">	docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/$imageName
</span></span><span class="line"><span class="cl">	docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/$imageName k8s.gcr.io/$imageName
</span></span><span class="line"><span class="cl">	docker rmi registry.cn-hangzhou.aliyuncs.com/google_containers/$imageName 
</span></span><span class="line"><span class="cl">done
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="22311-集群初始化">2.2.3.11 集群初始化</h5>
<blockquote>
<p>下面的操作只需要在master节点上执行即可</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 创建集群
</span></span><span class="line"><span class="cl">[root@master ~]# kubeadm init \
</span></span><span class="line"><span class="cl">	--apiserver-advertise-address=192.168.90.100 \
</span></span><span class="line"><span class="cl">	--image-repository registry.aliyuncs.com/google_containers \
</span></span><span class="line"><span class="cl">	--kubernetes-version=v1.17.4 \
</span></span><span class="line"><span class="cl">	--service-cidr=10.96.0.0/12 \
</span></span><span class="line"><span class="cl">	--pod-network-cidr=10.244.0.0/16
</span></span><span class="line"><span class="cl"># 创建必要文件
</span></span><span class="line"><span class="cl">[root@master ~]# mkdir -p $HOME/.kube
</span></span><span class="line"><span class="cl">[root@master ~]# sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
</span></span><span class="line"><span class="cl">[root@master ~]# sudo chown $(id -u):$(id -g) $HOME/.kube/config
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>下面的操作只需要在node节点上执行即可</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kubeadm join 192.168.0.100:6443 --token awk15p.t6bamck54w69u4s8 \
</span></span><span class="line"><span class="cl">    --discovery-token-ca-cert-hash sha256:a94fa09562466d32d29523ab6cff122186f1127599fa4dcd5fa0152694f17117 
</span></span></code></pre></td></tr></table>
</div>
</div><p>在master上查看节点信息</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@master ~]# kubectl get nodes
</span></span><span class="line"><span class="cl">NAME    STATUS   ROLES     AGE   VERSION
</span></span><span class="line"><span class="cl">master  NotReady  master   6m    v1.17.4
</span></span><span class="line"><span class="cl">node1   NotReady   &lt;none&gt;  22s   v1.17.4
</span></span><span class="line"><span class="cl">node2   NotReady   &lt;none&gt;  19s   v1.17.4
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="22313-安装网络插件只在master节点操作即可">2.2.3.13 安装网络插件，只在master节点操作即可</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">wget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml
</span></span></code></pre></td></tr></table>
</div>
</div><p>由于外网不好访问，如果出现无法访问的情况，可以直接用下面的 记得文件名是kube-flannel.yml，位置：/root/kube-flannel.yml内容：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">https://github.com/flannel-io/flannel/tree/master/Documentation/kube-flannel.yml
</span></span></code></pre></td></tr></table>
</div>
</div><p>也可手动拉取指定版本 docker pull quay.io/coreos/flannel:v0.14.0 #拉取flannel网络，三台主机 docker images #查看仓库是否拉去下来</p>
<p><code>个人笔记</code> 若是集群状态一直是 notready,用下面语句查看原因， journalctl -f -u kubelet.service 若原因是： cni.go:237] Unable to update cni config: no networks found in /etc/cni/net.d mkdir -p /etc/cni/net.d #创建目录给flannel做配置文件 vim /etc/cni/net.d/10-flannel.conf #编写配置文件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl"> &#34;name&#34;:&#34;cbr0&#34;,
</span></span><span class="line"><span class="cl"> &#34;cniVersion&#34;:&#34;0.3.1&#34;,
</span></span><span class="line"><span class="cl"> &#34;type&#34;:&#34;flannel&#34;,
</span></span><span class="line"><span class="cl"> &#34;deledate&#34;:{
</span></span><span class="line"><span class="cl">    &#34;hairpinMode&#34;:true,
</span></span><span class="line"><span class="cl">    &#34;isDefaultGateway&#34;:true
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="22314-使用kubeadm-reset重置集群">2.2.3.14 使用kubeadm reset重置集群</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">#在master节点之外的节点进行操作
</span></span><span class="line"><span class="cl">kubeadm reset
</span></span><span class="line"><span class="cl">systemctl stop kubelet
</span></span><span class="line"><span class="cl">systemctl stop docker
</span></span><span class="line"><span class="cl">rm -rf /var/lib/cni/
</span></span><span class="line"><span class="cl">rm -rf /var/lib/kubelet/*
</span></span><span class="line"><span class="cl">rm -rf /etc/cni/
</span></span><span class="line"><span class="cl">ifconfig cni0 down
</span></span><span class="line"><span class="cl">ifconfig flannel.1 down
</span></span><span class="line"><span class="cl">ifconfig docker0 down
</span></span><span class="line"><span class="cl">ip link delete cni0
</span></span><span class="line"><span class="cl">ip link delete flannel.1
</span></span><span class="line"><span class="cl">##重启kubelet
</span></span><span class="line"><span class="cl">systemctl restart kubelet
</span></span><span class="line"><span class="cl">##重启docker
</span></span><span class="line"><span class="cl">systemctl restart docker
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="22315-重启kubelet和docker">2.2.3.15 重启kubelet和docker</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 重启kubelet
</span></span><span class="line"><span class="cl">systemctl restart kubelet
</span></span><span class="line"><span class="cl"># 重启docker
</span></span><span class="line"><span class="cl">systemctl restart docker
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用配置文件启动fannel</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kubectl apply -f kube-flannel.yml
</span></span></code></pre></td></tr></table>
</div>
</div><p>等待它安装完毕 发现已经是 集群的状态已经是Ready</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/2232696-20210621233106024-1676033717.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/2232696-20210621233106024-1676033717.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/2232696-20210621233106024-1676033717.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/2232696-20210621233106024-1676033717.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/2232696-20210621233106024-1676033717.png"
        title="img" /></p>
<h5 id="22316-kubeadm中的命令">2.2.3.16 kubeadm中的命令</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 生成 新的token
</span></span><span class="line"><span class="cl">[root@master ~]# kubeadm token create --print-join-command
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="224-集群测试">2.2.4 集群测试</h4>
<h5 id="2241-创建一个nginx服务">2.2.4.1 创建一个nginx服务</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kubectl create deployment nginx  --image=nginx:1.14-alpine
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="2242-暴露端口">2.2.4.2 暴露端口</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kubectl expose deploy nginx  --port=80 --target-port=80  --type=NodePort
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="2243-查看服务">2.2.4.3 查看服务</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kubectl get pod,svc
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="2244-查看pod">2.2.4.4 查看pod</h5>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/2232696-20210621233130477-111035427.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/2232696-20210621233130477-111035427.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/2232696-20210621233130477-111035427.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/2232696-20210621233130477-111035427.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/2232696-20210621233130477-111035427.png"
        title="img" /></p>
<p>浏览器测试结果：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/2232696-20210621233157075-1117518703.png"
        data-srcset="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/2232696-20210621233157075-1117518703.png, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/2232696-20210621233157075-1117518703.png 1.5x, https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/2232696-20210621233157075-1117518703.png 2x"
        data-sizes="auto"
        alt="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/2232696-20210621233157075-1117518703.png"
        title="img" /></p>
<h2 id="三资源管理">三、资源管理</h2>
<h3 id="31-简介">3.1 简介</h3>
<p>在kubernetes中，所有的内容都抽象为资源，用户需要通过操作资源来管理kubernetes。</p>
<ul>
<li>
<p>kubernetes的本质上就是一个集群系统，用户可以在集群中部署各种服务，所谓的部署服务，其实就是在kubernetes集群中运行一个个的**<code>容器</code>**，并将指定的程序跑在容器中。</p>
</li>
<li>
<p>kubernetes的<strong>最小管理单元是pod</strong>而不是容器，所以只能将容器放在<code>Pod</code>中，而kubernetes一般也不会直接管理Pod，而是通过<code>Pod控制器</code>来管理Pod的。</p>
</li>
<li>
<p>Pod可以提供服务之后，就要考虑如何访问Pod中服务。kubernetes提供了**<code>Service</code>**实现这个功能。</p>
</li>
<li>
<p>当然，如果Pod中程序的数据需要持久化，kubernetes还提供了各种**<code>存储</code>**系统。</p>
</li>
</ul>
<img src="https://chuyu-typora.oss-cn-hangzhou.aliyuncs.com/image/image-20200406225334627.png" alt="image-20200406225334627" style="zoom:50%;" />
<blockquote>
<h5 id="学习kubernetes的核心就是学习如何对集群上的podpod控制器service存储等各种资源进行操作">学习kubernetes的核心，就是学习如何对集群上的<code>Pod、Pod控制器、Service、存储</code>等各种资源进行操作。</h5>
</blockquote>
<h3 id="32-yaml">3.2 YAML</h3>
<p><strong>YAML 常用来作为配置文件</strong>。</p>
<p>YAML的语法比较简单，主要有下面几个：</p>
<ul>
<li>大小写敏感</li>
<li>使用缩进表示层级关系</li>
<li>缩进不允许使用tab，只允许空格( 低版本限制 )</li>
<li>缩进的空格数不重要，只要相同层级的元素左对齐即可</li>
<li>&lsquo;#&lsquo;表示注释</li>
</ul>
<p>YAML支持以下几种数据类型：</p>
<ul>
<li><strong>纯量：单个的、不可再分的值</strong></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># 纯量, 就是指的一个简单的值，字符串、布尔值、整数、浮点数、Null、时间、日期</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># 1 布尔类型</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">c1</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="l">(或者True)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># 2 整型</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">c2</span><span class="p">:</span><span class="w"> </span><span class="m">234</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># 3 浮点型</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">c3</span><span class="p">:</span><span class="w"> </span><span class="m">3.14</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># 4 null类型 </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">c4</span><span class="p">:</span><span class="w"> </span><span class="l">~ </span><span class="w"> </span><span class="c"># 使用~表示null</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># 5 日期类型</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">c5</span><span class="p">:</span><span class="w"> </span><span class="ld">2018-02-17</span><span class="w">    </span><span class="c"># 日期必须使用ISO 8601格式，即yyyy-MM-dd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># 6 时间类型</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">c6</span><span class="p">:</span><span class="w"> </span><span class="ld">2018-02-17T15:02:31</span><span class="m">+08</span><span class="p">:</span><span class="m">00</span><span class="w">  </span><span class="c"># 时间使用ISO 8601格式，时间和日期之间使用T连接，最后使用+代表时区</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># 7 字符串类型</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">c7</span><span class="p">:</span><span class="w"> </span><span class="l">heima    </span><span class="w"> </span><span class="c"># 简单写法，直接写值 , 如果字符串中间有特殊字符，必须使用双引号或者单引号包裹 </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">c8</span><span class="p">:</span><span class="w"> </span><span class="l">line1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="l">line2    </span><span class="w"> </span><span class="c"># 字符串过多的情况可以拆成多行，每一行会被转化成一个空格</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>对象：键值对的集合</strong></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># 对象</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># 形式一(推荐):</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">heima</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">age</span><span class="p">:</span><span class="w"> </span><span class="m">15</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l">Beijing</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># 形式二(了解):</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">heima</span><span class="p">:</span><span class="w"> </span>{<span class="nt">age: 15,address</span><span class="p">:</span><span class="w"> </span><span class="l">Beijing}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>数组：列表(list)</strong></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># 数组</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># 形式一(推荐):</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">address</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">顺义</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">昌平  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># 形式二(了解):</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="l">顺义,昌平]</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<h3 id="小提示">小提示：</h3>
<ol>
<li>
<p>书写yaml切记在 <strong><code>:</code></strong> 后面要加一个空格</p>
</li>
<li>
<p>如果需要将多段yaml配置放在一个文件中，中间要使用 <strong><code>---</code></strong> 分隔</p>
</li>
<li>
<p><a href="https://www.json2yaml.com/convert-yaml-to-json" target="_blank" rel="noopener noreffer ">一个yaml转json的网站</a>，可以通过它验证yaml是否书写正确</p>
</li>
</ol>
</blockquote>
<h3 id="33-资源管理方式">3.3 资源管理方式</h3>
<ul>
<li>
<p><strong>命令式对象管理</strong>：直接使用命令去操作kubernetes资源</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl run nginx-pod --image<span class="o">=</span>nginx:1.17.1 --port<span class="o">=</span><span class="m">80</span> <span class="c1"># 很少直接用，顶多测试的时候用</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>命令式对象配置</strong>：通过命令配置和配置文件去操作kubernetes资源</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl create/patch -f nginx-pod.yaml				 <span class="c1"># 开发环境用</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>声明式对象配置</strong>：通过apply命令和配置文件去操作kubernetes资源</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl apply -f nginx-pod.yaml						 <span class="c1"># 支持目录操作，能直接应用整个目录下的YAML</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<table>
<thead>
<tr>
<th>类型</th>
<th>操作对象</th>
<th>适用环境</th>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody>
<tr>
<td>命令式对象管理</td>
<td>对象</td>
<td>测试</td>
<td>简单</td>
<td>只能操作活动对象，无法审计、跟踪</td>
</tr>
<tr>
<td>命令式对象配置</td>
<td>文件</td>
<td>开发</td>
<td>可以审计、跟踪</td>
<td>项目大时，配置文件多，操作麻烦</td>
</tr>
<tr>
<td>声明式对象配置</td>
<td>目录</td>
<td>开发</td>
<td>支持目录操作</td>
<td>意外情况下难以调试</td>
</tr>
</tbody>
</table>
<p>// TODO：https://gitee.com/yooome/golang/blob/main/k8s%E8%AF%A6%E7%BB%86%E6%95%99%E7%A8%8B-%E8%B0%83%E6%95%B4%E7%89%88/k8s%E8%AF%A6%E7%BB%86%E6%95%99%E7%A8%8B.md#3-%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 0001-01-01</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/15-kubernetes/index.md" target="_blank">Read Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://blog.seucy.me/15-kubernetes/" data-title=""><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://blog.seucy.me/15-kubernetes/"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="https://blog.seucy.me/15-kubernetes/" data-title=""><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="https://blog.seucy.me/15-kubernetes/" data-title=""><i data-svg-src="/lib/simple-icons/icons/line.min.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="https://blog.seucy.me/15-kubernetes/" data-title=""><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/16-docker/" class="prev" rel="prev" title=""><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i></a>
            <a href="/14-%E5%BE%AE%E6%9C%8D%E5%8A%A1/" class="next" rel="next" title=""><i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
<div id="comments"><div id="valine" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://valine.js.org/">Valine</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.115.1">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Chuyu</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/valine/valine.min.css"><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script type="text/javascript" src="/lib/valine/Valine.min.js"></script><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/mhchem.min.js"></script><script type="text/javascript" src="/lib/cookieconsent/cookieconsent.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{"valine":{"appId":"agUqGfsZRxSQL7fq0tYPH6Zp-MdYXbMMI","appKey":"2e9VDVO0nPzBiJqpzPN6kVPC","avatar":"mp","el":"#valine","emojiCDN":"https://cdn.jsdelivr.net/npm/emoji-datasource-google@14.0.0/img/google/64/","emojiMaps":{"100":"1f4af.png","alien":"1f47d.png","anger":"1f4a2.png","angry":"1f620.png","anguished":"1f627.png","astonished":"1f632.png","black_heart":"1f5a4.png","blue_heart":"1f499.png","blush":"1f60a.png","bomb":"1f4a3.png","boom":"1f4a5.png","broken_heart":"1f494.png","brown_heart":"1f90e.png","clown_face":"1f921.png","cold_face":"1f976.png","cold_sweat":"1f630.png","confounded":"1f616.png","confused":"1f615.png","cry":"1f622.png","crying_cat_face":"1f63f.png","cupid":"1f498.png","dash":"1f4a8.png","disappointed":"1f61e.png","disappointed_relieved":"1f625.png","dizzy":"1f4ab.png","dizzy_face":"1f635.png","drooling_face":"1f924.png","exploding_head":"1f92f.png","expressionless":"1f611.png","face_vomiting":"1f92e.png","face_with_cowboy_hat":"1f920.png","face_with_hand_over_mouth":"1f92d.png","face_with_head_bandage":"1f915.png","face_with_monocle":"1f9d0.png","face_with_raised_eyebrow":"1f928.png","face_with_rolling_eyes":"1f644.png","face_with_symbols_on_mouth":"1f92c.png","face_with_thermometer":"1f912.png","fearful":"1f628.png","flushed":"1f633.png","frowning":"1f626.png","ghost":"1f47b.png","gift_heart":"1f49d.png","green_heart":"1f49a.png","grimacing":"1f62c.png","grin":"1f601.png","grinning":"1f600.png","hankey":"1f4a9.png","hear_no_evil":"1f649.png","heart":"2764-fe0f.png","heart_decoration":"1f49f.png","heart_eyes":"1f60d.png","heart_eyes_cat":"1f63b.png","heartbeat":"1f493.png","heartpulse":"1f497.png","heavy_heart_exclamation_mark_ornament":"2763-fe0f.png","hole":"1f573-fe0f.png","hot_face":"1f975.png","hugging_face":"1f917.png","hushed":"1f62f.png","imp":"1f47f.png","innocent":"1f607.png","japanese_goblin":"1f47a.png","japanese_ogre":"1f479.png","joy":"1f602.png","joy_cat":"1f639.png","kiss":"1f48b.png","kissing":"1f617.png","kissing_cat":"1f63d.png","kissing_closed_eyes":"1f61a.png","kissing_heart":"1f618.png","kissing_smiling_eyes":"1f619.png","laughing":"1f606.png","left_speech_bubble":"1f5e8-fe0f.png","love_letter":"1f48c.png","lying_face":"1f925.png","mask":"1f637.png","money_mouth_face":"1f911.png","nauseated_face":"1f922.png","nerd_face":"1f913.png","neutral_face":"1f610.png","no_mouth":"1f636.png","open_mouth":"1f62e.png","orange_heart":"1f9e1.png","partying_face":"1f973.png","pensive":"1f614.png","persevere":"1f623.png","pleading_face":"1f97a.png","pouting_cat":"1f63e.png","purple_heart":"1f49c.png","rage":"1f621.png","relaxed":"263a-fe0f.png","relieved":"1f60c.png","revolving_hearts":"1f49e.png","right_anger_bubble":"1f5ef-fe0f.png","robot_face":"1f916.png","rolling_on_the_floor_laughing":"1f923.png","scream":"1f631.png","scream_cat":"1f640.png","see_no_evil":"1f648.png","shushing_face":"1f92b.png","skull":"1f480.png","skull_and_crossbones":"2620-fe0f.png","sleeping":"1f634.png","sleepy":"1f62a.png","slightly_frowning_face":"1f641.png","slightly_smiling_face":"1f642.png","smile":"1f604.png","smile_cat":"1f638.png","smiley":"1f603.png","smiley_cat":"1f63a.png","smiling_face_with_3_hearts":"1f970.png","smiling_imp":"1f608.png","smirk":"1f60f.png","smirk_cat":"1f63c.png","sneezing_face":"1f927.png","sob":"1f62d.png","space_invader":"1f47e.png","sparkling_heart":"1f496.png","speak_no_evil":"1f64a.png","speech_balloon":"1f4ac.png","star-struck":"1f929.png","stuck_out_tongue":"1f61b.png","stuck_out_tongue_closed_eyes":"1f61d.png","stuck_out_tongue_winking_eye":"1f61c.png","sunglasses":"1f60e.png","sweat":"1f613.png","sweat_drops":"1f4a6.png","sweat_smile":"1f605.png","thinking_face":"1f914.png","thought_balloon":"1f4ad.png","tired_face":"1f62b.png","triumph":"1f624.png","two_hearts":"1f495.png","unamused":"1f612.png","upside_down_face":"1f643.png","weary":"1f629.png","white_frowning_face":"2639-fe0f.png","white_heart":"1f90d.png","wink":"1f609.png","woozy_face":"1f974.png","worried":"1f61f.png","yawning_face":"1f971.png","yellow_heart":"1f49b.png","yum":"1f60b.png","zany_face":"1f92a.png","zipper_mouth_face":"1f910.png","zzz":"1f4a4.png"},"enableQQ":true,"highlight":true,"lang":"zh-CN","meta":["nick","mail","link"],"pageSize":10,"placeholder":"开始友好的交流吧~","recordIP":true,"serverURLs":"https://mukjinfv.api.lncldglobal.com","visitor":true}},"cookieconsent":{"content":{"dismiss":"Got it!","link":"Learn more","message":"This website uses Cookies to improve your experience."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
